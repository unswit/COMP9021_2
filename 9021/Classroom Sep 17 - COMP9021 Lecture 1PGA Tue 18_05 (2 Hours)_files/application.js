(function(){var t,a=[].slice;window.Echo={accessibility:{},core:{},helpers:{},routes:null!=(t=window.__routes__)?t.controllers:void 0,nav:{},pages:{accounts:{},admin:{captures:{filters:{}},configurations:{},courses:{},imports:{},institution:{},rooms:{},users:{},scheduling:{captureDayView:{}}},analytics:{},classroom:{},echoAdmin:{promoCodes:{}},home:{},legal:{},library:{},login:{},lti:{},pingone:{},questions:{},sectionContent:{},sectionHome:{},sectionSettings:{},settings:{},slideDecks:{},studyGuide:{},support:{},videos:{},zoom:{}},widgets:{accordion:{},activities:{creation:{},viewer:{},review:{}},captureModal:{},captures:{},createSection:{},csvUploads:{},departments:{},eventStore:{},lessonContent:{},media:{details:{}},notes:{},organizations:{},pubnub:{},questions:{},roomConfiguration:{},slideDeck:{},table:{},userEnrollmentModal:{},videoEditor:{},videoPlayer:{}}},Echo.sendToAirbrake=function(t,e){return"undefined"!=typeof airbrake&&null!==airbrake?airbrake.notify({error:{message:e},params:{data:t,location:window.location.toString(),userId:$('meta[name="userId"]').attr("content"),userAgent:navigator.userAgent}}):void 0},Echo.messages=function(){var t,e,i,o,n,s,r;if(s=arguments[0],i=2<=arguments.length?a.call(arguments,1):[],"undefined"==typeof __messages__||null===__messages__)return"n/a";if(null==(r=__messages__[s]))return Echo.sendToAirbrake({message:s},"no translation found for '"+s+"'"),s;for(e=o=0,n=i.length;o<n;e=++o)t=i[e],r=r.replace("{"+e+"}",t);return r},Echo.initializeWidgets=function(t){var e,i,o,n,s,r,a,h,l,c,u;for(h=[],i=0,n=(u=JSON.parse(t)).length;i<n;i++){for(c=(r=u[i])[0],l=r[1],e=Echo,o=0,s=(a=c.split(".")).length;o<s;o++)e=e[a[o]];h.push(new e(l))}return h},Echo.getPubnubHandle=function(){var t;return t=function(){var t;return t={publishKey:pubnubConfig.publishKey,subscribeKey:pubnubConfig.subscribeKey,cipherKey:pubnubConfig.cipherKey,ssl:!0,restore:!0},null!=pubnubConfig.authKey&&(t.authKey=pubnubConfig.authKey),new PubNub(t)},null==Echo.pubnubApi&&(Echo.pubnubApi=t()),Echo.pubnubApi}}).call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}};Echo.accessibility.Main=function(){function t(t){var e;e=t.suppressFirstTab,this.onFocusOut=i(this.onFocusOut,this),this.onFocusIn=i(this.onFocusIn,this),this.onKeyUp=i(this.onKeyUp,this),this.onKeyDown=i(this.onKeyDown,this),this.firstTabDone=!e,$("body").on("keydown",this.onKeyDown).on("keyup",this.onKeyUp).on("focusin",this.onFocusIn).on("focusout",this.onFocusOut)}return t.prototype.keydown=!1,t.prototype.onKeyDown=function(t){if(t.which===Echo.core.View.prototype.KEYS.TAB)return this.keydown=!0,document.activeElement!==$(t.target).get(0)||this.firstTabDone||(t.preventDefault(),this.checkIfSelectAndGetSelection(t.target).css("outline-width",2)),this.firstTabDone=!0},t.prototype.onKeyUp=function(t){if(t.which===Echo.core.View.prototype.KEYS.TAB)return this.keydown=!1},t.prototype.onFocusIn=function(t){var e;if(this.isControl(t.target))return e=!0===this.keydown?2:0,this.checkIfSelectAndGetSelection(t.target).css("outline-width",e)},t.prototype.onFocusOut=function(t){return this.checkIfSelectAndGetSelection(t.target).css("outline-width","")},t.prototype.isControl=function(t){return $(t).is('a, input, select, textarea, [contenteditable], button, [role="button"]')},t.prototype.checkIfSelectAndGetSelection=function(t){var e;return(e=$(t)).is("select")&&(e=e.siblings(".selection")),e},t}()}.call(this),function(){Echo.core.form={getData:function(t){var e,i,o,n,s,r,a,h;for(e={},o=0,n=(r=this.findFields(t)).length;o<n;o++)i=r[o],$(i).is(":disabled")||(s=(a=this.getFieldData(i))[0],h=a[1]),s&&this.shouldKeepValue(h,i)&&(e[s]=h);return e},getFieldData:function(t){var e;return(e=$(t)).is('fieldset[data-type="array"]')?this.getArrayData(e):e.is('fieldset[data-type="hash"]')?this.getHashData(e):e.is('fieldset[data-type="simpleArray"]')?this.getSimpleArrayData(e):e.is('fieldset[data-type="checkboxGroup"]')?this.getCheckboxGroupData(e):this.getInputData(e)},getCheckboxGroupData:function(t){var o,n,e;return e=t.data("name"),o=t.find('input[type="checkbox"]:checked'),[e,function(){var t,e,i;for(i=[],t=0,e=o.length;t<e;t++)n=o[t],i.push(this.getInputName($(n)));return i}.call(this)]},getSimpleArrayData:function(t){var e,i,o,n,s,r,a,h,l;for(s=t.data("name"),l=[],o=0,n=(r=this.findFields(t)).length;o<n;o++)e=r[o],i=(a=this.getFieldData(e))[0],h=a[1],i&&l.push(h);return[s,l.filter(this.shouldKeepValue)]},getArrayData:function(t){var e,i,o,n,s,r,a;for(r=t.data("name"),e=[],n=0,s=(i=t.find('fieldset[data-type="arrayElement"]')).length;n<s;n++)o=i[n],(a=this.getData(o))&&0!==Object.keys(a).length&&e.push(a);return[r,e]},getHashData:function(t){var e,i;return i=t.data("name"),e=this.getData(t),_.isEmpty(e)&&(e=null),[i,e]},getInputData:function(t){return[this.getInputName(t),this.getInputValue(t)]},getInputName:function(t){var e;return(e=t.attr("name"))&&(e=e.replace(/\[.*\]/,"")),"radio"===t.attr("type")&&!1===t.prop("checked")&&(e=null),e},getInputValue:function(t){var e;return e=$.trim(t.val()),"checkbox"===t.attr("type")&&(e=t.is(":checked")),"number"!==t.attr("type")&&"number"!==t.data("type")||""===e||(e=+e),"boolean"===t.data("type")&&(e="true"===e),null!=t.attr("contenteditable")&&(e=Echo.core.helpers.fixWhiteSpace(t.html())),e},findFields:function(t){var e,i,o,n,s;for(o=[],n=0,s=(i=$(t).children()).length;n<s;n++)e=i[n],$(e).is("input, textarea, select, button, fieldset, [contenteditable]")?o.push(e):o=o.concat(this.findFields(e));return o},findNestedField:function(t,e){var i,o,n,s,r,a;for((r=e.split(".")).shift(),i=r.pop(),a=$(t),o=0,n=r.length;o<n;o++)s=r[o],a=this.findObject(a,s);return"startTime"===i||"endTime"===i?a.find("[name='"+i+"Iso8601']"):a.find("[name='"+i+"'], [data-name='"+i+"']")},findObject:function(t,e){var i,o;return(o=e.match(/(.*)\[(.*)\]/))?(o[0],e=o[1],i=o[2],this.findArrayElement(t,e,i)):this.findHash(t,e)},findArray:function(t,e){return t.find("fieldset[data-type='array'][data-name='"+e+"']")},findArrayElement:function(t,e,i){return this.findArray(t,e).find("fieldset[data-type='arrayElement']").eq(i)},findHash:function(t,e){return t.find("fieldset[data-type='hash'][data-name='"+e+"']")},shouldKeepValue:function(t,e){return $(e).data("keep-value")||!(""===t||null===t)},getErrorJSON:function(t){var e,i,o;return null!=t&&null!=(e=t.responseJSON)&&null!=(i=e.data)&&null!=(o=i[0])?o.formErrors:void 0},onSubmitError:function(t,e,i,o){var n,s,r,a;if(null!=(null!=(n=null!=e?e.responseJSON:void 0)&&null!=(s=n.data)?s[0]:void 0)){if(a=this.processFormError(t,n.data[0].formErrors),null!=o&&t.trigger(o,n.data),null!=n.data[0].error&&!i.disableErrorAlert&&a)return alertify.error(n.data[0].error)}else if(null!=(null!=n&&null!=(r=n.data)?r[0]:void 0)&&t.trigger(o,null!=n?n.data:void 0),(null!=n?n.message:void 0)&&t.trigger(o,null!=n?n.message:void 0),!i.disableErrorAlert&&400!==e.status)return alertify.error(Echo.messages(i.errorAlertMessage))},processFormError:function(t,e){var i,o,n,s;for(o in i=0,e)s=e[o],n=Echo.core.form.findNestedField(t,o),this.fieldIsVisible(n)||(n=n.closest("div:visible")),0<n.length&&(i+=1,n.trigger("Input.setError",Echo.messages(s[0].msg,s[0].args)));return i},fieldIsVisible:function(t){return 0<t.length&&(null==t.attr("type")||"hidden"!==t.attr("type"))}}}.call(this),function(){Echo.core.helpers={htmlRegex:/(<([^>]+)>)/gi,emailFormat:/^.+@.+\..+$/,alphabets:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",fixWhiteSpace:function(t){return t.replace(/&nbsp;/g," ").trim()},getRRuleFromEvent:function(t){var e,i;try{return i=t.rruleString.replace(/^RRULE:/,""),(e=RRule.parseString(i)).dtstart=this.getDateFromISODateString(t.startDate,t.startTime),e.until&&e.until.setHours(0),new RRule(e)}catch(t){}},getDateFromISODateTimeString:function(t){var e,i,o;return e=(i=t.split("T"))[0],o=i[1],this.getDateFromISODateString(e,o)},getDateFromISODateString:function(t,e){var i,o,n,s,r,a,h;return null==e&&(e=null),h=(r=_.map(t.split("-"),function(t){return parseInt(t,10)}))[0],s=r[1],i=r[2],null!=e?(o=(a=_.map(e.split(":"),function(t){return parseInt(t,10)}))[0],n=a[1],new Date(h,s-1,i,o,n)):new Date(h,s-1,i)},getDateFromUtcOffsetHours:function(t){var e,i;return i=t-(e=new Date).getTimezoneOffset()/-60,e.setTime(e.getTime()+60*i*60*1e3),e},getTimeStringFromSeconds:function(t){var e,i,o,n;return t=Echo.core.helpers.clamp(t||0,{min:0,max:359999}),e=(o=this.expandSecondsToHoursMinutesSeconds(t))[0],i=o[1],n=o[2],this.padNumber(e)+":"+this.padNumber(i)+":"+this.padNumber(n)},getFormattedMonthFromNum:function(t,e){var i;return null==e&&(e=!0),i=["january","february","march","april","may","june","july","august","september","october","november","december"],e?Echo.messages("ViewHelpers.monthNumToShortMonthName."+i[t]):Echo.messages("ViewHelpers.monthNumToMonthName."+i[t])},expandSecondsToHoursMinutesSeconds:function(t){var e;return e=Math.floor(t/3600),t%=3600,[e,Math.floor(t/60),t%=60]},getFocusableElements:function(t){return $(["a[href]","area[href]","input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","*[tabindex]","*[contenteditable]"].join(),t)},getISODateStringFromDate:function(t){var e,i,o;return e=t.getDate(),i=t.getMonth()+1,o=t.getFullYear(),this.getISODateStringFromYMD({year:o,month:i,day:e})},getISODateStringFromYMD:function(t){var e,i,o;return o=t.year,i=t.month,e=t.day,o+"-"+(i=this.padNumber(i))+"-"+(e=this.padNumber(e))},getYMDFromDate:function(t){return this.getYMDFromISODateString(t.toISOString())},getYMDFromISODateString:function(t){var e;return{year:(e=_.map(t.split("-"),function(t){return parseInt(t,10)}))[0],month:e[1],day:e[2]}},minimalDifference:function(t,e){return Math.abs(t-e)<Math.pow(10,-6)},monthsDifferent:function(t,e){var i,o;return i=this.getYMDFromISODateString(t),o=this.getYMDFromISODateString(e),i.month!==o.month},padNumber:function(t,e){var i;for(null==e&&(e=2),i=t.toString();i.length<e;)i="0"+i;return i},uuid:function(){return"rxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e;return e=16*Math.random()|0,("x"===t?e:3&e|8).toString(16)})},replaceIds:function(o){return o.find("[id]").each(function(){var t,e,i;return e=$(this).attr("id"),t=Echo.core.helpers.uuid(),i=new RegExp(e,"g"),o.html(o.html().replace(i,t))}),o},timeToMs:function(t){var e,i;return""===t?"":(e=0,(i=t.split(":")).length&&(e+=1e3*+i.pop()),i.length&&(e+=6e4*+i.pop()),i.length&&(e+=36e5*+i.pop()),e)},msToTime:function(t,e){var i,o,n,s,r,a,h,l;return null==e&&(e={}),o=(h=((h=((h=(t-(n=t%1e3))/1e3)-(l=h%60))/60)-(s=h%60))/60)%60,r=null!=e.optionalPadding&&0===o?1:2,i=null!=e.optionalPadding?1:2,a=this.padNumber(s,r)+":"+this.padNumber(l),0===o&&e.hideZeroHours||1===r||(a=this.padNumber(o,i)+":"+a),a=a.replace(/^0(\d)/,"$1"),0!==n&&e.showMilliseconds?a+"."+Math.round(n):a},stripHtml:function(t){return t.replace(this.htmlRegex,"")},padZero:function(t,e){var i,o,n;for(n="0",i=1,o=e;1<=o?i<=o:o<=i;1<=o?++i:--i)n+="0";return(n+t).slice(-1*e)},preloadImage:function(t,e){var i;return(i=$("<img>"))[0].onload=e,i[0].src=t},postpone:function(t){return setTimeout(t,0)},canPlayH264:function(t){var e;e="";try{null!=t.canPlayType&&(e=t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""))}catch(t){}return 0<e.length},canPlayMP3:function(t){var e;e="";try{null!=t.canPlayType&&(e=t.canPlayType('audio/mp4; codecs="mp4a.40.5""').replace(/^no$/,""))}catch(t){}return 0<e.length},clamp:function(t,e){var i,o,n;return o=(n=null!=e?e:{}).min,i=n.max,null!=o&&t<o?o:null!=i&&i<t?i:t},onContentEditableChange:function(){return this.textContent?this.setAttribute("data-div-placeholder-content","true"):this.removeAttribute("data-div-placeholder-content")},getThumbnailImage:function(t,e){var i,o,n;if(null!=t){for(i=0,e=Math.floor(e/1e3),o=+t.timesInSeconds[i];t.timesInSeconds[i]<=e;)o=+t.timesInSeconds[i],i++;return n=Math.abs(e-o)>Math.abs(e-t.timesInSeconds[i])?t.timesInSeconds[i]:o,t.baseUri.replace(/\/$/,"")+"/"+n+"."+t.extension}},numToAlpha:function(t){if(!(t<0))return t<26?this.alphabets[t]:this.alphabets[Math.floor(t/26)]+this.alphabets[t%26]},getTooltip:function(t,e,i,o){return null==t&&(t=""),null==e&&(e=""),null==i&&(i=""),null==o&&(o=""),Echo.widgets.Tooltip.prototype.generateTooltip(t,e,i,o)},centerElementAtPosition:function(t,e){var i,o;if(null==e&&(e=null),1,null===e&&null!==t.position().left&&(e=t.position().left),i=e-(o=t.width())/2,t.css("left",i),1<Math.abs(t.width()-o))return this.centerElementAtPosition(t,e)},hideTooltip:function(t){return Echo.widgets.Tooltip.prototype.hide(t)}}}.call(this),function(){Echo.core.ValidationHelpers={validTimeFormat:function(t){var e,i,o,n,s;return!!/^(\d?\d\:)?\d?\d\:\d\d$/.test(t)&&(s=(n=t.split(":").reverse())[0],o=n[1],i=null==(e=n[2])||Echo.core.ValidationHelpers.validHours(+e),Echo.core.ValidationHelpers.validSecondsMinutes(+s)&&Echo.core.ValidationHelpers.validSecondsMinutes(+o)&&i)},validSecondsMinutes:function(t){return 0<=t&&t<=59},validHours:function(t){return 0<=t&&t<=23},validateSlideReference:function(t,e){var i;return t=Number(t),(i=isNaN(t)?"notANumber":t<=0?"lessThanOrEqualToZero":e<t?"greaterThanMax":void 0)&&alertify.error(Echo.messages("Errors.slideNum."+i)),!i},validateVideoReference:function(t,e){var i;return(i=this.validTimeFormat(t)?Echo.core.helpers.timeToMs(t)>e?"greaterThanMax":void 0:"notTime")&&alertify.error(Echo.messages("Errors.videoOffset."+i)),!i},validatePublishModal:function(t,e,i,o,n){var s,r,a;if(t){for(s=0,r=(a=[e,i,o]).length;s<r;s++)if(!a[s])return alertify.error(Echo.messages("error.path.missing")),!1;return!(!Echo.core.ValidationHelpers.validHours(i)||!Echo.core.ValidationHelpers.validSecondsMinutes(o))||(alertify.error(Echo.messages("Errors.invalidFormEntries")),!1)}return!(!n||n.trim().length<1)||(alertify.error(Echo.messages("Errors.lessonNeedsNameOrDateTime")),!1)},validateTimeDuration:function(t,e){return isNaN(t)&&isNaN(e)?{hoursError:!0,minutesError:!0,valid:!1}:isNaN(e)?{hoursError:!1,minutesError:!0,valid:!1,message:Echo.messages("Widgets.timeDuration.error.minutes.invalid")}:isNaN(t)?{hoursError:!0,minutesError:!1,valid:!1,message:Echo.messages("Widgets.timeDuration.error.hours.invalid")}:t<0?{hoursError:!0,minutesError:!1,valid:!1,message:Echo.messages("Widgets.timeDuration.error.notnegative")}:e<0?{hoursError:!1,minutesError:!0,valid:!1,message:Echo.messages("Widgets.timeDuration.error.notnegative")}:t%1!=0?{hoursError:!0,minutesError:!1,valid:!1,message:Echo.messages("Widgets.timeDuration.error.notwhole")}:e%1!=0?{hoursError:!1,minutesError:!0,valid:!1,message:Echo.messages("Widgets.timeDuration.error.notwhole")}:0===t&&0===e?{hoursError:!0,minutesError:!0,valid:!1,message:Echo.messages("Widgets.timeDuration.error.notzero")}:{hoursError:!1,minutesError:!1,valid:!0}},validateTimeSelect:function(t,e,i,o){return t=i?Echo.core.ValidationHelpers.validHours(t)?t:NaN:1<=t&&t<=12?t:NaN,i||(t%=12,"pm"===o&&(t+=12)),e=Echo.core.ValidationHelpers.validSecondsMinutes(e)?e:NaN,!isNaN(t)&&!isNaN(e)}}}.call(this),function(){var o=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,s=[].slice;Echo.core.View=function(t){function i(t){var e;this.subscribeTo=o(this.subscribeTo,this),this.createFakeInput=o(this.createFakeInput,this),this.onAddedToClipboard=o(this.onAddedToClipboard,this),this.onError=o(this.onError,this),this.pageRefresh=o(this.pageRefresh,this),this.replaceContent=o(this.replaceContent,this),this.triggerUpdate=o(this.triggerUpdate,this),this.setUpdateTimer=o(this.setUpdateTimer,this),this.clearErrors=o(this.clearErrors,this),this.buildUrl=o(this.buildUrl,this),this.loadingOff=o(this.loadingOff,this),this.loadingOn=o(this.loadingOn,this),this.onInjectFromUrlError=o(this.onInjectFromUrlError,this),this.onInjectComplete=o(this.onInjectComplete,this),this.dispose=o(this.dispose,this),this.removeGlobalListeners=o(this.removeGlobalListeners,this),this.addGlobalListeners=o(this.addGlobalListeners,this),this.removeBodyListeners=o(this.removeBodyListeners,this),this.addBodyListeners=o(this.addBodyListeners,this),this.bodyListeners=o(this.bodyListeners,this),this.removeDocListeners=o(this.removeDocListeners,this),this.addDocListeners=o(this.addDocListeners,this),this.docListeners=o(this.docListeners,this),(this.options=t).namespace&&(this.namespace=t.namespace),this.$doc=$(document),this.$body=$(document.body),this.addGlobalListeners(),this.templateId&&(e=$("#"+this.templateId).html(),this.template=_.template(e)),i.__super__.constructor.apply(this,arguments),this.$el.on("loading.on",this.loadingOn).on("loading.off",this.loadingOff).on("replaceContent",this.replaceContent)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Backbone.View),i.prototype.KEYS={ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,B:66,BACKSPACE:8,CONTROL:17,END:35,ENTER:13,ESC:27,HOME:36,PAGE_UP:33,PAGE_DOWN:34,SHIFT:16,SPACE_BAR:32,TAB:9},i.prototype.embedlyKey="b9c0511e7d564707bee1438331d9efbd",i.prototype.loadingOptions={theme:"dark",opacity:"transparent",fixed:!1},i.prototype.updateInterval=3e4,i.prototype.initialize=function(){return this.render()},i.prototype.$=function(t){return this.$el.find(t)},i.prototype.log=function(t){return Airbrake.push({error:{message:t},params:{location:window.location.toString(),userId:$('meta[name="userId"]').attr("content"),userAgent:navigator.userAgent}})},i.prototype.getOffsetX=function(t){var e;return null==t.offsetX&&(t.offsetX=t.layerX),null!=t.offsetX?t.offsetX:t.offsetX=null!=(e=t.originalEvent)?e.layerX:void 0},i.prototype.getOffsetY=function(t){var e;return null==t.offsetY&&(t.offsetY=t.layerY),null!=t.offsetY?t.offsetY:t.offsetY=null!=(e=t.originalEvent)?e.layerY:void 0},i.prototype.ajax=function(t,e){return(e=$.extend({data:{}},e)).data=JSON.stringify(e.data),e.contentType="application/json",t.ajax(e)},i.prototype.onEvent=function(t,e){return $(document).on(t,e)},i.prototype.docListeners=function(){return{}},i.prototype.addDocListeners=function(){var t,e,i,o;for(t in o=[],i=this.docListeners())e=i[t],o.push(this.$doc.on(t,e));return o},i.prototype.removeDocListeners=function(){var t,e,i,o;for(t in o=[],i=this.docListeners())e=i[t],o.push(this.$doc.off(t,e));return o},i.prototype.bodyListeners=function(){return{}},i.prototype.addBodyListeners=function(){var t,e,i,o;for(t in o=[],i=this.bodyListeners())e=i[t],o.push(this.$body.on(t,e));return o},i.prototype.removeBodyListeners=function(){var t,e,i,o;for(t in o=[],i=this.bodyListeners())e=i[t],o.push(this.$body.off(t,e));return o},i.prototype.addGlobalListeners=function(){return this.addDocListeners(),this.addBodyListeners()},i.prototype.removeGlobalListeners=function(){return this.removeDocListeners(),this.removeBodyListeners()},i.prototype.confirm=function(t,e,i){return alertify.confirm(this.i18n(t),function(t){return t?"function"==typeof e?e():void 0:"function"==typeof i?i():void 0})},i.prototype.confirmMultiple=function(t,e,i){return alertify.confirm(t,function(t){return t?"function"==typeof e?e():void 0:"function"==typeof i?i():void 0})},i.prototype.confirmHtml=function(t,e,i){return alertify.confirm($(t).html(),function(t){return t?"function"==typeof e?e():void 0:"function"==typeof i?i():void 0})},i.prototype.prompt=function(t,e,i,o){var n;return n=function(t,e){return t?"function"==typeof i?i(e):void 0:"function"==typeof o?o():void 0},alertify.prompt(t,n,e)},i.prototype.confirmationPrompt=function(t,e,i,o,n,s){var r,a;return a=function(t){return t===i?"function"==typeof n?n():void 0:(null!=o&&alertify.error(o),"function"==typeof s?s():void 0)},r=t+"<br>"+this.i18n("Alertify.promptConfirmation",i),this.prompt(r,e,a,s)},i.prototype.dispose=function(){return this.undelegateEvents(),this.removeGlobalListeners(),this.$el.removeData().unbind(),this.$el.off(),this.remove()},i.prototype.i18n=function(){var t,e;return e=arguments[0],t=2<=arguments.length?s.call(arguments,1):[],Echo.messages.apply(Echo,[e].concat(s.call(t)))},i.prototype.getMonthNames=function(t){var e,i,o,n,s;for(null==t&&(t="ViewHelpers.monthNumToMonthName"),s=[],e=0,i=(n=["january","february","march","april","may","june","july","august","september","october","november","december"]).length;e<i;e++)o=n[e],s.push(this.i18n(t+"."+o));return s},i.prototype.getShortMonthNames=function(){return this.getMonthNames("ViewHelpers.monthNumToShortMonthName")},i.prototype.namespacedEventName=function(t,e){var i;return i=t,this.namespace&&(i+="."+this.namespace),i+"."+e},i.prototype.request=function(t,i){return this.$el.one("Response."+t,function(t,e){return i(e)}),this.$body.trigger("Request."+t,{respondTo:this.$el})},i.prototype.respondTo=function(i,o){return this.$body.on("Request."+i,function(t,e){return e.respondTo.trigger("Response."+i,o())})},i.prototype.stopPropagation=function(t){return t.stopPropagation()},i.prototype.preventDefault=function(t){return t.preventDefault()},i.prototype.linkify=function(r){var i;return i=function(t){var e,i,o,n,s;if(o=/(\b(http[s]?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])(?![^<>]*>)/gim,n=/(^|[^\/])(www\.[\S]+(\b|$))(?![^<>]*>)/gim,s=/(\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,6})(?![^<>]*>)/gim,void 0===$(t).html()||$(t).hasClass("link")){if(o.test(t.nodeValue)||n.test(t.nodeValue)||s.test(t.nodeValue))return e=t.nodeValue.replace(o,'<a href="$1" target="_blank" class="link">$1</a>').replace(n,'$1<a href="http://$2" target="_blank" class="link">http://$2</a>').replace(s,'<a href="mailto:$1" class="link">$1</a>'),$(t).remove(),0<$(r).children().length?$(r).children().first().before($.parseHTML(e)):o.test(e)||n.test(e)||s.test(e)?$(r).html($.parseHTML(e)):$(r).html(e)}else if(i=$(t).html(),o.test(i)||n.test(i)||s.test(i))return e=i.replace(o,'<a href="$1" target="_blank" class="link">$1</a>').replace(n,'$1<a href="http://$2" target="_blank" class="link">http://$2</a>').replace(s,'<a href="mailto:$1" class="link">$1</a>'),$(t).html(e)},r[0].firstChild&&"#text"===r[0].firstChild.nodeName&&i(r[0].firstChild),$.each($(r).find("*"),function(t,e){return i(e)})},i.prototype.embedify=function(){return setTimeout((t=this,function(){return t.$el.trigger("Embedifier.embedify",500)}));var t},i.prototype.hasBottomOverflow=function(t,e){return t+$(e).outerHeight()>=$(document).height()},i.prototype.hasRightOverflow=function(t,e){return t+$(e).outerWidth()>=$(document).width()},i.prototype.fetch=function(t,e,i,o,n){return null==o&&(o=!1),null==n&&(n="fetch"),$.ajax({url:t,type:"GET",crossDomain:o,timeout:1e4,success:i,xhrFields:{withCredentials:!0},error:(s=this,function(){return alertify.error(s.i18n(null!=e?e:"Errors.errorLoadingFile",t)),s.$el.trigger("View."+n+".error")})});var s},i.prototype.injectFromUrl=function(t,e,i){var o,n,s;return this.loadingOn(),o={url:t,success:(s=this,function(t){return s.onInjectFromUrlSuccess(t,e)}),error:null!=i?i:this.onInjectFromUrlError,complete:this.onInjectComplete},(null!=(n=t.ajax)?n:$.ajax)(o)},i.prototype.onInjectComplete=function(){return this.loadingOff()},i.prototype.onInjectFromUrlSuccess=function(t,e){return(null!=e?$(e):this.$body).append(t.data[0].html)},i.prototype.onInjectFromUrlError=function(){return alertify.error(this.i18n("Alert.genericError"))},i.prototype.loadingOn=function(t,e){var i,o,n;return null!=t&&t.stopPropagation(),i=this.getLoadingElement(e),n=this.$el,(null!=e?e.selector:void 0)&&(n=n.find(e.selector)),this.loadingOff(),n.addClass("loading").append(i),n.find(".loading-background").clearQueue().fadeIn(null!=(o=null!=e?e.timeout:void 0)?o:300,function(){return null!=e&&"function"==typeof e.callback?e.callback():void 0})},i.prototype.loadingOff=function(t,e){var i,o;return null!=t&&"function"==typeof t.stopPropagation&&t.stopPropagation(),o=this.$el,(null!=e?e.selector:void 0)&&(o=o.find(e.selector)),o.removeClass("loading").find(".loading-background").clearQueue().fadeOut(null!=(i=null!=e?e.timeout:void 0)?i:300,function(){return $(this).remove(),null!=e&&"function"==typeof e.callback?e.callback():void 0})},i.prototype.loadingTmpl=_.template("<div class='loading-background <%=cssClasses%>' aria-label='loading'> <div class='loading'> <div class='loading-group'> <span></span> <span></span> <span></span> </div> </div> </div>"),i.prototype.loadingHtml=function(t){return null==t&&(t=""),this.loadingTmpl({cssClasses:t})},i.prototype.getLoadingElement=function(t){var e;return $.extend(this.loadingOptions,t),e=[this.loadingOptions.theme,this.loadingOptions.opacity],this.loadingOptions.fixed&&e.push("fixed"),$(this.loadingHtml(e.join(" ")))},i.prototype.buildUrl=function(t,e){var i;return null==e&&(e=!1),i="https://api.embed.ly/1/oembed?key="+this.embedlyKey+"&secure=true&urls="+t.map(escape).join(","),e?i+"&frame=true":i},i.prototype.fetchEmbedlyContent=function(i,e,t){return null==t&&(t=!1),$.ajax({url:this.buildUrl(i,t),dataType:"json",success:function(t){return e(t.filter(function(t){return"error"!==t.type}).map(function(t,e){return t.original_url=i[e],"photo"===t.type&&null==t.thumbnail_url&&(t.thumbnail_url=i[e]),t}))}})},i.prototype.disableOptions=function(t){return $(t).addClass("disabled").find("input").attr("disabled",!0)},i.prototype.enableOptions=function(t){return $(t).removeClass("disabled").find("input").attr("disabled",!1)},i.prototype.tabbableInputs="a, input, select, textarea, div[contenteditable], button",i.prototype.disableTabbing=function(t){return this.$(null!=t?t:this.tabbableInputs).attr("tabindex","-1")},i.prototype.enableTabbing=function(t){return this.$(null!=t?t:this.tabbableInputs).attr("tabindex","0")},i.prototype.clearErrors=function(){return this.$("input, textarea, div[contenteditable]").trigger("Input.clearError")},i.prototype.setUpdateTimer=function(){return null!=this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(this.triggerUpdate,this.updateInterval)},i.prototype.triggerUpdate=function(){return this.$el.trigger("Content.update")},i.prototype.replaceContent=function(t,e){return t.stopPropagation(),this.$el.after(e),this.afterRespawn(),this.dispose()},i.prototype.afterRespawn=function(){},i.prototype.pageRefresh=function(t){return null!=t?window.location=t:window.location.reload()},i.prototype.onError=function(){return alertify.error(this.i18n("Alert.genericError"))},i.prototype.setupClipboard=function(t){var e,i,o,n;if((e=t?$(t):this.$el).attr("data-clipboard-text")||e.attr("data-clipboard-target"))return i=new Clipboard(e.get(0)),o=e.attr("data-clipboard-desc"),i.on("success",(n=this,function(t){return n.onAddedToClipboard(o,t)}))},i.prototype.onAddedToClipboard=function(t,e){return null!=e&&e.clearSelection(),t?alertify.success(this.i18n("Clipboard.copied",t)):alertify.success(this.i18n("Clipboard.copiedGeneric"))},i.prototype.createFakeInput=function(){var t;return(t=$('<input type="text"></input>')).css({position:"absolute",left:-1e4}),this.$el.append(t),t},i.prototype.focusFirstInput=function(){var t;if(0===this.$firstInput.length)return this.$fakeInput.focus();this.$firstInput.focus();try{if(("text"===(t=this.$firstInput.attr("type"))||"textarea"===t||"date"===t)&&null!=this.$firstInput[0].firstChild)return this.$firstInput.caret(-1)}catch(t){t}},i.prototype.sendToAirbrake=function(t,e){return Echo.sendToAirbrake(t,e)},i.prototype.createToolTip=function(t,e,i,o,n,s,r){var a;return null==e&&(e=""),null==i&&(i=""),null==o&&(o=""),null==n&&(n="top"),null==s&&(s=null),null==r&&(r=!1),"function"==typeof t.append&&(a=Echo.core.helpers.getTooltip(e,i,o,n),t.append(a),a.fadeIn(Echo.widgets.Tooltip.prototype.transitionDelay)),!1!==r?Echo.core.helpers.centerElementAtPosition(a,s):null!==s?"last"===i?(a.css("left","auto"),a.css("right",s)):a.css("left",s):void 0},i.prototype.hideTooltip=function(t){var e;if("function"==typeof t.find&&(e=t.find(".tooltip")).length)return Echo.core.helpers.hideTooltip(e)},i.prototype.subscribeTo=function(o,n){var t,s;return(t=Echo.getPubnubHandle()).addListener({message:(s=this,function(e){var t,i;try{if(t=JSON.parse(e.message),e.channel!==o)return;return n(t)}catch(t){return i=t,s.sendToAirbrake(i,e)}})}),t.subscribe({channels:[o]})},i.prototype.encodeHTML=function(t){return $("<div>").text(t).html()},i.prototype.decodeHTML=function(t){return $("<div>").html(t).text()},i}()}.call(this),function(){Echo.helpers.Layout={fitDimensions:function(t,e,i,o,n){var s,r;return r=e,-1===o&&-1===n?(r=e,s=i):null!=t?(s=e/t,t<e/i&&(r=i*t,s=i)):r=1.333*(s=i),[r,s]},isHeightLimiting:function(t,e,i){return e/i>t.aspectRatio}}}.call(this),function(){Echo.helpers.Location={parseHash:function(){var t,e,i,o,n,s,r,a;for(t={},e=0,n=(i=window.location.hash.replace("#","").split("&")).length;e<n;e++)o=(s=i[e].split("="))[0],a=s[1],(null!=o?o.length:void 0)&&(null!=a?a.length:void 0)&&(a=(r=[decodeURIComponent(o),decodeURIComponent(a.replace("+"," "))])[1],"true"!==(t[o=r[0]]=a)&&"false"!==a||(t[o]="true"===a));return t},upsertHash:function(t){var e,i,o,n,s;for(e=Echo.helpers.Location.parseHash(),i=0,s=(o=Object.keys(t)).length;i<s;i++)e[n=o[i]]=t[n];return Echo.helpers.Location.updateHash(e)},updateHash:function(t){return window.location.hash=$.param(t)}}}.call(this),function(){Echo.helpers.Payment={types:[{niceType:"Visa",type:"visa",pattern:"^4\\d*$",gaps:[4,8,12],lengths:[16],code:{name:"CVV",size:3}},{niceType:"MasterCard",type:"master-card",pattern:"^5([1-5]\\d*)?$",gaps:[4,8,12],lengths:[16],code:{name:"CVC",size:3}},{niceType:"American Express",type:"american-express",pattern:"^3([47]\\d*)?$",isAmex:!0,gaps:[4,10],lengths:[15],code:{name:"CID",size:4}},{niceType:"DinersClub",type:"diners-club",pattern:"^3((0([0-5]\\d*)?)|[689]\\d*)?$",gaps:[4,10],lengths:[14],code:{name:"CVV",size:3}},{niceType:"Discover",type:"discover",pattern:"^6(0|01|011\\d*|5\\d*|4|4[4-9]\\d*)?$",gaps:[4,8,12],lengths:[16],code:{name:"CID",size:3}},{niceType:"JCB",type:"jcb",pattern:"^((2|21|213|2131\\d*)|(1|18|180|1800\\d*)|(3|35\\d*))$",gaps:[4,8,12],lengths:[16],code:{name:"CVV",size:3}},{niceType:"UnionPay",type:"unionpay",pattern:"^6(2\\d*)?$",gaps:[4,8,12],lengths:[16,17,18,19],code:{name:"CVN",size:3}},{niceType:"Maestro",type:"maestro",pattern:"^((5((0|[6-9])\\d*)?)|(6|6[37]\\d*))$",gaps:[4,8,12],lengths:[12,13,14,15,16,17,18,19],code:{name:"CVC",size:3}}],getCardType:function(t){var e,i,o,n,s;for(s=[],i=0,o=(n=Echo.helpers.Payment.types).length;i<o;i++)e=n[i],RegExp(e.pattern).test(t)&&s.push(e);return s}}}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.LTIProfileForm=function(t){var e;function i(){var t,e;return this.render=(t=this.render,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),e=function(t){return"#"+t.toLowerCase()+"FormTmpl"},i.prototype.render=function(){return this.formId=e($("#lmsConsumer").val()),this.$el.html($(this.formId).html())},i.prototype.initialize=function(){return this.render(),$("#lmsConsumer").on("change",this.render)},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.ChangeRoleModal=function(t){function i(){var t,e;return this.onInstitutionChange=(t=this.onInstitutionChange,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){return this.roleOptions=t.roleOptions,this.$roleSelect=this.$(".role-select"),this.$el.on("ChangeRoleModal.institutionChange",this.onInstitutionChange)},i.prototype.onInstitutionChange=function(t,e){return this.$roleSelect.trigger("Select.updateOptions",{options:this.roleOptions[e]})},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.UserDropdownPanel=function(t){function e(){return this.onLoadError=i(this.onLoadError,this),this.onLoadSuccess=i(this.onLoadSuccess,this),this.onChangeRole=i(this.onChangeRole,this),this.clearSessionStorage=i(this.clearSessionStorage,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$body.on("UserDropdownPanel.changeRole.open",this.onChangeRole),this.$button=this.$(".logout"),this.$button.on("click",this.clearSessionStorage)},e.prototype.clearSessionStorage=function(){var t,e,i,o,n;for(n=[],t=0,i=(o=["sectionCollection","mediaCollection","librarySelectedTab","userIdentifier"]).length;t<i;t++)e=o[t],n.push(window.sessionStorage.removeItem(e));return n},e.prototype.onChangeRole=function(){return this.injectFromUrl(Echo.routes.Authentication.changeRoleForm())},e.prototype.onLoadSuccess=function(t){return this.$el.trigger("Modal.changeRoleModal.replaceContent",t)},e.prototype.onLoadError=function(){return this.$el.trigger("Modal.changeRoleModal.close"),alertify.error(this.i18n("Alert.genericError"))},e}()}.call(this),function(){var t;t=function(t){this.$el=$(t),this.$tableHeaderCols=this.$el.find("thead th"),this.$tableContent=this.$el.find("tbody"),this.$el.attr("aria-live","polite").attr("aria-relevant","all"),this.$tableHeaderCols.attr("scope","col"),this.$tableContent.find("th").attr("scope","row"),this.$tableContent.keyboardFocusable("tr")},$.fn.accessibleTable=function(){return this.each(function(){return new t(this)})}}.call(this),function(){$.fn.caret=function(n){var t,e,i,s,o,r;if(null!=(r=this[0]))return s="true"===r.contentEditable,i=function(){return null!=window.getSelection?t():null!=document.selection?e():0},t=function(){var t,e;return s?(r.focus(),(e=(t=window.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(r),e.setEnd(t.endContainer,t.endOffset),e.toString().length):r.selectionStart},e=function(){var t,e,i,o;if(r.focus(),s)return i=document.selection.createRange(),(o=document.body.createTextRange()).moveToElementText(r),o.setEndPoint("EndToEnd",i),o.text.length;for(n=0,e=r.createTextRange(),t=(o=document.selection.createRange().duplicate()).getBookmark(),e.moveToBookmark(t);0!==e.moveStart("character",-1);)n++;return n},null==n?i():(-1===n&&(n=this[s?"text":"val"]().length),window.getSelection?s?(r.focus(),window.getSelection().collapse(r.firstChild,n)):r.setSelectionRange(n,n):null!=document.body.createTextRange&&((o=document.body.createTextRange()).moveToElementText(r),o.moveStart("character",n),o.collapse(!0),o.select()),s||r.focus(),n)}}.call(this),function(){var e;e=function(){function t(t,e){this.$el=$(t),this.$el.on("focusin",e,this.onFocusIn).on("focusout",e,this.onFocusOut),this.$tabbable=e?this.$el.find(e):this.$el,this.$tabbable.attr("tabindex","0")}return t.prototype.onFocusIn=function(){return $(this).addClass("focus")},t.prototype.onFocusOut=function(){return $(this).removeClass("focus")},t}(),$.fn.keyboardFocusable=function(t){return null==t&&(t=null),this.each(function(){return new e(this,t)})}}.call(this),function(){jQuery.fn.extend({value:function(){var t;return null!=(t=this.val())&&""!==t?t:null}})}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.AddableSelect=function(t){function e(){return this.onItemSelected=i(this.onItemSelected,this),this.onAddSelected=i(this.onAddSelected,this),this.onNoneSelected=i(this.onNoneSelected,this),this.onSelectChange=i(this.onSelectChange,this),this.onCancel=i(this.onCancel,this),this.onCreateSuccess=i(this.onCreateSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$addActionDiv=this.$(".addable-select-action-add"),this.$cancelButton=this.$(".cancel"),this.$selectWrapper=this.$(".addable-select-selector .select2-wrapper"),this.$select=this.$selectWrapper.find("select"),this.noneSelected="addable_select_none_selected",this.addSelected="addable_select_action_add",this.selectedVal=this.noneSelected,this.$cancelButton.on("click",this.onCancel),this.$el.on("AjaxForm.addableSelect.success",this.onCreateSuccess).on("AddableSelect.deselect",this.onCancel).on("AddableSelect.select.change",this.onSelectChange)},e.prototype.setValue=function(t){return this.$selectWrapper.find("select").val(t).trigger("change")},e.prototype.onCreateSuccess=function(t,e){return this.$select.append($("<option>").val(e.id).text(e.name)),this.setValue(e.id)},e.prototype.onCancel=function(t){return t.preventDefault(),this.setValue(this.noneSelected)},e.prototype.onSelectChange=function(t,e){switch(this.selectedVal=e,this.selectedVal){case this.noneSelected:return this.onNoneSelected();case this.addSelected:return this.onAddSelected();default:return this.onItemSelected()}},e.prototype.showAddActionDiv=function(){return this.$addActionDiv.slideDown()},e.prototype.hideAddActionDiv=function(){return this.$addActionDiv.slideUp()},e.prototype.onNoneSelected=function(){return this.$el.trigger("AddableSelect.deselected"),this.hideAddActionDiv()},e.prototype.onAddSelected=function(){return this.$el.trigger("AddableSelect.deselected"),this.showAddActionDiv()},e.prototype.onItemSelected=function(){return this.$el.trigger("AddableSelect.selected",this.selectedVal),this.hideAddActionDiv()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.AdminListItem=function(t){function e(){return this.onParentClick=i(this.onParentClick,this),this.onClick=i(this.onClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.clickData=t.clickData,this.disabled=t.disabled,this.$children=this.$(".adminListItem-children"),this.$el.on("click",".viewToggle",this.onParentClick).on("click",this.onClick)},e.prototype.onClick=function(t){if(null!=t&&null!=this.clickData&&t.stopPropagation(),null!=this.clickData)return this.$el.trigger("AdminListItem.clicked",this.clickData)},e.prototype.onParentClick=function(t){if(!this.disabled)return null!=t&&t.stopPropagation(),this.$el.toggleClass("expanded");t.stopPropagation()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,s=[].slice;Echo.widgets.AdminListTable=function(t){function e(){return this.onCsvUploadsUpdate=i(this.onCsvUploadsUpdate,this),this.updateCount=i(this.updateCount,this),this.checkTable=i(this.checkTable,this),this.onSearchSuccess=i(this.onSearchSuccess,this),this.onSearchComplete=i(this.onSearchComplete,this),this.search=i(this.search,this),this.clearContent=i(this.clearContent,this),this.loadMore=i(this.loadMore,this),this.filterItems=i(this.filterItems,this),this.staticSearch=i(this.staticSearch,this),this.onFilter=i(this.onFilter,this),this.onSearch=i(this.onSearch,this),this.onDeleteItems=i(this.onDeleteItems,this),this.onItemDeleted=i(this.onItemDeleted,this),this.onItemsAdded=i(this.onItemsAdded,this),this.onBulkCheckboxClick=i(this.onBulkCheckboxClick,this),this.onItemCheckboxChange=i(this.onItemCheckboxChange,this),this.onHeaderClick=i(this.onHeaderClick,this),this.onScroll=i(this.onScroll,this),this.onResize=i(this.onResize,this),this.onDisplayMore=i(this.onDisplayMore,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.currentPage=0,e.prototype.infiniteScroll=!0,e.prototype.sameSearch=!1,e.prototype.sortDirection="asc",e.prototype.total=0,e.prototype.fetched=!1,e.prototype.showItemCountWarning=!1,e.prototype.initialize=function(t){if(this.countMessage=t.countMessage,this.itemsToDisplay=t.itemsToDisplay,this.pageSize=t.pageSize,this.static=t.static,this.$headers=this.$(".adminList-header"),this.$list=this.$(".adminList"),this.$shownItemCount=this.$(".adminList-itemCount span"),this.$countWarning=this.$(".adminList-itemCount-warning"),this.$listItems=this.$(".adminList-items"),this.$bulkCheckbox=this.$("[name=bulkActions]"),this.$loadingSection=this.$(".loading-section"),this.$displayMore=this.$(".display-more"),null==this.countMessage&&(this.countMessage="Table.shownItemCount"),this.initSort(),this.$el.on("change",".adminTable-itemCheckbox",this.onItemCheckboxChange).on("click","[name=bulkActions]",this.onBulkCheckboxClick).on("click",".adminList-header[data-sortable]",this.onHeaderClick).on("AdminListItem.deleted",this.onItemDeleted).on("AdminListTable.itemsAdded",this.onItemsAdded).on("AdminListTable.deleteItems",this.onDeleteItems).on("AdminListTable.search",this.onSearch).on("AdminListTable.filter",this.onFilter).on("AdminListTable.refreshSelected",this.onBulkCheckboxClick).on("CsvUploadManager.updateDisplay",this.onCsvUploadsUpdate).on("loadMore",this.onLoadMore).on("click",".display-more",this.onDisplayMore),this.$body.on("Canvas.syncButtonInit",this.checkTable),this.$list.on("scroll",this.onScroll),this.$list.on("resize",this.onResize),this.static)return this.initStaticTable()},e.prototype.initStaticTable=function(){return this.$items=this.$listItems.find("> .adminList-item"),this.count=this.$items.length,this.count&&(this.fetched=!0),this.searchData={url:"",filters:{}},this.staticSearch(this.sortCategory,this.sortDirection)},e.prototype.renderStaticTable=function(){var t,e,i,o;for(this.onSearchSuccess({html:"",total:this.count}),t=e=0,i=this.count;0<=i?e<=i:i<=e;t=0<=i?++e:--e)this.$(".adminList-items > .adminList-item").eq(t).toggle(null==this.itemsToDisplay||t<this.itemsToDisplay);return this.$displayMore.text(this.i18n("Table.displayMore",this.count-(null!=(o=this.itemsToDisplay)?o:0))).toggle(null!=this.itemsToDisplay&&this.itemsToDisplay<this.count)},e.prototype.onDisplayMore=function(){return this.$(".adminList-item").show(),this.$(".display-more").hide()},e.prototype.onResize=function(){return this.fillTable()},e.prototype.onScroll=function(t){if(this.infiniteScroll)return this.$listItems.height()-this.$list.height()-this.$list.scrollTop()<=0?this.loadMore():void 0},e.prototype.initSort=function(){var t;return t=this.$headers.filter("[data-sortable]").first().attr("data-sort-dir",this.sortDirection),this.sortCategory=t.data("name")},e.prototype.onHeaderClick=function(t){var e,i,o,n,s,r;return i=(e=this.$(t.target).closest(".adminList-header")).data("name"),o="asc"===(null!=(n=e.attr("data-sort-dir"))?n:"desc")?"desc":"asc",this.$headers.removeAttr("data-sort-dir"),e.attr("data-sort-dir",this.sortDirection),this.updateSortDirection(i,o),this.$el.trigger("AdminListTable.updateSortOptions",{sortCategory:this.sortCategory,sortDirection:this.sortDirection}),null!=(s=this.searchData)&&(s.filters.sortCategory=this.sortCategory),null!=(r=this.searchData)&&(r.filters.sortDirection=this.sortDirection),this.static?this.staticSearch(this.sortCategory,this.sortDirection):this.onSearch(null,this.searchData)},e.prototype.onItemCheckboxChange=function(){var t;return 0===(t=this.$(".adminList-item:not(.toBeDeleted) .adminTable-itemCheckbox:checked").length)?(this.$bulkCheckbox.removeClass("someSelected").prop("checked",!1),this.$el.trigger("BulkActionButton.toggle",!1)):(t===this.$(".adminList-item").length?this.$bulkCheckbox.removeClass("someSelected").prop("checked",!0):this.$bulkCheckbox.addClass("someSelected").prop("checked",!1),this.$el.trigger("BulkActionButton.toggle",!0)),this.transmitCheckedItems()},e.prototype.onBulkCheckboxClick=function(t){var e;return this.$bulkCheckbox.hasClass("someSelected")?(this.$bulkCheckbox.prop("checked",!1).removeClass("someSelected"),this.$(".adminTable-itemCheckbox").prop("checked",!1),this.$el.trigger("BulkActionButton.toggle",!1)):(e=this.$bulkCheckbox.prop("checked"),this.$(".adminTable-itemCheckbox").prop("checked",e),this.$el.trigger("BulkActionButton.toggle",e)),this.transmitCheckedItems()},e.prototype.transmitCheckedItems=function(){var t;return t=this.$(".adminTable-itemCheckbox:checked").map(function(){var t;return{id:(t=$(this).closest(".adminList-item")).data("id"),type:t.data("type"),data:t.data("object")}}),this.$el.trigger("AdminListTable.updateSelected",t)},e.prototype.onItemsAdded=function(t,e){var i,o;return i=null!=(o=e.index)?o:0,this.$(".adminList-item:not(.toBeDeleted)").length<i&&(i=this.$(".adminList-item:not(.toBeDeleted)").length),i<=0?this.$listItems.prepend(e.html):this.$(".adminList-item:not(.toBeDeleted)").eq(i-1).after(e.html),this.total++,this.$el.trigger("AdminListTable.itemsAddedSuccess",e),this.tableDisplayUpdate(),this.$list.animate({scrollTop:0},300)},e.prototype.onItemDeleted=function(t,e){return 0<this.total&&this.total--,this.tableDisplayUpdate(),this.$el.trigger("AdminListTable.decrementCount",e)},e.prototype.onDeleteItems=function(){var t,e,i,o,n;for(arguments[0],n=[],i=0,o=(e=2<=arguments.length?s.call(arguments,1):[]).length;i<o;i++)t=e[i],n.push(this.$(".adminList-item[data-id="+t+"]").addClass("toBeDeleted").trigger("AdminListItem.delete"));return n},e.prototype.onSearch=function(t,e){return this.searchData=e,this.clearContent(),this.$el.trigger("loading.on",{selector:".adminList",theme:"light",opacity:"transparent"}),this.search()},e.prototype.onFilter=function(t,e){return this.searchData=e,this.staticSearch(this.sortCategory,this.sortDirection)},e.prototype.staticSearch=function(t,e){var i,o,n,s,r,a,h,l,c;for(this.sortCategory=t,this.sortDirection=e,i=this.filterItems(this.$items,this.searchData.filters),o=_.filter(i,function(t){return null!=$(t).data("first")}),n=_.filter(i,function(t){return null==$(t).data("first")}),l=_.sortBy(n,(c=this,function(t){return $(t).data(c.sortCategory)})),"desc"===this.sortDirection&&(l=l.reverse()),r=0,a=(h=o.concat(l)).length;r<a;r++)s=h[r],$(s).detach().appendTo(this.$listItems).show();return this.renderStaticTable()},e.prototype.filterItems=function(t,o){var e,i,n;for(e=0,i=(n=["sortCategory","sortDirection","requested"]).length;e<i;e++)delete o[n[e]];return _.filter(t,function(i){var t;return(t=_.reduce(_.keys(o),function(t,e){return t&&$(i).data(e)===o[e]},!0))||$(i).detach(),t})},e.prototype.loadMore=function(){if(null==this.xhr)return this.currentPage=this.currentPage+1,this.$loadingSection.show(),this.$el.trigger("loading.on",{selector:".loading-section",theme:"light",opacity:"transparent"}),this.search()},e.prototype.clearContent=function(){return this.$listItems.empty(),this.currentPage=0,this.sameSearch=!1},e.prototype.queryDefaults=function(){return{pageNumber:this.currentPage,pageSize:this.pageSize,sortCategory:this.sortCategory,sortDirection:this.sortDirection}},e.prototype.search=function(){var t,e,i,o;if((null!=(e=this.searchData)?e.url:void 0)&&""!==(null!=(i=this.searchData)?i.url:void 0))return this.fetched=!1,t=$.extend(this.queryDefaults(),this.searchData.filters),this.updateSortDirection(t.sortCategory,t.sortDirection),null!=(o=this.xhr)&&o.abort(),this.xhr=this.ajax(this.searchData.url,{data:t,success:this.onSearchSuccess,error:this.onSearchComplete})},e.prototype.onSearchComplete=function(){return this.$el.trigger("loading.off",{selector:".adminList"}).trigger("loading.off",{selector:".loading-section"}),this.$loadingSection.hide(),this.xhr=null},e.prototype.updateSortDirection=function(t,e){return this.$headers.filter("[data-sortable]").removeAttr("data-sort-dir").filter("[data-name='"+t+"']").attr("data-sort-dir",e),this.sortCategory=t,this.sortDirection=e,this.$listItems.find(".adminListItem-cell.sort-category").removeClass("sort-category"),this.$listItems.find(".adminListItem-cell").filter("."+t).addClass("sort-category")},e.prototype.onSearchSuccess=function(t){var e,i;return this.$listItems.append(t.html),this.static&&!this.fetched&&(this.$items=this.$listItems.find("> .adminList-item"),this.fetched=!0),e=this.$listItems.find("> .adminList-item").length,this.infiniteScroll=e<t.total&&t.total>this.pageSize&&0<(null!=(i=t.html)?i.length:void 0),this.total=!t.fragmentsFound||t.total>this.pageSize?t.total:e,this.showItemCountWarning=!!t.fragmentsFound&&this.total>this.pageSize,this.tableDisplayUpdate(),this.$el.trigger("AdminListTable.searchResults",{sameSearch:this.sameSearch,results:t}),this.sameSearch=!0,this.fillTable()},e.prototype.togglePlaceholder=function(){return this.$list.toggleClass("noItems",0===this.$listItems.find("> .adminList-item:not(.toBeDeleted)").length)},e.prototype.checkTable=function(){var t;return t=this.$listItems.find("> .adminList-item:not(.toBeDeleted)").length,this.$body.trigger("AdminListTable.calculateItemCount",t)},e.prototype.updateCount=function(){var t;if(this.countMessage)return t=this.i18n(this.countMessage,this.$listItems.find("> .adminList-item:not(.toBeDeleted)").length,this.total),this.$shownItemCount.text(t),this.$countWarning.toggle(this.showItemCountWarning)},e.prototype.tableDisplayUpdate=function(){return this.updateCount(),this.togglePlaceholder(),this.onItemCheckboxChange()},e.prototype.fillTable=function(){if(this.onSearchComplete(),this.$list.height()>=this.$listItems.height()&&this.infiniteScroll)return this.loadMore()},e.prototype.onCsvUploadsUpdate=function(t,e){var i,o;return i=e.count,41,o=Math.max($(".adminList-headers").height(),42),this.$list.css("top",41*i+o)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.AjaxFilterBar=function(t){function e(){return this.clear=i(this.clear,this),this.forceUpdate=i(this.forceUpdate,this),this.sendUpdate=i(this.sendUpdate,this),this.setGrid=i(this.setGrid,this),this.setList=i(this.setList,this),this.setState=i(this.setState,this),this.initializeViewToggle=i(this.initializeViewToggle,this),this.initializeListeners=i(this.initializeListeners,this),this.deactivateEvents=i(this.deactivateEvents,this),this.activateEvents=i(this.activateEvents,this),this.setupEventsAndListeners=i(this.setupEventsAndListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$form=this.$("form"),this.sendUpdateDebounced=_.debounce(this.sendUpdate,250),$('[href="#"]').on("click",this.preventDefault),this.initializeValues(),this.setupEventsAndListeners()},e.prototype.initializeValues=function(){var t;if(this.setInputsFromHash(),this.parseInputs(),null!=(t=Echo.helpers.Location.parseHash()).view)return this.initializeViewToggle(t.view)},e.prototype.setupEventsAndListeners=function(){return this.initializeListeners(),this.activateEvents()},e.prototype.activateEvents=function(){return this.$el.on("change",this.sendUpdateDebounced)},e.prototype.deactivateEvents=function(){return this.$el.off("change",this.sendUpdateDebounced)},e.prototype.initializeListeners=function(){var e;return this.$form.on("submit",this.preventDefault),this.$body.on("FilterBar.requestUpdate",(e=this,function(t){return e.sendUpdate(t,{requested:!0})})).on("FilterBar.forceUpdate",this.forceUpdate),this.$el.on("change","input, select",this.setState).on("FilterBar.clear",this.clear).on("ToggleView.showGrid",this.setGrid).on("ToggleView.showList",this.setList)},e.prototype.initializeViewToggle=function(t){var e;if("list"===t||"grid"===t)return e="list"===t?"initList":"initGrid",$("body").trigger("ToggleView."+e)},e.prototype.parseInputs=function(){var t,e,i,o,n,s,r,a;for(r=[],e=0,n=(s=this.$("[name]")).length;e<n;e++)i=s[e],o=(t=$(i)).attr("name"),""!==(a=this.getValue(t))?r.push(this.updateState(o,a)):r.push(void 0);return r},e.prototype.setInputsFromHash=function(){var t,e,i,o,n,s,r,a,h;for(t=0,s=(r=(o=window.location.hash.replace("#","")).split("&")).length;t<s;t++)n=(a=r[t].split("="))[0],h=a[1],""!==n&&0<(e=this.$("[name="+n+"]")).length&&(i=e.attr("type"),-1===["radio","checkbox"].indexOf(i)&&this.$("[name="+n+"]").val(decodeURIComponent(h.replace("+"," "))).trigger("change"));return o},e.prototype.getValue=function(t){var e,i;return i=t.val(),"boolean"===t.data("type")&&""!==i&&(i="true"===i),"checkbox"!==(e=t[0].type)&&"radio"!==e||(i=this.getCheckedVal(t)),i},e.prototype.getCheckedVal=function(t){return t.prop("checked")?t.val():""},e.prototype.setState=function(t,e){var i;if(null==e||!e.suppress)return t.preventDefault(),i=$(t.target),this.updateState(i.attr("name"),this.getValue(i))},e.prototype.getState=function(){return Echo.helpers.Location.parseHash()},e.prototype.updateState=function(t,e){var i;return i=Echo.helpers.Location.parseHash(),(null!=t?t.length:void 0)&&null!=e&&""!==e?i[t]=e:(null!=t?t.length:void 0)&&delete i[t],Echo.helpers.Location.updateHash(i)},e.prototype.setList=function(){return this.updateState("view","list")},e.prototype.setGrid=function(){return this.updateState("view","grid")},e.prototype.stateUnchanged=function(){var t,e;return e=this.getState(),t=_.isEqual(this.previousState,e),this.previousState=_.extend({},e),t},e.prototype.sendUpdate=function(t,e){if(!((null!=e?e.suppress:void 0)||this.stateUnchanged()))return this.$el.trigger("FilterBar.update",$.extend({requested:null!=e?e.requested:void 0},this.getState()))},e.prototype.forceUpdate=function(t,e){return this.$el.trigger("FilterBar.update",this.getState())},e.prototype.clear=function(){return this.deactivateEvents(),this.$form.trigger("reset").trigger("clear"),this.sendUpdate(),this.activateEvents()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.AjaxForm=function(t){function e(){return this.onFormReset=i(this.onFormReset,this),this.onInputErrorFixed=i(this.onInputErrorFixed,this),this.onInputError=i(this.onInputError,this),this.beforeSubmit=i(this.beforeSubmit,this),this.triggerSubmit=i(this.triggerSubmit,this),this.onChangeAction=i(this.onChangeAction,this),this.onSubmitError=i(this.onSubmitError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onSubmitComplete=i(this.onSubmitComplete,this),this.onSubmitWithData=i(this.onSubmitWithData,this),this.onForceSubmit=i(this.onForceSubmit,this),this.onFormSubmit=i(this.onFormSubmit,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){if(this.alerts=t.alerts,this.autoSubmit=t.autoSubmit,this.custom=t.custom,this.loadingOptions=t.loadingOptions,this.submitWithData=t.submitWithData,this.action=this.$el.attr("action"),this.method=this.$el.attr("method")||"POST",this.$buttons=this.$(".btn"),this.$inputs=this.$("input,select"),this.$el.on("submit",this.onFormSubmit).on("AjaxForm.forceSubmit",this.onForceSubmit).on("AjaxForm.submitWithData",this.onSubmitWithData).on(this.namespacedEventName("AjaxForm","changeAction"),this.onChangeAction).on("Input.onError",this.onInputError).on("Input.onErrorFixed",this.onInputErrorFixed).on("AjaxForm.reset",this.onFormReset),this.autoSubmit)return this.setupAutoSubmit()},e.prototype.onFormSubmit=function(t){if(t.preventDefault(),!this.submitWithData)return this.submit(),this.$el.trigger("AjaxForm.submit")},e.prototype.onForceSubmit=function(t){return t.preventDefault(),this.submit(),this.$el.trigger("AjaxForm.submit")},e.prototype.onSubmitWithData=function(t,e){return this.submit(e),this.$el.trigger("AjaxForm.submit")},e.prototype.onSubmitComplete=function(){if(this.loadingOptions.enable)return this.$el.trigger("loading.off",{selector:this.loadingOptions.el})},e.prototype.onSubmitSuccess=function(t){var e,i,o,n,s,r;if(this.$buttons.trigger("enable"),this.alerts.disableSuccessAlert||alertify.success(this.i18n(this.alerts.successAlertMessage)),null!=t?t.data:void 0){for(i=this.namespacedEventName("AjaxForm","success"),0===t.data.length&&this.$el.trigger(i),r=[],o=0,n=(s=t.data).length;o<n;o++)e=s[o],r.push(this.$el.trigger(i,e));return r}},e.prototype.onSubmitError=function(t){var e,i;return this.$buttons.trigger("enable"),e=this.namespacedEventName("AjaxForm","error"),null==(null!=t&&null!=(i=t.responseJSON)?i.message:void 0)&&(t.responseJSON={message:this.i18n("Errors.unknownError")}),Echo.core.form.onSubmitError(this.$el,t,this.alerts,e)},e.prototype.onChangeAction=function(t,e){return this.method=e.method,this.action=e.url},e.prototype.setupAutoSubmit=function(){return this.$el.on("change input",_.debounce(this.triggerSubmit,1e3))},e.prototype.submit=function(t){var e;if(null==t&&(t={}),!this.custom)return this.$buttons.trigger("disable"),this.$inputs.trigger("Input.clearError"),e=$.extend(Echo.core.form.getData(this.$el),t),$.ajax({beforeSend:this.beforeSubmit,contentType:"application/json",data:JSON.stringify(e),dataType:"json",type:this.method,url:this.action,success:this.onSubmitSuccess,error:this.onSubmitError,complete:this.onSubmitComplete})},e.prototype.triggerSubmit=function(){return this.$el.trigger("submit")},e.prototype.beforeSubmit=function(){if(this.loadingOptions.enable)return this.$el.trigger("loading.on",{selector:this.loadingOptions.el,theme:this.loadingOptions.color,opacity:this.loadingOptions.transparent?"transparent":"solid"})},e.prototype.onInputError=function(t,e){if(e)return this.$buttons.filter('button[type="submit"]').trigger("disable")},e.prototype.onInputErrorFixed=function(){return this.$buttons.filter('button[type="submit"]').trigger("enable")},e.prototype.onFormReset=function(){return this.$el[0].reset()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.AjaxFormCheckboxGroup=function(t){function e(){return this.onSetError=i(this.onSetError,this),this.onReset=i(this.onReset,this),this.onClearError=i(this.onClearError,this),this.onChange=i(this.onChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$error=this.$("span.error"),this.$el.on("change",this.onChange).on("Input.clearError",this.onClearError).on("Input.setError",this.onSetError).closest("form").on("reset",this.onReset)},e.prototype.onChange=function(){return this.hideError()},e.prototype.onClearError=function(){return this.hideError()},e.prototype.onReset=function(){return this.hideError()},e.prototype.onSetError=function(t,e){return this.showError(e)},e.prototype.showError=function(t){return this.$error.text(t),this.$el.addClass("error")},e.prototype.hideError=function(){return this.$el.removeClass("error")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.Alertify=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return alertify.set({labels:{ok:this.i18n("Labels.ok"),cancel:this.i18n("Labels.cancel")}})},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.AnnotationControls=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.mode="default",e.prototype.initialize=function(){return this.id=this.$el.attr("id")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.BatchSectionEnrollmentTable=function(t){function e(){return this.onCourseChange=i(this.onCourseChange,this),this.onTermChange=i(this.onTermChange,this),this.sectionUpdate=i(this.sectionUpdate,this),this.courseUpdate=i(this.courseUpdate,this),this.onSetEnabledRoles=i(this.onSetEnabledRoles,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$el.on("change",".term select",this.onTermChange).on("change",".course select",this.onCourseChange).on("setEnabledRoles",this.onSetEnabledRoles)},e.prototype.onSetEnabledRoles=function(t,e){var o,i,n;return o=e.enabledRoles.filter(function(t){var e;return"Student"===(e=t.value)||"Instructor"===e||"TeachingAssistant"===e}),i=function(){var t,e,i;for(i=[],t=0,e=o.length;t<e;t++)n=o[t],i.push("<option value='"+n.value+"'>"+n.name+"</option>");return i}().join(""),this.$(".role select").each(function(){var t,e;return e=(t=$(this)).val(),t.html(i).val(e).trigger("change")})},e.prototype.getRow=function(t){return $(t.target).closest("fieldset[data-type=arrayElement]")},e.prototype.resetSelect=function(t){return t.html("<option value =''>").val("").trigger("change")},e.prototype.courseUpdate=function(t,e){var i;if(i=t.find(".course select"),this.resetSelect(i),""!==e)return Echo.routes.Courses.getCourseFilterOptionsByTerm(e).ajax({success:function(t){return i.trigger("Select.updateOptions",{options:t.data[0].html})}})},e.prototype.sectionUpdate=function(t,e,i){var o;if(o=t.find(".section select"),this.resetSelect(o),""!==e)return Echo.routes.Sections.getSectionFilterOptions(e,i).ajax({success:function(t){return o.trigger("Select.updateOptions",{options:t.data[0].html})}})},e.prototype.onTermChange=function(t){var e,i;return i=(e=this.getRow(t)).find(".term select").val(),this.courseUpdate(e,i)},e.prototype.onCourseChange=function(t){var e,i,o;return o=(e=this.getRow(t)).find(".term select").val(),i=$(t.target).val(),this.sectionUpdate(e,i,o)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.widgets.Calendar=function(t){function e(){return this.onReset=i(this.onReset,this),this.onEmitDateSelected=i(this.onEmitDateSelected,this),this.onUpdateDate=i(this.onUpdateDate,this),this.onSetRange=i(this.onSetRange,this),this.onDayClick=i(this.onDayClick,this),this.goToPreviousMonth=i(this.goToPreviousMonth,this),this.goToNextMonth=i(this.goToNextMonth,this),this.clearEvents=i(this.clearEvents,this),this.addEvent=i(this.addEvent,this),this.tagWithClass=i(this.tagWithClass,this),this.tagWithDataForDay=i(this.tagWithDataForDay,this),this.tagWithClassForDay=i(this.tagWithClassForDay,this),this.tagWithText=i(this.tagWithText,this),this.tagWithEventForDay=i(this.tagWithEventForDay,this),this.constructCellDiv=i(this.constructCellDiv,this),this.constructCellTd=i(this.constructCellTd,this),this.constructCell=i(this.constructCell,this),this.onEventsFetched=i(this.onEventsFetched,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e,i,o,n;return this.displayedMonth=t.displayedMonth,this.displayedYear=t.displayedYear,this.allowPastDays=t.allowPastDays,e=t.localDate,o=t.newestDate,n=t.oldestDate,i=t.localEvents,o&&(this.newestDate=Echo.core.helpers.getDateFromISODateString(o)),n&&(this.oldestDate=Echo.core.helpers.getDateFromISODateString(n)),this.$calendarBody=this.$("tbody"),this.$prevMonth=this.$(".previous-month"),this.$nextMonth=this.$(".next-month"),this.addListeners(),this.initializeDays(e),this.initializeEvents(i),this.render()},e.prototype.addListeners=function(){return this.$el.on("click",".day:not(.past, .empty)",this.onDayClick).on("addEvent",this.addEvent).on("clearEvents",this.clearEvents).on("Calendar.setRange",this.onSetRange).on("Calendar.updateDate",this.onUpdateDate).on("Calendar.emitDateSelected",this.onEmitDateSelected).closest("form").on("reset",this.onReset),this.$prevMonth.on("click",this.goToPreviousMonth),this.$nextMonth.on("click",this.goToNextMonth)},e.prototype.fetchEvents=function(){return this.$el.trigger("EventStore.fetchByMonthAndYear",[this.displayedMonth,this.displayedYear,this.onEventsFetched])},e.prototype.onEventsFetched=function(t,e,i){return this.fillEvents(i)},e.prototype.fillEvents=function(t){var e,i,o;for(i=0,o=t.length;i<o;i++)(e=t[i]).rrule=Echo.core.helpers.getRRuleFromEvent(e);return this.fetchedEvents=t,this.retagFetchedEvents()},e.prototype.initializeDays=function(t){return this.today=Echo.core.helpers.getDateFromISODateString(null!=t?t:""),this.defaultDay=this.selectedDay=this.today.getDate(),this.defaultMonth=this.selectedMonth=this.displayedMonth,this.defaultYear=this.selectedYear=this.displayedYear},e.prototype.initializeEvents=function(t){var e,i,o,n;for(null==t&&(t=[]),this.fetchedEvents=[],this.localEvents=t,i=0,o=(n=this.localEvents).length;i<o;i++)(e=n[i]).rrule=Echo.core.helpers.getRRuleFromEvent(e);return this.fetchEvents()},e.prototype.lastRowFromCalendar=function(){var t;return(6<(t=this.$calendarBody.children("tr:last")).children("td").length||0===t.length)&&(t=$("<tr>")).appendTo(this.$calendarBody),t},e.prototype.addSpaceToCalendar=function(){return this.lastRowFromCalendar().append($('<td class="empty"><div>&nbsp;</div></td>'))},e.prototype.addDayToCalendar=function(t,e){var i,o,n;return n=(o=null!=e?e:{}).text,i=o.cssClass,this.lastRowFromCalendar().append(this.constructCell(t,n,i))},e.prototype.constructCell=function(t,e,i){var o,n;return n=this.constructCellTd(t,i),o=this.constructCellDiv(t,e),n.append(o)},e.prototype.constructCellTd=function(t,e){var i;return i=$("<td>"),this.tagWithClass(i,e),this.tagWithClassForDay(i,t),this.tagWithDataForDay(i,t)},e.prototype.constructCellDiv=function(t,e){var i;return i=$("<div>"),this.tagWithEventForDay(i,t),this.tagWithText(i,e||t)},e.prototype.tagWithEventForDay=function(t,e){var i,o,n;return i=(n=this.getEventsForDay(e)).fetched,null!=(o=n.local)[0]&&t.addClass("localEvent").data("color-local",o[0].color),null!=i[0]&&t.addClass("fetchedEvent").data("color-fetched",i[0].color),this.styleEventEl(t)},e.prototype.tagWithText=function(t,e){return t.text(e)},e.prototype.tagWithClassForDay=function(t,e){return this.dayInPast(e)&&t.addClass("past"),this.dayIsToday(e)&&t.addClass("today"),this.dayIsSelected(e)&&t.addClass("selected"),t.addClass("day")},e.prototype.tagWithDataForDay=function(t,e){return t.data("day",e)},e.prototype.tagWithClass=function(t,e){if(e)return t.addClass(e)},e.prototype.addEvent=function(t,e){return e.rrule=Echo.core.helpers.getRRuleFromEvent(e),this.localEvents.push(e),this.retagLocalEvent(e)},e.prototype.clearEvents=function(){return this.localEvents=[],this.retagLocalEvents()},e.prototype.dayIsDate=function(t,e){var i,o,n;return i=e.getDate()===t,o=e.getMonth()===this.displayedMonth-1,n=e.getFullYear()===this.displayedYear,i&&o&&n},e.prototype.dayInPast=function(t){return!this.allowPastDays&&(this.displayedYear<=this.today.getUTCFullYear()&&(this.displayedYear!==this.today.getUTCFullYear()||this.displayedMonth-1<=this.today.getMonth()&&(this.displayedMonth-1!==this.today.getMonth()||t<this.today.getDate())))},e.prototype.dayIsToday=function(t){return this.dayIsDate(t,this.today)},e.prototype.dayIsSelected=function(t){var e,i,o;return e=this.selectedDay===t,i=this.selectedMonth===this.displayedMonth,o=this.selectedYear===this.displayedYear,e&&i&&o},e.prototype.getCalendarHeader=function(){return this.monthName(this.displayedMonth-1)+" "+this.displayedYear},e.prototype.monthName=function(t){return this.monthNames||(this.monthNames=this.getMonthNames()),this.monthNames[t]},e.prototype.getEventsForDay=function(e){return{fetched:_.filter(this.fetchedEvents,(o=this,function(t){return o.filterEventForDay(t,e)})),local:_.filter(this.localEvents,(i=this,function(t){return i.filterEventForDay(t,e)}))};var i,o},e.prototype.filterEventForDay=function(t,e){var i,o,n,s;return i=Echo.core.helpers.getISODateStringFromYMD({year:this.selectedYear,month:this.selectedMonth,day:e}),t.rrule?!(t.exclusions&&0<=a.call(t.exclusions,i))&&(s=new Date(this.displayedYear,this.displayedMonth-1,e,0,0,0),o=new Date(this.displayedYear,this.displayedMonth-1,e,23,59,59),0!==t.rrule.between(s,o,!0).length):(n=Echo.core.helpers.getDateFromISODateString(t.startDate),this.dayIsDate(e,n))},e.prototype.getFirstDayOffset=function(){return new Date(this.displayedYear,this.displayedMonth-1,1).getDay()},e.prototype.getLastDayOffset=function(){return 6-new Date(this.displayedYear,this.displayedMonth,0).getDay()},e.prototype.getTotalDays=function(){return new Date(this.displayedYear,this.displayedMonth,0).getDate()},e.prototype.goToNextMonth=function(){if(!this.monthIsNewest())return this.displayedMonth%=12,this.displayedMonth++,1===this.displayedMonth&&this.displayedYear++,this.fetchEvents(),this.render()},e.prototype.goToPreviousMonth=function(){if(!this.monthIsOldest()||this.allowPastDays)return this.displayedMonth--,0===this.displayedMonth&&(this.displayedYear--,this.displayedMonth=12),this.fetchEvents(),this.render()},e.prototype.onDayClick=function(t){var e,i,o,n,s,r,a,h;for(this.selectedDay=$(t.currentTarget).data("day"),this.selectedMonth=this.displayedMonth,this.selectedYear=this.displayedYear,this.emitDateSelected(this.selectedDay,this.selectedMonth,this.selectedYear),o=(a=this.getEventsForDay(this.selectedDay)).fetched,r=a.local,0<(i=o.concat(r)).length&&this.$el.trigger("Calendar.clickEvent"),h=[],n=0,s=i.length;n<s;n++)e=i[n],h.push(this.$el.trigger("CalendarEvent."+e.eventId+".click"));return h},e.prototype.onSetRange=function(t,e){return this.oldestDate=Echo.core.helpers.getDateFromISODateString(e.startDate),this.newestDate=Echo.core.helpers.getDateFromISODateString(e.endDate),this.render()},e.prototype.onUpdateDate=function(t,e){return this.selectedDay=e.day,this.selectedMonth=this.displayedMonth=e.month,this.selectedYear=this.displayedYear=e.year,this.render()},e.prototype.onEmitDateSelected=function(){return this.emitDateSelected(this.selectedDay,this.selectedMonth,this.selectedYear)},e.prototype.emitDateSelected=function(t,e,i){return this.$el.trigger("Calendar.dateSelected",{day:t,month:e,year:i})},e.prototype.onReset=function(){return this.selectedDay=this.defaultDay,this.selectedMonth=this.displayedMonth=this.defaultMonth,this.selectedYear=this.displayedYear=this.defaultYear,this.render()},e.prototype.monthIsNewest=function(){var t,e;return!!this.newestDate&&(e=this.newestDate.getFullYear(),t=this.newestDate.getMonth()+1,e===this.displayedYear&&t===this.displayedMonth)},e.prototype.monthIsOldest=function(){var t,e;return!!this.oldestDate&&(e=this.oldestDate.getFullYear(),t=this.oldestDate.getMonth()+1,e===this.displayedYear&&t===this.displayedMonth)},e.prototype.render=function(){var t,e,i,o,n,s,r;for(this.$calendarBody.empty(),this.$(".month-label").text(this.getCalendarHeader()),e=0,n=this.getFirstDayOffset();e<n;e+=1)this.addSpaceToCalendar();for(t=i=1,s=this.getTotalDays();i<=s;t=i+=1)this.dayBeforeOldestMonth(t)||this.dayAfterNewestMonth(t)?this.addSpaceToCalendar():this.addDayToCalendar(t);for(o=0,r=this.getLastDayOffset();o<r;o+=1)this.addSpaceToCalendar();if(null==this.oldestDate||this.allowPastDays||this.updatePrevMonthNav(),null!=this.newestDate)return this.updateNextMonthNav()},e.prototype.updatePrevMonthNav=function(){return this.displayedYear===this.oldestDate.getUTCFullYear()&&this.displayedMonth===this.oldestDate.getMonth()+1?this.$prevMonth.hide():this.$prevMonth.show()},e.prototype.updateNextMonthNav=function(){return this.displayedYear===this.newestDate.getUTCFullYear()&&this.displayedMonth===this.newestDate.getMonth()+1?this.$nextMonth.hide():this.$nextMonth.show()},e.prototype.dayAfterNewestMonth=function(t){return this.monthIsNewest()&&t>this.newestDate.getDate()},e.prototype.dayBeforeOldestMonth=function(t){return this.monthIsOldest()&&t<this.oldestDate.getDate()},e.prototype.untagLocalEvents=function(){return this.untagEventsWithName("local")},e.prototype.untagFetchedEvents=function(){return this.untagEventsWithName("fetched")},e.prototype.untagEventsWithName=function(t){var e,i,o,n,s,r;for(r=[],o=0,n=(s=this.$("."+t+"Event")).length;o<n;o++)i=s[o],(e=$(i)).removeClass(t+"Event").data("color-"+t,""),r.push(this.styleEventEl(e));return r},e.prototype.styleEventEl=function(t){return t.hasClass("fetchedEvent")?t.css({background:t.data("color-fetched"),cursor:"pointer"}):t.hasClass("localEvent")?t.css({background:t.data("color-local"),cursor:"pointer"}):t.css({background:"",cursor:""})},e.prototype.retagLocalEvents=function(){var t,e,i,o,n;for(this.untagLocalEvents(),n=[],e=0,i=(o=this.localEvents).length;e<i;e++)t=o[e],n.push(this.retagLocalEvent(t));return n},e.prototype.retagFetchedEvents=function(){var t,e,i,o,n;for(this.untagFetchedEvents(),n=[],e=0,i=(o=this.fetchedEvents).length;e<i;e++)t=o[e],n.push(this.retagFetchedEvent(t));return n},e.prototype.retagLocalEvent=function(t){var e,i,o,n,s;for(s=[],i=0,o=(n=this.daysForEvent(t)).length;i<o;i++)e=n[i],s.push(this.tagElWithLocalEvent(this.tdForDay(e),t));return s},e.prototype.retagFetchedEvent=function(t){var e,i,o,n,s;for(s=[],i=0,o=(n=this.daysForEvent(t)).length;i<o;i++)e=n[i],s.push(this.tagElWithFetchedEvent(this.tdForDay(e),t));return s},e.prototype.tdForDay=function(t){return this.$("td.day div:eq("+(t-1)+")")},e.prototype.tagElWithLocalEvent=function(t,e){return t.addClass("localEvent").data("color-local",e.color),this.styleEventEl(t)},e.prototype.tagElWithFetchedEvent=function(t,e){return t.addClass("fetchedEvent").data("color-fetched",e.color),this.styleEventEl(t)},e.prototype.daysForEvent=function(t){var e,i,o,n,s,r;return null!=t.rrule?(r=new Date(this.displayedYear,this.displayedMonth-1,1),s=new Date(this.displayedYear,this.displayedMonth,0),i=t.rrule.between(r,s,!0),o=t.exclusions||[],n=_.filter(i,function(t){var e;return e=Echo.core.helpers.getISODateStringFromDate(t),a.call(o,e)<0}),_.map(n,function(t){return t.getDate()})):(e=Echo.core.helpers.getDateFromISODateString(t.startDate),this.dayIsDate(e.getDate(),e)?[e.getDate()]:[])},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.ClassroomDropdown=function(t){function e(){return this.closeMenu=i(this.closeMenu,this),this.openMenu=i(this.openMenu,this),this.toggle=i(this.toggle,this),this.onKeyDown=i(this.onKeyDown,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.menuPosition=t.menuPosition,this.closeEvent="click.dropdown.closer",this.toggleEvent="click.dropdown."+this.$el.attr("id"),this.$dropdownToggle=this.$("a.classroomDropdown-toggle"),this.$menu=this.$("ul.classroomDropdown-menu"),this.$menuLink=this.$menu.find("li a"),this.$tip=this.$(".tooltip"),this.$dropdownToggle.on(this.toggleEvent,this.toggle),this.$menuLink.on("click",this.closeMenu)},e.prototype.onKeyDown=function(t){if(t.which===this.KEYS.ESC)return this.closeMenu()},e.prototype.toggle=function(t,e){return this.$el.hasClass("open")?this.closeMenu():(this.$doc.trigger(this.closeEvent),this.reposition(t)),t.preventDefault(),t.stopPropagation()},e.prototype.openMenu=function(){return this.$doc.trigger(this.closeEvent),this.$el.addClass("open"),this.$doc.on(this.closeEvent,this.closeMenu),this.$doc.on("keydown",this.onKeyDown),this.$body.on("click",this.closeMenu)},e.prototype.closeMenu=function(t){if(this.$el.removeClass("open"),this.$tip.hide(),this.$doc.off(this.closeEvent),this.$doc.off("keydown",this.onKeyDown),this.$body.off("click",this.closeMenu),t)return t.stopPropagation()},e.prototype.reposition=function(t){var e,i;return i=$(t.target).position().top+this.getOffsetY(t),e=$(t.target).position().left+this.getOffsetX(t),"left"===this.menuPosition&&(e-=this.$menu.width()),this.$menu.css({top:i+"px",left:e+"px"}),this.openMenu()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Clickable=function(t){function e(){return this.render=i(this.render,this),this.onDisable=i(this.onDisable,this),this.onEnable=i(this.onEnable,this),this.onDestroy=i(this.onDestroy,this),this.onClick=i(this.onClick,this),this.onKeypress=i(this.onKeypress,this),this.docListeners=i(this.docListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.disabled=t.disabled,this.clickEvent=t.clickEvent,this.clickEventData=t.clickEventData,this.stopPropagation=t.stopPropagation,this.namespace=t.namespace,this.isToggle=t.isToggle,this.$el.on("enable",this.onEnable),this.$el.on("disable",this.onDisable),this.$el.on("click",this.onClick),this.$el.on("keypress",this.onKeypress),this.render(),this.setupClipboard()},e.prototype.docListeners=function(){var t;return t={},null!=this.options.namespace&&""!==this.options.namespace?t["Clickables."+this.options.namespace+".destroy"]=this.onDestroy:t["Clickables.destroy"]=this.onDestroy,$.extend(e.__super__.docListeners.apply(this,arguments),t)},e.prototype.onKeypress=function(t){var e;if((e=t.which)===this.KEYS.ENTER||e===this.KEYS.SPACE_BAR)return this.onClick(t)},e.prototype.onClick=function(t){return this.disabled?(t.preventDefault(),t.stopImmediatePropagation()):null==this.clickEvent&&!this.isToggle||("#"===this.$el.attr("href")&&t.preventDefault(),this.stopPropagation&&t.stopPropagation(),this.isToggle&&(this.$el.toggleClass("on"),this.$el.trigger("Clickable.toggle",this.$el.hasClass("on"))),null==this.clickEvent)?void 0:this.$el.trigger(this.clickEvent,this.clickEventData)},e.prototype.onDestroy=function(t){return this.dispose()},e.prototype.onEnable=function(){return this.disabled=!1,this.render()},e.prototype.onDisable=function(){return this.disabled=!0,this.render()},e.prototype.isLink=function(){return"A"===this.el.tagName},e.prototype.render=function(){var t;return this.isLink()?(t=this.disabled?"addClass":"removeClass",this.$el[t]("disabled")):this.$el.attr({disabled:this.disabled}).keyboardFocusable()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.ConfirmButton=function(t){function e(){return this.revertButton=i(this.revertButton,this),this.confirmifyButton=i(this.confirmifyButton,this),this.onCancelClick=i(this.onCancelClick,this),this.onButtonClick=i(this.onButtonClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.confirmMessage=t.confirmMessage,this.confirmEvent=t.confirmEvent,this.button=this.$(".btn"),this.cancelButton=this.$(".cancel"),this.initialButtonText=this.button.text(),this.button.on("click",this.onButtonClick),this.cancelButton.on("click",this.onCancelClick)},e.prototype.onButtonClick=function(t){return this.$el.hasClass("confirm")?(null!=this.confirmEvent&&this.$el.trigger(this.confirmEvent),this.revertButton()):(t.preventDefault(),this.confirmifyButton())},e.prototype.onCancelClick=function(t){return t.preventDefault(),this.revertButton()},e.prototype.confirmifyButton=function(){return this.button.text(this.confirmMessage),this.$el.addClass("confirm")},e.prototype.revertButton=function(){return this.button.text(this.initialButtonText),this.$el.removeClass("confirm")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.ConfirmSelect=function(t){function e(){return this.onCancelClick=i(this.onCancelClick,this),this.onConfirmClick=i(this.onConfirmClick,this),this.onControlChange=i(this.onControlChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.confirmMessage=t.confirmMessage,this.select=this.$(".select-control select"),this.confirmButton=this.$(".btn"),this.cancelButton=this.$(".cancel"),this.select.on("focus",function(){return this.selectedIndex=-1}),this.select.on("change",this.onControlChange),this.confirmButton.on("click",this.onConfirmClick),this.cancelButton.on("click",this.onCancelClick)},e.prototype.onControlChange=function(t){return t.preventDefault(),this.$el.addClass("confirm")},e.prototype.onConfirmClick=function(t){return t.preventDefault(),this.$el.removeClass("confirm")},e.prototype.onCancelClick=function(t){return t.preventDefault(),this.$el.removeClass("confirm")},e}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Confirmable=function(t){function o(){return this.onClickEvent=e(this.onClickEvent,this),this.onConfirm=e(this.onConfirm,this),o.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(o,Echo.widgets.Clickable),o.prototype.initialize=function(t){var e,i;return this.clickEvent=t.clickEvent,this.confirmMessage=t.confirmMessage,this.confirmUrl=t.confirmUrl,this.disabled=t.disabled,this.failureMessage=t.failureMessage,this.onCompleteEvent=t.onCompleteEvent,this.stopPropagation=t.stopPropagation,this.successMessage=t.successMessage,null==(e=this.options).clickEvent&&(e.clickEvent="confirmable.click"),null==(i=this.options).stopPropagation&&(i.stopPropagation=!0),o.__super__.initialize.apply(this,arguments),this.$el.on(this.clickEvent,this.onClickEvent),this.$el.addClass("confirmable")},o.prototype.onConfirm=function(){return this.onDisable(),$.ajax({url:this.confirmUrl,success:(i=this,function(){return alertify.success(i.i18n(i.successMessage))}),error:(e=this,function(){return e.onEnable(),alertify.error(e.i18n(e.failureMessage))}),complete:(t=this,function(){if(null!=t.onCompleteEvent!=null)return t.$el.trigger(t.onCompleteEvent)})});var t,e,i},o.prototype.onClickEvent=function(t){return this.confirm(this.confirmMessage,this.onConfirm)},o}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.ContentSelector=function(t){function i(){var t,e;return this.render=(t=this.render,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){return this.select=t.select,this.$select=this.$("#"+this.select+" select"),this.$select.on("change",this.render),this.render()},i.prototype.render=function(){var t;return t=this.$select.val(),this.$("[data-content]").hide(),this.$('[data-content="'+t+'"]').show()},i}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.CrudSelect=function(t){function i(){return this.updateEditDiv=e(this.updateEditDiv,this),this.onItemSelected=e(this.onItemSelected,this),this.onAddSelected=e(this.onAddSelected,this),this.onNoneSelected=e(this.onNoneSelected,this),this.onSelectChange=e(this.onSelectChange,this),this.onDeleteSuccess=e(this.onDeleteSuccess,this),this.onUpdateSuccess=e(this.onUpdateSuccess,this),this.onCreateSuccess=e(this.onCreateSuccess,this),this.onDeleteConfirm=e(this.onDeleteConfirm,this),this.onDelete=e(this.onDelete,this),this.onManage=e(this.onManage,this),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.AddableSelect),i.prototype.initialize=function(t){return this.controller=t.controller,this.getRoute=t.getRoute,this.updateRoute=t.updateRoute,this.deleteRoute=t.deleteRoute,this.deleteMessage=t.deleteMessage,this.$addActionDiv=this.$(".crud-select-action-add"),this.$editActionDiv=this.$(".crud-select-action-edit"),this.$updateActionDiv=this.$(".crud-select-action-update"),this.$deleteActionDiv=this.$(".crud-select-action-delete"),this.$contentLink=this.$(".manage-content"),this.$updateContent=this.$(".update-content"),this.$cancelButton=this.$(".cancel"),this.$selectWrapper=this.$(".crud-select-selector .select2-wrapper"),this.$select=this.$selectWrapper.find("select"),this.noneSelected="crud_select_none_selected",this.addSelected="crud_select_action_add",this.selectedVal=this.noneSelected,this.$el.on("AjaxForm.CrudSelect.create.success",this.onCreateSuccess).on("AjaxForm.CrudSelect.update.success",this.onUpdateSuccess).on("CrudSelect.deselect",this.onCancel).on("CrudSelect.manage",this.onManage).on("CrudSelect.delete.confirm",this.onDelete).on("CrudSelect.select.change",this.onSelectChange),this.$cancelButton.on("click",this.onCancel)},i.prototype.onManage=function(t){return this.ajax(Echo.routes[this.controller][this.getRoute](this.selectedVal),{success:(e=this,function(t){return e.updateEditDiv(t)})});var e},i.prototype.onDelete=function(){return this.confirm(this.deleteMessage,this.onDeleteConfirm)},i.prototype.onDeleteConfirm=function(){return this.ajax(Echo.routes[this.controller][this.deleteRoute](this.selectedVal),{success:(t=this,function(){return t.onDeleteSuccess()})});var t},i.prototype.onCreateSuccess=function(t,e){return this.$el.trigger("CrudSelect."+this.controller+".created",e),i.__super__.onCreateSuccess.apply(this,arguments)},i.prototype.onUpdateSuccess=function(t,e){return this.$selectWrapper.trigger("Select.updateOptionText",{value:e.id,text:e.name}),this.$el.trigger("CrudSelect."+this.controller+".updated",e),this.hideEditActionDiv()},i.prototype.onDeleteSuccess=function(){return this.$el.trigger("CrudSelect."+this.controller+".deleted",[this.selectedVal]),this.$selectWrapper.trigger("Select.deleteOption",[this.selectedVal]),this.hideEditActionDiv()},i.prototype.onSelectChange=function(){return this.hideEditActionDiv(),i.__super__.onSelectChange.apply(this,arguments)},i.prototype.showAddActionDiv=function(){return this.hideEditActionDiv(),i.__super__.showAddActionDiv.apply(this,arguments)},i.prototype.showEditActionDiv=function(){return this.$editActionDiv.slideDown(this.recenter),this.hideAddActionDiv()},i.prototype.hideEditActionDiv=function(){return this.$editActionDiv.slideUp()},i.prototype.onNoneSelected=function(){return this.$contentLink.addClass("disable"),this.$el.trigger("CrudSelect.deselected"),this.hideAddActionDiv()},i.prototype.onAddSelected=function(){return this.$contentLink.addClass("disable"),this.$el.trigger("CrudSelect.deselected"),this.showAddActionDiv()},i.prototype.onItemSelected=function(){return this.$contentLink.removeClass("disable"),this.$el.trigger("CrudSelect.selected",this.selectedVal),this.hideAddActionDiv()},i.prototype.updateEditDiv=function(t){return this.$updateActionDiv.find("form").trigger("AjaxForm.CrudSelect.update.changeAction",[Echo.routes[this.controller][this.updateRoute](this.selectedVal)]),this.$updateContent.html(t.data[0].html),this.$deleteActionDiv.find("h1").text(this.i18n("Widgets.crudSelect.manage",this.$selectWrapper.find("option[value='"+this.selectedVal+"']").text())),this.showEditActionDiv()},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.DateInput=function(t){function e(){return this.onEmitDate=i(this.onEmitDate,this),this.onSetRange=i(this.onSetRange,this),this.onInputChange=i(this.onInputChange,this),this.onInputFocus=i(this.onInputFocus,this),this.onInputBlur=i(this.onInputBlur,this),this.onKeyDown=i(this.onKeyDown,this),this.onDateSelected=i(this.onDateSelected,this),this.onCalendarMousedown=i(this.onCalendarMousedown,this),this.onBodyScroll=i(this.onBodyScroll,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.debounceDelay=t.debounceDelay,this.$calendar=this.$(".calendar").on("mousedown",this.onCalendarMousedown).on("Calendar.dateSelected",this.onDateSelected),this.$input=this.$(".input").on("change input",_.debounce(this.onInputChange,this.debounceDelay)),this.$el.on("Input.focused",this.onInputFocus).on("Input.blurred",this.onInputBlur).on("DateInput.setRange",this.onSetRange).on("DateInput.emitDate",this.onEmitDate).on("keydown",this.onKeyDown),this.$body.on("scroll",this.onBodyScroll)},e.prototype.onBodyScroll=function(){return this.$calendar.hide()},e.prototype.onCalendarMousedown=function(){return setTimeout((t=this,function(){return t.$input.trigger("Input.focus")}));var t},e.prototype.onDateSelected=function(t,e){var i;return i=Echo.core.helpers.getISODateStringFromYMD(e),this.$input.trigger("Input.updateValue",i),this.$input.trigger("Input.blur"),this.triggerNewDate()},e.prototype.onKeyDown=function(t){if(t.which===this.KEYS.TAB)return this.$calendar.hide()},e.prototype.onInputBlur=function(){return setTimeout((t=this,function(){if(!t.$input.hasClass("focus"))return t.$calendar.hide()}),100);var t},e.prototype.onInputFocus=function(){return this.$calendar.show(),this.positionCalenderUnderInput()},e.prototype.onInputChange=function(){var t,e;if(t=this.sanityCheckInput())return e=Echo.core.helpers.getYMDFromISODateString(t),this.$calendar.trigger("Calendar.updateDate",e)},e.prototype.onSetRange=function(t,e){return this.$calendar.trigger("Calendar.setRange",e)},e.prototype.onEmitDate=function(){return this.triggerNewDate()},e.prototype.sanityCheckInput=function(){var t;if((t=this.inputVal()).match(/\d{4}-\d{2}-\d{2}/))return t},e.prototype.positionCalenderUnderInput=function(){var t;return(t=this.$input.offset()).top+=this.$input.outerHeight(),this.hasBottomOverflow(t.top,this.$calendar)&&(t.top=t.top-this.$input.outerHeight()-this.$calendar.outerHeight()),this.$calendar.offset(t)},e.prototype.triggerNewDate=function(){return this.$el.trigger(this.namespacedEventName("DateInput","newDate"),this.inputVal())},e.prototype.inputVal=function(){return this.$input.find("input").val()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.DateRange=function(t){function e(){return this.onSetRange=i(this.onSetRange,this),this.onReset=i(this.onReset,this),this.onEmitDates=i(this.onEmitDates,this),this.onNewEndDate=i(this.onNewEndDate,this),this.onNewStartDate=i(this.onNewStartDate,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$start=this.$(".startDate").on("DateInput.newDate",this.onNewStartDate).trigger("DateInput.emitDate"),this.$end=this.$(".endDate").on("DateInput.newDate",this.onNewEndDate).trigger("DateInput.emitDate"),this.$startDate=this.$start.find("input"),this.$endDate=this.$end.find("input"),this.$el.on("DateRange.emitDates",this.onEmitDates).on("DateRange.setRange",this.onSetRange).closest("form").on("reset",this.onReset)},e.prototype.onNewStartDate=function(t,e){var i;return this.startDate=e,null==this.initialStartDate&&(this.initialStartDate=this.startDate),(!this.endDate||this.endDate<this.startDate)&&(this.endDate=this.startDate),null!=(i=this.$endDate)&&i.trigger("Input.updateValue",this.endDate),this.triggerChange()},e.prototype.onNewEndDate=function(t,e){return this.endDate=e,null==this.initialEndDate&&(this.initialEndDate=this.endDate),this.triggerChange()},e.prototype.onEmitDates=function(){return this.triggerChange()},e.prototype.onReset=function(){return this.startDate=this.initialStartDate,this.endDate=this.initialEndDate},e.prototype.onSetRange=function(t,e){return this.$startDate.trigger("Input.updateValue",e.startDate),this.$endDate.trigger("Input.updateValue",e.endDate)},e.prototype.triggerChange=function(){return this.$el.trigger(this.namespacedEventName("DateRange","change"),{startDate:this.startDate,endDate:this.endDate})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.DateTimeRange=function(t){function e(){return this.validateTime=i(this.validateTime,this),this.onSetRange=i(this.onSetRange,this),this.onReset=i(this.onReset,this),this.onEmitDates=i(this.onEmitDates,this),this.onNewEndDate=i(this.onNewEndDate,this),this.onNewStartDate=i(this.onNewStartDate,this),this.onTimeInputChange=i(this.onTimeInputChange,this),this.onEndTimeKeyDown=i(this.onEndTimeKeyDown,this),this.onStartTimeChange=i(this.onStartTimeChange,this),this.onSetError=i(this.onSetError,this),this.onClearDateError=i(this.onClearDateError,this),this.onSetDateError=i(this.onSetDateError,this),this.onClearError=i(this.onClearError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.userChangedEndTime=!1,e.prototype.initialize=function(t){return this.namespaces=t.namespaces,this.autoUpdateEndTime=t.autoUpdateEndTime,this.lockEndDate=t.lockEndDate,this.initializeProperties(),this.initializeEvents()},e.prototype.initializeProperties=function(){if(this.$start=this.$el.find(".startDateTime"),this.$end=this.$el.find(".endDateTime"),this.$startDate=this.$start.find(".startDate input"),this.$endDate=this.$end.find(".endDate input"),this.$startTime=this.$start.find(".timeSelect"),this.$endTime=this.$end.find(".timeSelect"),this.$error=this.$el.find("> span.error"),this.$startTimeIso8601=this.$el.find("[name='"+this.namespaces.startTime+"Iso8601']"),this.$endTimeIso8601=this.$el.find("[name='"+this.namespaces.endTime+"Iso8601']"),this.autoUpdateEndTime)return this.$startTimeHours=this.$el.find("[name='"+this.namespaces.startTime+"Hours']"),this.$startTimeMeridiem=this.$el.find("[name='"+this.namespaces.startTime+"Meridiem']"),this.$endTimeHours=this.$el.find("[name='"+this.namespaces.endTime+"Hours']"),this.$endTimeMeridiem=this.$el.find("[name='"+this.namespaces.endTime+"Meridiem']")},e.prototype.initializeEvents=function(){return this.autoUpdateEndTime&&(this.$startTimeHours.on("change",this.onStartTimeChange),this.$startTimeMeridiem.on("change",this.onStartTimeChange),this.$endTimeHours.on("keydown",this.onEndTimeKeyDown)),this.$start.on("DateInput.newDate DateInput.currentDate",this.onNewStartDate).trigger("DateInput.emitDate"),this.$end.on("DateInput.newDate DateInput.currentDate",this.onNewEndDate).trigger("DateInput.emitDate",this.onNewEndDate),this.$el.on("DateRange.emitDates",this.onEmitDates).on("DateRange.setRange",this.onSetRange),this.$startDate.on("Input.setError",this.onSetDateError).on("Input.clearError",this.onClearDateError).on("change",this.onClearDateError),this.$endDate.on("Input.setError",this.onSetDateError).on("Input.clearError",this.onClearDateError).on("change",this.onClearDateError),this.$startTime.find("input").on("Input.clearError",this.onClearError).on("Input.setError",this.onSetError).on("change",this.onTimeInputChange),this.$endTime.find("input").on("Input.clearError",this.onClearError).on("Input.setError",this.onSetError).on("change",this.onTimeInputChange),this.$el.closest("form").on("reset",this.onReset)},e.prototype.onClearError=function(){return this.hideError()},e.prototype.onSetDateError=function(t,e){return this.$error.text(e)},e.prototype.onClearDateError=function(){return this.$error.text("")},e.prototype.onSetError=function(t,e){return this.showError(e)},e.prototype.onStartTimeChange=function(){return this.userChangedEndTime?this.autoUpdateEndTime?this.updateMeridiem():void 0:(this.$endTimeHours.val(this.nextHourFor(this.$startTimeHours.val())),this.autoUpdateEndTime&&this.updateMeridiem(),this.$endTimeHours.trigger("change"))},e.prototype.onEndTimeKeyDown=function(){return this.userChangedEndTime=!0},e.prototype.onTimeInputChange=function(){return this.hideError(),this.validateTime()},e.prototype.checkDateValidity=function(){var t,e;return null==this.startDate?null!=(t=this.$startDate)?t.val(this.endDate).trigger("change"):void 0:null==this.endDate||this.startDate>this.endDate?null!=(e=this.$endDate)?e.val(this.startDate).trigger("change"):void 0:this.triggerChange()},e.prototype.onNewStartDate=function(t,e){return this.startDate=e,null==this.initialStartDate&&(this.initialStartDate=this.startDate),this.lockEndDate&&this.$endDate.val(t.value),this.checkDateValidity()},e.prototype.onNewEndDate=function(t,e){return this.endDate=e,null==this.initialEndDate&&(this.initialEndDate=this.endDate),this.checkDateValidity()},e.prototype.onEmitDates=function(){return this.triggerCurrent()},e.prototype.onReset=function(){return this.startDate=this.initialStartDate,this.endDate=this.initialEndDate,this.hideError()},e.prototype.onSetRange=function(t,e){return this.$start.trigger("DateInput.setRange",e),this.$end.trigger("DateInput.setRange",e)},e.prototype.triggerChange=function(){return this.$el.trigger(this.namespacedEventName("DateRange","change"),{startDate:this.startDate,endDate:this.endDate})},e.prototype.triggerCurrent=function(){return this.$el.trigger(this.namespacedEventName("DateRange","currentDates"),{startDate:this.startDate,endDate:this.endDate})},e.prototype.showError=function(t){return this.$error.text(t),this.$el.addClass("error"),this.$startTime.addClass("error"),this.$endTime.addClass("error")},e.prototype.hideError=function(){return this.$error.text(""),this.$el.removeClass("error"),this.$startTime.removeClass("error"),this.$endTime.removeClass("error")},e.prototype.updateMeridiem=function(){return"am"===this.$startTimeMeridiem.val()&&"12"===this.$endTimeHours.val()?this.adjustEndDate(0,"pm"):"pm"===this.$startTimeMeridiem.val()&&"12"===this.$endTimeHours.val()?this.adjustEndDate(1,"am"):this.adjustEndDate(0,this.$startTimeMeridiem.find("option:selected").val())},e.prototype.adjustEndDate=function(t,e){var i,o;return(i=new Date(null!=(o=this.$startDate)?o.val():void 0)).setHours(i.getHours()+i.getTimezoneOffset()/60),i.setDate(i.getDate()+t),this.$endDate.val(Echo.core.helpers.getISODateStringFromDate(i)).trigger("change"),this.$endTimeMeridiem.val(e).trigger("change"),this.onTimeInputChange()},e.prototype.nextHourFor=function(t){return"00"===(t=Echo.core.helpers.padZero((Number(t)+1)%12,2))?"12":t},e.prototype.validateTime=function(){var t;if(t=Echo.core.helpers.getDateFromISODateTimeString(this.$startDate.val()+"T@$startTimeIso8601.val()"),Echo.core.helpers.getDateFromISODateTimeString(this.$endDate.val()+"T@$endTimeIso8601.val()")<=t)return this.showError(this.i18n("Widgets.timeRange.error.invalid"))},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.DeleteUser=function(t){function i(){var t,e;return this.onSubmit=(t=this.onSubmit,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$form=this.$("form"),this.$confirmationInput=this.$("[name=confirmationInput]"),this.$el.on("submit",this.onSubmit)},i.prototype.onSubmit=function(t,e){return this.$confirmationInput.val().toLowerCase()!==this.i18n("Admin.Users.userDeleteConfirmationPhrase").toLowerCase()?(this.$("#confirmationInput").addClass("error"),void alertify.error(this.i18n("Errors.deleteConfirmationPhraseMismatch"))):this.$form.trigger("AjaxForm.forceSubmit")},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.DependentInput=function(t){function i(){var t,e;return this.toggle=(t=this.toggle,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){var e;return e=t.inputId,this.inputValue=t.inputValue,this.input=$("#"+e),this.input.on("change",this.toggle),this.toggle()},i.prototype.toggle=function(){return"checkbox"===this.input.attr("type")?this.toggleByCheckbox():this.toggleByValue()},i.prototype.toggleByCheckbox=function(){var t,e;return t=this.input.prop("checked"),e="1"===this.inputValue?t:!t,this.updateDisplay(e)},i.prototype.toggleByValue=function(){return this.updateDisplay(this.inputValue===this.input.val())},i.prototype.updateDisplay=function(t){return t?this.$el.show():this.$el.hide()},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.DependentRadio=function(t){function i(){var t,e;return this.toggle=(t=this.toggle,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){var e,i;return e=t.radioName,i=t.switchValue,this.$radios=$("[name='"+e+"'][type='radio']"),this.$switch=this.$radios.filter("[value='"+i+"']"),this.$radios.on("change",this.toggle),this.toggle()},i.prototype.toggle=function(){return this.$el.toggle(this.$switch.prop("checked"))},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.DeviceOptionsSelect=function(t){function e(){return this.onCaptureQualityChange=i(this.onCaptureQualityChange,this),this.onDeviceInputChange=i(this.onDeviceInputChange,this),this.disableSelects=i(this.disableSelects,this),this.onBuildingChange=i(this.onBuildingChange,this),this.onCampusChange=i(this.onCampusChange,this),this.updateInputsOnRoomChange=i(this.updateInputsOnRoomChange,this),this.updateQualitiesOnRoomChange=i(this.updateQualitiesOnRoomChange,this),this.onFetchQualitySelectsSuccess=i(this.onFetchQualitySelectsSuccess,this),this.onFetchInputsSelectsSuccess=i(this.onFetchInputsSelectsSuccess,this),this.fetchQualitySelects=i(this.fetchQualitySelects,this),this.fetchInputsSelects=i(this.fetchInputsSelects,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){if(this.startDate=t.startDate,this.startTime=t.startTime,this.utcOffsetMinutes=t.utcOffsetMinutes,this.selectedInput=t.selectedInput,this.selectedQuality=t.selectedQuality,this.$deviceInputSelectWrapper=this.$(".deviceInputSelect"),this.$deviceCaptureQualitySelect=this.$(".qualitySelect"),this.$el.on("roomChange",".deviceInputSelect",this.updateInputsOnRoomChange).on("roomChange",".deviceCaptureQualitySelect",this.updateQualitiesOnRoomChange).on("campusChange",this.onCampusChange).on("buildingChange",this.onBuildingChange).on("DeviceInputs.onChange",this.onDeviceInputChange).on("CaptureQuality.onChange",this.onCaptureQualityChange),this.startDate&&this.startTime)return this.startDateTime=Echo.core.helpers.getDateFromISODateString(this.startDate,this.startTime)},e.prototype.fetchInputsSelects=function(t){return Echo.routes.RoomConfigurations.getLogicalInputs(t).ajax({success:this.onFetchInputsSelectsSuccess})},e.prototype.fetchQualitySelects=function(t){return Echo.routes.RoomConfigurations.captureQualities(t).ajax({success:this.onFetchQualitySelectsSuccess})},e.prototype.onFetchInputsSelectsSuccess=function(t){var e;return e=t.data,this.$deviceInputSelectWrapper.find(".select").trigger("Select.updateOptions",{options:e[0].html}).trigger("enable")},e.prototype.onFetchQualitySelectsSuccess=function(t){var e;return e=t.data,this.$deviceCaptureQualitySelect.find(".select").trigger("Select.updateOptions",{options:e[0].html}),this.$deviceCaptureQualitySelect.filter(".deviceCaptureQualitySelect").find(".select").trigger("enable")},e.prototype.emptyRoomSelects=function(){return this.$deviceInputSelectWrapper.find(".select").trigger("empty").trigger("disable"),this.$deviceCaptureQualitySelect.find(".select").trigger("disable")},e.prototype.updateQualitiesOnRoomChange=function(t,e){return this.onRoomChange(e,this.fetchQualitySelects)},e.prototype.onRoomChange=function(t,e){return t?e(t):this.emptyRoomSelects()},e.prototype.updateInputsOnRoomChange=function(t,e){return this.onRoomChange(e,this.fetchInputsSelects)},e.prototype.onCampusChange=function(t,e,i){return this.utcOffsetMinutes=i,this.disableSelects()},e.prototype.onBuildingChange=function(t,e){return this.disableSelects()},e.prototype.disableSelects=function(){return this.$deviceInputSelectWrapper.find(".select").trigger("disable"),this.$deviceCaptureQualitySelect.find(".select").trigger("disable")},e.prototype.onDeviceInputChange=function(t,e){if(""!==e&&e!==this.selectedInput)return this.startingWithinFiveMinutes()?alertify.alert(this.i18n("Captures.captureModal.changeDeviceInput")):void 0},e.prototype.onCaptureQualityChange=function(t,e){if(""!==e&&e!==this.selectedQuality)return this.startingWithinFiveMinutes()?alertify.alert(this.i18n("Captures.captureModal.changeCaptureQuality")):void 0},e.prototype.startingWithinFiveMinutes=function(){var t,e;if(this.startDateTime)return t=Echo.core.helpers.getDateFromUtcOffsetHours(this.utcOffsetMinutes/60),0<(e=this.startDateTime.getTime()-t.getTime())&&e<=3e5},e}()}.call(this),function(){var n={}.hasOwnProperty,e=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.widgets.DisjointSelect=function(t){function i(){var t,e;return this.update=(t=this.update,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){var e,i,o;return e=t.primaryId,o=t.secondaryId,this.exceptions=null!=(i=t.exceptions)?i:[],this.$primary=this.$("#"+e),this.$secondary=this.$("#"+o),this.$secondaryOptions=this.$("#"+o+" option"),this.$primary.on("change",this.update),this.update()},i.prototype.update=function(){var t;return this.$secondaryOptions.prop({disabled:!1}),""!==this.$primary.val()&&(t=this.$primary.val(),e.call(this.exceptions,t)<0)&&this.$secondaryOptions.filter("[value='"+this.$primary.val()+"']").prop({disabled:!0,selected:!1}),this.$secondary.trigger("change")},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Dropdown=function(t){function e(){return this.closeMenu=i(this.closeMenu,this),this.openMenu=i(this.openMenu,this),this.toggle=i(this.toggle,this),this.onKeyDown=i(this.onKeyDown,this),this.onDestroy=i(this.onDestroy,this),this.docListeners=i(this.docListeners,this),this.onDropdownClose=i(this.onDropdownClose,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.defaultClasses=["menu-up","menu-right","menu-down","menu-left"],e.prototype.initialize=function(t){return this.hover=t.hover,this.forceDirection=t.forceDirection,this.closeEvent="click.dropdown.closer",this.toggleEvent="click.dropdown."+this.$el.attr("id"),this.$dropdownToggle=this.$("a.dropdown-toggle"),this.$menu=this.$("ul.dropdown-menu"),this.$menuLink=this.$menu.find("li a"),this.$dropdownToggle.on(this.toggleEvent,this.toggle),this.$menuLink.on("click",this.closeMenu),this.hover&&this.$el.on("mouseenter mouseleave",this.toggle),this.$el.on("Dropdown.close",this.onDropdownClose),this.setDefaultClass()},e.prototype.onDropdownClose=function(){return this.closeMenu()},e.prototype.docListeners=function(){return $.extend(e.__super__.docListeners.apply(this,arguments),{"Dropdowns.destroy":this.onDestroy})},e.prototype.onDestroy=function(){return this.$dropdownToggle.off(this.toggleEvent,this.toggle),this.$menuLink.off("click",this.closeMenu),this.$doc.off(this.closeEvent,this.closeMenu).off("keydown",this.onKeyDown),this.dispose()},e.prototype.onKeyDown=function(t){if(t.which===this.KEYS.ESC)return this.closeMenu()},e.prototype.toggle=function(t){return this.$el.hasClass("open")?this.closeMenu():(this.$doc.trigger(this.closeEvent),this.reposition()),t.preventDefault(),t.stopPropagation()},e.prototype.openMenu=function(){return this.$el.addClass("open"),this.$doc.on(this.closeEvent,this.closeMenu),this.$body.on("click",this.closeMenu),this.$doc.on("keydown",this.onKeyDown),this.$el.trigger("Dropdown.opened")},e.prototype.closeMenu=function(t){return this.$el.removeClass("open"),this.$body.off("click",this.closeMenu),this.$doc.off(this.closeEvent),this.$doc.off("keydown",this.onKeyDown),t&&t.stopPropagation(),this.$el.trigger("Dropdown.closed")},e.prototype.reposition=function(){if(this.openMenu(),this.setClass(this.defaultClass),!this.forceDirection)return this.adjustForOverflow()},e.prototype.adjustForOverflow=function(){var t,e;return t=this.hasBottomOverflow(this.$menu.offset().top,this.$menu),e=this.hasRightOverflow(this.$menu.offset().left,this.$menu),t?this.setClass("menu-up-left"):e?this.setClass("menu-left"):void 0},e.prototype.setClass=function(t){var e,i,o,n;for(i=0,o=(n=this.defaultClasses).length;i<o;i++)e=n[i],this.$el.removeClass(e);return this.$el.addClass(t)},e.prototype.setDefaultClass=function(){var t,e,i,o,n,s,r;for(r=[],e=0,i=(n=this.defaultClasses).length;e<i;e++)t=n[e],0<(null!=(o=null!=(s=this.$el.attr("class"))?s.match(t):void 0)?o.length:void 0)?r.push(this.defaultClass=o[0]):r.push(void 0);return r},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.DropdownPanel=function(t){function e(){return this.position=i(this.position,this),this.stopAndPropagate=i(this.stopAndPropagate,this),this.openPanel=i(this.openPanel,this),this.closePanel=i(this.closePanel,this),this.onKeyDown=i(this.onKeyDown,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.namespace=t.namespace,this.hover=t.hover,this.id=this.$el.attr("id"),this.$body.on("DropdownPanel."+this.namespace+".open",this.openPanel).on("DropdownPanel."+this.namespace+".close",this.closePanel).on("mousedown",this.closePanel),this.$opener=this.$el.siblings("a"),this.hover?this.$opener.on("mouseenter",(o=this,function(t){return o.handleMouseEvent(t,o.openPanel)})).on("mousemove",(i=this,function(t){if(i.hover)return i.position(t)})).on("mouseleave",(e=this,function(t){return e.handleMouseEvent(t,e.closePanel)})):(this.$el.on("mousedown",function(t){return t.stopPropagation()}),this.$opener.on("mousedown",this.stopAndPropagate));var e,i,o},e.prototype.handleMouseEvent=function(t,e){return t.stopPropagation(),e(t)},e.prototype.onKeyDown=function(t){if(t.which===this.KEYS.ESC)return this.closePanel()},e.prototype.closePanel=function(t,e){if(this.hover&&this.$el.removeClass("fixed"),this.$body.off("keydown",this.onKeyDown),null==e||e!==this.id)return this.$el.hide(),this.$opener.removeClass("dropdown-open"),this.$el.trigger("DropdownPanel."+this.namespace+".closed")},e.prototype.openPanel=function(t){return this.$el.show(),this.$opener.addClass("dropdown-open"),this.hover&&this.position(t),this.$body.on("keydown",this.onKeyDown)},e.prototype.stopAndPropagate=function(t){return t.stopPropagation(),this.$body.trigger("mousedown",this.id)},e.prototype.position=function(t){return this.$el.addClass("fixed").css({top:t.clientY+10,left:t.clientX-this.$el.outerWidth()+25})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.EditUser=function(t){function e(){return this.onSubmitError=i(this.onSubmitError,this),this.onSubmit=i(this.onSubmit,this),this.onInstructorRoleChange=i(this.onInstructorRoleChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.roles=t.roles,this.$rolesError=this.$(".rolesError"),this.$form=this.$("form"),this.$adminToggle=this.$("[name=Admin]"),this.$instructorToggle=this.$("[name=Instructor]"),this.$studentToggle=this.$("[name=Student]"),this.$teachingAssistantToggle=this.$("[name=TeachingAssistant]"),this.$instructorToggle.on("change",this.onInstructorRoleChange),this.$el.on("submit",this.onSubmit).on("AjaxForm.editUser.error",this.onSubmitError)},e.prototype.onInstructorRoleChange=function(){return this.$rolesError.hide().empty()},e.prototype.onSubmit=function(t,e){var i,o,n,s,r;{if(o=this.isLosingInstructorRole(),n=this.isLosingStudentRole(),s=this.isLosingTeachingAssistantRole(),o||n||s)return i=o&&n&&s?"Admin.Users.revokeAcademicRolesWarning":o&&n?"Admin.Users.revokeInstructorAndStudentRoleWarning":o&&s?"Admin.Users.revokeInstructorAndTeachingAssistantRoleWarning":n&&s?"Admin.Users.revokeStudentAndTeachingAssistantRoleWarning":o?"Admin.Users.revokeInstructorRoleWarning":n?"Admin.Users.revokeStudentRoleWarning":"Admin.Users.revokeTeachingAssistantRoleWarning",this.confirm(i,(r=this,function(){return r.$form.trigger("AjaxForm.forceSubmit")}));this.$form.trigger("AjaxForm.forceSubmit")}},e.prototype.isLosingInstructorRole=function(){return _.contains(this.roles,"Instructor")&&!this.$instructorToggle.prop("checked")},e.prototype.isLosingStudentRole=function(){return _.contains(this.roles,"Student")&&!this.$studentToggle.prop("checked")},e.prototype.isLosingTeachingAssistantRole=function(){return _.contains(this.roles,"TeachingAssistant")&&!this.$teachingAssistantToggle.prop("checked")},e.prototype.onSubmitError=function(t,e){return _.each(e.formErrors,(i=this,function(t,e){if("obj.roles.Instructor"===e)return i.$rolesError.show().text(i.i18n(t[0].msg))}));var i},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.EmbedMedia=function(t){function e(){return this.setMedia=i(this.setMedia,this),this.resetEmbed=i(this.resetEmbed,this),this.resetFileUpload=i(this.resetFileUpload,this),this.uploadFailure=i(this.uploadFailure,this),this.uploadSuccess=i(this.uploadSuccess,this),this.enableChoice=i(this.enableChoice,this),this.handleInput=i(this.handleInput,this),this.resetMedia=i(this.resetMedia,this),this.onLearnMoreToggle=i(this.onLearnMoreToggle,this),this.onClick=i(this.onClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.fileBlob=null,this.$fileStackWrapper=this.$(".fileStack-wrapper"),this.$embedMediaOptions=this.$(".embedMedia-options"),this.$urlField=this.$(".embed-url-input input"),this.$chooseFileBtn=this.$(".choose-file-btn"),this.$uploadWrapper=this.$(".upload-preview-wrapper"),this.$embedWrapper=this.$(".embed-preview-wrapper"),this.$uploadedImage=this.$uploadWrapper.find("img"),this.$filename=this.$uploadWrapper.find("p"),this.$urlRadio=this.$("input[value=url]"),this.$fileRadio=this.$("input[value=file]"),this.$embedToggle=this.$(".embedMedia-toggle"),this.$learnMoreToggle=this.$(".learn-more"),this.$embedExplanation=this.$(".url-more-help"),this.$embedToggle.on("click",this.onClick),this.$urlField.on("keydown paste cut",this.handleInput),this.$("input[type=radio]").on("click",this.enableChoice),this.$learnMoreToggle.on("click",this.onLearnMoreToggle),this.$el.on("FileStack.success",this.uploadSuccess).on("FileStack.failure",this.uploadFailure).on("EmbedMedia.reset",this.resetMedia).on("EmbedMedia.setMedia",this.setMedia),this.$urlRadio.trigger("click")},e.prototype.onClick=function(){return this.$embedToggle.prop("checked")?this.$embedMediaOptions.show(100):this.$embedMediaOptions.hide(100)},e.prototype.onLearnMoreToggle=function(){return this.$embedExplanation.toggleClass("more")},e.prototype.resetMedia=function(){return this.resetEmbed(),this.resetFileUpload(),this.$embedExplanation.removeClass("more"),this.$urlRadio.trigger("click"),this.$embedToggle.prop("checked",!1),this.$embedMediaOptions.hide(100)},e.prototype.handleInput=function(){return this.embedify()},e.prototype.enableChoice=function(t){return t&&"url"!==$(t.target).val()?(this.$urlField.attr("disabled","disabled"),this.$chooseFileBtn.removeClass("disabled"),this.$embedWrapper.hide(),this.$uploadWrapper.show()):(this.$urlField.removeAttr("disabled"),this.$chooseFileBtn.addClass("disabled"),this.$uploadWrapper.hide(),this.$embedWrapper.show())},e.prototype.uploadSuccess=function(t,e){return this.$el.trigger("loading.off"),t.stopPropagation(),this.$uploadedImage.attr("src",e.fileBlob.url),this.fileBlob=e.fileBlob,this.$filename.html(this.fileBlob.filename),this.$el.trigger("EmbedMedia.updateFile",this.fileBlob)},e.prototype.uploadFailure=function(t,e){return t.stopPropagation(),this.resetFileUpload(),alertify.alert(this.options.fileUploadError)},e.prototype.resetFileUpload=function(){return this.$uploadedImage.attr("src",""),this.$filename.html(""),this.fileBlob=null,this.$el.trigger("EmbedMedia.updateFile")},e.prototype.resetEmbed=function(){return this.$urlField.val(""),this.$(".embed-preview").remove(),this.handleInput()},e.prototype.setMedia=function(t,e){return null!=e.file?(this.$fileRadio.trigger("click"),this.$el.trigger("loading.on",{selector:".embedMedia-options",theme:"light"}),this.$fileStackWrapper.trigger("FileUploader.getFile",e.file)):null!=e.url&&(this.$urlRadio.trigger("click"),this.$urlField.val(e.url).trigger("keydown")),this.$embedToggle.prop("checked",!0),this.onClick()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Embedifier=function(t){function e(){return this.expandEmbeddedVideo=i(this.expandEmbeddedVideo,this),this.closeEmbedPreview=i(this.closeEmbedPreview,this),this.generatePreviews=i(this.generatePreviews,this),this.embedify=i(this.embedify,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.linkRegex=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,e.prototype.initialize=function(t){return this.body=t.body,this.parentId=t.parentId,this.expandable=t.expandable,this.closable=t.closable,this.multiple=t.multiple,this.templates={photo:_.template(this.$(".image_embed_preview").html()),video:_.template(this.$(".video_embed_preview").html())},this.$parent=$("#"+this.parentId),this.options.expandable&&this.$el.on("click",".overlay",this.expandEmbeddedVideo),this.options.closable&&this.$el.on("click",".close-embedPreview",this.closeEmbedPreview),this.$doc.ready((e=this,function(){return e.$body=e.$parent.find(e.body),e.$parent.on("Embedifier.embedify",e.embedify)}));var e},e.prototype.pullUniqueLinks=function(t){return _.uniq(t.match(this.linkRegex))},e.prototype.embedify=function(t){var e,i;return 0!==(e=this.$body.is("input")?this.$body[0].value:this.$body.html()).length&&(0!==(null!=(i=this.pullUniqueLinks(e))?i.length:void 0)&&(this.multiple||(i=[i[0]]),this.fetchEmbedlyContent(i,this.generatePreviews)))},e.prototype.generatePreviews=function(t){var e,i,o,n,s;for(this.$el.find("div").remove(),s=[],e=0,i=t.length;e<i;e++)"error"===(n=t[e]).type||"video"!==(o=n.type)&&"photo"!==o||s.push(this.render(n));return s},e.prototype.showHidePreviewWrapper=function(){return this.$el.toggle(0<this.$el.find(".embed-preview").length)},e.prototype.closeEmbedPreview=function(t){return $(t.target).closest(".embed-preview").remove(),this.showHidePreviewWrapper()},e.prototype.expandEmbeddedVideo=function(t){var e,i,o;return o=(i=$(t.target)).siblings("iframe").width(),e=i.siblings("iframe").height(),i.parent().addClass("expanded"),i.siblings("iframe").height(i.siblings("iframe").width()*e/o)},e.prototype.render=function(t){var e;return e=this.templates[t.type]({media:t,expandable:this.expandable,closable:this.closable}),this.$el.append(e),"video"===t.type&&this.$("img").load(function(){return $(this).siblings(".overlay").height($(this).height()),$(this).siblings(".overlay").width($(this).width())}),this.showHidePreviewWrapper()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.EulaPrompt=function(t){function e(){return this.onSubmitError=i(this.onSubmitError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onEulaAccept=i(this.onEulaAccept,this),this.onSwitchChange=i(this.onSwitchChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$form=this.$("form"),this.$button=this.$(".acceptButton"),this.$switchInput=this.$(".switch input"),this.$(".switch").on("change",this.onSwitchChange),this.$el.on("Eula.accept",this.onEulaAccept)},e.prototype.onSwitchChange=function(){return this.$switchInput.prop("checked")?this.$button.trigger("enable"):this.$button.trigger("disable")},e.prototype.onEulaAccept=function(t){return Echo.routes.Eula.accept().ajax({success:this.onSubmitSuccess,error:this.onSubmitError})},e.prototype.onSubmitSuccess=function(){return this.$el.trigger("Modal.close")},e.prototype.onSubmitError=function(){return alertify.error(this.i18n("Errors.errorAcceptingEula")),this.$el.trigger("Modal.close")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.EventStore=function(t){function i(){var t,e;return this.onFetchByMonthAndYear=(t=this.onFetchByMonthAndYear,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("EventStore.fetchByMonthAndYear",(n=this,function(t,e,i,o){return t.stopPropagation(),n.onFetchByMonthAndYear(t,e,i,o)}));var n},i.prototype.onFetchByMonthAndYear=function(t,e,i,o){return o(e,i,[])},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Expander=function(t){function e(){return this.onClose=i(this.onClose,this),this.onOpen=i(this.onOpen,this),this.onClick=i(this.onClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.checkbox=this.$("input"),this.$el.on("change",this.onClick),this.$el.on(this.namespacedEventName("Expander","opened"),this.onOpen),this.$el.on(this.namespacedEventName("Expander","closed"),this.onClose),$(this.onClick)},e.prototype.onClick=function(){return this.checkbox.prop("checked")?this.$el.trigger(this.namespacedEventName("Expander","opened")):this.$el.trigger(this.namespacedEventName("Expander","closed"))},e.prototype.onOpen=function(){return this.checkbox.prop("checked",!0)},e.prototype.onClose=function(){return this.checkbox.prop("checked",!1)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.FeatureToggle=function(t){function e(){return this.cancel=i(this.cancel,this),this.onError=i(this.onError,this),this.onToggleUpdateSuccess=i(this.onToggleUpdateSuccess,this),this.updateToggle=i(this.updateToggle,this),this.onToggle=i(this.onToggle,this),this.updateView=i(this.updateView,this),this.onUpdateChild=i(this.onUpdateChild,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){if(this.associationType=t.associationType,this.associationId=t.associationId,this.toggleType=t.toggleType,this.disabled=t.disabled,this.disabledByParent=t.disabledByParent,this.disableCanOverride=t.disableCanOverride,this.$parentToggle=this.$el.children(".parentToggle"),0!==this.$parentToggle.length)return this.$el.on("FeatureToggle.updateChild",this.onUpdateChild),this.$canOverride=this.$parentToggle.find("input[name=canOverride]"),this.$toggle=this.$parentToggle.find("[name=toggleEnabled]"),this.$subToggles=this.$el.children(".subToggles").find(".featureToggle"),this.updateView()},e.prototype.onUpdateChild=function(t,e,i,o){var n;if(t.stopPropagation(),this.disabledByParent=!e,this.disableCanOverride=!i,this.updateView(),this.$el.toggleClass("disabled",this.disabled||this.disabledByParent),this.subToggle=function(){var t,e,i;for(i=[],t=0,e=o.length;t<e;t++)(n=o[t]).feature===this.toggleType&&i.push(n);return i}.call(this)[0],this.subToggle)return this.$toggle.prop("checked",this.subToggle.isEnabled),this.$canOverride.prop("disabled",this.subToggle.canOverride)},e.prototype.updateView=function(){return this.disableCanOverride&&(this.disabled||this.disabledByParent)?this.$canOverride.prop("disabled",!0).off("change",this.updateToggle):this.$canOverride.prop("disabled",!1).off("change",this.updateToggle).on("change",this.updateToggle),this.disabled||this.disabledByParent?this.$toggle.trigger("disable").off("change",this.onToggle):this.$toggle.trigger("enable").off("change",this.onToggle).on("change",this.onToggle)},e.prototype.onToggle=function(){var t;return this.checked=this.$toggle.prop("checked"),t=this.checked?"Toggles."+this.toggleType+".toggleOnConfirmation":"Toggles."+this.toggleType+".toggleOffConfirmation",this.confirm(t,this.updateToggle,this.cancel)},e.prototype.updateToggle=function(){var e,t,i,o;return this.loadingOn(null,{theme:"light",opacity:"transparent",selector:"form"}),this.loadingOn(null,{theme:"light",opacity:"transparent",selector:".toggle-switch"}),t=function(){switch(this.associationType){case"institution":return Echo.routes.Toggles.updateForInstitution(this.toggleType);case"organization":return Echo.routes.Toggles.updateForOrganization(this.associationId,this.toggleType);case"department":return Echo.routes.Toggles.updateForDepartment(this.associationId,this.toggleType);case"section":return Echo.routes.Toggles.updateForSection(this.associationId,this.toggleType);case"lesson":return Echo.routes.Toggles.updateForLesson(this.associationId,this.toggleType)}}.call(this),e={isEnabled:this.$toggle.prop("checked"),canOverride:this.$canOverride.prop("checked")},this.ajax(t,{data:e,success:(o=this,function(t){return o.onToggleUpdateSuccess(e.isEnabled,e.canOverride,t.data)}),error:this.onError,complete:(i=this,function(){return i.loadingOff(null,{selector:".toggle-switch"}),i.loadingOff(null,{selector:"form"})})})},e.prototype.onToggleUpdateSuccess=function(t,e,i){return alertify.success(this.i18n("Toggles.updateSuccess")),this.updateView(),this.$subToggles.trigger("FeatureToggle.updateChild",[t,e,i])},e.prototype.onError=function(){return alertify.error(this.i18n("Toggles.updateError"))},e.prototype.cancel=function(){var t;return t=this.$toggle.prop("checked"),this.$toggle.prop("checked",!t)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.FileStack=function(t){function e(){return this.reset=i(this.reset,this),this.processBlob=i(this.processBlob,this),this.onSingleSuccess=i(this.onSingleSuccess,this),this.resetErrorList=i(this.resetErrorList,this),this.onErrorListClose=i(this.onErrorListClose,this),this.onClose=i(this.onClose,this),this.onError=i(this.onError,this),this.getFile=i(this.getFile,this),this.loadPicker=i(this.loadPicker,this),this.loadOptions=i(this.loadOptions,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e;return this.config=t.config,this.embed=t.embed,this.inputName=t.inputName,this.$embedContainer=this.$(".embedContainer"),this.fileAlertContainer=this.$(".upload-errors"),this.fileErrorModal=this.$(".fileUploaderModal"),this.$el.on("FileUploader.reset",this.reset).on("FileUploader.getFile",this.getFile).on("click",".close-btn",this.onErrorListClose).on("Modal.fileStackError.onClose",this.resetErrorList),this.checkFileStack=setInterval((e=this,function(){if("undefined"!=typeof filestack&&null!==filestack)return clearInterval(e.checkFileStack),e.loadOptions(),e.$el.on("FileStack.pick",e.loadPicker)}),500),this.fileErrorList=[]},e.prototype.loadOptions=function(){var t;return this.client=filestack.init(this.config.fileStackAPIKey),t={fromSources:this.config.uploadParameters.fileSources,maxSize:this.config.uploadParameters.maxSize,uploadInBackground:!1,onFileUploadFinished:this.onSingleSuccess,onFileUploadFailed:this.onError,onClose:this.onClose,concurrency:this.config.uploadParameters.fileConcurrency,storeTo:{location:"S3",region:this.config.region,access:"private",container:this.config.container,path:this.config.institutionId+"/"},uploadConfig:{timeout:this.config.uploadParameters.timeout,partSize:this.config.uploadParameters.partSize,retry:this.config.uploadParameters.retryAttempts,concurrency:this.config.uploadParameters.partConcurrency}},this.config.uploadParameters.acceptedFiles&&(t.accept=this.config.uploadParameters.acceptedFiles),t.maxFiles=this.config.uploadParameters.enableMultiUpload?this.config.uploadParameters.maxFiles:1,this.pickerInstance=this.client.picker(t)},e.prototype.loadPicker=function(){return this.pickerInstance.open()},e.prototype.getFile=function(t,e){var i;return e.filename=e.name,e.container=this.config.container,i=_.map(e.url.split("/"),function(t){return decodeURIComponent(t.replace(/\+/g," "))}),e.key=i.slice(-2).join("/"),this.processBlob(e)},e.prototype.onError=function(t,e){var i,o,n;if(n=e.name,"Upload cancelled"!==(o=e.message))return i={error:n+": "+o,file:t},this.enableMultiUpload&&this.fileErrorList.push(t.filename),this.sendToAirbrake(i,"FileStack upload failure"),this.$el.trigger("FileStack.failure",e)},e.prototype.onClose=function(){var t,e,i,o,n,s,r;if(this.config.uploadParameters.enableMultiUpload&&0<this.fileErrorList.length){for(t=this.fileAlertContainer.find(".error-file-list"),i=n=0,s=(r=this.fileErrorList).length;n<s;i=++n)e=r[i],o=$("<li></li>").text(e),t.append(o);this.$el.trigger("Modal.fileStackError.open")}return this.$el.trigger("FileStack.pickerClose")},e.prototype.onErrorListClose=function(){return this.$el.trigger("Modal.fileStackError.close")},e.prototype.resetErrorList=function(){return this.fileAlertContainer.find(".error-file-list").empty(),this.fileErrorList=[]},e.prototype.onSingleSuccess=function(t){return this.processBlob(t)},e.prototype.fileMetadataRequired=function(t){return t.handle&&(null==t.height||null==t.width)},e.prototype.processBlob=function(e){var t,i,o,n,s,r;return e.container=null!=(t=e.container)?t:this.config.container,e.s3Url=this.getS3Path(e),this.render(e),this.fileMetadataRequired(e)?null!=(i=this.client)?i.metadata(e.handle,{width:!0,height:!0}).then((r=this,function(t){return null!=e&&(e.height=t.height),null!=e&&(e.width=t.width),r.render(e),r.$el.trigger("FileStack.success",{fileBlob:e})})).catch((s=this,function(t){return null!=e&&(e.height=0),null!=e&&(e.width=0),s.render(e),s.$el.trigger("FileStack.success",{fileBlob:e})})):void 0:(e.height=null!=(o=e.height)?o:0,e.width=null!=(n=e.width)?n:0,this.$el.trigger("FileStack.success",{fileBlob:e}))},e.prototype.getS3Path=function(t){var e;return e=_.map(t.key.split("/"),function(t){return encodeURIComponent(t)}),""+this.config.baseS3Url.replace("%s",t.container)+e.join("/")},e.prototype.reset=function(t,e){return this.render(null!=e?e.pop:void 0)},e.prototype.render=function(t){return this.embed?this.$embedContainer.html(this.formHtml(t)):this.$embedContainer.empty()},e.prototype.formHtml=function(t){return null==t?"":"<fieldset data-type='hash' data-name='"+this.inputName+"'> "+this.imageHtml(t)+" <fieldset data-type='hash' data-name='file'> <input type='hidden' name='url' value='"+t.url+"'> <input type='hidden' name='mimetype' value='"+t.mimetype+"'> <input type='hidden' name='size' value='"+t.size+"' data-type='number'> <input type='hidden' name='filename' value='"+t.filename+"'> <input type='hidden' name='key' value='"+t.key+"'> <input type='hidden' name='container' value='"+t.container+"'> "+this.imageHtml(t)+" </fieldset> </fieldset>"},e.prototype.imageHtml=function(t){var e;return-1===(null!=(e=t.mimetype)?e.indexOf("image"):void 0)?"":"<input type='hidden' name='width' value='"+t.height+"' data-type='number'> <input type='hidden' name='height' value='"+t.width+"' data-type='number'>"},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.FormInput=function(t){function e(){return this.hideError=i(this.hideError,this),this.onClearError=i(this.onClearError,this),this.onSetError=i(this.onSetError,this),this.render=i(this.render,this),this.validateMaxValue=i(this.validateMaxValue,this),this.onFormReset=i(this.onFormReset,this),this.onFormClear=i(this.onFormClear,this),this.onUpdateValue=i(this.onUpdateValue,this),this.onInputFocus=i(this.onInputFocus,this),this.onInputEnable=i(this.onInputEnable,this),this.onInputDisable=i(this.onInputDisable,this),this.onInputChange=i(this.onInputChange,this),this.onInputBlur=i(this.onInputBlur,this),this.onKeyup=i(this.onKeyup,this),this.removeIgnoreAutocomplete=i(this.removeIgnoreAutocomplete,this),this.onAutocompleteChange=i(this.onAutocompleteChange,this),this.ignoreAutocomplete=i(this.ignoreAutocomplete,this),this.onKeydown=i(this.onKeydown,this),this._calculatePasswordStrength=i(this._calculatePasswordStrength,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e,i,o;return e=t.autocomplete,this.clearable=t.clearable,this.displayLabel=t.displayLabel,this.displayRequired=t.displayRequired,this.inputType=t.inputType,this.maxLength=t.maxLength,this.showPasswordStrength=t.showPasswordStrength,this.validateMaxLength=t.validateMaxLength,this.$form=this.$el.closest("form"),this.$input=this.$("input, textarea"),this.$labelText=this.$("label .text"),this.$labelRequiredAsterisk=this.$("label .required-asterisk"),this.$editable=this.$("[contenteditable]"),this.$passwordStrength=this.$(".password-strength"),this.displayRequired?this.$labelText.addClass("with-required"):this.$el.addClass("non-required"),this.input="contenteditable"===this.inputType?this.$editable:this.$input,"contenteditable"===this.inputType&&this.initContentEditablePlaceholder(),this.$el.on("enable",this.onInputEnable).on("disable",this.onInputDisable).on("Input.focus",(o=this,function(){return o.input.focus()})).on("Input.blur",(i=this,function(){return i.input.blur()})).on("Input.updateValue",this.onUpdateValue).on("Input.setError",this.onSetError).on("Input.clearError",this.onClearError).on("keydown",this.onKeydown),this.$form.on("reset",this.onFormReset),this.clearable&&this.$form.on("clear",this.onFormClear),this.input.on("focus",this.onInputFocus).on("blur",this.onInputBlur).on("change",this.onInputChange).on("keyup",this.onKeyup),this.calculatePasswordStrength=_.debounce(this._calculatePasswordStrength,200),(this.displayLabel||this.displayRequired||this.maxLength&&this.validateMaxLength)&&this.onInputChange(),e||this.ignoreAutocomplete(),this.setupClipboard(this.$input[0]),this.calculatePasswordStrength()},e.prototype._calculatePasswordStrength=function(){var s,r;if(this.showPasswordStrength)return s=this.input.val(),this.ajax(Echo.routes.Accounts.getPasswordStrength(),{data:{id:s},success:(r=this,function(t){var e,i,o,n;return n=null!=(i=null!=(e=t.data)&&null!=(o=e[0])?o.score:void 0)?i:0,r.$passwordStrength.toggleClass("strong",4===n).toggleClass("good",3===n).toggleClass("weak",0!==s.length&&n<3),r.$passwordStrength.find(".strength-text").text(r.i18n(r.getPasswordStrengthText(n,s)))})})},e.prototype.getPasswordStrengthText=function(t,e){return 4===t?"Labels.strong":3===t?"Labels.good":2===t?"Labels.medium":0!==e.length?"Labels.weak":""},e.prototype.onKeydown=function(t){var e;if((e=t.which)===this.KEYS.ARROW_LEFT||e===this.KEYS.ARROW_RIGHT||e===this.KEYS.ARROW_UP||e===this.KEYS.ARROW_DOWN)return t.stopPropagation()},e.prototype.ignoreAutocomplete=function(){return this.initialVal=this.input.val(),this.$el.on("change",this.onAutocompleteChange),setTimeout(this.removeIgnoreAutocomplete,250)},e.prototype.onAutocompleteChange=function(t){return t.preventDefault(),t.stopPropagation(),this.input.val(this.initialVal),this.removeIgnoreAutocomplete()},e.prototype.removeIgnoreAutocomplete=function(){return this.$el.off("change",this.onAutocompleteChange)},e.prototype.initContentEditablePlaceholder=function(){return this.$editable.on("change keydown keypress input",Echo.core.helpers.onContentEditableChange),this.$editable.trigger("change")},e.prototype.getVal=function(){return("contenteditable"===this.inputType?this.input.text():this.input.val()).trim()},e.prototype.setVal=function(t){return"contenteditable"===this.inputType?this.input.text(t):this.input.val(t)},e.prototype.onKeyup=function(t){if(t.which!==this.KEYS.ENTER)return this.hideError(),this.calculatePasswordStrength(),this.displayLabel||this.displayRequired||this.maxLength&&this.validateMaxLength?(this.maxLength&&this.validateMaxValue(t),this.onInputChange(t,!0)):void 0},e.prototype.onInputBlur=function(){return this.$el.removeClass("focus"),this.$el.trigger("Input.blurred")},e.prototype.onInputChange=function(t,e){return this.displayLabel&&this.updateLabel(),this.displayRequired&&this.updateRequired(),e||this.hideError(),this.calculatePasswordStrength()},e.prototype.onInputDisable=function(){return this.disabled=!0,this.render()},e.prototype.onInputEnable=function(){return this.disabled=!1,this.render()},e.prototype.onInputFocus=function(){return this.$el.addClass("focus"),this.$el.trigger("Input.focused")},e.prototype.onUpdateValue=function(t,e){return this.setVal(e).trigger("change")},e.prototype.onFormClear=function(){return this.setVal("").trigger("change")},e.prototype.onFormReset=function(){return setTimeout((t=this,function(){return t.input.trigger("change")}));var t},e.prototype.updateLabel=function(){return this.$labelText.toggleClass("show",""!==this.getVal())},e.prototype.updateRequired=function(){return this.$labelRequiredAsterisk.toggleClass("red",""===this.getVal())},e.prototype.validateMaxValue=function(t){return this.getVal().length>this.maxLength?this.showError(this.i18n("Input.error.exceedsMaxLength",this.maxLength),!0):this.hideError()},e.prototype.render=function(){return this.$el.toggleClass("disabled",this.disabled),this.input.prop({disabled:this.disabled})},e.prototype.onSetError=function(t,e){return this.showError(e)},e.prototype.onClearError=function(t){return null!=t&&t.stopPropagation(),this.hideError(t)},e.prototype.showError=function(t,e){return this.$input.attr("aria-invalid","true"),this.$el.hasClass("error")||this.$el.trigger("Input.onError",e),this.$el.addClass("error").find("span.error").text(t).show(),this.$passwordStrength.find(".strength-text").hide()},e.prototype.hideError=function(t){if(null!=t&&t.stopPropagation(),this.$input.removeAttr("aria-invalid"),this.$el.hasClass("error"))return this.$el.removeClass("error").find("span.error").text(""),this.$el.trigger("Input.onErrorFixed"),this.$passwordStrength.find(".strength-text").show()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.ImageSelect=function(t){function e(){return this.onFilepickerSuccess=i(this.onFilepickerSuccess,this),this.onImageRemove=i(this.onImageRemove,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.institutionId=t.institutionId,this.$preview=this.$("img.preview"),this.$input=this.$("input"),this.$container=this.$(".image-container"),this.$el.on("FileStack.success",this.onFilepickerSuccess),this.$el.on("ImageSelect.remove",this.onImageRemove)},e.prototype.onImageRemove=function(){return this.$preview.removeAttr("src"),this.$input.val(""),this.$container.removeClass("has-image")},e.prototype.onFilepickerSuccess=function(t,e){var i,o,n;return i=e.fileBlob.s3Url,Echo.routes.Accounts.newPreviewImageUrl(i,this.institutionId).ajax({success:(n=this,function(t){var e;return e=t.data,n.$preview.attr("src",e[0].previewImageUrl)}),error:(o=this,function(){return o.$preview.attr("src",i)})}),this.$input.val(i),this.$container.addClass("has-image")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.ImportModal=function(t){function e(){return this.onError=i(this.onError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onFilepickerSuccess=i(this.onFilepickerSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.namespace=t.namespace,this.timeout=t.timeout,this.url=t.url,this.timeout=parseInt(this.timeout),this.$el.on("FileStack.success",this.onFilepickerSuccess)},e.prototype.onFilepickerSuccess=function(t,e){return this.$el.trigger("Modal."+this.namespace+".close"),this.submit(e.fileBlob.s3Url,e.fileBlob.filename)},e.prototype.onSubmitSuccess=function(t){return this.$el.trigger("ImportModal."+this.namespace+".imported",t.data)},e.prototype.submit=function(t,e){var i,o;return i={contentType:"application/json",data:JSON.stringify({url:t,filename:e}),type:"POST",url:this.url,success:this.onSubmitSuccess,error:this.onError,complete:(o=this,function(){return o.$el.trigger("loading.off")})},null!=this.timeout&&0!==this.timeout&&(i=$.extend(i,{timeout:this.timeout})),this.$el.trigger("loading.on",{fixed:!0}),$.ajax(i)},e.prototype.onError=function(t,e,i){var o,n,s,r;return o=null!=(s=null!=(n=Echo.core.form.getErrorJSON(t))&&null!=(r=n["obj."][0])?r.msg:void 0)?s:this.i18n("Alert.genericError"),alertify.alert(o)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.InputList=function(t){function e(){return this.onReset=i(this.onReset,this),this.removeEntryDom=i(this.removeEntryDom,this),this.removeEntry=i(this.removeEntry,this),this.addEntry=i(this.addEntry,this),this.addDefaultEntries=i(this.addDefaultEntries,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e,i;if(e=t.useTemplateAsDefault,this.maxEntries=t.maxEntries,this.requireEntry=t.requireEntry,this.customRemove=t.customRemove,this.$el.on("click",".addEntryButton",(i=this,function(){return i.addEntry(i.templateHtml())})).on("click",".removeEntryButton",this.removeEntry).on("InputList.removeItem",this.removeEntryDom).closest("form").on("reset",this.onReset),this.template=this.$(".template"),this.addDefaultEntries(),e&&0===this.$(".defaultEntry").length)return this.addEntry(this.templateHtml())},e.prototype.addDefaultEntries=function(){var t,e,i,o,n;for(n=[],e=0,i=(o=this.$(".defaultEntry")).length;e<i;e++)t=o[e],n.push(this.addEntry($($(t).html())));return n},e.prototype.addEntry=function(t){var e,i,o,n,s;return n=null!=(s=this.$(".list .entry").last().attr("data-index"))?s:0,o=parseInt(n)+1,(i=t.attr("data-index",o)).html(i.html().replace(/INDEX/g,o)),e=Echo.core.helpers.replaceIds(i).appendTo(this.$(".list")),this.$el.trigger(this.namespacedEventName("InputList","itemAdded"),[e]),this.hideAddControlsIfNeeded()},e.prototype.removeEntry=function(t){var e,i;if(e=$(t.currentTarget).closest(".entry"),!this.requireEntry||1!==e.data("index")){if(!this.customRemove)return e.slideUp({duration:200,done:(i=this,function(){return i.removeEntryDom(null,e)})});this.$el.trigger(this.namespacedEventName("InputList","checkRemoveItem"),e)}},e.prototype.removeEntryDom=function(t,e){return this.$(e).remove(),this.showAddControls(),this.$el.trigger(this.namespacedEventName("InputList","itemRemoved"))},e.prototype.numberOfEntries=function(){return this.$(".list .entry").length},e.prototype.hideAddControlsIfNeeded=function(){if(null!=this.maxEntries)return this.numberOfEntries()>=this.maxEntries?this.$(".addEntryButton, .addPrompt").hide():void 0},e.prototype.showAddControls=function(){return this.$(".addEntryButton, .addPrompt").slideDown(200)},e.prototype.onReset=function(){return this.$(".list .entry").remove(),this.addDefaultEntries()},e.prototype.templateHtml=function(){return $(this.template.html())},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.LessonContent=function(t){function e(){return this.onSearch=i(this.onSearch,this),this.onLessonChangeError=i(this.onLessonChangeError,this),this.onLessonChangeSuccess=i(this.onLessonChangeSuccess,this),this.onLessonChange=i(this.onLessonChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.sectionId=t.sectionId,this.$body.on("LessonSelect.change",this.onLessonChange).on("LessonContent.search",this.onSearch)},e.prototype.onLessonChange=function(t,e){var i,o;return i=e.lessonId,this.loadingOn(),this.ajax(this.route(i),{success:(o=this,function(t){return o.onLessonChangeSuccess(t,i)}),error:this.onLessonChangeError})},e.prototype.onLessonChangeSuccess=function(t,e){return this.$el.html(t).trigger("LessonContent.updated",e)},e.prototype.onLessonChangeError=function(t){return this.loadingOff(),alertify.error(this.i18n("Errors.lessonContent.error"))},e.prototype.route=function(t){return""!==t?this.lessonRoute(this.sectionId,t):this.sectionRoute(this.sectionId)},e.prototype.onSearch=function(t,e){var i;return""===(i=e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").toLowerCase())?this.$(".studentList-item").show():this.$(".studentList-item").hide().filter("[data-name*='"+i+"']").show()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.LessonSelect=function(t){function e(){return this.onSearch=i(this.onSearch,this),this.onRelativeNavigationRight=i(this.onRelativeNavigationRight,this),this.onRelativeNavigationLeft=i(this.onRelativeNavigationLeft,this),this.onSelectChange=i(this.onSelectChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$select=this.$("select"),this.$search=this.$('[name="searchText"]'),this.$select.on("change",this.onSelectChange),this.$search.on("keyup",this.onSearch),this.$el.on("RelativeNavigation.left",this.onRelativeNavigationLeft),this.$el.on("RelativeNavigation.right",this.onRelativeNavigationRight),$((t=this,function(){return t.triggerChange()}));var t},e.prototype.onSelectChange=function(){return this.triggerChange()},e.prototype.onRelativeNavigationLeft=function(){var t;if(0<(t=this.$select.find("option:selected").prev()).length)return this.$select.val(t.val()).trigger("change")},e.prototype.onRelativeNavigationRight=function(){var t;if(0<(t=this.$select.find("option:selected").next()).length)return this.$select.val(t.val()).trigger("change")},e.prototype.triggerChange=function(){return $("body").trigger("LessonSelect.change",{lessonId:this.$select.val()})},e.prototype.onSearch=function(){return this.$el.trigger("LessonContent.search",this.$search.val())},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.LibraryFile=function(t){function e(){return this.onGetMediaItemError=i(this.onGetMediaItemError,this),this.onGetMediaItemSuccess=i(this.onGetMediaItemSuccess,this),this.getUpdatedMedia=i(this.getUpdatedMedia,this),this.onMediaDownload=i(this.onMediaDownload,this),this.onUnshareFromSelfError=i(this.onUnshareFromSelfError,this),this.onUnshareFromSelfCallback=i(this.onUnshareFromSelfCallback,this),this.onUnshareFromSelf=i(this.onUnshareFromSelf,this),this.onReProcessingError=i(this.onReProcessingError,this),this.onReProcessingSuccess=i(this.onReProcessingSuccess,this),this.onReProcess=i(this.onReProcess,this),this.onMediaDetailEdited=i(this.onMediaDetailEdited,this),this.onMediaDeleteError=i(this.onMediaDeleteError,this),this.onConfirmDelete=i(this.onConfirmDelete,this),this.onDelete=i(this.onDelete,this),this.openPreviewModal=i(this.openPreviewModal,this),this.wireClicks=i(this.wireClicks,this),this.onInfoEditModalOpen=i(this.onInfoEditModalOpen,this),this.onPublishModalOpen=i(this.onPublishModalOpen,this),this.onKeyUp=i(this.onKeyUp,this),this.bodyListeners=i(this.bodyListeners,this),this.onDispose=i(this.onDispose,this),this.onCopyError=i(this.onCopyError,this),this.onCopySuccess=i(this.onCopySuccess,this),this.onCopy=i(this.onCopy,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.mediaType=t.mediaType,this.mediaStatus=t.mediaStatus,this.preliminary=t.preliminary,this.wireClicks(),this.$el.on("keyup",this.onKeyUp).on("Media.previewModal.open",this.openPreviewModal).on("Media.publishModal.open",this.onPublishModalOpen).on("Media.infoEditModal.open",this.onInfoEditModalOpen).on("Media.delete",this.onDelete).on("Media.reprocess",this.onReProcess).on("Media.unshareFromSelf",this.onUnshareFromSelf).on("Media.copy",this.onCopy).on("dispose",this.onDispose)},e.prototype.onCopy=function(t){return t.stopPropagation(),this.confirm("Captures.createCopy.confirm",(e=this,function(){return Echo.routes.Media.copy(e.mediaId).ajax({beforeSend:function(){return e.loadingOn(null,{fixed:!0})},success:e.onCopySuccess,complete:e.loadingOff,error:e.onCopyError})}));var e},e.prototype.onCopySuccess=function(){return alertify.success(this.i18n("Captures.createCopy.success"))},e.prototype.onCopyError=function(){return alertify.error(this.i18n("Captures.createCopy.error"))},e.prototype.onDispose=function(t){return t.stopImmediatePropagation(),this.dispose()},e.prototype.bodyListeners=function(){var t;return(t={})["Library.list.destroy"]=this.dispose,t["Media."+this.options.mediaId+".edited"]=this.onMediaDetailEdited,t["Media."+this.options.mediaId+".published"]=this.getUpdatedMedia,t["Media."+this.options.mediaId+".processed"]=this.getUpdatedMedia,t["Media."+this.options.mediaId+".download"]=this.onMediaDownload,t["Media."+this.options.mediaId+".unshared"]=this.onUnshareCallback,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onKeyUp=function(t){if(t.which===this.KEYS.ENTER)return this.openPreviewModal()},e.prototype.onPublishModalOpen=function(){return this.injectFromUrl(Echo.routes.Publish.publisherModal(this.mediaId))},e.prototype.onInfoEditModalOpen=function(){return this.injectFromUrl(Echo.routes.Media.editorModal(this.mediaId))},e.prototype.wireClicks=function(){return this.$el.off("click").on("click",this.openPreviewModal)},e.prototype.openPreviewModal=function(){var t;if("processed"===this.mediaStatus||"processing"===this.mediaStatus&&this.preliminary)return this.$el.off("click"),t=$.param(Echo.helpers.Location.parseHash()),window.location.assign(Echo.routes.Media.details(this.mediaId).url+"?"+t)},e.prototype.onDelete=function(){return this.confirm("Library.warning.delete",this.onConfirmDelete)},e.prototype.onConfirmDelete=function(){return Echo.routes.Media.delete(this.mediaId).ajax({success:this.dispose,error:this.onMediaDeleteError})},e.prototype.onMediaDeleteError=function(t,e){var i,o,n;return i=null!=(o=null!=t&&null!=(n=t.responseJSON)?n.message:void 0)?o:this.i18n("Library.error.delete"),alertify.error(i)},e.prototype.onMediaDetailEdited=function(t,e){return this.$el.find("p.name").text(e.updatedMedia.name)},e.prototype.onReProcess=function(){return Echo.routes.Media.reprocess(this.mediaId).ajax({success:this.onReProcessingSuccess,error:this.onReProcessingError})},e.prototype.onReProcessingSuccess=function(t){return alertify.success(this.i18n("Media.reprocess.success")),this.$el.replaceWith(t)},e.prototype.onReProcessingError=function(t){return alertify.error(this.i18n("Media.publish.error.reProcessingError"))},e.prototype.onUnshareFromSelf=function(){return Echo.routes.Publish.unshareFromSelf(this.mediaId).ajax({success:this.onUnshareFromSelfCallback,error:this.onUnshareFromSelfError})},e.prototype.onUnshareFromSelfCallback=function(t){return alertify.success(this.i18n("Media.unshareFromSelf.success")),this.$el.fadeOut(500)},e.prototype.onUnshareFromSelfError=function(t){return alertify.error(this.i18n("Media.unshareFromSelf.error"))},e.prototype.onMediaDownload=function(t){return this.injectFromUrl(Echo.routes.MediaDownload.downloadModal(this.mediaId))},e.prototype.getUpdatedMedia=function(){return Echo.routes.Library.getMediaListItem(this.mediaId).ajax({success:this.onGetMediaItemSuccess,error:this.onGetMediaItemError})},e.prototype.onGetMediaItemSuccess=function(t){return this.$el.replaceWith(t.data[0].html),this.dispose()},e.prototype.onGetMediaItemError=function(){return alertify.error(this.i18n("Library.error.getUpdatedMedia"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.LineChart=function(t){function e(){return this.onToggle=i(this.onToggle,this),this.onSelect=i(this.onSelect,this),this.onScrollRight=i(this.onScrollRight,this),this.onScrollLeft=i(this.onScrollLeft,this),this.onResize=i(this.onResize,this),this.onHideUnselected=i(this.onHideUnselected,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),300,500,e.prototype.initialize=function(t){var e;return this.data=t.data,this.width=t.width,this.height=t.height,e=t.selected,this.xAxisType=t.xAxisType,this.maxElementsToDisplay=t.maxElementsToDisplay,this.monthNames=t.monthNames,this.xAxisSceneLength=t.xAxisSceneLength,this.setup(),this.draw(),this.$el.on("LineChart.hideUnselected",this.onHideUnselected).on("LineChart.select",this.onSelect).on("LineChart.toggle",this.onToggle),null!=this.width&&null!=this.height||this.$el.on("resize",_.debounce(this.onResize,500)),this.$(".scroll.left").on("click",this.onScrollLeft),this.$(".scroll.right").on("click",this.onScrollRight),this.selectSeries(e)},e.prototype.draw=function(){return this.svgWidth=null!=this.width?this.width:this.$el.width(),this.svgHeight=null!=this.height?this.height:this.$el.height(),this.drawSVG(),this.setupFilters(),this.drawBackground(),this.drawXAxis(),this.drawYAxes(),this.drawLines(),this.drawOverlay(),this.setupScroll()},e.prototype.drawSVG=function(){return this.scrollBarWidth=this.scrollable?20:0,this.topMargin=10,this.bottomMargin="date"===this.xAxisType?60:40,this.leftMargin=this.rightMargin=0===this.scrollBarWidth?15:15+this.scrollBarWidth,this.graphWidth=this.svgWidth-this.leftMargin-this.rightMargin,this.graphHeight=this.svgHeight-this.topMargin-this.bottomMargin,this.scrollable?(this.scrollableElementWidth=this.graphWidth/(this.maxElementsToDisplay-1),this.scrollableWidth=this.scrollableElementWidth*(this.domain.length-1),this.scrollLeft=this.scrollableWidth-this.graphWidth):(this.scrollableWidth=this.graphWidth,this.scrollLeft=0),this.svg=d3.select(this.$("svg")[0]).attr("width",this.svgWidth).attr("height",this.svgHeight).append("g").attr("transform","translate("+this.leftMargin+","+this.topMargin+")")},e.prototype.drawBackground=function(){if(!(this.graphWidth<0||this.graphHeight<0))return this.svg.append("rect").attr("class","background").attr("width",this.graphWidth).attr("height",this.graphHeight)},e.prototype.drawXAxis=function(){var l,c,u,t;return this.xScale=d3.scale.ordinal().rangePoints([0,this.scrollableWidth],0).domain(this.domain),t=d3.svg.axis().scale(this.xScale).tickSize(-this.graphHeight),this.gxAxis=this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.graphHeight+")").call(t),this.gxAxis.selectAll("text").attr("dy",28).attr("x",0),c=(l=this).xScale.range(),u=c[1]/2,this.svg.selectAll(".xlabel").remove(),"sceneNumber"===this.xAxisType&&this.svg.append("text").attr("class","xlabel").attr("y",this.graphHeight+15).attr("text-anchor","middle").text(l.i18n("Labels.time")),this.gxAxis.selectAll(".tick").each(function(t,e){var i,o,n,s,r,a,h;for("sceneNumber"===!l.xAxisType&&d3.select(this).insert("circle","text").attr("r",12).attr("cy",27),r=(o=[["hover-left",-(s=(n=0)===e?0:u),s],["hover-right",0,e===c.length-1?0:u]]).length;n<r;n++){if(i=(a=o[n])[0],h=a[1],(u=a[2])<0)return;d3.select(this).insert("rect","line").attr("class",i).attr("width",u).attr("height",l.graphHeight).attr("x",h).attr("y",-l.graphHeight)}return d3.select(this).insert("rect","line").attr("class","lineHover").attr("width",6).attr("height",l.graphHeight).attr("x",-3).attr("y",-l.graphHeight).style("filter","url(#blur)")}),this.formatXAxis()},e.prototype.setupFilters=function(){return this.svg.append("defs").append("filter").attr("id","blur").append("feGaussianBlur").attr("stdDeviation",8)},e.prototype.drawYAxes=function(){var t,e,i,o,n,s,r,a,h,l,c,u;for(this.yScales={},h=[],t=0,i=(r=this.data).length;t<i;t++)e=(a=r[t]).label,s=a.percent,l=a.values,o=s?1:(n=d3.max(l.map(function(t){return t[1]})),Math.max(2*Math.ceil(n/2),2)),c=d3.scale.linear().range([this.graphHeight,0]).domain([0,o]),u=d3.svg.axis().scale(c).tickValues([0,o/2,o]).tickSize(-this.graphWidth).orient("left"),s&&u.tickFormat(function(t){return 100*t}),this.svg.append("g").attr("class","y axis").attr("data-series",e).call(u).selectAll("text").attr("x",5).attr("y",10).style("text-anchor","start"),h.push(this.yScales[e]=c);return h},e.prototype.drawLines=function(){var t,e,i,o,n,s,r,a,h,l,c,u;if(!(this.graphWidth<0)){for(r=this.svg.append("svg").attr("class","wrapper").attr("width",this.graphWidth).attr("height",this.graphHeight+this.bottomMargin).attr("overflow","hidden"),l=[],i=0,n=(a=this.data).length;i<n;i++)t=(h=a[i]).color,e=h.display,o=h.label,s=1===(c=h.values).length?(c=[[0,u=c[0][1]],[this.graphWidth,u]],this.xHorizontalLine(o)):this.xScaledLine(o),l.push(r.append("path").classed("series",!0).attr("d",s(c)).attr("data-series",o).style("stroke",t).style("display",!1===e?"none":null));return l}},e.prototype.xHorizontalLine=function(e){return d3.svg.line().interpolate("linear").x(function(t){return t[0]}).y((i=this,function(t){return i.yScales[e](t[1])}));var i},e.prototype.xScaledLine=function(e){return d3.svg.line().interpolate("linear").x((o=this,function(t){return o.xScale(t[0])})).y((i=this,function(t){return i.yScales[e](t[1])}));var i,o},e.prototype.drawOverlay=function(){var f,t,e,g;if(g=null,e=function(){return g=null,f.gxAxis.selectAll(".tick").classed("selected",!1),f.$el.trigger("LineChart.clearValues"),f.hideTooltip(f.$el)},t=function(){var t,s,e,i,o,n,r,a,h,l,c,u,p,d;if((d=d3.mouse(this)[0])-(a=f.xScale.range())[(s=d3.bisectLeft(a,d))-1]<a[s]-d&&(s-=1),g!==s){for(g=s,f.hideTooltip(f.$el),u=f.gxAxis.select(".tick:nth-child("+(s+1)+")"),f.gxAxis.selectAll(".tick").classed("selected",!1),u.classed("selected",!0),f.gxAxis.selectAll(".tick:first-of-type").classed("hiddenCaptureTick",s<5),f.gxAxis.selectAll(".tick:last-of-type").classed("hiddenCaptureTick",a.length-s<6),t=function(){var t,e,i,o,n;for(n=[],t=0,e=(i=f.data).length;t<e;t++)l=i[t],n.push({label:l.label,percent:l.percent,value:null!=(o=l.values[s])?o[1]:void 0});return n}(),f.$el.trigger("LineChart.displayValues",{data:t}),p=[],e=0,o=(h=f.data).length;e<o;e++)(l=h[e]).label===f.selected&&null!=l.tooltips&&(p=l.tooltips);if(p.length){if(s>=p.length&&(s=p.length-1),!p[s])return;if(a=f.xScale.range(),null==(n=u.node()))return;return i=(r=n.getBoundingClientRect()).left-f.$el.offset().left+r.width/2,c=p[s],0===s?f.createToolTip(f.$el,c,"first","","top",a[0],!1):s===a.length-1?f.createToolTip(f.$el,c,"last","","top",0,!1):f.createToolTip(f.$el,c,"","","top",i,!0)}}},!((f=this).scrollableWidth<0))return this.svg.append("rect").attr("class","overlay").attr("width",this.scrollableWidth).attr("height",this.graphHeight).on("mouseout",e).on("mousemove",t)},e.prototype.formatXAxis=function(){return"date"===this.xAxisType&&this.formatXAxisAsDate(),"sceneNumber"===this.xAxisType&&this.formatXAxisAsVideoScene(),"slideNumber"===this.xAxisType&&this.formatXAxisAsSlideNumber(),this.gxAxis.classed("time","sceneNumber"===this.xAxisType),this.updateXAxis()},e.prototype.formatXAxisAsDate=function(){var r;return(r=this).gxAxis.selectAll(".tick").each(function(t,e){var i,o,n,s;return o=null!=(s=r.data[0].domainLabels[e])?s:t,n=Echo.core.helpers.getDateFromISODateString(o)>new Date,d3.select(this).classed("future",n),d3.select(this).on("mouseover",r.createToolTip.bind(r,e)).on("mouseout",r.hideTooltip.bind(r)),""===o?d3.select(this).select("text").text("-"):(i=Echo.core.helpers.getYMDFromISODateString(o),d3.select(this).select("text").classed("date",!0).text(i.day),d3.select(this).append("text").attr("transform","rotate(270)").attr("class","month").attr("text-anchor","end").text(r.monthNames[i.month-1]).attr("y",3).attr("x",-4).attr("dy",0).attr("dx",-35))})},e.prototype.formatXAxisAsVideoScene=function(){var o;return(o=this).gxAxis.selectAll(".tick").each(function(t,e){var i;return i=Echo.core.helpers.msToTime(t*o.xAxisSceneLength*1e3,{optionalPadding:!0,hideZeroHours:!0}),d3.select(this).select("text").text(i)})},e.prototype.formatXAxisAsSlideNumber=function(){return this.gxAxis.selectAll(".tick").each(function(t,e){return d3.select(this).select("text").text(t+1)})},e.prototype.onHideUnselected=function(){return this.$el.find("path:not(.selected)").hide()},e.prototype.onResize=function(){return this.$("svg").empty(),this.draw(),this.selectSeries(this.selected)},e.prototype.onScrollLeft=function(){return this.scrollLeft=Math.max(this.scrollLeft-this.graphWidth,0),this.scroll()},e.prototype.onScrollRight=function(){return this.scrollLeft=Math.min(this.scrollRight(),this.scrollableWidth-this.graphWidth),this.scroll()},e.prototype.onSelect=function(t,e){var i;return i=e.label,this.$el.find('path[data-series="'+i+'"]').show(),this.selectSeries(i)},e.prototype.onToggle=function(t,e){var i;return i=e.label,this.$el.find('path[data-series="'+i+'"]').toggle()},e.prototype.scroll=function(){var t;return(t=this.svg.transition().duration(300).ease("quad-in")).selectAll("path, .overlay").attr("transform","translate("+-1*this.scrollLeft+",0)"),t.select(".x.axis").attr("transform","translate("+-1*this.scrollLeft+","+this.graphHeight+")"),this.updateXAxis()},e.prototype.scrollEnd=function(t){return Echo.core.helpers.minimalDifference(this.scrollRight(),this.scrollLocation(t))},e.prototype.scrollLocation=function(t){return this.scrollableElementWidth*t},e.prototype.scrollRight=function(){return this.scrollLeft+this.graphWidth},e.prototype.scrollStart=function(t){return Echo.core.helpers.minimalDifference(this.scrollLeft,this.scrollLocation(t))},e.prototype.scrollVisible=function(t){var e;return this.scrollStart(t)||this.scrollEnd(t)||this.scrollLeft<(e=this.scrollLocation(t))&&e<this.scrollRight()},e.prototype.selectSeries=function(t){return this.selected=t,this.$el.find(".y.axis[data-series]").hide(),this.$el.find('.y.axis[data-series="'+t+'"]').show(),this.svg.selectAll("path[data-series]").classed("selected",!1),this.svg.selectAll('path[data-series="'+t+'"]').classed("selected",!0)},e.prototype.setup=function(){var t,e,i,o;for(t=0,e=(i=this.data).length;t<e;t++)null==(o=i[t]).values&&(o.values=[]);return this.domain=this.data[0].values.map(function(t){return t[0]}),this.scrollable=null!=this.maxElementsToDisplay&&this.maxElementsToDisplay<this.domain.length},e.prototype.setupScroll=function(){if(this.$(".scroll").css({height:this.graphHeight,width:this.scrollBarWidth-1,top:this.topMargin}),this.$(".scroll.left").css({left:0}),this.$(".scroll.right").css({right:0}),this.$(".scroll").toggle(this.scrollable),this.scrollable)return this.scroll()},e.prototype.toggleWithFade=function(t,e){var i;return i=e?"fadeIn":"fadeOut",this.$(t)[i](300)},e.prototype.updateXAxis=function(){if(this.scrollable&&this.updateXAxisScrollable(),"date"===this.xAxisType)return this.updateXAxisMonthDisplay()},e.prototype.updateXAxisScrollable=function(){var i;return(i=this).gxAxis.selectAll(".tick").each(function(t,e){return i.toggleWithFade(this,i.scrollVisible(e)),d3.select(this).classed("left",i.scrollStart(e)).classed("right",i.scrollEnd(e))})},e.prototype.updateXAxisMonthDisplay=function(){var a;return(a=this).gxAxis.selectAll(".tick .month").each(function(t,e){var i,o,n,s,r;return i=null!=(n=a.data[0].domainLabels[e])?n:t,o=0!==e?null!=(s=a.data[0].domainLabels[e-1])?s:a.domain[e-1].timing.start:void 0,r=0===e||Echo.core.helpers.monthsDifferent(i,o)||a.scrollable&&a.scrollStart(e),d3.select(this).classed("repeat",!r)})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.LineChartSeriesManager=function(t){function e(){return this.hideUnselected=i(this.hideUnselected,this),this.toggleSeries=i(this.toggleSeries,this),this.selectSeries=i(this.selectSeries,this),this.displayValues=i(this.displayValues,this),this.clearValues=i(this.clearValues,this),this.initializeSeriesList=i(this.initializeSeriesList,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.lineChart=this.$(".line-chart"),this.series=this.$(".legend [data-series]"),this.$seriesList=this.$(".series-list"),this.hideUnselectedLink=this.$("[data-action=hide-unselected]"),this.initializeSeries(),this.initializeSeriesList(),this.hideUnselectedLink.on("click",this.hideUnselected),this.series.on("click",this.selectSeries),this.series.on("click",".circle",this.toggleSeries),this.lineChart.on("LineChart.displayValues",this.displayValues),this.lineChart.on("LineChart.clearValues",this.clearValues),this.$doc.on("resize",this.initializeSeriesList)},e.prototype.initializeSeriesList=function(){var t,e;return e=$(this.series[0]).outerWidth(!0),t=Math.min(Math.floor(this.$el.width()/e),this.series.length),this.$seriesList.width(t*e)},e.prototype.initializeSeries=function(){return this.series.each((n=this,function(t,e){var i,o;if(i=(e=$(e)).attr("data-series"),"none"!==(o=n.lineChart.find('path[data-series="'+i+'"]')).css("display")&&e.addClass("show"),d3.select(o[0]).classed("selected"))return e.addClass("selected")}));var n},e.prototype.clearValues=function(){return this.series.find(".value").text("")},e.prototype.displayValues=function(t,e){var i,o,n,s,r,a,h;for(a=[],o=0,s=(i=e.data).length;o<s;o++)n=(r=i[o]).label,null==(h=r.value)&&(h=0),r.percent&&(h=Math.round(100*h)+"%"),a.push(this.series.filter('[data-series="'+n+'"]').find(".value").text(h));return a},e.prototype.selectSeries=function(t){var e;if(!(e=$(t.currentTarget)).hasClass("selected"))return this.series.removeClass("selected"),e.addClass("selected show"),this.lineChart.trigger("LineChart.select",{label:e.attr("data-series")})},e.prototype.toggleSeries=function(t){var e;if(t.stopPropagation(),!(e=$(t.currentTarget).parents("[data-series]")).hasClass("selected"))return e.toggleClass("show"),this.lineChart.trigger("LineChart.toggle",{label:e.attr("data-series")})},e.prototype.hideUnselected=function(t){var e;return e=$(t.currentTarget),this.series.not(".selected").removeClass("show"),this.lineChart.trigger("LineChart.hideUnselected",{label:e.attr("data-series")})},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.LivePlayer=function(t){function i(){var t,e;return this.onLivestreamStarted=(t=this.onLivestreamStarted,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){var e,i,o;return this.iframeId=t.iframeId,this.iframe=document.getElementById(this.iframeId),this.bubbleIframeMouseEvent(this.iframe,"mousemove"),this.bubbleIframeMouseEvent(this.iframe,"mouseclick"),this.$body.on("Livestream.started",this.onLivestreamStarted),this.$el.on("click",".toggle-livestream",(e=this,function(t){return e.toggleVideo(t,e.iframe,e.$el.find(".toggle-livestream"))})),this.$body.on("LivePlayer.resume",(i=this,function(){return i.resumeVideo(i.iframe,i.$el.find(".toggle-livestream"))})),this.$body.on("LivePlayer.pause",(o=this,function(){return o.pauseVideo(o.iframe,o.$el.find(".toggle-livestream"))}))},i.prototype.toggleVideo=function(t,e,i){return i.closest(".liveplayer").hasClass("playing")?(this.$body.trigger("LivePlayer.pause"),t.stopPropagation(),!1):this.$body.trigger("LivePlayer.resume")},i.prototype.resumeVideo=function(t,e){return e.closest(".liveplayer").hasClass("started")&&(e.closest(".liveplayer").addClass("playing"),e.text(this.i18n("Classroom.hideLiveStream"))),t.contentWindow.resumeVideo()},i.prototype.pauseVideo=function(t,e){return e.closest(".liveplayer").removeClass("playing"),e.text(this.i18n("Classroom.showLiveStream")),t.contentWindow.pauseVideo()},i.prototype.onLivestreamStarted=function(){return this.$el.addClass("started")},i.prototype.bubbleIframeMouseEvent=function(o,n){var s;return s=o.contentWindow["on"+n],o.contentWindow["on"+n]=function(t){var e,i;return null!=s&&s(t),i=document.createEvent("MouseEvents"),e=o.getBoundingClientRect(),i.initMouseEvent(n,!0,!1,window,t.detail,t.screenX,t.screenY,t.clientX+e.left,t.clientY+e.top,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,null),o.dispatchEvent(i)}},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Modal=function(t){function e(){return this.onMouseUp=i(this.onMouseUp,this),this.onBodyKeyUp=i(this.onBodyKeyUp,this),this.onElKeyUp=i(this.onElKeyUp,this),this.triggerCloseEvent=i(this.triggerCloseEvent,this),this.showLoadingContent=i(this.showLoadingContent,this),this.replaceContent=i(this.replaceContent,this),this.disposeModal=i(this.disposeModal,this),this.openModal=i(this.openModal,this),this.closeModal=i(this.closeModal,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.screenReaderElementsToHide=["[role=header]","[role=search]","[role=menu]"],e.prototype.initialize=function(t){var e;if(this.disposeOnClose=t.disposeOnClose,this.namespace=t.namespace,this.open=t.open,this.closeable=t.closeable,this.resetFocusInModal=t.resetFocusInModal,this.showUnsavedWarning=t.showUnsavedWarning,this.formNamespace=t.formNamespace,null==this.closeable&&(this.closeable=!0),this.modalIsOpen=!1,this.prefix="Modal."+this.namespace,this.openEvent=this.prefix+".open",this.closeEvent=this.prefix+".close",this.disposeEvent=this.prefix+".dispose",this.replaceContentEvent=this.prefix+".replaceContent",this.showLoadingContentEvent=this.prefix+".showLoadingContent",this.$form=this.$("form"),this.$content=this.$(".modal-body"),this.$background=this.$(".modal-backdrop"),this.$fakeInput=this.createFakeInput(),this.$firstInput=Echo.core.helpers.getFocusableElements(this.$(".modal-body-content")).first(),this.closeable&&(this.$(".modal-backdrop").on("click",this.triggerCloseEvent),this.$el.on("keyup.#{@namespace}",this.onElKeyUp)),this.$el.on("Modal.open",this.openModal).on("Modal.close",this.closeModal).on("mouseup",this.onMouseUp),this.showUnsavedWarning&&0<this.$form.length&&this.formNamespace&&this.$form.on("AjaxForm."+this.formNamespace+".success",(e=this,function(){return e.formData=e.$form.serialize()})),this.$body.on(this.openEvent,this.openModal).on(this.closeEvent,this.closeModal).on(this.disposeEvent,this.disposeModal).on(this.replaceContentEvent,this.replaceContent).on(this.showLoadingContentEvent,this.showLoadingContent).on("keyup.#{@namespace}",this.onBodyKeyUp),this.setAriaLabelledBy(),this.open)return setTimeout(this.openModal,20)},e.prototype.setupModalForScreenReader=function(){return this.otherModalsVisible()&&$(".modal").attr("aria-hidden",!0),this.toggleElementsForScreenReader(!0),this.$el.attr("aria-hidden",!1)},e.prototype.setAriaLabelledBy=function(){var t,e;if(t=this.$el.attr("aria-label"),e=this.$("h1").text(),null==t)return this.$el.attr("aria-label",e)},e.prototype.restorePageComponentsForScreenReader=function(){return this.otherModalsVisible()?$(".modal:visible").last().attr("aria-hidden",!1):this.toggleElementsForScreenReader(!1),this.$el.attr("aria-hidden",!0)},e.prototype.otherModalsVisible=function(){return 0<$(".modal:visible").not(this.$el).length},e.prototype.toggleElementsForScreenReader=function(t){var e,i,o,n,s;for(s=[],i=0,o=(n=this.screenReaderElementsToHide).length;i<o;i++)e=n[i],s.push($(e).attr("aria-hidden",t));return s},e.prototype.closeModal=function(t){var e,i;if(t.stopPropagation(),this.modalIsOpen)return this.showUnsavedWarning&&this.formData!==(null!=(e=this.$form)?e.serialize():void 0)?this.confirm("Modal.unsavedChanges",(i=this,function(){return i._closeModal()})):this._closeModal()},e.prototype._closeModal=function(){if(this.modalIsOpen=!1,$("body").css({overflow:"auto"}),this.$el.hide(),this.$("form").trigger("reset"),this.$el.trigger(this.prefix+".onClose",this.$el),this.restorePageComponentsForScreenReader(),this.disposeOnClose)return this.disposeModal()},e.prototype.openModal=function(t){var e;if(this.modalIsOpen=!0,this.$el.show(),$("body").css({overflow:"hidden"}),this.$el.trigger(this.prefix+".onOpen",this.$el),this.setupModalForScreenReader(),this.focusFirstInput(),this.showUnsavedWarning)return this.formData=null!=(e=this.$form)?e.serialize():void 0},e.prototype.disposeModal=function(t){return this.$el.trigger(this.prefix+".onDispose"),this.dispose()},e.prototype.replaceContent=function(t,e){return this.$(".modal-body-content").html(e)},e.prototype.showLoadingContent=function(){return this.loadingOn(null,{selector:".modal-body-content"})},e.prototype.triggerCloseEvent=function(t){return t.stopPropagation(),this.$body.trigger(this.closeEvent)},e.prototype.onElKeyUp=function(t){if(t.which!==this.KEYS.TAB&&t.stopPropagation(),t.which===this.KEYS.ESC)return this.triggerCloseEvent(t)},e.prototype.onBodyKeyUp=function(t){var e;if(e=0!==$(":focus").length,this.modalIsOpen&&e&&this.focusedElementNotInsideModalBody()&&this.resetFocusInModal)return this.focusFirstInput()},e.prototype.onMouseUp=function(){if(this.focusedElementNotInsideModalBody()&&this.resetFocusInModal)return this.$fakeInput.focus()},e.prototype.focusedElementNotInsideModalBody=function(){return 0===this.$(":focus").length},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.MutexManager=function(t){function e(){return this.onError=i(this.onError,this),this.timedRefresh=i(this.timedRefresh,this),this.refreshEditorKey=i(this.refreshEditorKey,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.refreshRate=t.refreshRate,this.$el.on("Mutex.getKey",this.refreshEditorKey)},e.prototype.refreshEditorKey=function(){return setTimeout(this.timedRefresh,parseInt(this.refreshRate))},e.prototype.timedRefresh=function(){return Echo.routes.Media.refreshEditorKey(this.mediaId).ajax({success:this.refreshEditorKey,error:this.onError})},e.prototype.onError=function(t){var e;return alertify.error(null!=(e=t.responseJSON)?e.message:void 0)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.NavUserInfo=function(t){function i(){var t,e;return this.onSuccess=(t=this.onSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$name=this.$(".user-dropdown-link"),this.$panelName=this.$(".user-dropdown-panel .name"),this.$body.on("AjaxForm.updateUser.success",this.onSuccess)},i.prototype.onSuccess=function(t,e){return this.$name.text(e.name),this.$panelName.text(e.name)},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.PasswordWithShow=function(t){function i(){var t,e;return this.toggle=(t=this.toggle,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){return this.switchId=t.switchId,this.input=this.$("input"),this.switch=$("#"+this.switchId),this.switch.on("change",this.toggle)},i.prototype.toggle=function(){var t;return t=this.switch.prop("checked")?"text":"password",this.input.attr("type",t)},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.PhoneNumberFormInput=function(t){function e(){return this.generateHtml=i(this.generateHtml,this),this.onPhoneNumberError=i(this.onPhoneNumberError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$formHtml=this.$(".phoneNumberHtml"),this.$codeSelect=this.$("select"),this.$number=this.$("input"),this.$el.closest("form").on("AjaxForm.updateUser.error AjaxForm.editUser.error AjaxForm.registerUser.error",this.onPhoneNumberError),this.$codeSelect.on("change",this.generateHtml),this.$number.on("change",this.generateHtml),this.generateHtml()},e.prototype.onPhoneNumberError=function(t,e){var i,o,n,s;if(null!=(null!=e?e.formErrors:void 0)){for(i in s=[],n=e.formErrors)o=n[i],"obj.number"===i&&(null!=e.error&&alertify.error(e.error),s.push(this.$number.trigger("Input.setError",this.i18n(o[0].msg,o[0].args))));return s}},e.prototype.generateHtml=function(){return""===$.trim(this.$number.val())?this.$formHtml.empty():this.$formHtml.html("<fieldset data-type='hash' data-name='phoneNumber'> <input type='hidden' name='region' value='"+this.$codeSelect.val()+"'/> <input type='hidden' name='number' value='"+this.$number.val()+"'/> </fieldset>")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.PieChart=function(t){function i(){var t,e;return this.onUpdateData=(t=this.onUpdateData,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){var e,i,o,n;return e=t.data,n=t.width,i=t.height,o=t.pieWidth,this.draw(e,n,i,o),this.updateData(e),this.$el.on("PieChart.updateData",this.onUpdateData)},i.prototype.draw=function(t,e,i,o){var n;return n=Math.min(e,i)/2-10,this.arc=d3.svg.arc().outerRadius(n).innerRadius(n-o),this.pie=d3.layout.pie().sort(null).value(function(t){return+t.value}),this.svg=d3.select(this.el).attr("width",e).attr("height",i).append("g").attr("transform","translate("+e/2+","+i/2+")")},i.prototype.onUpdateData=function(t,e){var i;return i=e.data,this.updateData(i)},i.prototype.updateData=function(t){var e,i,o,n,s,r,a;for(o=0,n=t.length;o<n;o++)(e=t[o]).value=+e.value;return s=t.reduce(function(t,e){return t+e.value},0),this.svg.selectAll(".arc").data(this.pie(t)).enter().append("g").attr("class","arc").attr("cursor","pointer"),(i=this.svg.selectAll(".arc")).selectAll("path").remove(),i.append("path").attr("d",this.arc).style("fill",function(t){return t.data.color}),i.on("mouseenter",(r=this,function(t){return r.$el.trigger("PieChart.mouseenterSection",$.extend(t.data,{sum:s}))})),i.on("mouseleave",(a=this,function(t){return a.$el.trigger("PieChart.mouseleaveSection")}))},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.PingOne=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e,i,o,n;return o=t.openToken,n=t.saasId,e=t.accountId,window.pingOneParams={ssoDivId:this.$el.attr("id"),openToken:o,saasId:n,accountId:e},(i=document.createElement("script")).type="text/javascript",i.async=!0,i.id="insertScript",i.src="https://admin.pingone.com/web-portal/integrate.js",this.$el.append(i)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.PingoneModal=function(t){function e(){return this.onPingoneOpen=i(this.onPingoneOpen,this),this.onInstitutionChange=i(this.onInstitutionChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.dom={submitButton:this.$(".pingoneLogin"),institutionSelect:this.$(".pingoneInstitution")},this.$body.on("openPingoneModal",this.onPingoneOpen),this.dom.institutionSelect.on("change",this.onInstitutionChange)},e.prototype.onInstitutionChange=function(t){return t.target.value?this.dom.submitButton.trigger("enable"):this.dom.submitButton.trigger("disable")},e.prototype.onPingoneOpen=function(t){return this.loadingOn(null,{fixed:!0}),Echo.routes.Institutions.getInstitutionsWithIdpid().ajax({success:(i=this,function(t){var e;return e=t.data,i.loadingOff(),i.$body.trigger("Modal.pingoneLogin.open"),i.updateInstitutionOptions(e[0].html)}),error:(e=this,function(){return e.loadingOff(),e.$body.trigger("Modal.pingoneLogin.close"),alertify.error(e.i18n("Alert.genericError"))})});var e,i},e.prototype.updateInstitutionOptions=function(t){var e;return e={options:t,keepEmptyOption:!0},this.dom.institutionSelect.trigger("Select.updateOptions",e).trigger("enable")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.PollingImage=function(t){function i(){var t,e;return this.reloadImage=(t=this.reloadImage,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){var e;return e=t.pollDuration,this.pollDurationMs=1e3*e,this.src=this.$el.attr("src"),setTimeout(this.reloadImage,this.pollDurationMs)},i.prototype.reloadImage=function(){return this.$el.attr("src",this.src+this.getCacheBreakString()),setTimeout(this.reloadImage,this.pollDurationMs)},i.prototype.getCacheBreakString=function(){return"#"+ +new Date},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.ProgressBar=function(t){function e(){return this.incrementProgress=i(this.incrementProgress,this),this.onUpdate=i(this.onUpdate,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){if(this.percentage=t.percentage,this.maxPercentage=t.maxPercentage,this.estimatedSecondsToCompletion=t.estimatedSecondsToCompletion,this.initializePercentages(),this.percentageBar=this.$(".percentage-bar"),this.percentageText=this.$(".percentage-text"),this.$el.on("ProgressBar.update",this.onUpdate),null!=this.estimatedSecondsToCompletion)return this.scheduleProgress()},e.prototype.initializePercentages=function(){return null==this.percentage&&(this.percentage=0),null==this.maxPercentage&&(this.maxPercentage=100),this.minPercentage=Echo.core.helpers.clamp(this.percentage,{min:0,max:this.maxPercentage}),this.percentageDelta=this.maxPercentage-this.percentage},e.prototype.onUpdate=function(t,e){return this.update(e)},e.prototype.update=function(t){if(this.percentage=Echo.core.helpers.clamp(t,{min:this.minPercentage,max:this.maxPercentage}),this.$el.attr("title",this.percentage+"%"),this.percentageBar.clearQueue().animate({width:this.percentage+"%"},1e3),null!=this.percentageText[0])return this.percentageText.text(this.percentage+"%")},e.prototype.scheduleProgress=function(){return setTimeout(this.incrementProgress,1e3*this.estimatedSecondsToCompletion/this.percentageDelta)},e.prototype.incrementProgress=function(){if(this.update(this.percentage+1),this.percentage<this.maxPercentage)return this.scheduleProgress()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.PublicLinkList=function(t){function e(){return this.updateListState=i(this.updateListState,this),this.onError=i(this.onError,this),this.onSuccess=i(this.onSuccess,this),this.onAddPublicLink=i(this.onAddPublicLink,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.createUrl=t.createUrl,this.$linkList=this.$(".publicLinks"),this.$el.on("PublicLink.add",this.onAddPublicLink).on("PublicLink.deleted",this.updateListState),this.updateListState()},e.prototype.onAddPublicLink=function(){return $.ajax({url:this.createUrl,method:"POST",success:this.onSuccess,error:this.onError})},e.prototype.onSuccess=function(t){var e,i;return e=t.data,this.$el.removeClass("no-results"),this.$linkList.append(null!=e&&null!=(i=e[0])?i.html:void 0),alertify.success(this.i18n("PublicLink.create.success"))},e.prototype.onError=function(){return alertify.alert(this.i18n("PublicLink.create.error"))},e.prototype.updateListState=function(){if(0===this.$(".public-link:not(.toBeDeleted)").length)return this.$el.addClass("no-results")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Question=function(t){function e(){return this.onLessonClick=i(this.onLessonClick,this),this.markQuestionRead=i(this.markQuestionRead,this),this.isUnread=i(this.isUnread,this),this.editQuestion=i(this.editQuestion,this),this.onDeleteQuestion=i(this.onDeleteQuestion,this),this.handleDelete=i(this.handleDelete,this),this.deleteQuestion=i(this.deleteQuestion,this),this.updateLike=i(this.updateLike,this),this.onQuestionEditUpdate=i(this.onQuestionEditUpdate,this),this.onQuestionStatusUpdate=i(this.onQuestionStatusUpdate,this),this.onToggleLike=i(this.onToggleLike,this),this.toggleLike=i(this.toggleLike,this),this.likeOrUnlike=i(this.likeOrUnlike,this),this.onUpdateBookmark=i(this.onUpdateBookmark,this),this.onToggleBookmark=i(this.onToggleBookmark,this),this.toggleBookmark=i(this.toggleBookmark,this),this.toggleBookmarkClient=i(this.toggleBookmarkClient,this),this.setSelectedError=i(this.setSelectedError,this),this.setSelectedSuccess=i(this.setSelectedSuccess,this),this.onComplete=i(this.onComplete,this),this.beforeSelect=i(this.beforeSelect,this),this.setSelected=i(this.setSelected,this),this.updateResponseCount=i(this.updateResponseCount,this),this.onUpdateSlides=i(this.onUpdateSlides,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e,i,o;return this.questionId=t.questionId,this.contentRef=t.contentRef,this.file=t.file,this.filename=t.filename,this.image=t.image,this.isClassroom=t.isClassroom,this.$questionBody=this.$(".question-body"),this.$parent=this.$el.parent(),this.$bookmark=this.$(".bookmark"),this.$like=this.$(".like"),this.$responseCount=this.$(".responseCount"),this.$lessonTitle=this.$(".title"),this.$reference=this.$(".reference"),this.big=this.$el.hasClass("expanded"),this.id=this.$el.attr("id"),this.lessonId=this.$el.data("lessonId"),this.question={id:this.questionId,anonymous:this.$el.data("anonymous"),lessonId:this.lessonId,html:$.trim(this.$questionBody.html()),contentRef:this.contentRef,file:this.file,filename:this.filename,image:this.image},this.$el.on("update.like",this.updateLike).on("update.bookmark",this.onUpdateBookmark).on("delete.resource",this.deleteQuestion).on("delete.question",this.onDeleteQuestion).on("edit.resource",this.editQuestion).on("destroy",(i=this,function(){return i.dispose()})),this.$lessonTitle.on("click",this.onLessonClick),this.big||this.$el.on("click",this.setSelected),this.$bookmark.on("click",this.toggleBookmark),this.$like.on("click",this.toggleLike),"Slide"===(null!=(e=this.contentRef)?e.content.type:void 0)&&$("body").on("SlideDeck."+this.contentRef.content.slideDeck.id+".updateSlides",this.onUpdateSlides),this.linkify(this.$(".question-body")),this.big&&this.embedify(),this.$doc.ready((o=this,function(){return o.updateUnreadCount()}))},e.prototype.bodyListeners=function(){var t;return(t={})["question."+this.options.questionId+".status"]=this.onQuestionStatusUpdate,t["question."+this.options.questionId+".deleted"]=this.handleDelete,t["question."+this.options.questionId+".edited"]=this.onQuestionEditUpdate,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onUpdateSlides=function(t,e){var i,o,n,s,r,a,h,l;if(h=e.slideIds,null!=(i=this.contentRef)&&null!=(o=i.content)&&null!=(n=o.slide)?n.slide.id:void 0)return l=(l=h.indexOf(null!=(s=this.contentRef)&&null!=(r=s.content)&&null!=(a=r.slide)?a.slide.id:void 0))<0?1:l+1,this.$reference.text(this.i18n("Labels.slide")+" "+l)},e.prototype.updateUnreadCount=function(){return this.$el.trigger("update.unreadQuestionCount")},e.prototype.updateResponseCount=function(t){return this.$responseCount.text(t)},e.prototype.setSelected=function(){return Echo.routes.Questions.getWithResponses().ajax({beforeSend:this.beforeSelect,success:this.setSelectedSuccess,error:this.setSelectedError,complete:this.onComplete,data:{isClassroom:this.isClassroom,questionId:this.question.id}})},e.prototype.beforeSelect=function(){return this.$el.closest(".questions-content").trigger("loading.on",{selector:".right-panel",theme:"light",opacity:"solid"}),this.$el.addClass("selected")},e.prototype.onComplete=function(){return this.$el.closest(".questions-content").trigger("loading.off",{selector:".right-panel"})},e.prototype.setSelectedSuccess=function(t){return this.markQuestionRead(),this.$parent.trigger("setSelected.question",this.id),this.$el.trigger("reload.expandedQuestion",t)},e.prototype.setSelectedError=function(t){return this.$el.removeClass("selected")},e.prototype.toggleBookmarkClient=function(){return this.$bookmark.toggleClass("active",!this.$bookmark.hasClass("active")),this.markQuestionRead()},e.prototype.toggleBookmark=function(t){var e;return t.stopPropagation(),e=this.getBookmarkRoute(),this.toggleBookmarkClient(),e.ajax({success:this.onToggleBookmark,error:this.toggleBookmarkClient})},e.prototype.getBookmarkRoute=function(){return this.$(".bookmark").hasClass("active")?Echo.routes.Questions.forget(this.question.id):Echo.routes.Questions.bookmark(this.question.id)},e.prototype.onToggleBookmark=function(t){if(this.$el.hasClass("selected")||this.$el.hasClass("expanded"))return this.$parent.trigger("update.bookmark",{id:this.question.id,bookmarked:this.$bookmark.hasClass("active"),sendTo:this.findTarget()})},e.prototype.onUpdateBookmark=function(t,e){return t.stopPropagation(),this.$bookmark.toggleClass("active",e)},e.prototype.markLiked=function(){return this.$like.addClass("active").text(+this.$like.text()+1)},e.prototype.markUnliked=function(){return this.$like.removeClass("active").text(+this.$like.text()-1)},e.prototype.likeOrUnlike=function(){return this.$like.hasClass("active")?this.markUnliked():this.markLiked()},e.prototype.toggleLike=function(t){var e;return t.stopPropagation(),e=this.getLikeRoute(),this.likeOrUnlike(),e.ajax({success:this.onToggleLike,error:this.likeOrUnlike})},e.prototype.getLikeRoute=function(){return this.$like.hasClass("active")?Echo.routes.Questions.dislike(this.question.id):Echo.routes.Questions.like(this.question.id)},e.prototype.onToggleLike=function(t){if(this.$el.hasClass("selected")||this.$el.hasClass("expanded"))return this.$parent.trigger("update.like",{id:this.question.id,count:+this.$like.text(),liked:this.$like.hasClass("active"),sendTo:this.findTarget()})},e.prototype.onQuestionStatusUpdate=function(t,e){if(null!=e.likeCount&&this.updateLike(null,{count:e.likeCount}),null!=e.responseCount)return this.updateResponseCount(e.responseCount)},e.prototype.onQuestionEditUpdate=function(t,e){if(!this.big&&e.id===this.questionId)return this.replaceContent(t,e.html)},e.prototype.afterRespawn=function(){if(this.$el.hasClass("selected"))return this.$el.next("[data-id="+this.questionId+"]").trigger("click")},e.prototype.updateLikeCount=function(t){return this.$like.text(t)},e.prototype.updateLike=function(t,e){if(null!=t&&t.stopPropagation(),this.$like.text(e.count),null!=e.liked)return this.$like.toggleClass("active",e.liked)},e.prototype.findTarget=function(){return this.$el.hasClass("expanded")?"small":"big"},e.prototype.deleteQuestion=function(t){return t.stopImmediatePropagation(),t.preventDefault(),alertify.confirm(this.i18n("Questions.deletePrompt"),(e=this,function(t){if(t)return Echo.routes.Questions.delete(e.question.id).ajax({success:e.handleDelete})}));var e},e.prototype.handleDelete=function(){return(this.$el.hasClass("selected")||this.$el.hasClass("expanded"))&&this.$parent.trigger("delete.question",{id:this.question.id,sendTo:this.findTarget()}),this.deleteActions()},e.prototype.onDeleteQuestion=function(t){return t.stopPropagation(),this.deleteActions()},e.prototype.deleteActions=function(){return this.$el.trigger("QuestionsList.selectQuestion",{exclude:this.$el.attr("id"),selected:this.$el.hasClass("selected")||this.$el.hasClass("expanded")}),this.markQuestionRead(),this.$el.trigger("toggle.placeholder"),this.dispose()},e.prototype.editQuestion=function(t){return t.stopImmediatePropagation(),t.preventDefault(),this.question.responseCount=+this.$responseCount.text(),$("body").trigger("QuestionCreator.edit",this.question)},e.prototype.isUnread=function(){return this.$el.hasClass("new")},e.prototype.markQuestionRead=function(){return this.$el.removeClass("new"),this.updateUnreadCount()},e.prototype.onLessonClick=function(){return this.$el.trigger("Questions.updateLessonSelect",this.lessonId)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.QuestionResponse=function(t){function e(){return this.editQuestionResponse=i(this.editQuestionResponse,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.onDeleteConfirmation=i(this.onDeleteConfirmation,this),this.deleteQuestionResponse=i(this.deleteQuestionResponse,this),this.toggleLikeState=i(this.toggleLikeState,this),this.onQuestionResponseEndorsedUpdate=i(this.onQuestionResponseEndorsedUpdate,this),this.onQuestionResponseStatusUpdate=i(this.onQuestionResponseStatusUpdate,this),this.toggleLike=i(this.toggleLike,this),this.onQuestionResponseEditedUpdate=i(this.onQuestionResponseEditedUpdate,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.questionResponseId=t.questionResponseId,this.role=t.role,this.file=t.file,this.filename=t.filename,this.image=t.image,this.id=this.$el.attr("id"),this.$likeElement=this.$(".like"),this.response={id:this.questionResponseId,anonymous:this.$el.data("anonymous"),questionId:this.$el.data("questionId"),html:this.$(".response-body").html().trim(),file:this.file,filename:this.filename,image:this.image},this.$el.on("delete.resource",this.deleteQuestionResponse).on("edit.resource",this.editQuestionResponse),this.$likeElement.on("click",this.toggleLike),this.linkify(this.$el),this.embedify()},e.prototype.bodyListeners=function(){var t;return(t={})["questionResponse."+this.options.questionResponseId+".deleted"]=this.onDeleteSuccess,t["questionResponse."+this.options.questionResponseId+".edited"]=this.onQuestionResponseEditedUpdate,t["questionResponse."+this.options.questionResponseId+".endorsed"]=this.onQuestionResponseEndorsedUpdate,t["questionResponse."+this.options.questionResponseId+".unendorsed"]=this.onQuestionResponseEndorsedUpdate,t["questionResponse."+this.options.questionResponseId+".status"]=this.onQuestionResponseStatusUpdate,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onQuestionResponseEditedUpdate=function(t,e){if(e.id===this.questionResponseId)return this.replaceContent(t,e.html)},e.prototype.toggleLike=function(){return this.toggleLikeState(),this.getLikeRoute().ajax({error:this.toggleLikeState})},e.prototype.getLikeRoute=function(){return this.$likeElement.hasClass("active")?Echo.routes.QuestionResponses.like(this.response.id):Echo.routes.QuestionResponses.dislike(this.response.id)},e.prototype.onQuestionResponseStatusUpdate=function(t,e){return this.updateLikeState(e.likeCount)},e.prototype.onQuestionResponseEndorsedUpdate=function(t,e){return this.updateEndorsedState(e.isEndorsed)},e.prototype.updateEndorsedState=function(t){return this.$likeElement.toggleClass("endorsed",t)},e.prototype.updateLikeState=function(t,e){if(this.$likeElement.text(t),null!=e)return this.$likeElement.toggleClass("active",e)},e.prototype.toggleLikeState=function(){var t,e;if(e=(t=this.$likeElement.hasClass("active"))?+this.$likeElement.text()-1:+this.$likeElement.text()+1,this.updateLikeState(e,!t),"Instructor"===this.role)return this.updateEndorsedState(!t)},e.prototype.deleteQuestionResponse=function(t){return this.confirm("Questions.response.deletePrompt",this.onDeleteConfirmation)},e.prototype.onDeleteConfirmation=function(){return Echo.routes.QuestionResponses.delete(this.response.id).ajax({success:this.onDeleteSuccess})},e.prototype.onDeleteSuccess=function(){return this.$el.addClass("toBeDeleted").trigger("update.responseCount"),this.dispose()},e.prototype.editQuestionResponse=function(t){return t.stopImmediatePropagation(),t.preventDefault(),this.$el.trigger("QuestionWithResponse.openResponseEditor",this.response)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Radio=function(t){function e(){return this.onEnable=i(this.onEnable,this),this.onDisable=i(this.onDisable,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.disabled=t.disabled,this.$input=this.$("input"),this.$el.on("enable",this.onEnable),this.$el.on("disable",this.onDisable),this.render()},e.prototype.onDisable=function(){return this.disabled=!0,this.render()},e.prototype.onEnable=function(){return this.disabled=!1,this.render()},e.prototype.render=function(){var t;return t=this.disabled?"addClass":"removeClass",this.$el[t]("disabled"),this.$input.prop({disabled:this.disabled})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.RelativeNavigation=function(t){function e(){return this.onUpdateArrows=i(this.onUpdateArrows,this),this.onRightClick=i(this.onRightClick,this),this.onLeftClick=i(this.onLeftClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e;return e=t.triggerOnId,this.$triggerOn=$("#"+e),this.$left=this.$(".left"),this.$right=this.$(".right"),this.$el.on("RelativeNavigation.updateArrows",this.onUpdateArrows),this.$left.on("click",this.onLeftClick),this.$right.on("click",this.onRightClick)},e.prototype.onLeftClick=function(){return this.$triggerOn.trigger("RelativeNavigation.left")},e.prototype.onRightClick=function(){return this.$triggerOn.trigger("RelativeNavigation.right")},e.prototype.onUpdateArrows=function(t,e){return this.$left.toggleClass("active",e.left),this.$right.toggleClass("active",e.right)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.RibbonSlide=function(t){function e(){return this.onError=i(this.onError,this),this.onSlideGetSuccess=i(this.onSlideGetSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.slideId=t.slideId,this.lessonId=t.lessonId,this.slideDeckId=t.slideDeckId,this.$container=this.$(".ribbonSlide-container"),this.getSlide()},e.prototype.getSlide=function(){return Echo.routes.Slides.getSlideWithImage().ajax({success:this.onSlideGetSuccess,error:this.onError,data:{lessonId:this.lessonId,slideDeckId:this.slideDeckId,slideId:this.slideId}})},e.prototype.onSlideGetSuccess=function(t){var e;return e=t.data,this.$container.html(e[0].html)},e.prototype.onError=function(){return alertify.error(this.i18n("Alert.genericError"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.SectionHeader=function(t){function e(){return this.onUnlinkSectionSuccess=i(this.onUnlinkSectionSuccess,this),this.onUnlinkSectionError=i(this.onUnlinkSectionError,this),this.onCanUnlinkSection=i(this.onCanUnlinkSection,this),this.onUnlinkResourceSuccess=i(this.onUnlinkResourceSuccess,this),this.onUnlinkResourceError=i(this.onUnlinkResourceError,this),this.onCanUnlinkResource=i(this.onCanUnlinkResource,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.lmsProfileId=t.lmsProfileId,this.ltiContextId=t.ltiContextId,this.lmsLinkId=t.lmsLinkId,this.sectionId=t.sectionId,this.$button=this.$(".unlink-lti"),this.$el.on("Lti.unlinkResource",this.onCanUnlinkResource),this.$el.on("Lti.unlinkSection",this.onCanUnlinkSection)},e.prototype.onCanUnlinkResource=function(){return this.confirm("Lti.unlinkResourceWarning",(t=this,function(){return Echo.routes.lti.LmsResources.unlinkResource(t.lmsProfileId,t.lmsLinkId).ajax({success:t.onUnlinkResourceSuccess,error:t.onUnlinkResourceError})}));var t},e.prototype.onUnlinkResourceError=function(t){var e;return alertify.alert(null!=(e=t.responseJSON)?e.message:void 0)},e.prototype.onUnlinkResourceSuccess=function(t){var e;return t.data,alertify.success(this.i18n("Lti.unlinkResourceSuccess")),this.$button.fadeOut(300),e="/lti/"+this.lmsProfileId+"/links/"+this.lmsLinkId,window.location=e},e.prototype.onCanUnlinkSection=function(){return this.confirm("Lti.unlinkSectionWarning",(t=this,function(){return Echo.routes.lti.LtiContexts.delete(t.lmsProfileId,t.ltiContextId,t.sectionId).ajax({success:t.onUnlinkSectionSuccess,error:t.onUnlinkSectionError})}));var t},e.prototype.onUnlinkSectionError=function(t){var e;return alertify.alert(null!=(e=t.responseJSON)?e.message:void 0)},e.prototype.onUnlinkSectionSuccess=function(t){return t.data,alertify.success(this.i18n("Lti.unlinkSectionSuccess")),this.$button.fadeOut(300)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Select=function(t){function e(){return this.onUpdateSelectedSilent=i(this.onUpdateSelectedSilent,this),this.setOptional=i(this.setOptional,this),this.onFormReset=i(this.onFormReset,this),this.onFormClear=i(this.onFormClear,this),this.onUpdateSelected=i(this.onUpdateSelected,this),this.onUpdateOptions=i(this.onUpdateOptions,this),this.onUpdateOptionText=i(this.onUpdateOptionText,this),this.onSetError=i(this.onSetError,this),this.onDeleteOption=i(this.onDeleteOption,this),this.onCreateOption=i(this.onCreateOption,this),this.onClearError=i(this.onClearError,this),this.onChange=i(this.onChange,this),this.onEnable=i(this.onEnable,this),this.onDisable=i(this.onDisable,this),this.onEmpty=i(this.onEmpty,this),this.onBlur=i(this.onBlur,this),this.onFocus=i(this.onFocus,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.disabled=t.disabled,this.event=t.event,this.sortOptions=t.sortOptions,this.sortBy=t.sortBy,this.openWidth=t.openWidth,this.optional=t.optional,this.initializeProperties(),this.initializeOpacity(),this.initializeEvents(),this.updateDisabled(),this.updateSelectedText(),this.sortOptions&&this.sortSelectOptions(),this.setOptional(null,this.optional)},e.prototype.initializeProperties=function(){return this.$error=this.$("span.error"),this.$select=this.$("select"),this.$selection=this.$(".selection")},e.prototype.initializeOpacity=function(){return this.$select.css("opacity",0),this.$selection.css("opacity",1)},e.prototype.initializeEvents=function(){return this.$select.on("change",this.onChange).on("focus",this.onFocus).on("blur",this.onBlur),this.$el.on("enable",this.onEnable).on("disable",this.onDisable).on("empty",this.onEmpty).on("Input.clearError",this.onClearError).on("Input.setError",this.onSetError).on("Select.createOption",this.onCreateOption).on("Select.deleteOption",this.onDeleteOption).on("Select.updateOptionText",this.onUpdateOptionText).on("Select.updateOptions",this.onUpdateOptions).on("Select.updateSelected",this.onUpdateSelected).on("Select.updateSelectedSilent",this.onUpdateSelectedSilent).on("Select.setOptional",this.setOptional).closest("form").on("clear",this.onFormClear).on("reset",this.onFormReset)},e.prototype.onFocus=function(){return this.$selection.addClass("focus")},e.prototype.onBlur=function(){return this.$selection.removeClass("focus")},e.prototype.onEmpty=function(){return this.updateOptions("<option></option>",!1,!1,!1)},e.prototype.onDisable=function(){return this.disabled=!0,this.updateDisabled()},e.prototype.onEnable=function(){return this.disabled=!1,this.updateDisabled()},e.prototype.onChange=function(){if(this.hideError(),this.updateSelectedText(),null!=this.event)return this.$el.trigger(this.event,this.$select.val())},e.prototype.onClearError=function(){return this.hideError()},e.prototype.onCreateOption=function(t,e){var i,o,n;if(!this.optionExists(e.value))return o=null!=(n=e.data)?n:"",i="<option value='"+e.value+"' data-value='"+o+"'>"+e.text+"</option>",e.optGroup?this.$select.find("optgroup[label='"+e.optGroup+"']").append(i):this.$select.append(i),this.$select.trigger("change"),this.sortOptions?this.sortSelectOptions():void 0},e.prototype.onDeleteOption=function(t,e){return this.$select.find("option[value='"+e+"']").remove(),this.$select.trigger("change")},e.prototype.onSetError=function(t,e){return this.showError(e)},e.prototype.onUpdateOptionText=function(t,e){var i,o;if(o=e.value,i=e.text,this.$select.find("option[value='"+o+"']").text(i),this.$select.trigger("change").trigger("select2.reset"),this.sortOptions)return this.sortSelectOptions()},e.prototype.onUpdateOptions=function(t,e){var i,o,n,s;return n=e.options,i=e.keepEmptyOption,o=e.maintainSelection,s=e.selectFirstOption,this.updateOptions(n,i,o,s),this.$select.trigger("select2.reset")},e.prototype.onUpdateSelected=function(t,e){return this.updateSelected(e)},e.prototype.onFormClear=function(){return this.$select.find("option").first().prop({selected:!0}),this.$select.trigger("change")},e.prototype.onFormReset=function(){return setTimeout((t=this,function(){return t.$select.trigger("change")}));var t},e.prototype.setOptional=function(t,e){return this.optional=e,this.optional?(this.$selection.addClass("optional"),this.$(".optional-label").show()):(this.$selection.removeClass("optional"),this.$(".optional-label").hide())},e.prototype.optionExists=function(t){var e;return e=!1,this.$("option").each(function(){if(this.value===t)return!(e=!0)}),e},e.prototype.showError=function(t){return this.$error.text(t),this.$el.addClass("error"),this.$select.attr("aria-invalid","true")},e.prototype.hideError=function(){return this.$el.removeClass("error"),this.$select.removeAttr("aria-invalid")},e.prototype.updateDisabled=function(){return this.$el.toggleClass("disabled",this.disabled),this.$select.attr({disabled:this.disabled})},e.prototype.updateSelectedText=function(){var t;return t=this.$select.find("option:selected").text(),this.$selection.text(t)},e.prototype.updateOptions=function(t,e,i,o){var n,s;return s=this.$select.val(),n=this.$select.find("option"),e&&(n=n.not('[value=""]')),n.remove(),this.$select.append(t),this.sortOptions&&this.sortSelectOptions(),i&&this.$select.find("option[value='"+s+"']").length?this.$select.val(s):i&&o?(this.$select.find("option").eq(0).prop("selected",!0),this.$select.trigger("change")):i?void 0:this.$select.trigger("change")},e.prototype.updateSelected=function(t){return this.$select.val(t).trigger("change")},e.prototype.onUpdateSelectedSilent=function(t,e){return this.$select.val(e),this.updateSelectedText()},e.prototype.sortSelectOptions=function(){var t,i;return(t=this.$("option").not('[value=""]')).sort((i=this,function(t,e){return i.compare(t,e)})),this.$("option").not('[value=""]').remove(),this.$select.append(t)},e.prototype.compare=function(t,e){return"data"===this.sortBy?this.$(t).data("value")<this.$(e).data("value")?1:-1:t.text.toUpperCase()>e.text.toUpperCase()?1:-1},e}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Select2=function(t){function i(){return this.onSelectClose=e(this.onSelectClose,this),this.onOptionalLabelClick=e(this.onOptionalLabelClick,this),this.onSelectOpen=e(this.onSelectOpen,this),this.formatResults=e(this.formatResults,this),this.formatResult=e(this.formatResult,this),this.onAddAjaxData=e(this.onAddAjaxData,this),this.initSelect2=e(this.initSelect2,this),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.Select),i.prototype.initialize=function(t){return this.openWidth=t.openWidth,this.ajaxUrl=t.ajaxUrl,this.ajaxData=t.ajaxData,this.defaultOptions=t.defaultOptions,this.disableInput=t.disableInput,i.__super__.initialize.apply(this,arguments),null==this.ajaxData&&(this.ajaxData={}),setTimeout((e=this,function(){return e.initSelect2(),e.$select.on("select2:open",e.onSelectOpen).on("select2:close",e.onSelectClose).on("select2.addAjaxData",e.onAddAjaxData).on("select2.reset",e.initSelect2),e.$el.on("click",".optional-label",e.onOptionalLabelClick)}),120);var e},i.prototype.initSelect2=function(){var e;return this.$(".select2").remove(),this.$select.select2({ajax:this.ajaxOpts(this.ajaxUrl),templateResult:this.formatResult,templateSelection:(e=this,function(t){return e.encodeHTML(t.text)}),escapeMarkup:function(t){return t}}),this.disableInput&&this.$select.select2({minimumResultsForSearch:-1}),this.$select2=this.$(".select2-container")},i.prototype.onAddAjaxData=function(t,e){var i,o,n;for(i in $.extend(this.ajaxData,e),n=[],o=this.ajaxData)""===o[i]&&n.push(delete this.ajaxData[i]);return n},i.prototype.ajaxOpts=function(t){return null==t?null:{url:function(){return t},cache:!0,dataType:"json",type:"POST",contentType:"application/json",delay:250,data:(e=this,function(t){return JSON.stringify(_.extend(e.ajaxData,{searchText:""===(null!=t?t.term:void 0)||null==(null!=t?t.term:void 0)?null:null!=t?t.term:void 0,pageNumber:null==(null!=t?t.page:void 0)||isNaN(null!=t?t.page:void 0)?0:(null!=t?t.page:void 0)-1}))}),processResults:this.formatResults};var e},i.prototype.formatResult=function(t){var e,i;return i=this.encodeHTML(t.text),null!=(e=$(t.element).attr("context"))?"<div class='select2-result-item'> <div class='select2-result-item-with-context' title='"+i+"'>"+i+"</div><div class='select2-result-context'>"+e+"</div> </div>":"<div class='select2-result-item' title='"+i+"'>"+i+"</div>"},i.prototype.formatResults=function(t,e){var i;return(null==(null!=e?e.page:void 0)||isNaN(e.page))&&(null!=e?e.page=1:e={page:1}),i=_.map(t.results,function(t){return{id:t.id,text:t.text}}),{results:1===e.page?this.formatDefaultOptions().concat(i):i,pagination:{more:t.more}}},i.prototype.formatDefaultOptions=function(){return null==("undefined"!=typeof page&&null!==page?page.page:void 0)||1===("undefined"!=typeof page&&null!==page?page.page:void 0)?_.map(this.defaultOptions,function(t){return{id:t.value,text:t.name}}):[]},i.prototype.onSelectOpen=function(t){var e,i;if(this.$el.width(),this.$dropdown=$(".select2-dropdown"),null!=this.openWidth)return null!=(e=this.$select2)&&"function"==typeof e.css&&e.css({minWidth:this.openWidth+"px",width:this.openWidth+"px"}),null!=(i=this.$dropdown)&&"function"==typeof i.css?i.css({width:this.openWidth+"px",minWidth:this.openWidth+"px"}):void 0},i.prototype.onOptionalLabelClick=function(t){return this.$select.select2("open")},i.prototype.onSelectClose=function(){var t;if(null!=this.openWidth)return null!=(t=this.$select2)?t.css({minWidth:"100%",width:"100%"}):void 0},i.prototype.updateDisabled=function(){return this.$el.toggleClass("disabled",this.disabled),this.$select.prop({disabled:this.disabled})},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.SimpleEventEmitter=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e,i,o,n,s,r,a;return o=t.listenEvent,r=t.triggeredEvent,i=t.listenEl,s=t.stopPropagation,n=t.preventDefault,e=t.data,$(i).on(o,(a=this,function(t){return s&&t.stopPropagation(),n&&t.preventDefault(),a.$el.trigger(r,e)}))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,p=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.widgets.SimpleTable=function(t){function e(){return this.sortColumn=i(this.sortColumn,this),this.configureColSort=i(this.configureColSort,this),this.dispatchInteractionEvent=i(this.dispatchInteractionEvent,this),this.render=i(this.render,this),this.toggleRowSelection=i(this.toggleRowSelection,this),this.toggleSelectAll=i(this.toggleSelectAll,this),this.handleClick=i(this.handleClick,this),this.handleMousedown=i(this.handleMousedown,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e,i,o,n,s;if(this.ids=t.ids,this.rows=t.rows,this.colConfig=t.colConfig,this.useTemplate=t.useTemplate,this.useBatchOps=t.useBatchOps,this.$el.on("mousedown",this.handleMousedown),this.$el.on("click",this.handleClick),this.activeSelection=[],this.colConfig)for(e=i=0,o=(n=this.colConfig.sortable).length;i<o;e=++i)s=n[e],this.configureColSort(s,e);return this.render()},e.prototype.handleMousedown=function(t){var e;return!!this.useBatchOps&&((e=$(t.target).closest("tr")).hasClass("header")?void 0:(this.toggleRowSelection(e),this.dispatchInteractionEvent(),this.render()))},e.prototype.handleClick=function(t){var e;return!!this.useBatchOps&&((e=$(t.target).closest("tr")).hasClass("header")?(this.toggleSelectAll(e),this.dispatchInteractionEvent(),this.render()):void 0)},e.prototype.toggleSelectAll=function(t){return $(t).find(":checkbox").prop("checked")?this.activeSelection=this.ids:this.activeSelection=[]},e.prototype.toggleRowSelection=function(t){var e,i;return e=$(t).find(":checkbox"),i=e.data("elementId").toString(),p.call(this.activeSelection,i)<0?this.activeSelection.push(i):this.activeSelection=this.activeSelection.filter(function(t){return t!==i})},e.prototype.render=function(){var t,e,i,o,n,s,r,a,h,l,c,u;if(this.useTemplate){for(this.$("tr:not(.header)").remove(),e=this.$("tbody"),h=[],i=n=0,a=this.rows.length-1;0<=a?n<=a:a<=n;i=0<=a?++n:--n){for(o=this.ids[i],l=this.rows[i],u={index:i,element_id:this.ids[i],checked:0<=p.call(this.activeSelection,o),columns:[]},s=0,r=l.length;s<r;s++)t=l[s],u.columns.push(t);c=_.template($("#simpleTable-data-rowTemplate").html(),u),h.push(e.append(c))}return h}},e.prototype.dispatchInteractionEvent=function(){return $(this.$el).trigger("tableSelectionChanged",[this.activeSelection])},e.prototype.configureColSort=function(t,e){var i;if(t)return(i=$("th."+this.colConfig.colType[e])).addClass("sort").unbind(),this.colConfig.defaultSort[e]?i.addClass("desc").trigger("click"):void 0},e.prototype.sortColumn=function(t){var e,i,o,n,s,r;for(t.stopImmediatePropagation(),(e=$(t.currentTarget)).hasClass("desc")?(this.resetColSort(e),e.addClass("asc")):(this.resetColSort(e),e.addClass("desc")),s=[],i=0,o=(n=e.siblings()).length;i<o;i++)r=n[i],s.push(this.resetColSort(r));return s},e.prototype.resetColSort=function(t){return $(t).removeClass("desc asc")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Slide=function(t){function e(){return this.onSlideViewing=i(this.onSlideViewing,this),this.triggerActivityResize=i(this.triggerActivityResize,this),this.onUpdateVisibleView=i(this.onUpdateVisibleView,this),this.onActivityEditing=i(this.onActivityEditing,this),this.onSlideToggleSuccess=i(this.onSlideToggleSuccess,this),this.onSlideVisibilityMessage=i(this.onSlideVisibilityMessage,this),this.onActivityMessage=i(this.onActivityMessage,this),this.imageLoaded=i(this.imageLoaded,this),this.onFetchEmbedlyContent=i(this.onFetchEmbedlyContent,this),this._updateActivity=i(this._updateActivity,this),this.fetchActivitySuccess=i(this.fetchActivitySuccess,this),this.initActivitySlideSuccess=i(this.initActivitySlideSuccess,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.aspectRatio=4/3,e.prototype.initialize=function(t){if(this.id=t.id,this.activityId=t.activityId,this.lessonId=t.lessonId,this.hidden=t.hidden,this.preview=t.preview,this.role=t.role,this.embedlyUrl=t.embedlyUrl,this.slideDeckId=t.slideDeckId,this.slideContent=t.slideContent,this.editing=!0,this.isEmbedlySlide=!1,this.$el.on("Slide.viewing",this.onSlideViewing),this.initializeOnAttach=_.once(this._initializeOnAttach),0===this.$el.closest(".slideDeck").length)return this.onSlideViewing()},e.prototype._initializeOnAttach=function(){var t,e,i;return this.hidden&&"Student"===this.role?setTimeout((t=this,function(){return t.updateDimensions(1200,1600)}),100):null!=this.activityId?this.initActivitySlide():null!=this.embedlyUrl?this.initEmbedlySlide():this.initMediaSlide(),this.updateActivity=_.debounce(this._updateActivity,500),this.$el.on("Activity.editing",this.onActivityEditing).on("Activity.update",this.updateActivity).on("Activity.updateVisibleView",this.onUpdateVisibleView).on("resize",this.triggerActivityResize).on("ToggleView.showGrid",(i=this,function(){return i.reOrderVisibleView="grid"})).on("ToggleView.showList",(e=this,function(){return e.reOrderVisibleView="list"}))},e.prototype.bodyListeners=function(){var t;return t={},null!=this.options.lessonId&&"Student"===this.options.role&&(t["Lesson."+this.options.lessonId+".SlideDeck."+this.options.slideDeckId+".slideVisibility"]=this.onSlideVisibilityMessage),$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.getUrl=function(){return null!=this.lessonId?Echo.routes.Activities.getActivityWithTogglesAndResponse(this.lessonId,this.activityId):Echo.routes.Activities.getActivity(this.activityId)},e.prototype.initActivitySlide=function(){return this.loadingOn(null,{theme:"gray"}),this.getUrl().ajax({success:this.initActivitySlideSuccess})},e.prototype.initActivitySlideSuccess=function(t){if(this.loadingOff(),this.fetchActivitySuccess(t,!0),null!=this.lessonId&&null!=this.activityId)return this.$body.on("Lesson."+this.lessonId+".Activity."+this.activityId+".message",this.onActivityMessage)},e.prototype.fetchActivitySuccess=function(t,e){var i,o;return o=t.data,null==e&&(e=!1),this.$(".activity").trigger("Activity.dispose"),i=this.reOrderVisibleView,this.$(".activity-wrapper").html(null!=o?o[0].html:void 0),e?this.$(".activity").fadeIn(300):this.$(".activity").show(),this.reOrderVisibleView=i,this.$(".activity").trigger("Activity.toggleView",{visible:this.visible,reOrderVisibleView:this.reOrderVisibleView}),0<this.$el.closest(".slidePreview, .preview-stage").length?this.updateDimensions(1200,1600):this.updateDimensions(-1,-1),this.$el.trigger("Activity.fetched")},e.prototype._updateActivity=function(){return this.getUrl().ajax({success:(e=this,function(t){return e.fetchActivitySuccess(t,!1)})});var e},e.prototype.initEmbedlySlide=function(){return this.fetchEmbedlyContent([this.embedlyUrl],this.onFetchEmbedlyContent,!0)},e.prototype.buildImage=function(t){var e;return e=$("<img>").attr("src",t),this.$(".embedly-slide").remove(),this.$(".slide-media").append(e),this.initMediaSlide()},e.prototype.buildEmbedlyThumbnail=function(t){var e;return e=$("<img>").attr("src",t),this.$(".slide-thumbnail").prepend(e)},e.prototype.onFetchEmbedlyContent=function(t){var e,i,o;for(e=0,o=t.length;e<o;e++)null!=(i=t[e]).thumbnail_url&&this.buildEmbedlyThumbnail(i.thumbnail_url),null!=i.html?(this.$(".embedly-slide").html(i.html),this.isEmbedlySlide=!0):"photo"===i.type?this.buildImage(i.original_url):(this.$(".embedly-slide").append(i.original_url),this.linkify(this.$el));return this.updateDimensions(1200,1600)},e.prototype.initMediaSlide=function(){return this.$img=this.$(".slide-media img"),this.getImageDimensions(this.$img)},e.prototype.getImageDimensions=function(t){var e;return(e=$("<img/>")).on("load",this.imageLoaded),e.attr("src",t.attr("src"))},e.prototype.imageLoaded=function(t){return this.aspectRatio=t.target.width/t.target.height,this.updateDimensions(t.target.height,t.target.width)},e.prototype.onActivityMessage=function(t,e){switch(this.role){case"Student":return this.onStudentMessage(e);case"Instructor":return this.onInstructorMessage(e)}},e.prototype.onStudentMessage=function(t){if(this.editing)switch(t.eventType){case"activityResponseCreated":case"activityResponseDeleted":case"activityResponseUpdated":case"activityResultsOpened":case"activityResultsClosed":return this.$body.trigger("Lesson."+t.lessonId+".Activity."+t.activityId+"."+t.eventType,t);case"activityOpened":case"activityReset":return this.updateActivity();case"activityClosed":return this.onActivityClosed();case"activityAnswerClosed":case"activityAnswerOpened":return this.onActivityAnswersToggle();case"activityUpdated":return this.onActivityUpdated()}else if("activityResponseDeleted"!==t.eventType||t.userId!==Echo.userId)return this.updateActivity()},e.prototype.onInstructorMessage=function(t){var e;return"activityAnswerClosed"===(e=t.eventType)||"activityAnswerOpened"===e||"activityOpened"===e||"activityUpdated"===e||"activityReset"===e?this.updateActivity():this.$body.trigger("Lesson."+t.lessonId+".Activity."+t.activityId+"."+t.eventType,t)},e.prototype.onActivityClosed=function(){return this.$el.is(":visible")?this.$(".activity").trigger("Activity.manualUpdate","Activity.closed"):this.updateActivity()},e.prototype.onActivityUpdated=function(){return this.onActivityAnswersToggle()},e.prototype.onActivityAnswersToggle=function(){return this.$el.is(":visible")?this.$(".activity").trigger("Activity.manualUpdate","Activity.update"):this.updateActivity()},e.prototype.onSlideVisibilityMessage=function(t,e){if((null!=e?e.slideId:void 0)===this.id&&"Student"===this.role)return Echo.routes.Slides.getSlideWithImage().ajax({success:this.onSlideToggleSuccess,data:{lessonId:this.lessonId,slideDeckId:this.slideDeckId,slideId:this.id}})},e.prototype.onSlideToggleSuccess=function(t){var e;return e=t.data,$(".slideDeck").trigger("SlideDeck."+this.slideDeckId+".refreshSlide",{slideId:this.id,slide:e[0].html}),this.dispose()},e.prototype.onActivityEditing=function(t,e){return this.editing=e},e.prototype.onUpdateVisibleView=function(t,e){return this.visible=e},e.prototype.triggerActivityResize=function(){return this.$el.trigger("Slide.resize")},e.prototype.updateDimensions=function(t,e){return this.$el.trigger("Slide.updateDimensions",{id:this.id,width:e,height:t})},e.prototype.onSlideViewing=function(){return""===this.$el.html().trim()&&this.$el.html(this.slideContent),this.initializeOnAttach()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,s=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.widgets.SlideDeck=function(t){function e(){return this.onFocus=i(this.onFocus,this),this.onRefreshSlide=i(this.onRefreshSlide,this),this.toggleFullScreen=i(this.toggleFullScreen,this),this.toggleAnnotation=i(this.toggleAnnotation,this),this.onSynchronize=i(this.onSynchronize,this),this.onRequestForSlideId=i(this.onRequestForSlideId,this),this.goToSlide=i(this.goToSlide,this),this.nextSlide=i(this.nextSlide,this),this.prevSlide=i(this.prevSlide,this),this.updateSlideDimensions=i(this.updateSlideDimensions,this),this.onStageRefocused=i(this.onStageRefocused,this),this.onActivityFetched=i(this.onActivityFetched,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e;return this.initialSlideId=t.initialSlideId,this.slideDeckId=t.slideDeckId,this.slideIds=t.slideIds,this.slideImages=t.slideImages,this.$slidesContainer=this.$("div.slides"),this.$stage=this.$el.parents(".stage"),this.currSlideId=null,this.currSlideNum=null,this.id=this.$el.attr("id"),this.$body.on("SlideDeck."+this.slideDeckId+".previousSlide",this.prevSlide).on("SlideDeck."+this.slideDeckId+".nextSlide",this.nextSlide).on("SlideDeck."+this.slideDeckId+".goToSlide",this.goToSlide).on("SlideDeck."+this.slideDeckId+".synchronize",this.onSynchronize).on("SlideDeck."+this.slideDeckId+".toggleAnnotation",this.toggleAnnotation).on("SlideDeck."+this.slideDeckId+".toggleFullScreen",this.toggleFullScreen).on("SlideDeck."+this.slideDeckId+".focus",this.onFocus).on("SlideDeck."+this.slideDeckId+".updated",this.onUpdated),this.initSlides(),this.$el.on("Slide.updateDimensions",this.updateSlideDimensions).on("SlideDeck."+this.slideDeckId+".refreshSlide",this.onRefreshSlide).on("Stage.refocused",this.onStageRefocused).on("Activity.fetched",this.onActivityFetched),this.respondTo("slideId",this.onRequestForSlideId),this.prefetchImages(),this.showSlideById(null!=(e=this.initialSlideId)?e:this.slideIds[0])},e.prototype.prefetchImages=function(){return this.prefetched=_.object(_.map(this.slideImages,function(t){var e;return e=t.id,t.url,[e,!1]})),_.map(this.slideImages,(n=this,function(t){var e,i,o;return e=t.id,o=t.url,(i=new Image).onload=function(){if(n.prefetched[e]=!0,e===n.currSlideId)return n.showSlideById(e)},i.src=o}));var n},e.prototype.onActivityFetched=function(){return this.$el.hasClass("active")?this.enableTabbing("a"):this.disableTabbing("a")},e.prototype.onStageRefocused=function(t,e){return e===this.id?this.enableTabbing("a"):this.disableTabbing("a")},e.prototype.initSlides=function(){var t,e,i,o,n,s;for(this.slidesById={},n=[],i=t=0,e=(o=this.slideIds).length;t<e;i=++t)s=o[i],n.push(this.slidesById[s]={id:s,$el:this.$(".slide[data-slide="+s+"]"),num:i});return n},e.prototype.updateSlideDimensions=function(t,e){if(this.slidesById[e.id].width=e.width,this.slidesById[e.id].height=e.height,this.currSlideId===e.id)return this.$el.trigger("Stage.media.updateDimensions",{width:e.width,height:e.height})},e.prototype.showSlideById=function(t){var e,i,o;if(!(s.call(this.slideIds,t)<0))return this.$el.trigger("Slide.view",{slideDeckId:this.slideDeckId,slideId:null!=(e=this.currSlideId)?e:t}),this.currSlideId=t,this.currSlideNum=this.slidesById[t].num,this.$(".slide").fadeOut(300).detach(),null==this.prefetched[t]||this.prefetched[t]?(this.loadingOff(),this.slidesById[t].$el.appendTo(this.$slidesContainer).fadeIn(300).trigger("Slide.resize").trigger("Slide.viewing")):this.loadingOn(null,{theme:"gray"}),this.$el.trigger("SlideDeck."+this.slideDeckId+".navigate",{slideId:t,slideNum:this.currSlideNum+1}),this.$el.trigger("Stage.media.updateDimensions",{width:null!=(i=this.slidesById[t].width)?i:1600,height:null!=(o=this.slidesById[t].height)?o:1200})},e.prototype.prevSlide=function(){var t;if(!(this.currSlideNum-1<0))return null!=(t=this.slideIds[this.currSlideNum-1])?this.showSlideById(t):void 0},e.prototype.nextSlide=function(){var t;if(!(this.currSlideNum+1>=this.slideIds.length))return null!=(t=this.slideIds[this.currSlideNum+1])?this.showSlideById(t):void 0},e.prototype.goToSlide=function(t,e){var i,o;if(i=e.slideId,0<=s.call(this.slideIds,i)&&this.showSlideById(e.slideId),e.focus&&(o=e.slideId,0<=s.call(this.slideIds,o)))return this.$el.trigger("click")},e.prototype.onRequestForSlideId=function(){return{slideDeckId:this.slideDeckId,slideId:this.currSlideId,slideNum:this.currSlideNum+1}},e.prototype.onSynchronize=function(t){},e.prototype.toggleAnnotation=function(){},e.prototype.toggleFullScreen=function(){return this.$stage.trigger("Stage.toggleFullScreen")},e.prototype.onRefreshSlide=function(t,e){var i,o;if(i=e.slideId,!(s.call(this.slideIds,i)<0))return null!=(o=this.slidesById[e.slideId])&&(o.$el=$(e.slide)),this.showSlideById(this.currSlideId)},e.prototype.onFocus=function(){return this.$el.click()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.SlideDeckControls=function(t){function e(){return this.showLessonNameTooltip=i(this.showLessonNameTooltip,this),this.onKeyDown=i(this.onKeyDown,this),this.changeSlide=i(this.changeSlide,this),this.onElKeypress=i(this.onElKeypress,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.slideDeckId=t.slideDeckId,this.lessonName=t.lessonName,this.$slideNumIndicator=this.$("span.slide-num"),this.$lessonName=this.$("a.btn.midnight.lessonName").on("mouseenter",this.showLessonNameTooltip),this.$body.on("SlideDeck."+this.slideDeckId+".navigate",this.changeSlide),this.$body.on("keydown",this.onKeyDown),this.$el.on("keypress",this.onElKeypress)},e.prototype.onElKeypress=function(t){var e;if((e=t.which)===this.KEYS.ENTER||e===this.KEYS.SPACE_BAR)return t.stopPropagation()},e.prototype.changeSlide=function(t,e){return this.$slideNumIndicator.text(e.slideNum)},e.prototype.onKeyDown=function(t){var e;if(0!==(e=this.$el.closest(".stage")).length&&!e.hasClass("justificationsOpen")&&(e.find(".slideDeck").hasClass("active")||e.hasClass("preview-stage")))switch(t.stopPropagation(),t.which){case this.KEYS.ARROW_LEFT:case this.KEYS.PAGE_UP:return this.prevSlide();case this.KEYS.ARROW_RIGHT:case this.KEYS.PAGE_DOWN:return this.nextSlide()}},e.prototype.prevSlide=function(){return this.$el.trigger("SlideDeck."+this.slideDeckId+".previousSlide")},e.prototype.nextSlide=function(){return this.$el.trigger("SlideDeck."+this.slideDeckId+".nextSlide")},e.prototype.showLessonNameTooltip=function(){if(this.$lessonName[0].scrollWidth>this.$lessonName[0].offsetWidth)return this.$lessonName.attr("data-tooltip-pos","top"),this.$lessonName.attr("data-tooltip","<p>"+this.lessonName+"</p>")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.SlideDeckNavigation=function(t){function e(){return this.onCloseKeypress=i(this.onCloseKeypress,this),this.onSlideKeypress=i(this.onSlideKeypress,this),this.onFocusout=i(this.onFocusout,this),this.onSuccess=i(this.onSuccess,this),this.onSlideVisibilityMessage=i(this.onSlideVisibilityMessage,this),this.onKeyUp=i(this.onKeyUp,this),this.navigated=i(this.navigated,this),this.close=i(this.close,this),this.open=i(this.open,this),this.docListeners=i(this.docListeners,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.lessonId=t.lessonId,this.slideDeckId=t.slideDeckId,this.$slideEls=this.$("div.slideDeckNavigation-slide"),this.$closeSlideDeckNavigationBtn=this.$("a.closeSlideDeckNavigationBtn"),this.$(".slideDeckNavigation-slide").on("keypress",this.onSlideKeypress),this.$(".closeSlideDeckNavigationBtn").on("keypress",this.onCloseKeypress),this.$el.on("click",this.close),this.$body.on("keyup",this.onKeyUp),this.close()},e.prototype.bodyListeners=function(){var t;return(t={})["SlideDeck."+this.options.slideDeckId+".navigation.open"]=this.open,t["SlideDeck."+this.options.slideDeckId+".navigation.close"]=this.close,t["SlideDeck."+this.options.slideDeckId+".goToSlide"]=this.close,t["SlideDeck."+this.options.slideDeckId+".navigate"]=this.navigated,t["Lesson."+this.options.lessonId+".SlideDeck."+this.options.slideDeckId+".slideVisibility"]=this.onSlideVisibilityMessage,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.docListeners=function(){var t;return(t={})["keyup.SlideDeck."+this.options.slideDeckId]=this.onKeyUp,$.extend(e.__super__.docListeners.apply(this,arguments),t)},e.prototype.open=function(t){return this.$el.on("focusout.SlideDeckNavigation",this.onFocusout),this.enableTabbing("a, .slideDeckNavigation-slide"),this.$el.attr("aria-hidden",!1).show(),this.$closeSlideDeckNavigationBtn.focus()},e.prototype.close=function(t){return this.disableTabbing("a, .slideDeckNavigation-slide"),this.$el.attr("aria-hidden",!0).fadeOut(50),this.$el.off("focusout.SlideDeckNavigation")},e.prototype.navigated=function(t,e){return this.$slideEls.removeClass("active"),this.$slideEls.eq(e.slideNum-1).addClass("active")},e.prototype.onKeyUp=function(t){if(t.which===this.KEYS.ESC)return this.$el.is(":visible")?(t.stopImmediatePropagation(),this.$doc.off("keyup.SlideDeck."+this.slideDeckId),this.close()):void 0},e.prototype.onSlideVisibilityMessage=function(){return Echo.routes.SlideDecks.getSlideDeckNavigation(this.slideDeckId,this.lessonId).ajax({success:this.onSuccess})},e.prototype.onSuccess=function(t){var e;return e=t.data,this.$el.after(e[0].html),this.dispose()},e.prototype.onFocusout=function(t){if(this.$el.is(":visible"))return 0===$(t.relatedTarget).parents(".slideDeckNavigation").length?this.$closeSlideDeckNavigationBtn.focus():void 0},e.prototype.onSlideKeypress=function(t){var e,i;if((e=t.which)===this.KEYS.ENTER||e===this.KEYS.SPACE_BAR)return t.stopPropagation(),i=$(t.target).data("slide-id"),this.$el.trigger("SlideDeck."+this.options.slideDeckId+".goToSlide",{slideId:i})},e.prototype.onCloseKeypress=function(t){var e;if((e=t.which)===this.KEYS.ENTER||e===this.KEYS.SPACE_BAR)return t.stopPropagation()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.SlidePreview=function(t){function e(){return this.onKeyUp=i(this.onKeyUp,this),this.closeMain=i(this.closeMain,this),this.open=i(this.open,this),this.showNextPreview=i(this.showNextPreview,this),this.showPreviousPreview=i(this.showPreviousPreview,this),this.recenter=i(this.recenter,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.activeSlideId=t.activeSlideId,this.slideIds=t.slideIds,this.full=t.full,this.$previous=this.$(".previous-preview"),this.$next=this.$(".next-preview"),this.$slideContainer=this.$(".slide-container"),this.$slidePreviewContainer=this.$(".slidePreview-container"),this.$slideNumber=this.$(".preview-slideNumber"),this.$previous.on("click",this.showPreviousPreview),this.$next.on("click",this.showNextPreview),this.$el.find(".close").on("click",this.closeMain),this.$body.on("keyup.SlidePreview",this.onKeyUp),this.$el.on("Slide.resize",this.recenter),setTimeout(this.open,20)},e.prototype.slideIndex=function(){return this.slideIds.indexOf(this.activeSlideId)},e.prototype.toggleArrows=function(){return 0===this.slideIds.indexOf(this.activeSlideId)?this.$previous.hide():this.$previous.show(),this.slideIds.indexOf(this.activeSlideId)+1===this.slideIds.length?this.$next.hide():this.$next.show()},e.prototype.showPreview=function(t){return null!=t&&(this.activeSlideId=t,this.toggleArrows(),this.$slideContainer.hide().filter("[data-id="+this.activeSlideId+"]").show(),this.$slideNumber.hide().filter("[data-id="+this.activeSlideId+"]").show()),this.recenter()},e.prototype.recenter=function(){var t,e,i,o;if(t=(o=this.$slideContainer.filter(":visible")).height(),i=this.$slidePreviewContainer.height(),0!==t&&0!==i)return e=(i-t)/2,o.animate({"margin-top":e},30)},e.prototype.showPreviousPreview=function(){var t;if(0!==(t=this.slideIndex())&&-1!==t)return this.showPreview(this.slideIds[t-1])},e.prototype.showNextPreview=function(){var t;if((t=this.slideIndex())!==this.slideIds.length-1&&-1!==t)return this.showPreview(this.slideIds[t+1])},e.prototype.open=function(){return this.$body.addClass("noscroll"),this.$el.addClass("open"),this.showPreview(this.activeSlideId),this.$el.find(".activity").show()},e.prototype.closeMain=function(t){return null!=t&&t.stopPropagation(),this.$body.removeClass("noscroll"),this.$el.removeClass("open"),this.$body.trigger("Stage.destroy",this.$el),this.$body.off("keyup.SlidePreview"),this.dispose()},e.prototype.onKeyUp=function(t){switch(t.which){case this.KEYS.ESC:return this.closeMain();case this.KEYS.ARROW_RIGHT:return this.showNextPreview();case this.KEYS.ARROW_LEFT:return this.showPreviousPreview()}},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Slider=function(t){function e(){return this.reset=i(this.reset,this),this.onKeyDown=i(this.onKeyDown,this),this.onMouseUp=i(this.onMouseUp,this),this.onMouseMove=i(this.onMouseMove,this),this.onMouseDown=i(this.onMouseDown,this),this.onInputChange=i(this.onInputChange,this),this.onFormReset=i(this.onFormReset,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.color=this.$el.attr("data-color"),this.$bar=this.$(".slider-bar"),this.$form=this.$el.parents("form"),this.$handle=this.$(".slider-bar-handle"),this.$input=this.$("input"),this.$sections=this.$(".slider-bar-section"),this.$percentage=this.$(".percentage"),this.barWidth=this.$bar.outerWidth(),this.handleWidth=this.$handle.outerWidth(),this.numberOfSections=this.$sections.length,this.sectionWidth=this.barWidth/this.numberOfSections,this.reset(),this.setSectionWidth(),this.$form.on("reset",this.onFormReset),this.$handle.on("mousedown",this.onMouseDown),this.$input.on("keydown",this.onKeyDown),this.$input.on("change",this.onInputChange)},e.prototype.onFormReset=function(){return setTimeout((t=this,function(){return t.reset({noInputTrigger:!0})}),0);var t},e.prototype.onInputChange=function(){return this.reset({noInputTrigger:!0})},e.prototype.onMouseDown=function(){return this.$body.on("mousemove",this.onMouseMove),this.$body.on("mouseup",this.onMouseUp)},e.prototype.onMouseMove=function(t){var e,i;return e=this.getMousePosition(t),i=this.getValueByMousePosition(e),this.setValue(i)},e.prototype.onMouseUp=function(){return this.$body.off("mousemove",this.onMouseMove),this.$body.off("mouseup",this.onMouseUp)},e.prototype.onKeyDown=function(t){if(t.which!==this.KEYS.TAB)switch(t.preventDefault(),t.stopPropagation(),t.which){case this.KEYS.ARROW_RIGHT:case this.KEYS.ARROW_UP:return this.moveRight();case this.KEYS.ARROW_LEFT:case this.KEYS.ARROW_DOWN:return this.moveLeft()}},e.prototype.moveLeft=function(){var t;return t=+this.$input.val()-1,this.setValue(t)},e.prototype.moveRight=function(){var t;return t=+this.$input.val()+1,this.setValue(t)},e.prototype.setValue=function(t,e){return null==e&&(e={}),t=this.sanitizeValue(t),this.$input.val(t),this.setHandleLeft(t),this.setFilledSections(t),e.noInputTrigger||this.$input.trigger("change"),this.$el.trigger("Slider.change")},e.prototype.getMousePosition=function(t){return null!=t.pageX?t.pageX:null!=t.clientX?t.clientX+document.body.scrollLeft:0},e.prototype.getValueByMousePosition=function(t){var e,i,o,n,s,r,a,h;if(t<(e=this.$bar.offset().left))return 0;if(t>e+this.barWidth)return this.numberOfSections;for(i=t-e,h=o=0,n=this.numberOfSections;0<=n?o<=n:n<=o;h=0<=n?++o:--o)if(r=(s=h*this.sectionWidth)-this.sectionWidth/2,a=s+this.sectionWidth/2,r<=i&&i<=a)return h},e.prototype.reset=function(t){return null==t&&(t={}),this.setValue(+this.$input.val(),t)},e.prototype.sanitizeValue=function(t){return t<0?0:t>this.numberOfSections?this.numberOfSections:t},e.prototype.setFilledSections=function(t){var e,i,o,n,s,r,a;for(r=[],o=i=0,n=(s=this.$sections).length;i<n;o=++i)a=s[o],e=o<t?this.color:"",r.push($(a).css("background-color",e));return r},e.prototype.setHandleLeft=function(t){var e;return e=0===t?0:e=t===this.numberOfSections?this.barWidth-this.handleWidth:this.sectionWidth*t-this.handleWidth/2,this.$handle.css("left",e)},e.prototype.setSectionWidth=function(){return this.$sections.css("width",this.sectionWidth+"px")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Switch=function(t){function e(){return this.toggleCheckbox=i(this.toggleCheckbox,this),this.setChecked=i(this.setChecked,this),this.onReset=i(this.onReset,this),this.onEnable=i(this.onEnable,this),this.onDisable=i(this.onDisable,this),this.onChange=i(this.onChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.disabled=t.disabled,this.checkbox=this.$("input"),this.toggleSwitch=this.$(".toggle-switch"),this.checkbox.on("change",this.onChange),this.toggleSwitch.on("click",this.toggleCheckbox),this.$el.on("enable",this.onEnable),this.$el.on("disable",this.onDisable),this.$el.closest("form").on("reset",this.onReset),this.setChecked(),this.render()},e.prototype.onChange=function(){return this.$el.trigger(this.namespacedEventName("Switch","stateChange"),{state:this.checkbox.prop("checked")})},e.prototype.onDisable=function(){return this.disabled=!0,this.render()},e.prototype.onEnable=function(){return this.disabled=!1,this.render()},e.prototype.onReset=function(){return setTimeout((t=this,function(){return t.checkbox.trigger("change")}));var t},e.prototype.setChecked=function(){if("checked"===this.checkbox.attr("checked"))return this.checkbox.prop({checked:!0})},e.prototype.render=function(){var t;return t=this.disabled?"addClass":"removeClass",this.$el[t]("disabled"),this.checkbox.attr({disabled:this.disabled})},e.prototype.toggleCheckbox=function(){if(!this.disabled)return this.checkbox.prop({checked:!this.checkbox.prop("checked")}),this.checkbox.trigger("change")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.Tabbed=function(t){function i(){var t,e;return this.onTabClick=(t=this.onTabClick,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$tabs=this.$("a.tab"),this.$contentsContainer=this.$("div.contents"),this.$contents=this.$contentsContainer.find("div.tab"),this.$el.on("Tabbed.clickTab",this.onTabClick),setTimeout((t=this,function(){return t.$tabs.first().trigger("Tabbed.clickTab",t.$tabs.first().data("key"))}),1);var t},i.prototype.onTabClick=function(t,e){return this.$tabs.not("[data-key='"+e+"']").removeClass("selected"),this.$tabs.filter("[data-key='"+e+"']").addClass("selected"),this.$contents.not("[data-key='"+e+"']").removeClass("selected"),this.$contents.filter("[data-key='"+e+"']").addClass("selected")},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.TimeDuration=function(t){function e(){return this.validate=i(this.validate,this),this.displayError=i(this.displayError,this),this.onClearAndDisable=i(this.onClearAndDisable,this),this.onFillDefaultValues=i(this.onFillDefaultValues,this),this.onDurationChange=i(this.onDurationChange,this),this.onReset=i(this.onReset,this),this.onSetError=i(this.onSetError,this),this.onClearError=i(this.onClearError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.namespaces=t.namespaces,this.initializeProperties(),this.initializeEvents()},e.prototype.initializeProperties=function(){return this.$input=this.$("input, select"),this.$error=this.$("span.timeDurationError"),this.$hours=this.$("[name='"+this.namespaces.hours+"']"),this.$minutes=this.$("[name='"+this.namespaces.minutes+"']"),this.$durationMilliseconds=this.$("[name='"+this.namespaces.durationMilliseconds+"']")},e.prototype.initializeEvents=function(){return this.$el.on("TimeDuration.fillDefaultValues",this.onFillDefaultValues).on("TimeDuration.clearAndDisable",this.onClearAndDisable),this.$input.on("Input.clearError",this.onClearError).on("Input.setError",this.onSetError),this.$hours.on("change",this.onDurationChange),this.$minutes.on("change",this.onDurationChange),this.$input.closest("form").on("reset",this.onReset)},e.prototype.onClearError=function(){return this.hideError()},e.prototype.onSetError=function(t,e){return this.showError(e)},e.prototype.onReset=function(){return this.hideError(),this.clearDuration()},e.prototype.onDurationChange=function(){return this.hideError(),!0===this.validate()?this.calculateDuration():this.clearDuration()},e.prototype.onFillDefaultValues=function(){var t,e;return t=parseInt(this.$hours.val()),e=parseInt(this.$minutes.val()),isNaN(t)&&this.$hours.val("1"),isNaN(e)&&this.$minutes.val("0"),this.$hours.trigger("enable"),this.$minutes.trigger("enable"),this.calculateDuration()},e.prototype.onClearAndDisable=function(){return this.onReset(),this.$el.find(".input").removeClass("error"),this.$el.find(".timeSelect").removeClass("error"),this.$hours.val("").trigger("disable"),this.$minutes.val("").trigger("disable"),this.clearDuration()},e.prototype.calculateDuration=function(){var t;return t=1e3*(3600*Number(this.$hours.val())+60*Number(this.$minutes.val())),this.$durationMilliseconds.val(t)},e.prototype.clearDuration=function(){return this.$durationMilliseconds.val("")},e.prototype.showError=function(t){return this.$error.text(t),this.$el.addClass("durationError").addClass("error")},e.prototype.displayError=function(t,e){var i,o,n;for(o=0,n=t.length;o<n;o++)(i=t[o]).val("").trigger("Input.setError",""),i.addClass("error");return this.$error.text(e)},e.prototype.hideError=function(){return this.$error.text(""),this.$input.removeClass("error"),this.$(".input").removeClass("error")},e.prototype.validate=function(){var t;return(t=Echo.core.ValidationHelpers.validateTimeDuration(Number(this.$hours.val()),Number(this.$minutes.val()))).hoursError&&t.minutesError&&this.displayError([this.$hours,this.$minutes],t.message),t.hoursError&&this.displayError([this.$hours],t.message),t.minutesError&&this.displayError([this.$minutes],t.message),t.valid},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.TimeRange=function(t){function e(){return this.validate=i(this.validate,this),this.onReset=i(this.onReset,this),this.onInputChange=i(this.onInputChange,this),this.onEndTimeKeyDown=i(this.onEndTimeKeyDown,this),this.onStartTimeChange=i(this.onStartTimeChange,this),this.onSetError=i(this.onSetError,this),this.onClearError=i(this.onClearError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.userChangedEndTime=!1,e.prototype.initialize=function(t){return this.namespaces=t.namespaces,this.autoUpdateEndTime=t.autoUpdateEndTime,this.initializeProperties(),this.initializeEvents()},e.prototype.initializeProperties=function(){if(this.$input=this.$el.find("input, select"),this.$error=this.$el.find("span.error"),this.$startTimeIso8601=this.$el.find("[name='"+this.namespaces.startTime+"Iso8601']"),this.$endTimeIso8601=this.$el.find("[name='"+this.namespaces.endTime+"Iso8601']"),this.autoUpdateEndTime)return this.$startTimeHours=this.$el.find("[name='"+this.namespaces.startTime+"Hours']"),this.$startTimeMeridiem=this.$el.find("[name='"+this.namespaces.startTime+"Meridiem']"),this.$endTimeHours=this.$el.find("[name='"+this.namespaces.endTime+"Hours']"),this.$endTimeMeridiem=this.$el.find("[name='"+this.namespaces.endTime+"Meridiem']")},e.prototype.initializeEvents=function(){return this.autoUpdateEndTime&&(this.$startTimeHours.on("change",this.onStartTimeChange),this.$startTimeMeridiem.on("change",this.onStartTimeChange),this.$endTimeHours.on("keydown",this.onEndTimeKeyDown)),this.$input.on("Input.clearError",this.onClearError).on("Input.setError",this.onSetError).on("change",this.onInputChange),this.$input.closest("form").on("reset",this.onReset)},e.prototype.onClearError=function(){return this.hideError()},e.prototype.onSetError=function(t,e){return this.showError(e)},e.prototype.onStartTimeChange=function(){return this.userChangedEndTime?this.autoUpdateEndTime?this.updateMeridiem():void 0:(this.$endTimeHours.val(this.nextHourFor(this.$startTimeHours.val())),this.autoUpdateEndTime&&this.updateMeridiem(),this.$endTimeHours.trigger("change"))},e.prototype.onEndTimeKeyDown=function(){return this.userChangedEndTime=!0},e.prototype.onInputChange=function(){return this.hideError(),this.validate()},e.prototype.onReset=function(){return this.hideError()},e.prototype.showError=function(t){return this.$error.text(t),this.$el.addClass("error")},e.prototype.hideError=function(){return this.$error.text(""),this.$el.removeClass("error")},e.prototype.updateMeridiem=function(){return"am"===this.$startTimeMeridiem.val()&&"12"===this.$endTimeHours.val()?this.$endTimeMeridiem.val("pm"):"pm"===this.$startTimeMeridiem.val()&&"12"===this.$endTimeHours.val()?this.$endTimeMeridiem.val("am"):this.$endTimeMeridiem.val(this.$startTimeMeridiem.find("option:selected").val()),this.$endTimeMeridiem.trigger("change")},e.prototype.nextHourFor=function(t){return"00"===(t=Echo.core.helpers.padZero((Number(t)+1)%12,2))?"12":t},e.prototype.validate=function(){if(this.$startTimeIso8601.val()>=this.$endTimeIso8601.val())return this.showError(this.i18n("Widgets.timeRange.error.invalid"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.TimeSelect=function(t){function e(){return this.validate=i(this.validate,this),this.setDefaultMinutes=i(this.setDefaultMinutes,this),this.setDefaultHour=i(this.setDefaultHour,this),this.onClearAndDisable=i(this.onClearAndDisable,this),this.onFillDefaultValues=i(this.onFillDefaultValues,this),this.onInputChange=i(this.onInputChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){if(this.namespace=t.namespace,this.use24HourTime=t.use24HourTime,this.useDefaultIsoVal=t.useDefaultIsoVal,this.initializeProperties(),this.initializeEvents(),this.useDefaultIsoVal||this.$hours.val()&&this.$minutes.val())return this.setIso8601()},e.prototype.initializeProperties=function(){return this.$error=this.$el.find("span.error"),this.$hours=this.$el.find("[name='"+this.namespace+"Hours']"),this.$minutes=this.$el.find("[name='"+this.namespace+"Minutes']"),this.$meridiem=this.$el.find("[name='"+this.namespace+"Meridiem']"),this.$iso8601=this.$el.find("[name='"+this.namespace+"Iso8601']")},e.prototype.initializeEvents=function(){var t,e,i,o,n,s;for(this.$el.on("click",(s=this,function(){return s.$hours.focus()})).on("TimeSelect.fillDefaultValues",this.onFillDefaultValues).on("TimeSelect.clearAndDisable",this.onClearAndDisable),n=[],e=0,i=(o=[this.$hours,this.$minutes,this.$meridiem]).length;e<i;e++)(t=o[e]).on("input change",this.onInputChange),t.on("input change",this.stopPropagation),n.push(t.on("click",this.stopPropagation));return n},e.prototype.onInputChange=function(){return this.hideError(),this.setIso8601(),this.validate()},e.prototype.onFillDefaultValues=function(){var t,e;return this.$el.removeClass("disabled"),t=this.getHours(),e=this.getMinutes(),isNaN(t)&&this.setDefaultHour(),isNaN(e)&&this.setDefaultMinutes(),this.$hours.prop("disabled",!1),this.$minutes.prop("disabled",!1),this.$meridiem.prop("disabled",!1),this.setIso8601()},e.prototype.onClearAndDisable=function(){return this.$el.removeClass("error"),this.$el.addClass("disabled"),this.$hours.val("").prop("disabled",!0),this.$minutes.val("").prop("disabled",!0),this.$meridiem.prop("disabled",!0),this.$iso8601.val("")},e.prototype.showError=function(t){return this.$error.text(t),this.$el.addClass("error")},e.prototype.hideError=function(){return this.$error.text(""),this.$el.removeClass("error")},e.prototype.hourIsValid=function(t){return this.use24HourTime?0<=t&&t<=23:1<=t&&t<=12},e.prototype.setDefaultHour=function(){var t;return 12<(t=(new Date).getHours())?(this.$hours.val(""+(t-12)),this.$meridiem.val("pm")):(this.$hours.val(""+t),this.$meridiem.val("am"))},e.prototype.setDefaultMinutes=function(){var t;return t=Echo.core.helpers.padZero((new Date).getMinutes().toString(),2),this.$minutes.val(""+t)},e.prototype.getHours=function(){var t;return t=parseInt(this.$hours.val(),10),this.hourIsValid(t)?(this.use24HourTime||(t%=12,"pm"===this.$meridiem.val()&&(t+=12)),t):NaN},e.prototype.getMinutes=function(){var t;return 0<=(t=parseInt(this.$minutes.val(),10))&&t<=59?t:NaN},e.prototype.validate=function(){if(!Echo.core.ValidationHelpers.validateTimeSelect(parseInt(this.$hours.val(),10),parseInt(this.$minutes.val(),10),this.use24HourTime,this.$meridiem.val()))return this.showError(this.i18n("Widgets.timeRange.error.invalid"))},e.prototype.setIso8601=function(){var t,e;return t=this.getHours(),e=this.getMinutes(),t=Echo.core.helpers.padNumber(t),e=Echo.core.helpers.padNumber(e),this.$iso8601.val(t+":"+e).trigger("change")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.TimingInfo=function(t){function i(){var t,e;return this.onDateChange=(t=this.onDateChange,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$timeSelect=this.$(".timeSelect"),this.$timeDuration=this.$(".timeDuration"),this.$el.on("DateInput.newDate",this.onDateChange)},i.prototype.onDateChange=function(t,e){return null!=e&&0<e.trim().length?(this.$timeSelect.trigger("TimeSelect.fillDefaultValues"),this.$timeDuration.trigger("TimeDuration.fillDefaultValues")):(this.$timeSelect.trigger("TimeSelect.clearAndDisable"),this.$timeDuration.trigger("TimeDuration.clearAndDisable"))},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.ToggleView=function(t){function e(){return this.switchToGridView=i(this.switchToGridView,this),this.switchToListView=i(this.switchToListView,this),this.render=i(this.render,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.listSelected=t.listSelected,this.listEl=t.listEl,this.gridEl=t.gridEl,this.eventOnly=t.eventOnly,this.listViewButton=this.$(".view-list"),this.gridViewButton=this.$(".view-grid"),this.listViewButton.on("click",this.switchToListView),this.gridViewButton.on("click",this.switchToGridView),this.$body.on("ToggleView.refresh",this.render),this.$body.on("ToggleView.initList",this.switchToListView),this.$body.on("ToggleView.initGrid",this.switchToGridView),this.$doc.ready((e=this,function(){return e.render()}));var e},e.prototype.render=function(){if(this.$listEl=$(this.listEl),this.$gridEl=$(this.gridEl),this.listSelected){if(this.listViewButton.addClass("selected"),this.gridViewButton.removeClass("selected"),this.$el.trigger("ToggleView.showList"),!this.eventOnly)return this.$listEl.show(),this.$gridEl.hide()}else if(this.gridViewButton.addClass("selected"),this.listViewButton.removeClass("selected"),this.$el.trigger("ToggleView.showGrid"),!this.eventOnly)return this.$gridEl.show(),this.$listEl.hide()},e.prototype.switchToListView=function(){return this.listSelected=!0,this.render()},e.prototype.switchToGridView=function(){return this.listSelected=!1,this.render()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.Tooltip=function(t){function e(){return this.flash=i(this.flash,this),this.onSuppress=i(this.onSuppress,this),this.onResume=i(this.onResume,this),this.leave=i(this.leave,this),this.enter=i(this.enter,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.startDelay=1e3,e.prototype.transitionDelay=300,e.prototype.enabled=!0,e.prototype.initialize=function(){return this.showTimeout=this.startDelay,this.$body.on("mouseenter focus","[data-tooltip]",this.enter).on("mouseleave blur","[data-tooltip]",this.leave).on("Tooltip.suppress","[data-tooltip]",this.onSuppress).on("Tooltip.resume","[data-tooltip]",this.onResume).on("Tooltip.flash","[data-tooltip]",this.flash)},e.prototype.tooltipTimer=function(t){var e,i;return 0===(e=$(".tooltip")).length?this.showTimeout=this.startDelay:this.showTimeout=this.transitionDelay/2,this.timeout=setTimeout((i=this,function(){if("in"===i.hoverState)return i.constructTooltip(t)}),this.showTimeout),this.hide(e)},e.prototype.getTooltipTarget=function(t){return t.target.getAttribute("data-tooltip")||!t.currentTarget.getAttribute("data-tooltip-wrap")?t.target:t.currentTarget},e.prototype.constructTooltip=function(t){var e,i,o,n,s,r,a,h,l;if(r=(s=this.getTooltipTarget(t)).getAttribute("data-tooltip"))return a=null!=(i=s.getAttribute("data-tooltip-css"))?i:"",l=null!=(o=s.getAttribute("data-tooltip-style"))?o:"",h=null!=(n=s.getAttribute("data-tooltip-pos"))?n:"right",e=this.generateTooltip(r,a,l,h),this.positionTooltip(e,$(s),t)},e.prototype.positionTooltip=function(t,e,i){var o,n,s,r,a,h,l,c,u,p,d,f,g,y,m,v,S,C;if(this.$el.append(t),v="none"===t.find(".tooltip-inner").css("max-width")?t.find(".tooltip-inner").css("min-width"):t.find(".tooltip-inner").css("max-width"),t.css({visibility:"hidden",display:"block",position:"absolute",width:v}),{left:i.clientX,top:i.clientY},l=e.offset(),h=e.outerHeight(),c=e.outerWidth(),g=t.outerHeight(!0),y=t.outerWidth(!0),C=$(window).width(),S=$(window).height(),o={right:["left","top","bottom"],top:["bottom","left","right"],bottom:["top","left","right"],left:["right","top","bottom"]},n=function(t){switch(t){case"top":return{bottom:-l.top,top:"auto",left:l.left+c/2,right:"auto",transform:"translateX(-50%)"};case"bottom":return{top:l.top+h,left:l.left+c/2,right:"auto",bottom:"auto",transform:"translateX(-50%)"};case"left":return{right:$(document).width()-l.left,left:"auto",top:l.top+h/2,bottom:"auto",transform:"translateY(-50%)"};case"right":return{left:l.left+c,right:"auto",top:l.top+h/2,bottom:"auto",transform:"translateY(-50%)"}}},!(f={right:function(){return 0<C-y-l.left-c},top:function(){return l.top>g},bottom:function(){return 0<S-l.top-g-h},left:function(){return l.left>y}})[a=m=null!=(p=e.attr("data-tooltip-pos"))?p:"right"]())for(s=0,r=(d=o[m]).length;s<r;s++)if(f[u=d[s]]()){a=u;break}return t.removeClass(m).addClass(a).css(n(a)).css({visibility:"initial",display:"none",width:"auto"}),t.fadeIn(this.transitionDelay)},e.prototype.generateTooltip=function(t,e,i,o){var n,s;return n=$("<div>").addClass("tooltip").addClass(o).addClass(e).addClass(i),(s=$("<div>").addClass("tooltip-inner")).text(t),n.append(s),n},e.prototype.enter=function(t){if("in"!==this.hoverState&&this.enabled)return clearTimeout(this.timeout),this.hoverState="in",this.tooltipTimer(t)},e.prototype.leave=function(t){var e;if("out"!==this.hoverState)return clearTimeout(this.timeout),this.hoverState="out",this.timeout=setTimeout((e=this,function(){if("out"===e.hoverState)return e.hide(e.$el.find(".tooltip"))}),1)},e.prototype.hide=function(t){return t.clearQueue().fadeOut(this.transitionDelay,function(){return $(this).remove()})},e.prototype.onResume=function(){return this.enabled=!0},e.prototype.onSuppress=function(){return this.enabled=!1},e.prototype.flash=function(t){var e;return(e=$(t.target)).mouseenter(),setTimeout(function(){return e.blur()},4e3)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.UpdatableImage=function(t){function i(){var t,e;return this.onUpdateSrc=(t=this.onUpdateSrc,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$body.on(this.namespacedEventName("UpdatableImage","updateSrc"),this.onUpdateSrc)},i.prototype.onUpdateSrc=function(t,e){return e?this.$el.attr({src:e}).show():this.$el.hide().removeAttr("src")},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.WizardProgress=function(t){function e(){return this.onReset=i(this.onReset,this),this.onNext=i(this.onNext,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$rows=this.$("tr"),this.$el.on("WizardProgress.next",this.onNext),this.$el.on("WizardProgress.reset",this.onReset)},e.prototype.onNext=function(){var t;return(t=this.$rows.filter(".active")).removeClass("active").addClass("completed"),t.next().addClass("active")},e.prototype.onReset=function(){return this.$rows.removeClass("active completed"),this.$rows.first().addClass("active")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.accounts.AlertPreferences=function(t){function e(){return this.onErrorProcess=i(this.onErrorProcess,this),this.onSuccessProcess=i(this.onSuccessProcess,this),this.onRadioChange=i(this.onRadioChange,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$el.on("change","input",this.onRadioChange)},e.prototype.onRadioChange=function(t){var e,i;return e=this.$(t.currentTarget).prop("checked"),i=this.$(t.currentTarget).prop("name"),Echo.routes.Accounts.alertPreferencesToggle(i,e).ajax({success:this.onSuccessProcess,error:this.onErrorProcess})},e.prototype.onSuccessProcess=function(){return alertify.success(this.i18n("Settings.savedSuccessfully"))},e.prototype.onErrorProcess=function(){return alertify.error(this.i18n("Labels.error"))},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.accounts.ChangePasswordModal=function(t){function i(){var t,e;return this.onSuccess=(t=this.onSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){return this.namespace=t.namespace,this.$el.on("AjaxForm."+this.namespace+".success",this.onSuccess)},i.prototype.onSuccess=function(){return alertify.success(this.i18n("Accounts."+this.namespace+".success")),this.$el.trigger("Modal."+this.namespace+".close")},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.accounts.LoneWolfLanding=function(t){function e(){return this.onAddTermSuccess=i(this.onAddTermSuccess,this),this.onAddSectionSuccess=i(this.onAddSectionSuccess,this),this.validate=i(this.validate,this),this.onCourseAdded=i(this.onCourseAdded,this),this.onTermSelectChange=i(this.onTermSelectChange,this),this.onCourseSelectChange=i(this.onCourseSelectChange,this),this.onFormSubmit=i(this.onFormSubmit,this),this.onTermModalClose=i(this.onTermModalClose,this),this.onCourseModalClose=i(this.onCourseModalClose,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){var t,e,i,o;return this.$courseSelector=this.$(".courseSelector select"),this.$termSelector=this.$(".termSelector select"),this.$sectionNumber=this.$("[name=sectionNumber]"),this.$btn=this.$(".createNewSection"),this.$el.on("change",".courseSelector select",this.onCourseSelectChange).on("change",".termSelector select",this.onTermSelectChange).on("Course.added",this.onCourseAdded).on("change","select",this.validate).on("keyup","input",this.validate).on("AjaxForm.addCourse.success",(o=this,function(){return o.loadingOff()})).on("AjaxForm.addCourse.error",(i=this,function(){return i.loadingOff()})).on("AjaxForm.addSection.success",this.onAddSectionSuccess).on("AjaxForm.addSection.error",(e=this,function(){return e.loadingOff()})).on("AjaxForm.addTerm.success",this.onAddTermSuccess).on("AjaxForm.addTerm.error",(t=this,function(){return t.loadingOff()})).on("AjaxForm.submit",this.onFormSubmit),this.$body.on("Modal.addCourse.onClose",this.onCourseModalClose),this.$body.on("Modal.addTerm.onClose",this.onTermModalClose)},e.prototype.onCourseModalClose=function(){return this.courseSuccess?this.courseSuccess=!1:this.$courseSelector.trigger("Select.updateSelected","")},e.prototype.onTermModalClose=function(){return this.termSuccess?this.termSuccess=!1:this.$termSelector.trigger("Select.updateSelected","")},e.prototype.onFormSubmit=function(){return this.loadingOn()},e.prototype.onCourseSelectChange=function(t){if("NEW"===this.$courseSelector.val())return this.$el.trigger("Modal.addCourse.open")},e.prototype.onTermSelectChange=function(t){if("NEW"===this.$termSelector.val())return this.$el.trigger("Modal.addTerm.open")},e.prototype.onCourseAdded=function(t,e){return this.courseSuccess=!0,this.$courseSelector.trigger("Select.createOption",{value:e.courseId,text:e.courseIdentifier}).trigger("Select.updateSelected",e.courseId),this.$el.trigger("Modal.addCourse.close")},e.prototype.validate=function(){var t,e;return""!==(t=this.$courseSelector.val())&&"NEW"!==t&&""!==(e=this.$termSelector.val())&&"NEW"!==e&&""!==this.$sectionNumber.val().trim()?this.$btn.trigger("enable"):this.$btn.trigger("disable")},e.prototype.onAddSectionSuccess=function(t,e){return this.loadingOff(),window.location=Echo.routes.SectionHome.index(null!=e?e.sectionId:void 0).url},e.prototype.onAddTermSuccess=function(t,e){return this.termSuccess=!0,this.loadingOff(),this.$termSelector.trigger("Select.createOption",{value:e.id,text:e.name,optGroup:e.active?this.i18n("Labels.activeTerms"):this.i18n("Labels.inactiveTerms")}).trigger("Select.updateSelected",e.id),this.$el.trigger("Modal.addTerm.close"),alertify.success(this.i18n("Courses.CreateTerm.success"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.accounts.LoneWolfRegistration=function(t){function e(){return this.onBack=i(this.onBack,this),this.onContinue=i(this.onContinue,this),this.onFetchPublicInstitutions=i(this.onFetchPublicInstitutions,this),this.onInstitutionSelectorChange=i(this.onInstitutionSelectorChange,this),this.onChange=i(this.onChange,this),this.onEulaChange=i(this.onEulaChange,this),this.onRegisterError=i(this.onRegisterError,this),this.onRegisterSuccess=i(this.onRegisterSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.publicSectionRegistration=t.publicSectionRegistration,this.$backBtn=this.$(".back-btn"),this.$continueBtn=this.$(".continueToSignupBtn"),this.$countrySelector=this.$(".countrySelector select"),this.$error=this.$(".region-unsupported"),this.$emailRegisteredError=this.$(".error"),this.$registeredUserLoginUrl=this.$("[name=registeredUserLoginUrl]"),this.$email=this.$("[name=email]"),this.$eula=this.$("[name=eula]"),this.$openRegistrationWarning=this.$(".open-registration-warning"),this.$openRegistrationDisclaimer=this.$(".open-registration-disclaimer"),this.$publicInstitutionSelect=this.$("[name=publicInstitutionId]"),this.$publicInstitutionSelector=this.$(".publicInstitutionSelector"),this.$submitBtn=this.$(".signUp-btn"),this.$wizard=this.$(".register-wizard"),this.$captcha=this.$(".g-recaptcha"),this.$backBtn.on("click",this.onBack),this.$continueBtn.on("click",this.onContinue),this.$countrySelector.on("change",this.onChange),this.$eula.on("change",this.onEulaChange),this.$publicInstitutionSelect.on("change",this.onInstitutionSelectorChange),this.$el.on("AjaxForm.registerUser.success",this.onRegisterSuccess),this.$el.on("AjaxForm.registerUser.error",this.onRegisterError),this.$countrySelector.trigger("change")},e.prototype.onRegisterSuccess=function(){return window.location=Echo.routes.Accounts.loneWolfInstructorLanding().url},e.prototype.onRegisterError=function(t,e){var i,o,n,s;for(i in s=e.formErrors)n=s[i],"obj.recaptcha"===i&&alertify.error(Echo.messages(n[0].msg)),"Errors.loneWolfUserExists"===n[0].msg&&(o=encodeURIComponent(this.$email.val().trim()),this.$emailRegisteredError.append('<div class="navLink">&nbsp;<a href=\''+this.$registeredUserLoginUrl.val()+"&email="+o+"'>"+this.i18n("Accounts.loneWolf.signIn")+"</a></div>"));if(this.$captcha&&"undefined"!=typeof grecaptcha&&null!==grecaptcha)return grecaptcha.reset()},e.prototype.onEulaChange=function(){return this.validate()},e.prototype.validate=function(){var t,e;return t=this.$eula.prop("checked"),this.publicSectionRegistration||(e=this.$publicInstitutionSelect.find("option:selected").data("value")),this.$openRegistrationWarning.toggle(!(null==e||e)),this.$openRegistrationDisclaimer.toggle(null!=e&&e),this.publicSectionRegistration||this.$publicInstitutionSelector.find(".selection").toggleClass("italics",null!=e&&!e),t&&(e||this.publicSectionRegistration)?this.$submitBtn.trigger("enable"):this.$submitBtn.trigger("disable")},e.prototype.onChange=function(){var t;if(!this.publicSectionRegistration)return t=this.$countrySelector.val(),Echo.routes.PublicInstitutions.getByCountry(t).ajax({success:this.onFetchPublicInstitutions})},e.prototype.onInstitutionSelectorChange=function(){return this.validate()},e.prototype.onFetchPublicInstitutions=function(t){var e;return e=t.data,this.$publicInstitutionSelect.trigger("Select.updateOptions",{options:this.buildOptions(e[0].publicInstitutions),keepEmptyOption:!0})},e.prototype.buildOptions=function(t){return _.map(t,function(t){return"<option value='"+t.id+"' data-value="+t.openRegistration+">"+t.name+"</option>"})},e.prototype.onContinue=function(){return this.$wizard.removeClass("one").addClass("two"),document.title=this.i18n("Accounts.Login.Form.signUpAsAnInstructor")},e.prototype.onBack=function(){return this.$wizard.removeClass("two").addClass("one"),document.title=this.i18n("Accounts.loneWolf.whatCountryAreYouIn")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.accounts.PayWall=function(t){function e(){return this.showPaymentMethodView=i(this.showPaymentMethodView,this),this.onPaymentOptionEdit=i(this.onPaymentOptionEdit,this),this.onPaypalEdit=i(this.onPaypalEdit,this),this.onAnnualBtnClick=i(this.onAnnualBtnClick,this),this.onTrimesterBtnClick=i(this.onTrimesterBtnClick,this),this.onPromoCodeBtnClick=i(this.onPromoCodeBtnClick,this),this.onPaypalBtnClick=i(this.onPaypalBtnClick,this),this.onCreditCardBtnClick=i(this.onCreditCardBtnClick,this),this.onPaymentMethodReceived=i(this.onPaymentMethodReceived,this),this.onCardTokenize=i(this.onCardTokenize,this),this.onPromoCodeCheckSuccess=i(this.onPromoCodeCheckSuccess,this),this.onPromoCodeCheckError=i(this.onPromoCodeCheckError,this),this.onSubmit=i(this.onSubmit,this),this.onBrainTreeError=i(this.onBrainTreeError,this),this.onPromoCodesError=i(this.onPromoCodesError,this),this.onPaymentSuccess=i(this.onPaymentSuccess,this),this.onPaymentComplete=i(this.onPaymentComplete,this),this.onCreditCardYearChange=i(this.onCreditCardYearChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.nonce={},e.prototype.initialize=function(t){return this.accountCreated=t.accountCreated,this.afterPaymentUrl=t.afterPaymentUrl,this.clientToken=t.clientToken,this.$registrationWizard=this.$(".registration-wizard"),this.$registrationSuccessMessage=this.$(".registration-success"),this.$trimesterBtn=this.$(".trimester-btn"),this.$annualBtn=this.$(".annual-btn"),this.$paypalBtn=this.$(".paypal-btn"),this.$continueWithCheckoutBtn=this.$(".continueWithCheckoutBtn"),this.$creditCardBtn=this.$(".creditCard-btn"),this.$promoCodeBtn=this.$(".promoCode-btn"),this.$promoCode=this.$(".promoCode input"),this.$promoCodeDisclaimer=this.$(".promoCode-disclaimer"),this.$form=this.$("form"),this.$braintreeContent=this.$(".braintree-content"),this.$paymentOptionText=this.$(".payment-option span"),this.$paymentTypeText=this.$(".payment-type span"),this.$paypalDetails=this.$(".paypal-details"),this.$paypalDetailsText=this.$paypalDetails.find(".payment-type"),this.$creditCardNumber=this.$("[data-braintree-name=number]"),this.$creditCardMonth=this.$("[data-braintree-name=expiration_month]"),this.$creditCardYear=this.$("[data-braintree-name=expiration_year]"),this.$creditCardCvv=this.$("[data-braintree-name=cvv]"),this.$el.on("submit",this.onSubmit).on("AjaxForm.braintree.success",this.onPaymentSuccess).on("AjaxForm.braintree.error",this.onBrainTreeError).on("PaymentOption.edit",this.onPaymentOptionEdit).on("PaymentType.edit",this.showPaymentMethodView).on("Payment.complete",this.onPaymentComplete).on("Paypal.edit",this.onPaypalEdit).on("click",".paypal-overlay",this.stopPropagation),this.$trimesterBtn.on("click",this.onTrimesterBtnClick),this.$annualBtn.on("click",this.onAnnualBtnClick),this.$creditCardBtn.on("click",this.onCreditCardBtnClick),this.$paypalBtn.on("click",this.onPaypalBtnClick),this.$promoCodeBtn.on("click",this.onPromoCodeBtnClick),this.$creditCardYear.on("change",this.onCreditCardYearChange),this.accountCreated&&this.flashSuccessMessage(),this.initOpenRegistration(),this.onCreditCardYearChange()},e.prototype.initOpenRegistration=function(){return braintree.setup(this.clientToken,"custom",{container:this.$braintreeContent.attr("id"),paypal:{container:this.$paypalBtn.attr("id")},onPaymentMethodReceived:this.onPaymentMethodReceived}),this.client=new braintree.api.Client({clientToken:this.clientToken})},e.prototype.flashSuccessMessage=function(){return this.$registrationSuccessMessage.addClass("flash"),setTimeout((t=this,function(){return t.$registrationSuccessMessage.removeClass("flash")}),3e3);var t},e.prototype.onCreditCardYearChange=function(){var t,e,i,o;return o=+this.$creditCardYear.val(),i=+this.$creditCardMonth.val(),e=(new Date).getFullYear(),t=(new Date).getMonth(),o!==e?this.$creditCardMonth.find("option").removeAttr("disabled"):(this.$creditCardMonth.find("option:lt("+t+")").attr("disabled",!0),this.$creditCardMonth.find("option:gt("+(t-1)+")").removeAttr("disabled"),i<=t?this.$creditCardMonth.trigger("Select.updateSelected",t+1):void 0)},e.prototype.onPaymentComplete=function(){return this.$promoCodeBtn.hasClass("selected")?this.submitPromoCodePayment():this.submitPaymentForm()},e.prototype.submitPaymentForm=function(){var t;return t=this.$creditCardBtn.hasClass("selected")?this.nonce.creditCard:this.nonce.payPal,this.$("form").trigger("AjaxForm.submitWithData",{nonce:t,paymentType:this.paymentType})},e.prototype.submitPromoCodePayment=function(){return Echo.routes.PromoCodes.redeem(this.$promoCode.val().trim()).ajax({success:this.onPaymentSuccess,error:this.onPromoCodesError})},e.prototype.onPaymentSuccess=function(){return window.location=this.afterPaymentUrl},e.prototype.onPromoCodesError=function(t){return Echo.core.form.onSubmitError(this.$el,t,{}),this.showPaymentMethodView()},e.prototype.onBrainTreeError=function(t,e){if(this.errorCheck=!0,this.showErrorMessages(e),this.showPaymentMethodView(),!0===this.errorCheck)return alertify.error(this.i18n("Errors.paymentFailed"))},e.prototype.showErrorMessages=function(t){if(null!=t.CREDIT_CARD_CVV_IS_INVALID&&this.$creditCardCvv.trigger("Input.setError",t.CREDIT_CARD_CVV_IS_INVALID),null!=t.CREDIT_CARD_NUMBER_IS_INVALID&&this.$creditCardNumber.trigger("Input.setError",t.CREDIT_CARD_NUMBER_IS_INVALID),null!=t.CREDIT_CARD_NUMBER_HAS_INVALID_LENGTH&&this.$creditCardNumber.trigger("Input.setError",t.CREDIT_CARD_NUMBER_HAS_INVALID_LENGTH),null!=t.PAYMENT_FAILED)return alertify.error(t.PAYMENT_FAILED),this.errorCheck=!1},e.prototype.onSubmit=function(){return this.$creditCardBtn.hasClass("selected")?this.processCreditCard():null!=this.nonce.payPal&&this.$paypalBtn.hasClass("selected")?this.togglePaymentViews():this.$promoCodeBtn.hasClass("selected")?this.processPromoCode():void 0},e.prototype.processPromoCode=function(){var t;return""===(t=this.$promoCode.val().trim())?this.$promoCode.trigger("Input.setError",this.i18n("Errors.promoCodeRequired")):Echo.routes.PromoCodes.isRedeemable(t).ajax({success:this.onPromoCodeCheckSuccess,error:this.onPromoCodeCheckError})},e.prototype.onPromoCodeCheckError=function(t){return Echo.core.form.onSubmitError(this.$el,t,{})},e.prototype.onPromoCodeCheckSuccess=function(t){return t.data[0].redeemable?(this.updatePaymentOptionText(),this.updatePaymentTypeText({type:"PromoCode"}),this.togglePaymentViews()):this.$promoCode.trigger("Input.setError",this.i18n("Errors.promoCodeNotRedeemable"))},e.prototype.processCreditCard=function(){if(this.isCardValid())return this.client.tokenizeCard({number:this.$creditCardNumber.val(),expirationMonth:this.$creditCardMonth.val(),expirationYear:this.$creditCardYear.val(),cvv:this.$creditCardCvv.val()},this.onCardTokenize)},e.prototype.isCardValid=function(){var t,e,i,o,n,s;return i=this.$creditCardNumber.val().trim(),n=""!==(e=this.$creditCardCvv.val().trim()),(o=""!==i)||this.$creditCardNumber.trigger("Input.setError",this.i18n("Errors.creditCardRequired")),n||this.$creditCardCvv.trigger("Input.setError",this.i18n("Errors.cvvRequired")),0===(t=Echo.helpers.Payment.getCardType(i)).length?(o&&this.$creditCardNumber.trigger("Input.setError",this.i18n("Errors.creditCardInvalid")),!1):(this.expectedCvvLength=t[0].code.size,(s=this.expectedCvvLength===e.length)||this.$creditCardCvv.trigger("Input.setError",this.i18n("Errors.cvvInvalid",this.expectedCvvLength)),o&&n&&s)},e.prototype.onCardTokenize=function(t,e){if(null!=e)return this.onPaymentMethodReceived({nonce:e,type:"CreditCard",details:{lastFour:this.$creditCardNumber.val().substring(this.$creditCardNumber.val().length-4)}})},e.prototype.onPaymentMethodReceived=function(t){switch(t.type){case"CreditCard":this.nonce.creditCard=t.nonce;break;case"PayPalAccount":this.nonce.payPal=t.nonce}return this.updatePaymentTypeText(t),this.$creditCardBtn.hasClass("selected")&&this.togglePaymentViews(),this.$creditCardBtn.toggleClass("selected","CreditCard"===t.type),this.$paypalBtn.toggleClass("selected","PayPalAccount"===t.type),this.processNonce(t)},e.prototype.processNonce=function(t){if(null==this.nonce.payPal&&this.$paypalBtn.find(".paypal-overlay").remove(),"PayPalAccount"===t.type)return this.$continueWithCheckoutBtn.trigger("enable"),this.$paypalBtn.prepend('<div class="paypal-overlay"></div>'),this.$paypalDetails.addClass("paid"),this.$paypalDetailsText.text(this.i18n("Accounts.Register.paypal",t.details.email))},e.prototype.onCreditCardBtnClick=function(){return this.$continueWithCheckoutBtn.trigger("enable"),this.$creditCardBtn.addClass("selected"),this.$paypalBtn.removeClass("selected"),this.$promoCodeBtn.removeClass("selected"),this.$form.removeClass("paypal promoCode").addClass("creditCard"),this.$creditCardNumber.focus()},e.prototype.onPaypalBtnClick=function(t){if(0!==t.screenX||0!==t.screenY||0!==t.clientX||0!==t.clientY||this.fakePaypalClick)return this.fakePaypalClick&&(this.fakePaypalClick=!1),null==this.nonce.payPal&&this.$continueWithCheckoutBtn.trigger("disable"),this.$creditCardBtn.removeClass("selected"),this.$promoCodeBtn.removeClass("selected"),this.$form.removeClass("creditCard promoCode").addClass("paypal"),null!=this.nonce.payPal?this.$paypalBtn.addClass("selected"):void 0},e.prototype.onPromoCodeBtnClick=function(){if(!this.$annualBtn.hasClass("selected"))return this.$continueWithCheckoutBtn.trigger("enable"),this.$creditCardBtn.removeClass("selected"),this.$paypalBtn.removeClass("selected"),this.$form.removeClass("creditCard promoCode").addClass("promoCode"),this.$promoCodeBtn.addClass("selected"),this.$promoCode.focus()},e.prototype.onTrimesterBtnClick=function(){return this.paymentType="StudentAccessTrimester",this.$trimesterBtn.addClass("selected"),this.$annualBtn.removeClass("selected"),this.$promoCodeDisclaimer.hide(),this.updatePaymentOptionText(),this.showPaymentMethodView()},e.prototype.onAnnualBtnClick=function(){return this.paymentType="StudentAccessAnnual",this.$annualBtn.addClass("selected"),this.$trimesterBtn.removeClass("selected"),this.updatePromoCodeWrapper(),this.updatePaymentOptionText(),this.showPaymentMethodView()},e.prototype.updatePaymentOptionText=function(){var t;return t=this.$promoCodeBtn.hasClass("selected")?this.i18n("Accounts.Register.promoCodeTerm"):this.$trimesterBtn.hasClass("selected")?this.$trimesterBtn.text():this.$annualBtn.hasClass("selected")?this.$annualBtn.text():void 0,this.$paymentOptionText.text(t)},e.prototype.updatePromoCodeWrapper=function(){return this.$promoCodeBtn.removeClass("selected"),this.$form.removeClass("promoCode"),this.$promoCode.val(""),this.$promoCodeDisclaimer.show()},e.prototype.updatePaymentTypeText=function(t){switch(t.type){case"CreditCard":return this.$paymentTypeText.text(this.i18n("Accounts.Register.creditCardEndingIn",t.details.lastFour));case"PayPalAccount":return this.$paymentTypeText.text(this.i18n("Accounts.Register.paypal",t.details.email));case"PromoCode":return this.$paymentTypeText.text(this.i18n("Accounts.Register.promoCode",this.$promoCode.val().trim()))}},e.prototype.togglePaymentViews=function(){return this.$registrationWizard.removeClass("one two three four").addClass(this.accountCreated?"four":"three")},e.prototype.onPaypalEdit=function(){return this.fakePaypalClick=!0,this.$paypalBtn.find("img").click()},e.prototype.onPaymentOptionEdit=function(){return this.$registrationWizard.removeClass("one two three four").addClass(this.accountCreated?"two":"one")},e.prototype.showPaymentMethodView=function(){return this.$registrationWizard.removeClass("one two three four").addClass(this.accountCreated?"three":"two")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.accounts.Register=function(t){function e(){return this.handleUserRegistrationErrors=i(this.handleUserRegistrationErrors,this),this.handleUserRegistrationSuccess=i(this.handleUserRegistrationSuccess,this),this.focusEula=i(this.focusEula,this),this.clearUserRegistrationErrors=i(this.clearUserRegistrationErrors,this),this.onEulaChange=i(this.onEulaChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.$userRegistrationErrorsDiv=this.$("#userRegistrationErrors"),this.$checkbox=this.$("input[name=eula]"),this.$firstName=this.$("input[name=firstName]"),this.$submitBtn=this.$(".registerSubmitBtn"),this.$captcha=this.$(".g-recaptcha"),this.$firstName.focus(),this.$el.on("submit",this.clearUserRegistrationErrors).on("FileStack.success",this.focusEula).on("AjaxForm.registerUser.error",this.handleUserRegistrationErrors).on("AjaxForm.registerUser.success",this.handleUserRegistrationSuccess),this.$checkbox.on("change",this.onEulaChange)},e.prototype.onEulaChange=function(){return this.$checkbox.prop("checked")?this.$submitBtn.trigger("enable"):this.$submitBtn.trigger("disable")},e.prototype.clearUserRegistrationErrors=function(){return this.$userRegistrationErrorsDiv.empty()},e.prototype.focusEula=function(){return this.$checkbox.focus()},e.prototype.handleUserRegistrationSuccess=function(t,e){if(null!=e.url)return window.location=e.url},e.prototype.handleUserRegistrationErrors=function(t,e){var i,o,n,s,r,a;for(o in a=e.formErrors)r=a[o],"obj.recaptcha"===o?alertify.error(Echo.messages(r[0].msg)):(i=(s=Echo.core.form.findNestedField(this.$body,o)).attr("aria-label"),n=Echo.messages(r[0].msg,r[0].args),this.$userRegistrationErrorsDiv.append('<div class="user-registration-error">'+i+" "+n+"</div>"),s.focus());if(this.$captcha&&"undefined"!=typeof grecaptcha&&null!==grecaptcha)return grecaptcha.reset()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.accounts.Update=function(t){function e(){return this.onCreatePassword=i(this.onCreatePassword,this),this.onChangePassword=i(this.onChangePassword,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$el.on("Accounts.update.changePassword",this.onChangePassword).on("Accounts.update.createPassword",this.onCreatePassword)},e.prototype.onChangePassword=function(){return this.injectFromUrl(Echo.routes.Accounts.changePasswordModal())},e.prototype.onCreatePassword=function(){return this.injectFromUrl(Echo.routes.Accounts.createPasswordModal())},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.analytics.ConfusingContent=function(t){function e(){return this.onRelativeNavigationRight=i(this.onRelativeNavigationRight,this),this.onRelativeNavigationLeft=i(this.onRelativeNavigationLeft,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.ROWS_IN_PAGE=5,e.prototype.initialize=function(t){return this.url=t.url,this.$rows=this.$(".row"),this.$nav=this.$(".relative-navigation"),this.pageIndex=0,this.maxPageIndex=Math.max(0,Math.ceil(this.$rows.length/this.ROWS_IN_PAGE)-1),this.update(),this.$el.on("RelativeNavigation.left",this.onRelativeNavigationLeft),this.$el.on("RelativeNavigation.right",this.onRelativeNavigationRight)},e.prototype.onRelativeNavigationLeft=function(){if(0!==this.pageIndex)return this.pageIndex-=1,this.update()},e.prototype.onRelativeNavigationRight=function(){if(this.pageIndex!==this.maxPageIndex)return this.pageIndex+=1,this.update()},e.prototype.update=function(){var t,e;return t=(e=this.pageIndex*this.ROWS_IN_PAGE)+this.ROWS_IN_PAGE,this.$rows.hide(),this.$rows.slice(e,t).show().trigger("ConfusingContentItem.sizeThumbnail"),this.updateArrows()},e.prototype.updateArrows=function(){return this.$nav.trigger("RelativeNavigation.updateArrows",{left:0!==this.pageIndex,right:this.pageIndex!==this.maxPageIndex})},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.analytics.ConfusingContentItem=function(t){function i(){var t,e;return this.onLoad=(t=this.onLoad,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.maxHeight=75,i.prototype.maxWidth=100,i.prototype.initialize=function(){return this.$wrapper=this.$(".confusing-thumbnail-wrapper"),this.$img=this.$("img"),Echo.core.helpers.preloadImage(this.$img.attr("src"),this.onLoad),this.$el.on("ConfusingContentItem.sizeThumbnail",this.onLoad)},i.prototype.onLoad=function(){if("none"!==this.$el.css("display"))return this.$wrapper.css({marginLeft:(this.maxWidth-this.$img.width())/2,marginRight:(this.maxWidth-this.$img.width())/2,marginTop:(this.maxHeight-this.$img.height())/2,marginBottom:(this.maxHeight-this.$img.height())/2,height:this.$img.height(),width:this.$img.width()})},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.analytics.Export=function(t){function e(){return this.toggleSendButton=i(this.toggleSendButton,this),this.selectMetric=i(this.selectMetric,this),this.unSelectAll=i(this.unSelectAll,this),this.selectAll=i(this.selectAll,this),this.lmsProfileChange=i(this.lmsProfileChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e;return this.sectionId=t.sectionId,this.$lessonList=this.$(".lessonList"),this.$sendButton=this.$(".sendToGradebook"),this.$metrics=this.$(".legend .metrics"),this.$checkboxes=this.$lessonList.find("input[type=checkbox]"),this.$lmsProfileSelect=this.$(".lmsProfile"),this.$lmsProfileSelect.on("Analytics.lmsProfile.change",this.lmsProfileChange),this.$(".resourceList-item").length&&(e=this.$(".resourceList-item").data("lms-profile-id"),this.$lmsProfileSelect.trigger("Select.updateSelected",e),this.lmsProfileChange(null,this.$lmsProfileSelect.find("select").val())),this.$exportTypeSelect=this.$(".start-export-job select"),this.$body.on("Analytics.export.selectAll",this.selectAll).on("Analytics.export.unSelectAll",this.unSelectAll),this.$metrics.on("click",this.selectMetric),this.$checkboxes.on("click",this.toggleSendButton)},e.prototype.lmsProfileChange=function(t,e){return _.each(this.$(".resourceList-item"),function(t){return this.$(t).toggle(this.$(t).data("lms-profile-id")===e)})},e.prototype.selectAll=function(){return this.$checkboxes.prop("checked",!0),this.toggleSendButton()},e.prototype.unSelectAll=function(){return this.$checkboxes.prop("checked",!1),this.toggleSendButton()},e.prototype.selectMetric=function(t){var e;if(!(e=this.$(t.currentTarget)).hasClass("selected"))return this.$metrics.removeClass("selected"),e.addClass("selected")},e.prototype.toggleSendButton=function(){return 0===this.$lessonList.find("input:checkbox:checked").length?this.$sendButton.trigger("disable"):this.$sendButton.trigger("enable")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.analytics.ExportLmsResource=function(t){function e(){return this.toggleSendButton=i(this.toggleSendButton,this),this.selectMetric=i(this.selectMetric,this),this.unSelectAll=i(this.unSelectAll,this),this.selectAll=i(this.selectAll,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$lessonList=this.$(".lessonList"),this.$sendButton=this.$(".sendToGradebook"),this.$metrics=this.$(".legend .metrics"),this.$checkboxes=this.$lessonList.find("input[type=checkbox]"),this.$body.on("Analytics.export.selectAll",this.selectAll).on("Analytics.export.unSelectAll",this.unSelectAll),this.$metrics.on("click",this.selectMetric),this.$checkboxes.on("click",this.toggleSendButton)},e.prototype.selectAll=function(){return this.$checkboxes.prop("checked",!0),this.toggleSendButton()},e.prototype.unSelectAll=function(){return this.$checkboxes.prop("checked",!1),this.toggleSendButton()},e.prototype.selectMetric=function(t){var e;if(!(e=this.$(t.currentTarget)).hasClass("selected"))return this.$metrics.removeClass("selected"),e.addClass("selected")},e.prototype.toggleSendButton=function(){return 0===this.$lessonList.find("input:checkbox:checked").length?this.$sendButton.trigger("disable"):this.$sendButton.trigger("enable")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.analytics.ExportAnalyticsModal=function(t){function e(){return this.onSubmitError=i(this.onSubmitError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onSubmit=i(this.onSubmit,this),this.onOpen=i(this.onOpen,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.namespace=t.namespace,this.sectionId=t.sectionId,this.$body.on("Modal.sendAnalytics.open",this.onOpen),this.$el.on("Analytics.send.submit",this.onSubmit)},e.prototype.onOpen=function(){return this.confirmMultiple(this.i18n("Analytics.export.warning.text")+" <br /><br /> "+this.i18n("Analytics.export.warning.continue"),this.onSubmit)},e.prototype.onSubmit=function(){var t;return t=$(".metrics.selected"),this.buildSelectedLessonMap(),this.ajax(Echo.routes.SectionAnalytics.send(this.sectionId),{data:{exportType:t.attr("data-series"),ids:this.selectedLessons},success:this.onSubmitSuccess,error:this.onSubmitError})},e.prototype.onSubmitSuccess=function(){return alertify.success(this.i18n("Analytics.studentAnalytics.sent")),this.$el.trigger("Modal."+this.namespace+".close")},e.prototype.onSubmitError=function(){return alertify.error(this.i18n("Alert.genericError"))},e.prototype.buildSelectedLessonMap=function(){var t,i;return this.selectedLessons=[],t=$(".lessonList").find("input:checkbox:checked").closest(".lessonList-row"),$(t).each((i=this,function(t,e){return i.selectedLessons.push($(e).attr("data-lesson-id"))}))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.analytics.LmsResourceItem=function(t){function e(){return this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onSubmitError=i(this.onSubmitError,this),this.exportLmsResource=i(this.exportLmsResource,this),this.onExportGroup=i(this.onExportGroup,this),this.onExport=i(this.onExport,this),this.onEditSuccess=i(this.onEditSuccess,this),this.onEdit=i(this.onEdit,this),this.onExportSelectAll=i(this.onExportSelectAll,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.lmsLinkId=t.lmsLinkId,this.lmsLinkTitle=t.lmsLinkTitle,this.lmsResource=t.lmsResource,this.$metric=this.$('[name="exportType"]'),this.$body.find(".exportAnalyticsSection .check-all-links").change(this.onExportSelectAll),this.$el.on("LmsResource.edit",this.onEdit).on("LmsResource.export",this.onExport)},e.prototype.onExportSelectAll=function(t){var e;return e=this.$body.find(".exportAnalyticsSection .check-all-links").prop("checked"),this.$body.find('.exportAnalyticsSection input[name="links"]').prop("checked",e)},e.prototype.onEdit=function(){return this.$body.find(".editLmsLink #react-box").attr("data-lms-link-id",this.lmsLinkId).attr("data-lms-profile-id",this.lmsResource.lmsProfileId),this.$body.on("LmsResource.editSuccess",this.onEditSuccess),this.$body.trigger("Modal.editLmsLink.open")},e.prototype.onEditSuccess=function(t,e){var i,o,n;return"ok"===e.status&&(this.lmsResource=e.data[0].resource,null!=e.data[0].lesson?null!=(i=e.data[0].lesson).name&&null!=i.timing?(n=Echo.core.helpers.getDateFromISODateString(i.timing.start),o=Echo.core.helpers.getFormattedMonthFromNum(n.getMonth())+" "+n.getDate()+" - "+i.name):null==(o=i.name)&&(o=Echo.core.helpers.getFormattedMonthFromNum(n.getMonth())+" "+n.getDate()):o="Section",this.$el.find(".linked-to").text(o)),this.$body.off("LmsResource.editSuccess"),this.$body.trigger("Modal.editLmsLink.close")},e.prototype.onExport=function(){return"Lesson"===this.lmsResource.objectType?this.confirmMultiple(this.i18n("Analytics.export.warning.text")+" <br /><br /> "+this.i18n("Analytics.export.warning.continue"),(e=this,function(){return e.exportLmsResource()})):this.confirmMultiple(this.i18n("Analytics.export.warning.text")+" <br /><br /> "+this.i18n("Analytics.export.warning.continue"),(t=this,function(){return t.$body.on("Analytics.exportAnalyticsForm2.export",t.onExportGroup),t.$body.trigger("Modal.exportAnalyticsForm2.open")}));var t,e},e.prototype.onExportGroup=function(){var t;return t=_.map(_.filter($('.exportAnalyticsForm2 input[name="links"]:checked').serializeArray(),function(t){return"check-all-links"!==t.value}),function(t){return t.value}),this.exportLmsResource(t),this.$body.off("Analytics.exportAnalyticsForm2.export"),this.$body.trigger("Modal.exportAnalyticsForm2.close")},e.prototype.exportLmsResource=function(t){var e;return null==t&&(t=[]),e=this.$metric.val(),this.ajax(Echo.routes.lti.LmsResources.exportLmsResource(this.lmsResource.lmsProfileId,this.lmsLinkId),{data:{ids:t,exportType:e},dataType:"json",type:"POST",success:this.onSubmitSuccess,error:this.onSubmitError})},e.prototype.onSubmitError=function(){return alertify.alert(this.i18n("Errors.lmsExportErrror"))},e.prototype.onSubmitSuccess=function(t){return alertify.success(this.i18n("Analytics.studentAnalytics.sent"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.analytics.Settings=function(t){function e(){return this.updateForm=i(this.updateForm,this),this.onReset=i(this.onReset,this),this.onFormChange=i(this.onFormChange,this),this.onPresetChange=i(this.onPresetChange,this),this.onBeforeUnload=i(this.onBeforeUnload,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e,i,o;return this.engagementPresets=t.engagementPresets,this.sectionId=t.sectionId,this.$form=this.$("form"),this.$sliderInputs=this.$(".slider input"),this.$sliderPercentages=this.$(".slider-container .percentage"),this.$resetBtn=this.$(".settings-reset-btn"),this.$saveBtn=this.$(".settings-save-btn"),this.$form.on("AjaxForm.analyticsSettings.error",this.onFormChange).on("AjaxForm.analyticsSettings.success",this.updateForm).on("Slider.change",this.onFormChange).on("reset",this.onReset).on("Preset.inClass",(o=this,function(t){return o.onPresetChange(t.namespace)})).on("Preset.remote",(i=this,function(t){return i.onPresetChange(t.namespace)})).on("Preset.personalAndPeer",(e=this,function(t){return e.onPresetChange(t.namespace)})),window.onbeforeunload=this.onBeforeUnload,this.sliderData=this.$form.serialize(),this.subscribeTo("sectionInstructor-"+this.sectionId,this.onMessage)},e.prototype.onBeforeUnload=function(){if(this.$form.serialize()!==this.sliderData)return this.i18n("Analytics.engagementSettings.unsaved")},e.prototype.onPresetChange=function(t){var e,i,o,n;for(e in o=[],i=this.engagementPresets[t])n=i[e],o.push(this.$form.find("input[name="+e+"]").val(n).trigger("change"));return o},e.prototype.onFormChange=function(){var t;return t=this.$form.serialize(),this.calculateMetricPercentages(),t!==this.sliderData?this.enableButtons():this.disableButtons()},e.prototype.getMetricTotal=function(t){var e,i,o,n,s;for(e=n=0,o=(s=this.$sliderInputs).length;e<o;e++)i=s[e],n+=+this.$(i).val()+t;return n},e.prototype.calculateMetricPercentages=function(){var t,e,i,o,n,s,r,a,h,l;for((t=0)===(n=this.getMetricTotal(t))&&(t=1,n=this.getMetricTotal(t)),s={},l=[],i=e=0,o=(h=this.$sliderPercentages).length;e<o;i=++e)r=h[i],a=Math.round(100*(+this.$sliderInputs.eq(i).val()+t)*100/n,2)/100,this.$(r).text(a+"%"),l.push(s[this.$(r).attr("data-metric")]=a/100);return l},e.prototype.onReset=function(){return this.disableButtons()},e.prototype.updateForm=function(t,e){var i,o,n,s,r;for(r=e.weight,i=0,n=(s=this.$sliderInputs).length;i<n;i++)o=s[i],(o=$(o)).attr("value",r[o.attr("name")]);return this.sliderData=this.$form.serialize(),this.disableButtons(),alertify.success(this.i18n("Analytics.engagementSettingsSavedSuccessfully"))},e.prototype.enableButtons=function(){return this.$resetBtn.trigger("enable"),this.$saveBtn.trigger("enable")},e.prototype.disableButtons=function(){return this.$resetBtn.trigger("disable"),this.$saveBtn.trigger("disable")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.analytics.SyncButton=function(t){function e(){return this.showSyncButton=i(this.showSyncButton,this),this.onMetricsImportGradesFromCanvas=i(this.onMetricsImportGradesFromCanvas,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.namespace=t.namespace,this.sectionId=t.sectionId,this.$body.on("AdminListTable.calculateItemCount",this.showSyncButton),this.$body.on("Canvas.syncButton",this.onMetricsImportGradesFromCanvas),this.$body.trigger("Canvas.syncButtonInit")},e.prototype.onMetricsImportGradesFromCanvas=function(){return this.ajax(Echo.routes.SectionAnalytics.queueCanvasMetricsImport(),{success:(t=this,function(){return alertify.success(t.i18n("Notifications.queuedCanvasImport"))}),error:this.onError});var t},e.prototype.showSyncButton=function(t,e){return 0===e?$(".syncCanvasButton").hide():$(".syncCanvasButton").show()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.classroom.Classroom=function(t){function e(){return this.onNotify=i(this.onNotify,this),this.submitSlideView=i(this.submitSlideView,this),this.submitVideoTimeView=i(this.submitVideoTimeView,this),this.onDownloadNotes=i(this.onDownloadNotes,this),this.onSlideView=i(this.onSlideView,this),this.onVideoTimeView=i(this.onVideoTimeView,this),this.closeSidebar=i(this.closeSidebar,this),this.toggleQuestions=i(this.toggleQuestions,this),this.toggleNotes=i(this.toggleNotes,this),this._onRecordPlay=i(this._onRecordPlay,this),this.onBeforeUnload=i(this.onBeforeUnload,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.lessonId=t.lessonId,this.videoId=t.videoId,this.deckId=t.deckId,this.isStudent=t.isStudent,this.sectionId=t.sectionId,this.legacyLive=t.legacyLive,this.questionsEnabled=t.questionsEnabled,this.isNewClassroom=t.isNewClassroom,this.id=this.$el.attr("id"),this.$sidebar=this.$(".classroom-sidebar"),this.$notesBtn=this.$(".open-notes-btn"),this.$questionsBtn=this.$(".open-questions-btn"),this.$sidebarNotes=this.$sidebar.find(".notes"),this.$el.on("Notebook.notes.toggle",this.toggleNotes).on("Classroom.questions.toggle",this.toggleQuestions).on("Classroom.sidebar.close",this.closeSidebar).on("Classroom.download.notes",this.onDownloadNotes),$(window).on("beforeunload",this.onBeforeUnload),this.loggedStart=!1,this.hasSlideChanged=!1,this.onRecordPlay=_.debounce(this._onRecordPlay,1e3),this.isNewClassroom||this.$el.on("Classroom.notify",this.onNotify).on("Video.timeView",this.onVideoTimeView).on("Slide.view",this.onSlideView).on("Video.recordPlay",this.onRecordPlay),this.isStudent?this.$el.trigger("Notebook.notes.toggle",{doNotFocus:!0}):this.questionsEnabled&&(null!=this.videoId||null!=this.deckId||this.legacyLive||this.toggleQuestions()),$(".nav").hide(),this.$(".media.active").focus()},e.prototype.onBeforeUnload=function(){null==this.currentSlide||this.isNewClassroom||this.onSlideView(null,{slideId:this.currentSlide,slideDeckId:this.deckId,force:!0})},e.prototype._onRecordPlay=function(t,e){var i;return i=null!=(null!=e?e.time:void 0)?1e3*Math.round(parseInt(e.time)):0,this.ajax(Echo.routes.PlayerAnalytics.recordVideoPlay(this.videoId),{data:{contextId:this.lessonId,contextType:"Lesson",time:i,start:!this.loggedStart}}),this.loggedStart=!0},e.prototype.toggleNotes=function(t,e){return this.$el.hasClass("showSidebar")&&this.$sidebar.hasClass("showNotes")?this.closeSidebar():this.showNotes(null!=e?e.doNotFocus:void 0)},e.prototype.showNotes=function(t){if(this.$el.addClass("showSidebar"),this.$sidebar.removeClass("showQuestions").addClass("showNotes"),this.$questionsBtn.removeClass("active"),this.$notesBtn.addClass("active"),null==t)return this.$sidebar.find(".notes .classroom-sidebar-close").focus()},e.prototype.toggleQuestions=function(){return this.$el.hasClass("showSidebar")&&this.$sidebar.hasClass("showQuestions")?this.closeSidebar():this.showQuestions()},e.prototype.showQuestions=function(){return this.$el.addClass("showSidebar"),this.$sidebar.removeClass("showNotes").addClass("showQuestions"),this.$notesBtn.removeClass("active"),this.$questionsBtn.addClass("active"),this.$sidebar.find(".questions .classroom-sidebar-close").focus()},e.prototype.closeSidebar=function(){return this.$el.removeClass("showSidebar"),this.$sidebar.removeClass("showNotes showQuestions"),this.$notesBtn.removeClass("active"),this.$questionsBtn.removeClass("active")},e.prototype.onVideoTimeView=function(t,e){return this.submitVideoTimeView(e)},e.prototype.onSlideView=function(t,e){var i,o;if(i=(new Date).getTime(),null!=this.currentSlide)return null==this.slideViewStartTime&&(this.slideViewStartTime=i),this.slideViewEndTime=i,o=this.slideViewEndTime-this.slideViewStartTime,this.submitSlideView(this.currentSlide,e.slideDeckId,o,!e.force),this.hasSlideChanged=this.currentSlide!==e.slideId,this.currentSlide=e.slideId;this.slideViewStartTime=i,this.currentSlide=e.slideId},e.prototype.onDownloadNotes=function(t,e){return window.location=Echo.routes.Notes.downloadForLesson(this.lessonId).url,setTimeout((i=this,function(){return alertify.success(i.i18n("Classroom.notesDownloadedSuccessfully"))}),100);var i},e.prototype.submitVideoTimeView=function(t){var e,i;if(i=1e3*Math.round(t.startTime),e=1e3*Math.round(t.endTime),!(t.endTime-t.startTime<10))return this.ajax(Echo.routes.PlayerAnalytics.recordVideoEvent(this.videoId),{data:{contextId:this.lessonId,contextType:"Lesson",sceneStartTimeInMs:i,sceneEndTimeInMs:e,sceneDurationInMs:e-i}})},e.prototype.submitSlideView=function(t,e,i,o){return this.ajax(Echo.routes.PlayerAnalytics.recordSlideEvent(e,this.hasSlideChanged),{async:o,data:{contextId:this.lessonId,contextType:"Lesson",slideId:t,viewDurationInMs:i}})},e.prototype.onNotify=function(t,e){return e.confirm?alertify.alert(this.i18n(e.message)):alertify.success(this.i18n(e.message))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.classroom.InstructorConfusion=function(t){function e(){return this.redraw=i(this.redraw,this),this.onGetSlideConfusedSuccess=i(this.onGetSlideConfusedSuccess,this),this.onGetSceneConfusedSuccess=i(this.onGetSceneConfusedSuccess,this),this.getSlideConfused=i(this.getSlideConfused,this),this.getSceneConfused=i(this.getSceneConfused,this),this.onVideoTimeUpdate=i(this.onVideoTimeUpdate,this),this.onSlideDeckNavigate=i(this.onSlideDeckNavigate,this),this.onVideoConfusion=i(this.onVideoConfusion,this),this.onSlideConfusion=i(this.onSlideConfusion,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.VIEW_INTERVAL=30,e.prototype.initialize=function(t){return this.lessonId=t.lessonId,this.videoId=t.videoId,this.deckId=t.deckId,this.sectionId=t.sectionId,this.confusedSlides={},this.confusedScenes={},this.$badge=this.$(".badge"),this.$body.on("SlideDeck."+this.deckId+".navigate",this.onSlideDeckNavigate).on("Video."+this.videoId+".timeUpdate",this.onVideoTimeUpdate).on("Lesson."+this.lessonId+".slideConfusion",this.onSlideConfusion).on("Lesson."+this.lessonId+".videoConfusion",this.onVideoConfusion)},e.prototype.onSlideConfusion=function(t,e){if(e.slideDeckId===this.deckId)return this.getSlideConfused(e.slideId)},e.prototype.onVideoConfusion=function(t,e){if(e.videoId===this.videoId)return this.getSceneConfused(e.time)},e.prototype.onSlideDeckNavigate=function(t,e){return this.slideId=e.slideId,null==this.confusedSlides[this.slideId]&&(this.confusedSlides[this.slideId]=0,this.getSlideConfused(this.slideId)),this.redraw()},e.prototype.onVideoTimeUpdate=function(t,e){return this.currTime=Math.floor(e.currentTime/1e3),this.scene=this.getSceneFromMillis(e.currentTime),null==this.confusedScenes[this.scene]&&(this.confusedScenes[this.scene]=0,this.getSceneConfused(this.currTime)),this.redraw()},e.prototype.getSceneFromMillis=function(t){return this.getSceneFromSeconds(Math.floor(t/1e3))},e.prototype.getSceneFromSeconds=function(t){return Math.floor(t/this.VIEW_INTERVAL)},e.prototype.getSceneConfused=function(t){return this.ajax(Echo.routes.DataPoints.getVideoTimeConfusionCount(this.lessonId,this.videoId,Math.round(t)),{success:this.onGetSceneConfusedSuccess})},e.prototype.getSlideConfused=function(t){if(t)return this.ajax(Echo.routes.DataPoints.getSlideConfusionCount(this.lessonId,this.deckId,t),{success:this.onGetSlideConfusedSuccess})},e.prototype.onGetSceneConfusedSuccess=function(t){return t=t.data[0],this.confusedScenes[this.getSceneFromSeconds(t.time)]=t.numConfused,this.redraw()},e.prototype.onGetSlideConfusedSuccess=function(t){return t=t.data[0],this.confusedSlides[t.slideId]=t.numConfused,this.redraw()},e.prototype.redraw=function(){var t,e,i,o,n,s;return s=[],0===(t=(n=null!=(e=this.confusedSlides[this.slideId])?e:0)+(o=null!=(i=this.confusedScenes[this.scene])?i:0))?(this.$badge.hide(),s.push(this.i18n("Classroom.noConfusion"))):(this.$badge.text(t).show(),0<o&&s.push(this.i18n("Classroom.numConfusedVideo",o)),0<n&&s.push(this.i18n("Classroom.numConfusedSlide",n))),0<n&&0<o?this.$el.attr("data-tooltip-css","twoRow"):this.$el.attr("data-tooltip-css",""),this.$el.attr("data-tooltip",s.join(", "))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.classroom.Navigation=function(t){function e(){return this.onFocusout=i(this.onFocusout,this),this.onKeyUp=i(this.onKeyUp,this),this.close=i(this.close,this),this.open=i(this.open,this),this.onCloseKeydown=i(this.onCloseKeydown,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$classroomNavBtn=$(".classroom-nav-btn"),this.$closeNavigationBtn=this.$(".classroom-navigation-close-btn"),this.$exitClassroomBtn=this.$("a.exitBtn"),this.$body.on("ClassroomNavigation.open",this.open).on("keyup",this.onKeyUp),this.$closeNavigationBtn.on("click",this.close).on("keydown",this.onCloseKeydown),this.close()},e.prototype.onCloseKeydown=function(t){var e;if(t.stopPropagation(),(e=t.which)===this.KEYS.ENTER||e===this.KEYS.SPACE_BAR)return this.close()},e.prototype.open=function(){return this.$el.on("focusout.ClassroomNavigation",this.onFocusout),this.enableTabbing("a"),this.$el.show(),this.$closeNavigationBtn.focus(),setTimeout((t=this,function(){return t.$el.attr("aria-hidden",!1).addClass("open"),t.$classroomNavBtn.hide()}),1);var t},e.prototype.close=function(t){return null!=t&&t.stopPropagation(),$("a.open-notes-btn").length?$("a.open-notes-btn").focus():$("a.open-questions-btn").focus(),this.disableTabbing("a"),this.$el.off("focusout.ClassroomNavigation"),this.$el.removeClass("open"),setTimeout((e=this,function(){return e.$el.hide().attr("aria-hidden",!0),e.$classroomNavBtn.show()}),250);var e},e.prototype.onKeyUp=function(t){var e;if(this.$el.hasClass("open")&&t.keyCode===this.KEYS.ESC)return t.stopPropagation(),setTimeout((e=this,function(){return e.close()}),250)},e.prototype.onFocusout=function(t){if(this.$el.hasClass("open"))return 0===$(t.relatedTarget).parents(".classroom-navigation").length?this.$exitClassroomBtn.focus():void 0},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty;Echo.pages.classroom.StudentBookmark=function(t){function e(){return this.redraw=i(this.redraw,this),this.onBookmarkWithContentRefDeleted=i(this.onBookmarkWithContentRefDeleted,this),this.onBookmarkWithContentRefUpdated=i(this.onBookmarkWithContentRefUpdated,this),this.onVideoTimeUpdate=i(this.onVideoTimeUpdate,this),this.onSlideDeckNavigate=i(this.onSlideDeckNavigate,this),this.onBookmarkVideo=i(this.onBookmarkVideo,this),this.onBookmarkSlide=i(this.onBookmarkSlide,this),this.onKeypress=i(this.onKeypress,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)a.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.VIEW_INTERVAL=30,e.prototype.initialize=function(t){var e;if(this.videoId=t.videoId,this.deckId=t.deckId,this.bookmarkedSlides={},this.bookmarkedScenes={},this.$videoBtn=this.$(".bookmark-video-btn"),this.$slideBtn=this.$(".bookmark-slide-btn"),e=_.throttle(this.onVideoTimeUpdate,500),this.$el.on("StudentBookmark.bookmarkSlide",this.onBookmarkSlide).on("StudentBookmark.bookmarkVideo",this.onBookmarkVideo),this.$body.on("Video."+this.videoId+".timeUpdate",e).on("SlideDeck."+this.deckId+".navigate",this.onSlideDeckNavigate).on("Bookmark.withContentRef.updated",this.onBookmarkWithContentRefUpdated).on("Bookmark.withContentRef.deleted",this.onBookmarkWithContentRefDeleted).on("StudentBookmark.manualSlideUpdate",this.onSlideDeckNavigate),0<this.$el.closest(".stage").length)return this.$body.on("keypress",this.onKeypress)},e.prototype.onKeypress=function(t){var e,i,o;if(e="TEXTAREA"===(o=t.target.tagName)||"INPUT"===o,i=0<$(t.target).parents("textarea, input").length,!e&&!i)return t.shiftKey&&t.which===this.KEYS.B?this.bookmarkActiveMedia():void 0},e.prototype.bookmarkActiveMedia=function(){return this.$el.closest(".stage").find(".media.active").hasClass("video")?this.onBookmarkVideo():this.onBookmarkSlide()},e.prototype.onBookmarkSlide=function(){return this.isSlideBookmarked(this.currSlideId)?this.$el.trigger("Notebook.deleteBookmark",this.bookmarkedSlides[this.currSlideId]):this.$el.trigger("Notebook.bookmarkSlide"),this.redraw()},e.prototype.onBookmarkVideo=function(){return this.isSceneBookmarked(this.currTime)?this.$el.trigger("Notebook.deleteBookmark",this.bookmarkedScenes[this.getSceneFromSeconds(this.currTime)]):this.$el.trigger("Notebook.bookmarkVideo"),this.redraw()},e.prototype.onSlideDeckNavigate=function(t,e){return this.currSlideId=e.slideId,this.redraw()},e.prototype.onVideoTimeUpdate=function(t,e){return this.currTime=Math.floor(e.currentTime/1e3),this.getSceneFromSeconds(this.currTime),this.redraw()},e.prototype.onBookmarkWithContentRefUpdated=function(t,e){var i,o,n,s,r;if(null!=e.slideId){for(r in i=this.bookmarkedSlides)a.call(i,r)&&i[r].noteId===e.noteId&&(this.bookmarkedSlides[r]=!1);this.bookmarkedSlides[e.slideId]={noteId:e.noteId}}else if(null!=e.timestamp){for(n in s=this.getSceneFromSeconds(Math.floor(e.timestamp/1e3)),o=this.bookmarkedScenes)a.call(o,n)&&o[n].noteId===e.noteId&&(this.bookmarkedScenes[n]=!1);this.bookmarkedScenes[s]={noteId:e.noteId}}return this.redraw()},e.prototype.onBookmarkWithContentRefDeleted=function(t,e){var i;return null!=e.slideId?this.bookmarkedSlides[e.slideId]=!1:null!=e.timestamp&&(i=this.getSceneFromSeconds(Math.floor(e.timestamp/1e3)),this.bookmarkedScenes[i]=!1),this.redraw()},e.prototype.getSceneFromSeconds=function(t){return Math.floor(t/this.VIEW_INTERVAL)},e.prototype.isSlideBookmarked=function(t){return this.bookmarkedSlides[t]},e.prototype.isSceneBookmarked=function(t){return this.bookmarkedScenes[this.getSceneFromSeconds(this.currTime)]},e.prototype.redraw=function(){var t,e;return e=this.isSlideBookmarked(this.currSlideId),t=this.isSceneBookmarked(this.currTime),e||t?this.$el.addClass("active"):this.$el.removeClass("active"),t?this.$videoBtn.addClass("active").text(this.i18n("Classroom.unBookmarkVideo")):this.$videoBtn.removeClass("active").text(this.i18n("Classroom.bookmarkVideo")),e?this.$slideBtn.addClass("active").text(this.i18n("Classroom.unBookmarkSlide")):this.$slideBtn.removeClass("active").text(this.i18n("Classroom.bookmarkSlide"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.classroom.StudentConfusion=function(t){function e(){return this.redraw=i(this.redraw,this),this.onGetSlideConfusedSuccess=i(this.onGetSlideConfusedSuccess,this),this.onGetSceneConfusedSuccess=i(this.onGetSceneConfusedSuccess,this),this.getSlideConfused=i(this.getSlideConfused,this),this.deleteSlideConfused=i(this.deleteSlideConfused,this),this.onSubmitSlideConfusedSuccess=i(this.onSubmitSlideConfusedSuccess,this),this.submitSlideConfused=i(this.submitSlideConfused,this),this.getSceneConfused=i(this.getSceneConfused,this),this.deleteSceneConfused=i(this.deleteSceneConfused,this),this.onSubmitSceneConfusedSuccess=i(this.onSubmitSceneConfusedSuccess,this),this.submitSceneConfused=i(this.submitSceneConfused,this),this.confusionSlide=i(this.confusionSlide,this),this.confusionVideo=i(this.confusionVideo,this),this.onVideoTimeUpdate=i(this.onVideoTimeUpdate,this),this.onSlideDeckNavigate=i(this.onSlideDeckNavigate,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.VIEW_INTERVAL=30,e.prototype.initialize=function(t){var e;return this.lessonId=t.lessonId,this.videoId=t.videoId,this.deckId=t.deckId,this.sectionId=t.sectionId,this.confusedSlides={},this.confusedScenes={},this.$stage=this.$(".classroom-stage"),this.$videoBtn=this.$(".videoConfusionBtn"),this.$slideBtn=this.$(".slideConfusionBtn"),this.$el.on("Classroom.confusion.video",this.confusionVideo),this.$el.on("Classroom.confusion.slide",this.confusionSlide),this.$body.on("SlideDeck."+this.deckId+".navigate",this.onSlideDeckNavigate),e=_.throttle(this.onVideoTimeUpdate,500),this.$body.on("Video.mediaEvent."+this.videoId+".timeUpdate",e)},e.prototype.onSlideDeckNavigate=function(t,e){return this.currSlideId=e.slideId,null==this.confusedSlides[e.slideId]&&(this.confusedSlides[e.slideId]=!1,this.getSlideConfused(e.slideId)),this.redraw()},e.prototype.onVideoTimeUpdate=function(t,e){var i;if(e.currentTime)return this.currTime=Math.floor(e.currentTime/1e3),i=this.getSceneFromSeconds(this.currTime),null==this.confusedScenes[i]&&(this.confusedScenes[i]=!1,this.getSceneConfused(this.currTime)),this.redraw()},e.prototype.getSceneFromMillis=function(t){return this.getSceneFromSeconds(Math.floor(t/1e3))},e.prototype.getSceneFromSeconds=function(t){return Math.floor(t/this.VIEW_INTERVAL)},e.prototype.isSlideConfusing=function(t){var e;return null!=(e=this.confusedSlides[t])&&e},e.prototype.isSceneConfusing=function(t){var e;return null!=(e=this.confusedScenes[this.getSceneFromSeconds(this.currTime)])&&e},e.prototype.confusionVideo=function(){return this.isSceneConfusing(this.currTime)?(this.confusedScenes[this.getSceneFromSeconds(this.currTime)]=!1,this.deleteSceneConfused(this.currTime)):(this.confusedScenes[this.getSceneFromSeconds(this.currTime)]=!0,this.submitSceneConfused(this.currTime)),this.redraw()},e.prototype.confusionSlide=function(){return this.isSlideConfusing(this.currSlideId)?(this.confusedSlides[this.currSlideId]=!1,this.deleteSlideConfused(this.currSlideId)):(this.confusedSlides[this.currSlideId]=!0,this.submitSlideConfused(this.currSlideId)),this.redraw()},e.prototype.submitSceneConfused=function(t){return this.ajax(Echo.routes.DataPoints.createForVideoTimeConfused(this.sectionId),{data:{lessonId:this.lessonId,videoId:this.videoId,time:Math.round(t)},success:this.onSubmitSceneConfusedSuccess})},e.prototype.onSubmitSceneConfusedSuccess=function(){return this.$el.trigger("Classroom.notify",{message:"Notifications.sceneMarkedConfusing"})},e.prototype.deleteSceneConfused=function(t){return this.ajax(Echo.routes.DataPoints.deleteForVideoTimeConfused(this.lessonId,this.videoId,Math.round(t)))},e.prototype.getSceneConfused=function(t){return this.ajax(Echo.routes.DataPoints.getForVideoTimeConfused(this.lessonId,this.videoId,Math.round(t)),{success:this.onGetSceneConfusedSuccess,error:this.onGetVideoConfusedError})},e.prototype.submitSlideConfused=function(t){return this.ajax(Echo.routes.DataPoints.createForSlideConfused(this.sectionId),{data:{lessonId:this.lessonId,slideDeckId:this.deckId,slideId:t},success:this.onSubmitSlideConfusedSuccess})},e.prototype.onSubmitSlideConfusedSuccess=function(){return this.$el.trigger("Classroom.notify",{message:"Notifications.slideMarkedConfusing"})},e.prototype.deleteSlideConfused=function(t){return this.ajax(Echo.routes.DataPoints.deleteForSlideConfused(this.lessonId,this.deckId,t))},e.prototype.getSlideConfused=function(t){return this.ajax(Echo.routes.DataPoints.getForSlideConfused(this.lessonId,this.deckId,t),{success:this.onGetSlideConfusedSuccess,error:this.onGetSlideConfusedError})},e.prototype.onGetSceneConfusedSuccess=function(t){var e;if(t=null!=t&&null!=(e=t.data)?e[0]:void 0)return this.confusedScenes[this.getSceneFromSeconds(t.time)]=t.isConfused,this.redraw()},e.prototype.onGetSlideConfusedSuccess=function(t){var e;if(t=null!=t&&null!=(e=t.data)?e[0]:void 0)return this.confusedSlides[t.slideId]=t.isConfused,this.redraw()},e.prototype.redraw=function(){var t,e,i;return e=this.isSlideConfusing(this.currSlideId),t=this.isSceneConfusing(this.currTime),e||t?this.$el.addClass("active"):this.$el.removeClass("active"),t?this.$videoBtn.addClass("active"):this.$videoBtn.removeClass("active"),e?this.$slideBtn.addClass("active"):this.$slideBtn.removeClass("active"),i=t&&e?this.i18n("Classroom.confusedOnSceneAndSlide"):t&&!e?this.i18n("Classroom.confusedOnScene"):!t&&e?this.i18n("Classroom.confusedOnSlide"):this.i18n("Classroom.flagAsConfused"),this.$el.hasClass("classroomDropdown")?this.$el.find(".classroomDropdown-toggle").attr("data-tooltip",i):this.$el.attr("data-tooltip",i)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.echoAdmin.UpdateInstitutionASRInfo=function(t){function i(){var t,e;return this.onSuccess=(t=this.onSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("AjaxForm.updateASRInfo.success",this.onSuccess)},i.prototype.onSuccess=function(t,e){return alertify.success(this.i18n("EchoAdmin.asrSuccessfullyUpdated"))},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.echoAdmin.UpdateInstitutionCountry=function(t){function i(){var t,e;return this.onSuccess=(t=this.onSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("AjaxForm.updateCountry.success",this.onSuccess).on("AjaxForm.updateCountry.error",this.onEnrollUserError)},i.prototype.onSuccess=function(t,e){return alertify.success("Institution country successfully updated")},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.echoAdmin.AdminRow=function(t){function e(){return this.onRoleChanged=i(this.onRoleChanged,this),this.onDelete=i(this.onDelete,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.userId=t.userId,this.$(".delete-admin").on("click",this.onDelete),this.$(".role-picker").on("change",this.onRoleChanged)},e.prototype.onDelete=function(){return Echo.routes.EchoAdmins.delete(this.userId).ajax({complete:function(){return window.location.reload()}})},e.prototype.onRoleChanged=function(t){return $.ajax({contentType:"application/json",url:Echo.routes.EchoAdmins.update(this.userId).url,data:JSON.stringify(t.target.value),dataType:"json",type:"PUT",success:function(){return alert("Role updated successfully")}})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.echoAdmin.CreatePublicInstitution=function(t){function e(){return this.onError=i(this.onError,this),this.onSuccess=i(this.onSuccess,this),this.onRegionChange=i(this.onRegionChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$country=this.$("[name=country]"),this.$region=this.$("[name=region]"),this.$region.on("change",this.onRegionChange),this.$el.on("AjaxForm.createPublicInstitution.success",this.onSuccess).on("AjaxForm.createPublicInstitution.error",this.onError)},e.prototype.onRegionChange=function(t,e){var i,o;return i="ON"===(o=this.$region.value())||"QC"===o||"NS"===o||"NB"===o||"MB"===o||"BC"===o||"PE"===o||"SK"===o||"AB"===o||"NL"===o?"CA":"US",this.$country.val(i)},e.prototype.onSuccess=function(){return alertify.success("Public institution created")},e.prototype.onError=function(){return alertify.error("Error creating public institution")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.echoAdmin.LinkPublicInstitution=function(t){function e(){return this.onSuccess=i(this.onSuccess,this),this.updateButton=i(this.updateButton,this),this.onFetchPublicInstitutions=i(this.onFetchPublicInstitutions,this),this.onRegionChange=i(this.onRegionChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$region=this.$("[name=region]"),this.$publicInstitution=this.$("[name=id]"),this.$button=this.$("[type=submit]"),this.$region.on("change",this.onRegionChange),this.$publicInstitution.on("change",this.updateButton),this.$el.on("AjaxForm.linkPublicInstitution.success",this.onSuccess).on("AjaxForm.linkPublicInstitution.error",this.onEnrollUserError),this.onRegionChange()},e.prototype.onRegionChange=function(t,e){var i;return null!=(i=this.$region.value())?Echo.routes.PublicInstitutions.getByRegion(i).ajax({success:this.onFetchPublicInstitutions}):(this.$publicInstitution.trigger("disable"),this.$button.trigger("disable"))},e.prototype.onFetchPublicInstitutions=function(t){var e;return e=t.data,this.$publicInstitution.trigger("enable").trigger("Select.updateOptions",{options:this.buildOptions(e[0].publicInstitutions),keepEmptyOption:!0}),this.updateButton()},e.prototype.buildOptions=function(t){return _.map(t,function(t){return"<option value='"+t.id+"' data-value="+t.openRegistration+">"+t.name+"</option>"})},e.prototype.updateButton=function(){return null!=this.$publicInstitution.value()?this.$button.trigger("enable"):this.$button.trigger("disable")},e.prototype.onSuccess=function(t,e){return $(".publicInstitutionList").append(e.html)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.echoAdmin.UnlinkPublicInstitution=function(t){function e(){return this.onSuccess=i(this.onSuccess,this),this.unlink=i(this.unlink,this),this.onSubmit=i(this.onSubmit,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.publicInstitutionId=t.publicInstitutionId,this.$el.on("PublicInstitution.unlink",this.onSubmit)},e.prototype.onSubmit=function(t){return null!=t&&t.stopPropagation(),this.confirm("Warnings.areYouSure",(e=this,function(){return e.unlink()}));var e},e.prototype.unlink=function(t,e){return Echo.routes.PublicInstitutions.unlink(this.publicInstitutionId).ajax({success:this.onSuccess})},e.prototype.onSuccess=function(t,e){return this.$el.remove()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.home.Index=function(t){function e(){return this.onSectionCreate=i(this.onSectionCreate,this),this.onTermChange=i(this.onTermChange,this),this.onCreateSectionSuccess=i(this.onCreateSectionSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$sections=this.$(".sectionSummary"),this.$homeContent=this.$(".home-content"),this.$termFilterSelect=this.$("#term-filter select"),this.$termFilterSelect.on("change",this.onTermChange),this.onTermChange(),this.$el.on("Section.create",this.onSectionCreate),this.$body.on("CreateSection.success",this.onCreateSectionSuccess)},e.prototype.onCreateSectionSuccess=function(t,e){var i;return i=e.sectionId,window.location=Echo.routes.SectionHome.index(i).url},e.prototype.onTermChange=function(){var t,e,i,o,n,s,r,a,h,l,c;if(c=this.$termFilterSelect.val(),a=!1,this.$homeContent.scrollTop(0),"all"===c)this.$sections.show(),this.$sections.first().parent().removeClass("hidden-row");else if("active"===c)for(e=0,o=(s=this.$sections).length;e<o;e++)h=s[e],(t=this.$(h)).toggle("true"===t.attr("data-active")),a||"true"!==t.attr("data-active")||(t.parent().removeClass("hidden-row"),a=!0);else for(i=0,n=(r=this.$sections).length;i<n;i++)h=r[i],l=$(h).data("term-id"),this.$(h).toggle(l===c),a||l!==c||(this.$(h).parent().removeClass("hidden-row"),a=!0);return this.togglePlaceholders("active"===c)},e.prototype.togglePlaceholders=function(t){return this.$homeContent.removeClass("no-courses").toggleClass("no-courses",0===this.$sections.filter(":visible").length).toggleClass("active",t)},e.prototype.onSectionCreate=function(){return this.injectFromUrl(Echo.routes.Sections.getCreateSectionModal())},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.home.InstructorSectionRow=function(t){function e(){return this.onComplete=i(this.onComplete,this),this.onFetchEngagementData=i(this.onFetchEngagementData,this),this.onFetchError=i(this.onFetchError,this),this.showSurroundingRows=i(this.showSurroundingRows,this),this.sectionInView=i(this.sectionInView,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.sectionId=t.sectionId,this.ajaxCallCount=0,this.$studentsToWatch=this.$(".info-stat.next a"),this.$studentEngagementGraph=this.$(".studentEngagementGraph div"),this.$el.on("inview",this.sectionInView)},e.prototype.sectionInView=function(t,e){var i;if(!(!e||this.graphFetching||this.graphFetched||2<this.ajaxCallCount))return this.showSurroundingRows(this.$el.parent()),this.loadingOn(null,{selector:".studentEngagementGraph",theme:"light"}),this.loadingOn(null,{selector:".info-stat.next",theme:"light"}),Echo.routes.Home.getSectionEngagementStats(this.sectionId).ajax({beforeSend:(i=this,function(){return i.graphFetching=!0}),success:this.onFetchEngagementData,error:this.onFetchError,complete:this.onComplete})},e.prototype.showSurroundingRows=function(t){return t.prevAll().slice(0,30).removeClass("hidden-row"),t.nextAll().slice(0,30).removeClass("hidden-row")},e.prototype.onFetchError=function(){return this.ajaxCallCount++,this.graphFetching=!1},e.prototype.onFetchEngagementData=function(t){var e;return e=t.data,this.graphFetched=!0,this.$studentsToWatch.text(e[0].studentsToWatch),this.$studentsToWatch.attr("aria-label",this.i18n("Home.studentsToWatch")+" - "+e[0].studentsToWatch),this.$studentEngagementGraph.html(e[0].html)},e.prototype.onComplete=function(){return this.loadingOff(null,{selector:".studentEngagementGraph"}),this.loadingOff(null,{selector:".info-stat.next"})},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.legal.UserAgreement=function(t){function i(){var t,e;return this.onDecline=(t=this.onDecline,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){return this.message=t.message,this.$el.on("UserAgreement.decline",this.onDecline)},i.prototype.onDecline=function(){return alertify.alert(this.message)},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.Library=function(t){function e(){return this.insertRows=i(this.insertRows,this),this.onLibrarySort=i(this.onLibrarySort,this),this.hideLoading=i(this.hideLoading,this),this.showLoading=i(this.showLoading,this),this.updateCount=i(this.updateCount,this),this.onSearchSuccess=i(this.onSearchSuccess,this),this.search=i(this.search,this),this.queryDefaults=i(this.queryDefaults,this),this.clearContent=i(this.clearContent,this),this.onLibraryContentType=i(this.onLibraryContentType,this),this.onLoadMore=i(this.onLoadMore,this),this.onFilterBarUpdate=i(this.onFilterBarUpdate,this),this.onMediaEvents=i(this.onMediaEvents,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onSubmitError=i(this.onSubmitError,this),this.fileUploadSuccess=i(this.fileUploadSuccess,this),this.setupSearchListeners=i(this.setupSearchListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e,i;return this.userId=t.userId,this.institutionId=t.institutionId,this.currentPage=0,this.contentType="MyContent",this.$mediaListContainer=this.$("div.mediaList-container"),this.$mediaListContent=this.$mediaListContainer.find(".mediaList"),this.$mediaCount=this.$(".mediaCount .count"),this.$moreButton=this.$mediaListContainer.find(".moreButton"),this.$moreButton.hide(),this.$mediaListContainer=this.$(".mediaList-container"),this.$el.on("FileStack.success",this.fileUploadSuccess).on("MediaListHeader.sort",this.onLibrarySort).on("Library.contentType",this.onLibraryContentType).on("loadMore",this.onLoadMore),this.$el.on("ToggleView.showGrid",(e=this,function(){return e.$mediaListContainer.addClass("gridView")})),this.$el.on("ToggleView.showList",(i=this,function(){return i.$mediaListContainer.removeClass("gridView")})),this.$el.keyboardFocusable(".mediaList-item"),this.setupSearchListeners(),this.subscribeTo("media-"+this.userId+"-"+this.institutionId,this.onMediaEvents)},e.prototype.setupSearchListeners=function(){return this.$el.on("FilterBar.update",this.onFilterBarUpdate),this.$el.trigger("FilterBar.requestUpdate")},e.prototype.fileUploadSuccess=function(t,e){var i,o;return o={name:(i=e.fileBlob).filename,fileBlob:i},this.ajax(Echo.routes.MediaUpload.process(),{data:o,success:this.onSubmitSuccess,error:this.onSubmitError})},e.prototype.onSubmitError=function(){return alertify.alert(this.i18n("Errors.submitMediaError"))},e.prototype.onSubmitSuccess=function(t){var e;if("MyContent"===this.contentType)return e=t.data[0].html,this.$mediaListContainer.find(".mediaList-header").after(e),this.updateCount()},e.prototype.onMediaEvents=function(t){return this.$body.trigger("Media.statusChange",t)},e.prototype.onFilterBarUpdate=function(t,e){return this.filters=e,this.clearContent(),this.search()},e.prototype.onLoadMore=function(t){return this.currentPage=this.currentPage+1,this.search()},e.prototype.onLibraryContentType=function(t,e){return this.contentType=e,this.clearContent(),this.search()},e.prototype.clearContent=function(){return this.currentPage=0,this.$mediaListContent.find(".mediaList-item").remove(),this.$moreButton.hide()},e.prototype.queryDefaults=function(){return{pageNumber:this.currentPage,contentType:this.contentType,sortDescending:!0}},e.prototype.search=function(){return setTimeout(this.showLoading,1),this.ajax(Echo.routes.Library.search(),{data:$.extend(this.queryDefaults(),this.filters),success:this.onSearchSuccess,error:this.onSearchError,complete:this.hideLoading})},e.prototype.onSearchSuccess=function(t){var e,i,o;if(null!=(e=null!=(o=t.data)?o[0]:void 0))return this.$mediaListContent.append(e.items),i=this.$mediaListContent.find(".mediaList-item").length,e.total>i?this.$moreButton.show():this.$moreButton.hide(),this.updateCount(),null!=this.sortParams?this.$el.trigger("MediaListHeader.sort",this.sortParams):void 0},e.prototype.updateCount=function(){var t,e,i;return e=1===(t=this.$mediaListContent.find(".mediaList-item").length)?"Library.item":"Library.items",i=t+" "+Echo.messages(e),this.$mediaCount.text(i)},e.prototype.showLoading=function(){return this.$el.trigger("loading.on",{selector:".mediaContent",theme:"light",opacity:"transparent"})},e.prototype.hideLoading=function(){return this.$el.trigger("loading.off",{selector:".mediaContent"})},e.prototype.onLibrarySort=function(t,e){var i,o;return this.sortParams=e,this.filters=$.extend(this.filters,{sortDescending:"desc"===e.direction}),i="desc"===e.direction?this.compareDesc:this.compareAsc,o=this.$mediaListContainer.find(".mediaList").children("li:not(.mediaList-header)").get(),this.insertRows(this.sortRows(o,e.sortBy,i))},e.prototype.insertRows=function(t){return $(t).each((i=this,function(t,e){return i.$mediaListContainer.find(".mediaList").append(e)}));var i},e.prototype.sortRows=function(t,n,s){return t.sort(function(t,e){var i,o;return i=$(t).find("p."+n).text(),o=$(e).find("p."+n).text(),s(i,o)})},e.prototype.compareAsc=function(t,e){return naturalSort(t,e)},e.prototype.compareDesc=function(t,e){return naturalSort(e,t)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.library.MediaListHeader=function(t){function e(){return this.sortByColumn=i(this.sortByColumn,this),this.onClick=i(this.onClick,this),this.initialSort=i(this.initialSort,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.sortBy="",e.prototype.direction="desc",e.prototype.initialize=function(t){return this.suppress=t.suppress,this.$headerColumns=this.$(".mediaList-header-col"),this.$cols={name:this.$headerColumns.filter("[data-name=name]"),type:this.$headerColumns.filter("[data-name=type]"),published:this.$headerColumns.filter("[data-name=published]"),uploaded:this.$headerColumns.filter("[data-name=date]")},this.$headerColumns.on("click",this.onClick),setTimeout(this.initialSort)},e.prototype.initialSort=function(){return this.sortByColumn(this.$cols.uploaded)},e.prototype.onClick=function(t){return this.sortByColumn($(t.currentTarget))},e.prototype.sortByColumn=function(t){var e;return(e=t.data("name"))===this.sortBy?this.switchDirection():this.sortBy=e,this.$headerColumns.removeClass("asc desc"),t.addClass(this.direction),this.$el.trigger("MediaListHeader.sort",{sortBy:this.sortBy,direction:this.direction})},e.prototype.switchDirection=function(){return this.direction="asc"===this.direction?"desc":"asc"},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.Library.MediaStatus=function(t){function e(){return this.onMediaProgress=i(this.onMediaProgress,this),this.onMediaStatusChange=i(this.onMediaStatusChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.listItemId=t.listItemId,this.mediaId=t.mediaId,this.status=t.status,this.$body.on("Media.statusChange",this.onMediaStatusChange),this.$statusText=this.$(".status-text"),this.progressBar=this.$(".progressBar-widget"),"Processed"===this.status||"Failed"===this.status?this.progressBar.hide():this.progressBar.show()},e.prototype.onMediaStatusChange=function(t,e){var i;if(e.mediaId===this.mediaId)return"status"===(i=e.eventType)||"updated"===i?this.onMediaStatus(e.mediaStatus):void 0},e.prototype.onMediaStatus=function(t){var e;switch(t){case"PreUploaded":e=this.i18n("Media.process.preUploaded"),this.onMediaProgress(0);break;case"Uploaded":e=this.i18n("Media.process.uploaded"),this.onMediaProgress(25);break;case"Processing":e=this.i18n("Media.process.processing"),$("#"+this.listItemId).removeClass("failed"),this.onMediaProgress(50);break;case"Processed":e=this.i18n("Media.process.processed"),this.onMediaProgress(100),this.$el.trigger("Media."+this.mediaId+".processed");break;case"Failed":e=this.i18n("Media.process.failed"),this.onMediaProgress(0),$("#"+this.listItemId).addClass("failed")}return this.$statusText.text(e)},e.prototype.onMediaProgress=function(t){switch(this.progressBar.trigger("ProgressBar.update",t),t){case 0:return this.progressBar.hide();case 100:return this.progressTimeout=setTimeout((e=this,function(){return e.progressBar.fadeOut(600),clearTimeout(e.progressTimeout)}),5e3)}var e},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.library.SidebarLinks=function(t){function i(){var t,e;return this.onLinkClick=(t=this.onLinkClick,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$links=this.$("a"),this.$links.on("click",this.onLinkClick)},i.prototype.onLinkClick=function(t){var e;return this.$links.parent().removeClass("selected"),(e=$(t.target)).parent().addClass("selected"),this.$el.trigger("Library.contentType",e.attr("data-target"))},i}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}};Echo.pages.login.CookiesDisabledModal=function(){function t(){this.refreshPage=e(this.refreshPage,this),this.onDocReady=e(this.onDocReady,this),$(document).on("ready",this.onDocReady).on("cookiesDisabled.refreshPage",this.refreshPage)}return t.prototype.onDocReady=function(){if(this.cookiesDisabled())return $("body").trigger("Modal.cookiesDisabled.open")},t.prototype.cookiesDisabled=function(){var t;return t=Math.floor(1e3*Math.random()),document.cookie=t,-1===document.cookie.indexOf(t)},t.prototype.refreshPage=function(){return window.top.location.reload(!0)},t}()}.call(this),function(){Echo.pages.login.Login=function(){function t(){var t,e;this.onDocReady=(t=this.onDocReady,e=this,function(){return t.apply(e,arguments)}),$(document).on("ready",this.onDocReady)}return t.prototype.onDocReady=function(){return $("input[name=email]").trigger("focus")},t}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.login.RegionSelect=function(t){function i(){var t,e;return this.onChange=(t=this.onChange,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$select=this.$("select"),this.$select.on("change",this.onChange)},i.prototype.onChange=function(){return window.location.hostname=this.$select.val()},i}()}.call(this),function(){Echo.pages.lti.Login=function(){function t(){var t,e;this.onDocReady=(t=this.onDocReady,e=this,function(){return t.apply(e,arguments)}),$(document).on("ready",this.onDocReady)}return t.prototype.onDocReady=function(){if($("input[name=password]").trigger("focus"),this.cookiesDisabled())return alertify.alert(Echo.messages("Warnings.cookiesDisabled"))},t.prototype.cookiesDisabled=function(){return document.cookie="testcookie",-1===document.cookie.indexOf("testcookie")},t}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.lti.LtiCreatePassword=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$el.on("AjaxForm.createPassword.success",this.onSuccess)},e.prototype.onSuccess=function(t,e){return window.location=e.url},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.lti.LtiMissingFields=function(t){function e(){var t,e;this.onDocReady=(t=this.onDocReady,e=this,function(){return t.apply(e,arguments)}),$(document).on("ready",this.onDocReady)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$el.on("AjaxForm.registerUser.success",this.onSuccess)},e.prototype.onSuccess=function(t,e){return window.location=e.url},e.prototype.onDocReady=function(){if(this.cookiesDisabled())return alertify.alert(Echo.messages("Warnings.cookiesDisabled"))},e.prototype.cookiesDisabled=function(){return document.cookie="testcookie",-1===document.cookie.indexOf("testcookie")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.lti.MockRequestForm=function(t){function i(){var t,e;return this.onChange=(t=this.onChange,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){return this.key=t.key,this.secret=t.secret,this.$form=this.$("form"),this.$sig=this.$("input[name=oauth_signature]"),this.$el.find("input.listen").on("input",this.onChange),this.onChange()},i.prototype.onChange=function(t,e){var i,o;return o="https://localhost:9009"+this.$form.attr("action"),delete(e=Echo.core.form.getData(this.$form)).oauth_signature,i=oauthSignature.generate("POST",o,e,this.secret,null,{encodeSignature:!1}),i=decodeURIComponent(i),this.$sig.val(i)},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.sectionContent.Index=function(t){function e(){return this.onSearchSuccess=i(this.onSearchSuccess,this),this.onSearchComplete=i(this.onSearchComplete,this),this.onFilterBarUpdate=i(this.onFilterBarUpdate,this),this.clearContent=i(this.clearContent,this),this.loadMore=i(this.loadMore,this),this.onScroll=i(this.onScroll,this),this.onResize=i(this.onResize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.currentPage=0,e.prototype.infiniteScroll=!0,e.prototype.searched=!1,e.prototype.initialize=function(t){return this.sectionId=t.sectionId,this.$contentSearchResultsCount=this.$(".content-search-results-count"),this.$contentSearchResults=this.$(".content-search-results"),this.$contentSearchResultsWrapper=this.$(".content-search-results-wrapper"),this.$contentSearchResultsList=this.$(".content-search-results-list"),this.$contentSearchNoResultsPlaceholder=this.$(".content-search-placeholder.noResults"),this.$contentSearchPlaceholder=this.$(".content-search-placeholder.placeholder"),this.$loadingSection=this.$(".loading-section"),this.$el.on("FilterBar.update",this.onFilterBarUpdate),this.$contentSearchResultsWrapper.on("resize",this.onResize).on("scroll",this.onScroll),this.$el.trigger("FilterBar.requestUpdate")},e.prototype.onResize=function(){if(this.searched)return this.fillContent()},e.prototype.onScroll=function(t){if(this.infiniteScroll)return this.$contentSearchResultsList.height()-this.$contentSearchResultsWrapper.height()-this.$contentSearchResultsWrapper.scrollTop()<=0?this.loadMore():void 0},e.prototype.loadMore=function(){if(null==this.xhr)return this.currentPage=this.currentPage+1,this.$loadingSection.show(),this.$el.trigger("loading.on",{selector:".loading-section",theme:"light",opacity:"transparent"}),this.search()},e.prototype.clearContent=function(){return this.searched=!1,this.$contentSearchResultsList.empty(),this.currentPage=0,this.updateResultCount(0,0),this.$contentSearchNoResultsPlaceholder.hide(),this.$contentSearchPlaceholder.show()},e.prototype.queryDefaults=function(){return{pageNumber:this.currentPage}},e.prototype.onFilterBarUpdate=function(t,e){if(this.filters=e,this.clearContent(),null!=this.filters.searchText)return this.$el.trigger("loading.on",{selector:".content-search-results",theme:"light",opacity:"transparent"}),this.search()},e.prototype.search=function(){var t;return null!=(t=this.xhr)&&t.abort(),this.xhr=this.ajax(Echo.routes.SectionContent.search(this.sectionId),{data:$.extend(this.filters,this.queryDefaults()),success:this.onSearchSuccess,error:this.onSearchComplete})},e.prototype.onSearchComplete=function(){return this.$el.trigger("loading.off",{selector:".content-search-results"}).trigger("loading.off",{selector:".loading-section"}),this.$loadingSection.hide(),this.xhr=null},e.prototype.onSearchSuccess=function(t){var e,i,o,n,s;for(e=0,i=(o=t.results).length;e<i;e++)n=o[e],this.$contentSearchResultsList.append(n);return s=this.$contentSearchResultsList.find(".section-content-search-result").length,this.infiniteScroll=s<t.total,this.updateResultCount(s,t.total),this.$contentSearchNoResultsPlaceholder.toggle(0===s),this.$contentSearchPlaceholder.hide(),this.searched=!0,this.fillContent()},e.prototype.updateResultCount=function(t,e){if(this.$contentSearchResults.toggleClass("show-count",0<t),!(t<0))return this.$contentSearchResultsCount.text(this.i18n("SectionContent.resultCount",t,e))},e.prototype.fillContent=function(){if(this.onSearchComplete(),this.$contentSearchResultsWrapper.height()>=this.$contentSearchResultsList.height()&&this.infiniteScroll)return this.loadMore()},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.sectionContent.SearchResult=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){var t,e,i,o,n;if(this.$header=this.$(".result-header"),this.$text=this.$(".result-text"),this.$span=this.$(".result-text > span"),this.parseText(this.$header),0!==this.$text.length){if(0===this.$span.length)return this.parseText(this.$text);for(n=[],e=0,i=(o=this.$span).length;e<i;e++)t=o[e],n.push(this.parseText(this.$(t)));return n}},e.prototype.encodeHtml=function(t){return $("<div>").text(t).html()},e.prototype.parseText=function(t){var e,i,o,n,s,r,a;for(a=this.encodeHtml("<hilite>"),o=this.encodeHtml("</hilite>"),e=t.html(),t.text(""),s=e.indexOf(a),r=0;-1!==s;)t.html(e.substring(r,s)),-1!==(i=e.indexOf(o,s))?(n=e.substring(s+a.length,i),t.append("<span class='search-highlight'>"+n+"</span>"),r=i+o.length,s=e.indexOf(a,s+1)):t.append(e.substring(s+a.length));if(-1===s)return t.append(e.substring(r))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.sectionHome.AddContentModal=function(t){function e(){return this.onOpen=i(this.onOpen,this),this.onAddContentSuccess=i(this.onAddContentSuccess,this),this.onFilepickerSuccess=i(this.onFilepickerSuccess,this),this.onImportFromLibrary=i(this.onImportFromLibrary,this),this.onShowImporterSuccess=i(this.onShowImporterSuccess,this),this.onShowImporter=i(this.onShowImporter,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$body.on("Modal."+this.namespace+".open",this.onOpen).on("ImportFromLibrary.mediaSelected",this.onImportFromLibrary),this.$el.on("FileStack.success",this.onFilepickerSuccess).on("FileStack.failure",this.onError).on(this.capitalizedNamespace+".import",this.onShowImporter)},e.prototype.ajaxData=function(t){var e;return null==t&&(t={}),e={lessonId:this.lessonId,timing:"During",availability:{type:"Immediate",body:{}},deletionDate:null},$.extend(e,t)},e.prototype.onShowImporter=function(){return this.loadingOn(),this.ajax(this.route,{success:this.onShowImporterSuccess,error:this.onError,complete:this.loadingOff})},e.prototype.onShowImporterSuccess=function(t){return this.$body.trigger("Modal."+this.namespace+".close").append(t)},e.prototype.onImportFromLibrary=function(t,e){if(null!=this.lessonId)return this.loadingOn(),this.ajax(Echo.routes.Publish.publishToLesson(e),{data:this.ajaxData(),success:this.onAddContentSuccess,error:this.onError,complete:this.loadingOff})},e.prototype.onFilepickerSuccess=function(t,e){var i;return i=e.fileBlob,this.$body.trigger("Modal."+this.namespace+".close"),this.ajax(Echo.routes.MediaUpload.uploadAndPublish(),{data:this.ajaxData({upload:{name:i.filename,fileBlob:i}}),success:this.onAddContentSuccess,error:this.onError})},e.prototype.onAddContentSuccess=function(){return this.$body.trigger("Lesson."+this.lessonId+".fetch")},e.prototype.onOpen=function(t,e){return this.lessonId=e},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.sectionHome.AddPresentationModal=function(t){function i(){var t,e;return this.onCreateNew=(t=this.onCreateNew,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.pages.sectionHome.AddContentModal),i.prototype.initialize=function(){return this.namespace="addPresentation",this.capitalizedNamespace=this.namespace.charAt(0).toUpperCase()+this.namespace.slice(1),this.route=Echo.routes.Library.importSlideDeckModalContent(),this.$el.on(this.capitalizedNamespace+".create",this.onCreateNew),i.__super__.initialize.apply(this,arguments)},i.prototype.onCreateNew=function(){return this.ajax(Echo.routes.SlideDecks.createAndPublish(),{data:this.ajaxData(),success:(i=this,function(t){var e;return e=t.data,i.pageRefresh(e[0])}),error:this.onError});var i},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.sectionHome.AddVideoModal=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.pages.sectionHome.AddContentModal),e.prototype.initialize=function(){return this.namespace="addVideo",this.capitalizedNamespace=this.namespace.charAt(0).toUpperCase()+this.namespace.slice(1),this.route=Echo.routes.Library.importVideoModalContent(),e.__super__.initialize.apply(this,arguments)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.sectionHome.CloningIndex=function(t){function i(){var t,e;return this.onSectionCloneButtonClick=(t=this.onSectionCloneButtonClick,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){return this.sectionId=t.sectionId,this.$body.on("Section.clone",this.onSectionCloneButtonClick)},i.prototype.onSectionCloneButtonClick=function(){return this.injectFromUrl(Echo.routes.Sections.sectionCloningModal(this.sectionId))},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.sectionHome.Index=function(t){function e(){return this.onMediaRemoveError=i(this.onMediaRemoveError,this),this.onConfirmedRemove=i(this.onConfirmedRemove,this),this.onRemove=i(this.onRemove,this),this.onDownload=i(this.onDownload,this),this.onAvailabilitySettings=i(this.onAvailabilitySettings,this),this.onMakeAvailableConfirmation=i(this.onMakeAvailableConfirmation,this),this.onMakeAvailable=i(this.onMakeAvailable,this),this.onSubmitError=i(this.onSubmitError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onMakeUnavailableConfirmation=i(this.onMakeUnavailableConfirmation,this),this.onMakeUnavailable=i(this.onMakeUnavailable,this),this.onEditDetails=i(this.onEditDetails,this),this.onViewDetails=i(this.onViewDetails,this),this.onEdit=i(this.onEdit,this),this.onMessage=i(this.onMessage,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.hasInstructionalRole=t.hasInstructionalRole,this.userId=t.userId,this.institutionId=t.institutionId,this.sectionId=t.sectionId,this.hasInstructionalRole&&this.initInstructorEventListeners(),this.$body.on("Media.download",this.onDownload),this.subscribeTo("media-"+this.userId+"-"+this.institutionId,this.onMessage)},e.prototype.onMessage=function(t){var e;if("status"===t.eventType)return"Processing"===(e=t.mediaStatus)||"Failed"===e||"Processed"===e?this.$el.trigger("Media."+t.mediaId+".statusChange"):void 0},e.prototype.initInstructorEventListeners=function(){return this.$body.on("Media.edit",this.onEdit).on("Media.editDetails",this.onEditDetails).on("Media.viewDetails",this.onViewDetails).on("Media.availabilitySettings",this.onAvailabilitySettings).on("Media.remove",this.onRemove).on("Media.makeAvailable",this.onMakeAvailable).on("Media.makeUnavailable",this.onMakeUnavailable)},e.prototype.getMessage=function(){return this.i18n("Warnings.instructor.editContent.part1")+" <b>"+this.i18n("Labels.all").toLowerCase()+"</b> "+this.i18n("Warnings.instructor.editContent.part2")},e.prototype.onEdit=function(t,e){var i;return i=this.getMessage(),alertify.confirm(i,function(t){if(t)return window.location="presentation"===e.mediaType?Echo.routes.SlideDecks.editorPage(e.mediaId).url:"video"===e.mediaType?Echo.routes.Videos.editorPage(e.mediaId).url:void 0})},e.prototype.onViewDetails=function(t,e){return window.location.assign(Echo.routes.Media.details(e).url)},e.prototype.onEditDetails=function(t,e){var i,o;return i=this.getMessage(),alertify.confirm(i,(o=this,function(t){if(t)return o.injectFromUrl(Echo.routes.Media.editorModal(e.mediaId))}))},e.prototype.onMakeUnavailable=function(t,e){return this.confirm("Media.publish.makeUnavailableConfirmation",(i=this,function(){return i.onMakeUnavailableConfirmation(e)}));var i},e.prototype.onMakeUnavailableConfirmation=function(t){return Echo.routes.Publish.makeUnavailable(t.mediaId,t.lessonId).ajax({success:(e=this,function(){return e.onSubmitSuccess(t)}),error:this.onSubmitError});var e},e.prototype.onSubmitSuccess=function(t){return this.$el.trigger("Lesson."+t.lessonId+".fetch")},e.prototype.onSubmitError=function(t,e){return alertify.error(t.message)},e.prototype.onMakeAvailable=function(t,e){return this.confirm("Media.publish.makeAvailableConfirmation",(i=this,function(){return i.onMakeAvailableConfirmation(e)}));var i},e.prototype.onMakeAvailableConfirmation=function(t){return Echo.routes.Publish.makeAvailable(t.mediaId,t.lessonId).ajax({success:(e=this,function(){return e.onSubmitSuccess(t)}),error:this.onSubmitError});var e},e.prototype.onAvailabilitySettings=function(t,e){return this.injectFromUrl(Echo.routes.Publish.publishedOptionsModal(e.mediaId,e.lessonId))},e.prototype.onDownload=function(t,e){return this.injectFromUrl(Echo.routes.MediaDownload.downloadModal(e,this.sectionId))},e.prototype.onRemove=function(t,e){return this.confirm("Library.warning.delete",(i=this,function(){return i.onConfirmedRemove(e)}));var i},e.prototype.onConfirmedRemove=function(t){return Echo.routes.Publish.unpublish(t.lessonId,t.mediaId).ajax({success:(e=this,function(){return e.onSubmitSuccess(t)}),error:this.onMediaRemoveError});var e},e.prototype.onMediaRemoveError=function(t){return alertify.error(this.i18n(t.responseJSON.message))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.sectionSettings.BaseInvite=function(t){function e(){return this.onBatchResendInvitationSuccess=i(this.onBatchResendInvitationSuccess,this),this.onBatchResendInvitation=i(this.onBatchResendInvitation,this),this.onBatchDeleteSuccess=i(this.onBatchDeleteSuccess,this),this.confirmBatchDelete=i(this.confirmBatchDelete,this),this.onBatchDelete=i(this.onBatchDelete,this),this.onImportSuccess=i(this.onImportSuccess,this),this.onFilepickerSuccess=i(this.onFilepickerSuccess,this),this.enableImport=i(this.enableImport,this),this.onAddByEmailInputKeyDown=i(this.onAddByEmailInputKeyDown,this),this.onAddByEmailSuccess=i(this.onAddByEmailSuccess,this),this.onAddByEmail=i(this.onAddByEmail,this),this.enableAddByEmail=i(this.enableAddByEmail,this),this.onTableSelectionChanged=i(this.onTableSelectionChanged,this),this.onEmailError=i(this.onEmailError,this),this.onError=i(this.onError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.sectionId=t.sectionId,this.tableSelection=[],this.$addByEmailInput=this.$("input[name=email]"),this.$addByEmailButton=this.$("[data-action=add-by-email]"),this.$batchDeleteButton=this.$("[data-action=batch-delete]"),this.$batchResendInvitationButton=this.$("[data-action=batch-resend-invitation]"),this.$importButton=this.$("[data-action=import]"),this.$tableBody=this.$("table tbody"),this.$addByEmailInput.on("keydown",this.onAddByEmailInputKeyDown),this.$addByEmailButton.on("click",this.onAddByEmail),this.$batchDeleteButton.on("click",this.onBatchDelete),this.$batchResendInvitationButton.on("click",this.onBatchResendInvitation),this.$el.on("FileStack.success",this.onFilepickerSuccess).on("FileStack.failure",this.onError).on("Table.selectionChanged",this.onTableSelectionChanged),this.onTableSelectionChanged(null,{ids:[]})},e.prototype.onAddSuccess=function(t){var e,i,o,n,s,r,a;for(a=t.rows,s=t.message,i=t.invitationIds,e=o=0,n=a.length;o<n;e=++o)r=a[e],0===this.$tableBody.find("#"+i[e]).length&&this.$tableBody.append(r);return alertify.success(s)},e.prototype.onError=function(){return alertify.error(this.i18n("Alert.genericError"))},e.prototype.onEmailError=function(t){return null!=Echo.core.form.getErrorJSON(t)?Echo.core.form.onSubmitError(this.$el,t,{disableErrorAlert:!1}):alertify.error(this.i18n("Alert.genericError"))},e.prototype.onTableSelectionChanged=function(t,e){var i;return i=e.ids,this.tableSelection={invitations:this.filterInvitations(i),users:this.filterUsers(i)},this.updateBatchActions()},e.prototype.isInvitation=function(t){var e;return!(null==(e=t.match(/^invitation/))||!e.length)},e.prototype.isUser=function(t){var e;return!(null==(e=t.match(/^user/))||!e.length)},e.prototype.filterInvitations=function(t){var e;return e=_.filter(t,this.isInvitation),_.map(e,function(t){return t.replace(/^invitation-/,"")})},e.prototype.filterUsers=function(t){var e;return e=_.filter(t,this.isUser),_.map(e,function(t){return t.replace(/^user-/,"")})},e.prototype.updateBatchActions=function(){var t;return t=0===this.tableSelection.invitations.length&&0===this.tableSelection.users.length?"disable":"enable",this.$batchDeleteButton.trigger(t),t=0===this.tableSelection.invitations.length?"disable":"enable",this.$batchResendInvitationButton.trigger(t)},e.prototype.disableAddByEmail=function(){return this.$addByEmailInput.trigger("disable"),this.$addByEmailButton.trigger("disable")},e.prototype.enableAddByEmail=function(){return this.$addByEmailInput.trigger("enable"),this.$addByEmailButton.trigger("enable")},e.prototype.onAddByEmail=function(){var t;return this.disableAddByEmail(),t=this.$addByEmailInput.val().split(",").map(function(t){return t.trim()}),this.ajax(this.addRoute(this.sectionId),{data:{emails:t},success:this.onAddByEmailSuccess,error:this.onEmailError,complete:this.enableAddByEmail})},e.prototype.onAddByEmailSuccess=function(t){var e;return e=t.data,this.onAddSuccess(e[0]),this.$addByEmailInput.val("")},e.prototype.onAddByEmailInputKeyDown=function(t){if(t.keyCode===this.KEYS.ENTER)return this.onAddByEmail()},e.prototype.disableImport=function(){return this.$importButton.trigger("disable")},e.prototype.enableImport=function(){return this.$importButton.trigger("enable"),this.loadingOff()},e.prototype.onFilepickerSuccess=function(t,e){return this.disableImport(),this.loadingOn(null,{fixed:!0,theme:"light",opacity:"transparent"}),this.ajax(Echo.routes.Invitations.sendSectionInvitationsFromCsv(),{data:{sectionId:this.sectionId,invitationRole:this.importRole,csvUrl:e.fileBlob.s3Url},success:this.onImportSuccess,error:this.onError,complete:this.enableImport})},e.prototype.onImportSuccess=function(t){var e;return e=t.data,this.onAddSuccess(e[0])},e.prototype.onBatchDelete=function(t,e){var i,o;if(o=this.tableSelection.invitations.length+this.tableSelection.users.length)return i="Settings.section.confirmUserDelete",1<o&&(i="Settings.section.confirmBatchUserDelete"),this.confirm(i,this.confirmBatchDelete)},e.prototype.confirmBatchDelete=function(){return this.deleteUsers()},e.prototype.deleteUsers=function(){if(0!==this.tableSelection.users.length||0!==this.tableSelection.invitations.length)return this.ajax(Echo.routes.UserSections.removeUserSections(this.sectionId),{data:{ids:this.tableSelection.users.concat(this.tableSelection.invitations)},success:this.onBatchDeleteSuccess,error:this.onError})},e.prototype.onBatchDeleteSuccess=function(t){var e,i,o,n,s;for(o=0,n=(s=(e=t.data)[0].ids).length;o<n;o++)i=s[o],this.$tableBody.find("#user-"+i).remove(),this.$tableBody.find("#invitation-"+i).remove();return this.$tableBody.trigger("Table.contentChanged"),alertify.success(e[0].message)},e.prototype.onBatchResendInvitation=function(t,e){return this.ajax(Echo.routes.Invitations.resendSectionInvitations(this.sectionId),{data:{ids:this.tableSelection.invitations},success:this.onBatchResendInvitationSuccess,error:this.onError})},e.prototype.onBatchResendInvitationSuccess=function(t){var e;return e=t.data,alertify.success(e[0].message)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.sectionSettings.InstructorInvite=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.pages.sectionSettings.BaseInvite),e.prototype.initialize=function(){return this.addRoute=Echo.routes.Invitations.inviteSectionInstructors,this.importRole="Instructor",e.__super__.initialize.apply(this,arguments)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.sectionSettings.PublicLinkInfo=function(t){function e(){return this.onUnauthenticatedChange=i(this.onUnauthenticatedChange,this),this.onInstructorChange=i(this.onInstructorChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$instructor=this.$("[type=radio][value=Instructor]"),this.$role=this.$("[type=radio][name=role]"),this.$defaultRole=this.$("[type=radio][name=role][value=Student]"),this.$unauthenticated=this.$("[type=radio][value=Unauthenticated]"),this.$permission=this.$("[type=radio][name=permission]"),this.$defaultPermission=this.$("[type=radio][name=permission][value=OpenRegistration]"),this.$role.on("change",this.onInstructorChange),this.$permission.on("change",this.onUnauthenticatedChange)},e.prototype.onPropChange=function(t,e,i){return t.prop("checked")?(e.prop("checked")&&(e.prop("checked",!1),i.trigger("enable").trigger("click")),e.trigger("disable")):e.trigger("enable")},e.prototype.onInstructorChange=function(){return this.onPropChange(this.$instructor,this.$unauthenticated,this.$defaultPermission)},e.prototype.onUnauthenticatedChange=function(){return this.onPropChange(this.$unauthenticated,this.$instructor,this.$defaultRole)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.sectionSettings.StudentInvite=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.pages.sectionSettings.BaseInvite),e.prototype.initialize=function(){return this.addRoute=Echo.routes.Invitations.inviteSectionStudents,this.importRole="Student",e.__super__.initialize.apply(this,arguments)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.sectionSettings.TeachingAssistantInvite=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.pages.sectionSettings.BaseInvite),e.prototype.initialize=function(){return this.addRoute=Echo.routes.Invitations.inviteSectionTeachingAssistants,this.importRole="TeachingAssistant",e.__super__.initialize.apply(this,arguments)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.settings.BrandingSection=function(t){function e(){return this.onAjaxError=i(this.onAjaxError,this),this.onAjaxSuccess=i(this.onAjaxSuccess,this),this.onSave=i(this.onSave,this),this.onFilePickerSuccess=i(this.onFilePickerSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.id=this.$el.attr("id"),this.$el.on("FileStack.success",this.onFilePickerSuccess).on("branding.Save",this.onSave).on("AjaxForm.success",this.onAjaxSuccess).on("AjaxForm.error",this.onAjaxError),this.$brandingEnabled=this.$("input[name=brandingEnabled]"),this.$form=this.$("form")},e.prototype.onFilePickerSuccess=function(t,e){var i;return this.$brandingEnabled.prop("checked",!1)&&this.$brandingEnabled.trigger("click"),null!=(i=$("#video"+this.id))&&i.text(e.fileBlob.filename),this.fileBlob=e.fileBlob},e.prototype.onSave=function(){var t;return t={enabled:this.$brandingEnabled.prop("checked"),sourceFile:null!=this.fileBlob?this.fileBlob:void 0},this.$form.trigger("AjaxForm.submitWithData",t)},e.prototype.onAjaxSuccess=function(t,e){if(null!=(null!=e?e.message:void 0)&&alertify.success(e.message),"string"==typeof e)return alertify.success(e)},e.prototype.onAjaxError=function(t,e){return null!=(null!=e?e.error:void 0)&&alertify.error(e.error),window.location.reload()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.settings.DeptListItem=function(t){function e(){return this.onDepartmentOrphaned=i(this.onDepartmentOrphaned,this),this.onDeleteError=i(this.onDeleteError,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.onDeleteConfirm=i(this.onDeleteConfirm,this),this.onDepartmentDelete=i(this.onDepartmentDelete,this),this.onDepartmentEdited=i(this.onDepartmentEdited,this),this.onDepartmentEdit=i(this.onDepartmentEdit,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){if(this.departmentId=t.departmentId,this.departmentName=t.departmentName,this.organizationId=t.organizationId,this.updated=t.updated,this.$nameCell=this.$(".adminListItem-cell.name"),this.$infoCell=this.$(".adminListItem-cell.info.courseCount"),this.$el.on("Department.edit",this.onDepartmentEdit).on("Department.delete",this.onDepartmentDelete).on("Department.orphaned",this.onDepartmentOrphaned),this.$body.on("Department.edited",this.onDepartmentEdited),this.updated)return this.$el.addClass("updated")},e.prototype.onDepartmentEdit=function(t){return t.stopPropagation(),this.injectFromUrl(Echo.routes.Departments.getEditDepartmentModal(this.departmentId))},e.prototype.onDepartmentEdited=function(t,e){if(e.department.id===this.departmentId)return e.department.organizationId===this.organizationId||null==e.department.organizationId&&null==this.organizationId?(this.$nameCell.text(e.department.name),this.$el.addClass("updated")):(this.$el.trigger("Department.deleted",this.departmentId),this.$el.trigger("Department.created",e),this.dispose())},e.prototype.onDepartmentDelete=function(){return"Admin.organizations.deleteDepartment.confirm","Department names did not match",this.confirm("Admin.organizations.deleteDepartment.confirm",this.onDeleteConfirm)},e.prototype.onDeleteConfirm=function(){return Echo.routes.Departments.delete(this.departmentId).ajax({success:this.onDeleteSuccess,error:this.onDeleteError})},e.prototype.onDeleteSuccess=function(){return this.$el.trigger("Department.deleted",this.departmentId),alertify.success(this.i18n("Admin.organizations.deleteDepartment.success")),this.dispose()},e.prototype.onDeleteError=function(){return alertify.error(this.i18n("Admin.organizations.deleteDepartment.error")),this.$el.closest(".adminList").trigger("loading.off")},e.prototype.onDepartmentOrphaned=function(){return this.$(".department-spacer").remove(),this.$el.removeClass("child").addClass("updated")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.settings.Institution=function(t){function i(){var t,e;return this.onAjaxSuccess=(t=this.onAjaxSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("AjaxForm.success",this.onAjaxSuccess)},i.prototype.onAjaxSuccess=function(t,e){return this.$body.trigger("UpdatableImage.institutionImage.updateSrc",e.institutionImageUrl),alertify.success(e.message)},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.settings.InstitutionListItem=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.settings.OrgListItem=function(t){function e(){return this.onDepartmentDeleted=i(this.onDepartmentDeleted,this),this.onDepartmentCreated=i(this.onDepartmentCreated,this),this.onDepartmentCreate=i(this.onDepartmentCreate,this),this.onDeleteError=i(this.onDeleteError,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.onDeleteConfirm=i(this.onDeleteConfirm,this),this.onOrganizationDelete=i(this.onOrganizationDelete,this),this.onOrganizationEdited=i(this.onOrganizationEdited,this),this.onOrganizationEdit=i(this.onOrganizationEdit,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.organizationId=t.organizationId,this.organizationName=t.organizationName,this.departmentIds=t.departmentIds,this.$nameCell=this.$(".adminListItem-cell.name.organizationName"),this.$infoCell=this.$(".adminListItem-cell.info.departmentCount"),this.$depts=this.$(".adminListItem-children.departments"),this.$el.on("Department.create",this.onDepartmentCreate).on("Department.deleted",this.onDepartmentDeleted).on("Organization.edit",this.onOrganizationEdit).on("Organization.delete",this.onOrganizationDelete),this.$body.on("Department.created",this.onDepartmentCreated).on("Organization.edited",this.onOrganizationEdited)},e.prototype.onOrganizationEdit=function(t){return t.stopPropagation(),this.injectFromUrl(Echo.routes.Organizations.getEditOrganizationModal(this.organizationId))},e.prototype.onOrganizationEdited=function(t,e){if(e.organization.id===this.organizationId)return this.$nameCell.text(e.organization.name),this.$el.addClass("updated")},e.prototype.onOrganizationDelete=function(){return"Admin.organizations.deleteOrganization.confirm","Organization names did not match",this.confirm("Admin.organizations.deleteOrganization.confirm",this.onDeleteConfirm)},e.prototype.onDeleteConfirm=function(){return Echo.routes.Organizations.delete(this.organizationId).ajax({success:this.onDeleteSuccess,error:this.onDeleteError})},e.prototype.onDeleteSuccess=function(){return this.$deptEls=this.$depts.children(".adminList-item.department").detach(),this.$deptEls.trigger("Department.orphaned"),this.$el.trigger("Departments.orphaned",{deptEls:this.$deptEls}),alertify.success(this.i18n("Admin.organizations.deleteOrganization.success")),this.dispose()},e.prototype.onDeleteError=function(){return alertify.error(this.i18n("Admin.organizations.deleteOrganization.error")),this.$el.closest(".adminList").trigger("loading.off")},e.prototype.onDepartmentCreate=function(t){return t.stopPropagation(),this.injectFromUrl(Echo.routes.Departments.getAddDepartmentModal(this.organizationId))},e.prototype.onDepartmentCreated=function(t,e){if(e.department.organizationId===this.organizationId)return this.$(".add-placeholder.department").remove(),this.$depts.append(e.html),this.$el.addClass("expanded"),this.addDepartment(e.department)},e.prototype.addDepartment=function(t){if(!(-1<_.indexOf(this.departmentIds,t.id)))return this.departmentIds.push(t.id),this.updateDeptCount()},e.prototype.updateDeptCount=function(){var t;return t=this.departmentIds.length,this.$infoCell.text(this.i18n("Admin.organizations.departmentCount",t))},e.prototype.onDepartmentDeleted=function(t,e){return this.departmentIds=_.filter(this.departmentIds,function(t){return t!==e}),this.updateDeptCount()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.settings.OrganizationList=function(t){function e(){return this.onDepartmentsOrphaned=i(this.onDepartmentsOrphaned,this),this.onDepartmentCreated=i(this.onDepartmentCreated,this),this.onDepartmentCreate=i(this.onDepartmentCreate,this),this.onOrganizationCreated=i(this.onOrganizationCreated,this),this.onOrganizationCreate=i(this.onOrganizationCreate,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$orgList=this.$(".orgList"),this.$table=this.$(".adminList-table"),this.$el.on("Organization.create",this.onOrganizationCreate).on("Department.create",this.onDepartmentCreate),this.$body.on("Organization.created",this.onOrganizationCreated).on("Department.created",this.onDepartmentCreated).on("Departments.orphaned",this.onDepartmentsOrphaned)},e.prototype.onOrganizationCreate=function(t){return t.stopPropagation(),this.injectFromUrl(Echo.routes.Organizations.getAddOrganizationModal())},e.prototype.onOrganizationCreated=function(t,e){return this.$table.trigger("AdminListTable.itemsAdded",{html:e,index:1})},e.prototype.onDepartmentCreate=function(t){return t.stopPropagation(),this.injectFromUrl(Echo.routes.Departments.getAddDepartmentModal())},e.prototype.onDepartmentCreated=function(t,e){if(null==e.department.organizationId)return this.$table.trigger("AdminListTable.itemsAdded",{html:e.html,index:1})},e.prototype.onDepartmentsOrphaned=function(t,e){return this.$table.trigger("AdminListTable.itemsAdded",{html:e.deptEls,index:1})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.settings.OrganizationRow=function(t){function e(){return this.onUpdate=i(this.onUpdate,this),this.onRemove=i(this.onRemove,this),this.onEdit=i(this.onEdit,this),this.onAjaxError=i(this.onAjaxError,this),this.onAjaxSuccess=i(this.onAjaxSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.organizationId=t.organizationId,this.editing=!1,this.$input=this.$("input"),this.$editButton=this.$("[data-action=edit]"),this.$updateButton=this.$("[data-action=update]"),this.$removeButton=this.$("[data-action=remove]"),this.$editButton.on("click",this.onEdit),this.$updateButton.on("click",this.onUpdate),this.$removeButton.on("click",this.onRemove),this.render()},e.prototype.ajaxRemove=function(){return this.ajax(Echo.routes.Organizations.delete(),{data:{id:this.organizationId},success:this.onAjaxSuccess,error:this.onAjaxError})},e.prototype.ajaxUpdate=function(){return this.ajax(Echo.routes.Organizations.update(),{data:{name:this.$input.val(),id:this.organizationId},success:this.onAjaxSuccess,error:this.onAjaxError})},e.prototype.onAjaxSuccess=function(t){return alertify.success(t)},e.prototype.onAjaxError=function(){return alertify.error(this.i18n("Alert.genericError"))},e.prototype.onEdit=function(){return this.editing=!0,this.render()},e.prototype.onRemove=function(){return this.confirmRemove()},e.prototype.onUpdate=function(){return this.editing=!1,this.render(),this.ajaxUpdate()},e.prototype.confirmRemove=function(){return alertify.confirm(this.i18n("Settings.institution.organization.confirmRemove"),(e=this,function(t){if(t)return e.ajaxRemove(),e.dispose()}));var e},e.prototype.render=function(){var t;return t=this.editing?"enable":"disable",this.$input.trigger(t),this.$editButton.toggle(!this.editing),this.$updateButton.toggle(this.editing)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.slideDecks.Common=function(t){function e(){return this.onReorderError=i(this.onReorderError,this),this.onReorderSuccess=i(this.onReorderSuccess,this),this.reorderSlides=i(this.reorderSlides,this),this.wireDragDrop=i(this.wireDragDrop,this),this.filterSlides=i(this.filterSlides,this),this.selectAll=i(this.selectAll,this),this.deselectAll=i(this.deselectAll,this),this.setSelected=i(this.setSelected,this),this.deleteSelected=i(this.deleteSelected,this),this.deleteSingleSlide=i(this.deleteSingleSlide,this),this.onDeleteError=i(this.onDeleteError,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this._delete=i(this._delete,this),this.onPreviewSuccess=i(this.onPreviewSuccess,this),this.onPreviewSlide=i(this.onPreviewSlide,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$filter=this.$(".slideType-filter select"),this.toBeDeleted=[],this.$deleteBtn=this.$(".delete-btn"),this.$deselectBtn=this.$(".deselectAll-btn"),this.$filter.on("change",this.filterSlides),this.$el.on("select.slide",this.setSelected),this.$el.on("selectAll.slides",this.selectAll),this.$el.on("deselectAll.slides",this.deselectAll),this.$el.on("deleteSelected.slides",this.deleteSelected),this.$el.on("deleteMe",this.deleteSingleSlide),this.$el.on("Editor.previewSlide",this.onPreviewSlide),this.disableButtonsIfNoneSelected()},e.prototype.onPreviewSlide=function(t,e){return Echo.routes.Slides.getSlidePreviewFull(this.slideDeckId,e).ajax({success:this.onPreviewSuccess})},e.prototype.onPreviewSuccess=function(t){return this.$el.append(t.data[0].html)},e.prototype.disableButtons=function(){return this.$headerBarButtons.trigger("enable"),this.$deleteBtn.trigger("disable"),this.$deselectBtn.trigger("disable")},e.prototype.enableButtons=function(){return this.$headerBarButtons.trigger("enable")},e.prototype.wire=function(){return this.$container=this.$(".presentation-editor-slideList")},e.prototype._delete=function(e){var t,i;return t={labels:{ok:this.i18n("Labels.delete"),cancel:this.i18n("Labels.cancel")},buttonFocus:"cancel"},alertify.set(t),alertify.confirm(this.i18n("SlideDeck.deleteConfirmation"),(i=this,function(t){if(t)return i._confirmedDelete(e)}))},e.prototype._confirmedDelete=function(t){return this.toBeDeleted=t,this.ajax(Echo.routes.SlideDecks.deleteSlides(this.slideDeckId),{data:{slideIds:t},success:this.onDeleteSuccess,error:this.onDeleteError})},e.prototype.onDeleteSuccess=function(t){var e,i,o,n;for(e=0,i=(o=this.toBeDeleted).length;e<i;e++)n=o[e],this.$container.find(".presentationEditor-slide[data-id="+n+"]").trigger("deleted.slide");return this.reorderSlideNumbers(),this.wireDragDrop(),this.disableButtonsIfNoneSelected()},e.prototype.onDeleteError=function(t){return this.toBeDeleted=[],alertify.alert(this.i18n("Errors.deleteSlides"))},e.prototype.deleteSingleSlide=function(t,e){return null!=e.confirm?this._delete([e.id]):this.removeSlidesFromDom([e.id])},e.prototype.deleteSelected=function(){var t;return t=this.$container.find(".presentationEditor-slide.selected").map(function(){return $(this).data("id")}).get(),this.$container.hasClass("slideDeck-importer-slideList")?this.removeSlidesFromDom(t):(this.$deleteBtn.trigger("blur"),this._delete(t))},e.prototype.setSelected=function(t,e){var i;if(t.stopPropagation(),null!=e)return i=$(e.target).closest(".presentationEditor-slide"),e.ctrlKey||e.metaKey||this.deselectAll(),i.toggleClass("selected"),this.disableButtonsIfNoneSelected()},e.prototype.unwire=function(){var t;return null!=(t=this.$headerBarButtons)?t.trigger("disable"):void 0},e.prototype.disableButtonsIfNoneSelected=function(){var t,e;return 0<(null!=(t=this.$container)?t.find(".presentationEditor-slide.selected:not(.sortDisabled)").length:void 0)?this.enableButtons():0<(null!=(e=this.$container)?e.find(".presentationEditor-slide:not(.sortDisabled)").length:void 0)?this.disableButtons():this.unwire()},e.prototype.deselectAll=function(t){return this.$(".presentationEditor-slide").removeClass("selected"),this.disableButtonsIfNoneSelected()},e.prototype.selectAll=function(t){return this.$(".presentationEditor-slide").addClass("selected"),this.disableButtonsIfNoneSelected()},e.prototype.filterSlides=function(){if(this.$(".presentationEditor-slide").hide(),this.$(".presentationEditor-slide."+this.$filter.val()).show(),"all"===this.$filter.val()){if(this.wireDragDrop(),this.$container.hasClass("slideDeck-importer-slideList"))return this.$el.trigger("Editor.rewireSortable")}else if(void 0!==this.sortable&&null!=this.sortable&&null!=this.sortable.el)return this.sortable.destroy()},e.prototype.wireDragDrop=function(){if(void 0!==this.sortable&&null!=this.sortable&&null!=this.sortable.el&&this.sortable.destroy(),0<this.$container.length)return this.$container.hasClass("slideDeck-editor-slideList")?setTimeout((o=this,function(){return o.sortable=new Sortable(o.$container.get(0),{group:"slides",onStart:function(t){var e;return o.selectedSlideIndex=$(t.item).index,$(t.item).addClass("selected"),e=$(t.target).find(".selected").not(t.item).hide(),$(t.target).data("multiple",e)},onUpdate:function(t){return o.onSlideUpdate(t)},onAdd:function(t){return o.onSlideAdd(t)}})}),1e3):this.sortable=new Sortable(this.$container.get(0),{group:"slides",filter:".sortDisabled",onStart:(i=this,function(t){var e;return i.selectedSlideIndex=$(t.item).index(),$(t.item).addClass("selected"),e=$(t.target).find(".selected").not(t.item).hide(),$(t.target).data("multiple",e)}),onUpdate:(e=this,function(t){return e.onSlideUpdate(t)})});var e,i,o},e.prototype.reorderSlides=function(t){return this.ajax(Echo.routes.SlideDecks.reorderSlides(this.slideDeckId),{data:{ids:t},success:this.onReorderSuccess,error:this.onReorderError})},e.prototype.onReorderSuccess=function(t){var e,i,o,n,s,r;for(s=[],i=e=0,o=(n=t.data).length;e<o;i=++e)r=n[i],s.push(this.$container.find(".presentationEditor-slide[data-id="+r+"]").trigger("update.slideNumber",i));return s},e.prototype.onReorderError=function(t){return alertify.error(this.i18n("Errors.reorderSlides"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.slideDecks.Edit=function(t){function e(){return this.triggerImporter=i(this.triggerImporter,this),this.toggleImporter=i(this.toggleImporter,this),this.sendToImporter=i(this.sendToImporter,this),this.onRewireSortable=i(this.onRewireSortable,this),this.onImportSlides=i(this.onImportSlides,this),this.onDestroySortable=i(this.onDestroySortable,this),this.onReAddMovedSlides=i(this.onReAddMovedSlides,this),this.onHideMovedSlides=i(this.onHideMovedSlides,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$editor=this.$(".slideDeck-editor"),this.$importer=this.$(".slideDeck-importer"),this.$el.on("open.Importer",this.toggleImporter).on("close.Importer",this.toggleImporter).on("Upload.sentToProcessor",this.triggerImporter).on("Editor.rewireSortable",this.onRewireSortable).on("Editor.importSlides",this.onImportSlides).on("Importer.destroySortable",this.onDestroySortable).on("Importer.reAddMovedSlides",this.onReAddMovedSlides).on("Importer.hideMovedSlides",this.onHideMovedSlides),this.$body.on("ImportFromLibrary.mediaSelected",this.sendToImporter),this.toggleImporter({type:"close"})},e.prototype.onHideMovedSlides=function(t,e){return this.$importer.trigger("hideMovedSlides",e)},e.prototype.onReAddMovedSlides=function(t,e){return this.$importer.trigger("reAddMovedSlides",e)},e.prototype.onDestroySortable=function(){return this.$importer.trigger("destroySortable")},e.prototype.onImportSlides=function(t,e){return this.$editor.trigger("importSlides",e)},e.prototype.onRewireSortable=function(){return this.$editor.trigger("rewireSortable")},e.prototype.sendToImporter=function(t,e){return this.$importer.trigger("populateSlides",e),this.$body.trigger("Modal.importFromLibrary.close"),this.$el.trigger("open.Importer")},e.prototype.toggleImporter=function(t){var e,i;return i="open"===t.type,e="open"===t.type?"enableTabbing":"disableTabbing",this.$el.toggleClass("open",i),this.$importer.toggleClass("open",i),this[e](this.$importer.find(this.tabbableInputs))},e.prototype.triggerImporter=function(t,e){return this.$importer.trigger("populateContent",e),this.$el.trigger("open.Importer")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.slideDecks.EditorSlide=function(t){function e(){return this.positionVertically=i(this.positionVertically,this),this.setSelected=i(this.setSelected,this),this.previewSlide=i(this.previewSlide,this),this.updateSlideNumber=i(this.updateSlideNumber,this),this.deleteSlide=i(this.deleteSlide,this),this.onGetError=i(this.onGetError,this),this.onGet=i(this.onGet,this),this.editSlide=i(this.editSlide,this),this.onFetchEmbedlyContent=i(this.onFetchEmbedlyContent,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.thumbMaxHeight=120,e.prototype.initialize=function(t){var e,i,o;return this.activityId=t.activityId,this.embedlyUrl=t.embedlyUrl,this.type=t.type,this.id=this.$el.data("id"),this.$slideWrapper=this.$(".slide-wrapper"),this.$img=this.$slideWrapper.find("img"),this.$slideNumber=this.$(".slide-ordinal"),this.$el.on("click",this.setSelected).on("update.slideNumber",this.updateSlideNumber).on("preview.slide",this.previewSlide).on("delete.slide",this.deleteSlide).on("deleted.slide",(o=this,function(){return o.dispose()})).on("mouseenter",(i=this,function(){return i.$slideWrapper.addClass("hoverShadow")})).on("mouseleave",(e=this,function(){return e.$slideWrapper.removeClass("hoverShadow")})),"editor-slide"===this.type&&this.$el.on("edit.slide",this.editSlide),this.$img.on("load",this.positionVertically),null!=this.embedlyUrl&&this.fetchEmbedlyContent([this.embedlyUrl],this.onFetchEmbedlyContent),this.positionVertically()},e.prototype.buildEmbedlyThumbnail=function(t){return this.$img.attr("src",t),Echo.core.helpers.preloadImage(t,this.positionVertically)},e.prototype.onFetchEmbedlyContent=function(t){var e,i,o,n;for(n=[],e=0,o=t.length;e<o;e++)null!=(i=t[e]).thumbnail_url?n.push(this.buildEmbedlyThumbnail(i.thumbnail_url)):n.push(void 0);return n},e.prototype.editSlide=function(t){return Echo.routes.Activities.getActivityForEditing(this.activityId).ajax({success:this.onGet,error:this.onGetError})},e.prototype.onGet=function(t){return this.$el.trigger("Activity.edit",t)},e.prototype.onGetError=function(t){return alertify.error(this.i18n("Errors.fetchActivityForEditing"))},e.prototype.deleteSlide=function(){var t;return t={id:this.id},"editor-slide"===this.type&&(t.confirm=!0),this.$(".delete-slide").trigger("blur"),this.$el.trigger("deleteMe",t)},e.prototype.updateSlideNumber=function(t,e){return this.$slideNumber.text(e+1)},e.prototype.previewSlide=function(t){return t.stopPropagation(),this.$el.trigger("Editor.previewSlide",this.id)},e.prototype.setSelected=function(t){return t.stopPropagation(),this.$el.trigger("select.slide",t)},e.prototype.positionVertically=function(){var t,e;if(0<this.$img.length&&0!==(t=this.$img.height()))return e=(this.thumbMaxHeight-t)/2,this.$slideWrapper.css("margin-top",e+"px")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.slideDecks.Editor=function(t){function e(){return this.onSlideCreated=i(this.onSlideCreated,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onSlideEdited=i(this.onSlideEdited,this),this.onSubmitError=i(this.onSubmitError,this),this.submitBlankSlide=i(this.submitBlankSlide,this),this.editActivity=i(this.editActivity,this),this.onImportError=i(this.onImportError,this),this.reorderSlideNumbers=i(this.reorderSlideNumbers,this),this.onImportSuccess=i(this.onImportSuccess,this),this._importSlides=i(this._importSlides,this),this.onImportSlides=i(this.onImportSlides,this),this.getSlideInsertPosition=i(this.getSlideInsertPosition,this),this.onMediaUploadSuccess=i(this.onMediaUploadSuccess,this),this.onMediaUploadError=i(this.onMediaUploadError,this),this.fileUploadSuccess=i(this.fileUploadSuccess,this),this.fileUploadFailure=i(this.fileUploadFailure,this),this.onPreviewActivitySlide=i(this.onPreviewActivitySlide,this),this.onGetSlidesError=i(this.onGetSlidesError,this),this.enableEditorActions=i(this.enableEditorActions,this),this.onGetSlides=i(this.onGetSlides,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.pages.slideDecks.Common),e.prototype.initialize=function(t){return this.slideDeckId=t.slideDeckId,this.mediaId=t.mediaId,e.__super__.initialize.apply(this,arguments),this.insertSlideNum=0,this.insertIndex=null,this.$modals=this.$(".activityCreation-modals"),this.$mainContentButtons=this.$(".slideDeck-add-buttons .btn"),this.$slideTypeFilter=this.$(".slideType-filter select"),this.$headerBarButtons=this.$(".bulk-action-buttons .btn"),this.$placeholderText=this.$(".slideDeck-placeholder-text"),this.$el.on("SlideDeckEditor.createBlankSlide",this.submitBlankSlide).on("Slide.created",this.onSlideCreated).on("Slide.edited",this.onSlideEdited).on("Activity.edit",this.editActivity).on("FileStack.success",this.fileUploadSuccess).on("FileStack.failure",this.fileUploadFailure).on("rewireSortable",this.wireDragDrop).on("importSlides",this.onImportSlides).on("Editor.previewActivitySlide",this.onPreviewActivitySlide).on("click",".slideDeck-edit-pane",this.deselectAll),this.fetchSlides()},e.prototype.fetchSlides=function(){return Echo.routes.SlideDecks.getSlidesForEditing(this.mediaId).ajax({beforeSend:(e=this,function(){return e.loadingOn(null,{selector:".slideDeck-editor-slideList"})}),success:this.onGetSlides,error:this.onGetSlidesError,complete:(t=this,function(){return t.loadingOff(null,{selector:".slideDeck-editor-slideList"})})});var t,e},e.prototype.onGetSlides=function(t){return this.$(".slideDeck-edit-pane").removeClass("locked"),this.$(".slideDeck-editor-slideList").append(t),this.wire(),this.disableButtonsIfNoneSelected(),this.enableEditorActions()},e.prototype.enableEditorActions=function(){return this.$mainContentButtons.trigger("enable"),this.$slideTypeFilter.trigger("enable"),this.$el.trigger("Mutex.getKey")},e.prototype.onGetSlidesError=function(t){return this.$placeholderText.text(t.responseJSON.message),this.$(".slideDeck-edit-pane").addClass("locked")},e.prototype.wire=function(){return e.__super__.wire.apply(this,arguments),this.$doc.ready(this.wireDragDrop)},e.prototype.onPreviewActivitySlide=function(t,e){return this.ajax(Echo.routes.Slides.previewActivitySlide(this.slideDeckId),{data:e,success:this.onPreviewSuccess})},e.prototype.fileUploadFailure=function(t,e){return alertify.alert(this.i18n("Errors.fileUploadError")),this.fileBlob=null},e.prototype.fileUploadSuccess=function(t,e){var i;return this.fileBlob=e.fileBlob,i={name:this.fileBlob.filename,fileBlob:this.fileBlob},this.ajax(Echo.routes.MediaUpload.process(),{data:i,success:this.onMediaUploadSuccess,error:this.onMediaUploadError})},e.prototype.onMediaUploadError=function(t){return alertify.alert(this.i18n("Errors.submitMediaError")),this.fileBlob=null},e.prototype.onMediaUploadSuccess=function(t){return this.$el.trigger("Upload.sentToProcessor",t)},e.prototype.getSlideInsertPosition=function(){var t;return 0<(t=this.$container.find(".editor-slide.selected:last")).length?this.insertSlideNum=this.$container.find(".editor-slide").index(t)+1:this.insertSlideNum=this.$container.find(".editor-slide").length},e.prototype.onSlideUpdate=function(t){var e,i,o;return o=$(t.item),void 0!==(i=$(t.target).data("multiple"))&&(o.after(i),i.show(),this.deselectAll()),e=this.$container.find(".editor-slide").map(function(){return $(this).data("id")}).get(),this.reorderSlides(e)},e.prototype.onSlideAdd=function(t){var e,i,o,n,s;return s=$(t.item),void 0!==(e=$(t.from).data("multiple"))&&(o=e.removeClass("selected").show().clone(),s.after(o),this.deselectAll()),n=this.$container.find(".importer-slide").map(function(){return $(this).data("id")}).get(),i=this.$container.find(".presentationEditor-slide").index(this.$container.find(".importer-slide:first")),"object"!=typeof n&&(n=[n]),s.after(s.clone()),this.$el.trigger("Importer.reAddMovedSlides",{slides:s.detach()}),this._importSlides({slides:n,slideDeckId:s.data("slidedeckId")},i)},e.prototype.onImportSlides=function(t,e){return this._importSlides(e,this.getSlideInsertPosition())},e.prototype._importSlides=function(t,e){var i;return i={offset:e,slideIds:t.slides,slideDeckId:t.slideDeckId},this.insertIndex=e,this.movedSlides=t.slides,this.ajax(Echo.routes.SlideDecks.importSlides(this.slideDeckId),{data:i,success:this.onImportSuccess,error:this.onImportError})},e.prototype.onImportSuccess=function(t){return this.$container.find(".importer-slide").remove(),0===this.insertIndex?this.$container.prepend(t.data[0].html):this.$container.find(".editor-slide:nth-child("+this.insertIndex+")").after(t.data[0].html),this.wireDragDrop(),this.reorderSlideNumbers(),this.$el.trigger("Importer.hideMovedSlides",{slides:this.movedSlides}),this.disableButtonsIfNoneSelected()},e.prototype.reorderSlideNumbers=function(){return this.$container.find(".editor-slide").each(function(t,e){return $(e).trigger("update.slideNumber",t)})},e.prototype.onImportError=function(t){return alertify.alert(this.i18n("Alert.genericError"))},e.prototype.editActivity=function(t,e){return this.$modals.trigger("Activity.edit",e)},e.prototype.submitBlankSlide=function(){var t;return this.getSlideInsertPosition(),t={num:this.insertSlideNum},this.ajax(Echo.routes.Slides.create(this.slideDeckId),{data:t,success:this.onSubmitSuccess,error:this.onSubmitError})},e.prototype.onSubmitError=function(t){return alertify.alert(this.i18n("Errors.slideCreationError"))},e.prototype.onSlideEdited=function(t){return this.$modals.trigger("closeAllModals")},e.prototype.onSubmitSuccess=function(t){return this.onSlideCreated(null,{slide:t.data[0].html,num:this.insertSlideNum})},e.prototype.onSlideCreated=function(t,e){return 0===e.num?this.$container.prepend(e.slide):this.$container.find(".editor-slide:nth-child("+e.num+")").after(e.slide),this.$container.find(".editor-slide").each(function(t){return $(this).trigger("update.slideNumber",t)}),this.wireDragDrop(),this.$modals.trigger("closeAllModals")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.slideDecks.Importer=function(t){function e(){return this.setWidth=i(this.setWidth,this),this.updateImporterSlides=i(this.updateImporterSlides,this),this.fetchTrayError=i(this.fetchTrayError,this),this.getSlideImporterTray=i(this.getSlideImporterTray,this),this.onMediaProcessed=i(this.onMediaProcessed,this),this.onPopulateContent=i(this.onPopulateContent,this),this.moveSelected=i(this.moveSelected,this),this.onPopulateSlides=i(this.onPopulateSlides,this),this.onDestroySortable=i(this.onDestroySortable,this),this.onReAddMovedSlides=i(this.onReAddMovedSlides,this),this.onMessage=i(this.onMessage,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.pages.slideDecks.Common),e.prototype.SLIDE_WIDTH=160,e.prototype.SLIDE_GUTTER=30,e.prototype.MARGIN=25,e.prototype.initialize=function(t){return this.userId=t.userId,this.institutionId=t.institutionId,e.__super__.initialize.apply(this,arguments),this.$moveButton=this.$(".importer-moveAll-btn"),this.$headerBarButtons=this.$(".slideDeck-importer-header .btn:not(.close-importer)"),this.wire(),this.$el.on("click",this.deselectAll),this.$el.on("moveSelected.slides",this.moveSelected),this.$el.on("populateContent",this.onPopulateContent),this.$el.on("populateSlides",this.onPopulateSlides),this.$el.on("destroySortable",this.onDestroySortable),this.$el.on("reAddMovedSlides",this.onReAddMovedSlides),this.$el.on("hideMovedSlides",this.onHideMovedSlides),this.subscribeTo("media-"+this.userId+"-"+this.institutionId,this.onMessage)},e.prototype.disableButtons=function(){return e.__super__.disableButtons.apply(this,arguments),this.$moveButton.trigger("disable")},e.prototype.enableButtons=function(){return e.__super__.enableButtons.apply(this,arguments),this.$moveButton.trigger("enable")},e.prototype.onMessage=function(t){if("SlideDeckInfo"===t.mediaType&&t.mediaId===this.importedDeckMediaId)return"Processed"===t.mediaStatus&&this.onMediaProcessed(),this.$body.trigger("Media.statusChange",t)},e.prototype.removeSlidesFromDom=function(t){var e,i,o;for(e=0,i=t.length;e<i;e++)o=t[e],this.$container.find(".presentationEditor-slide[data-id="+o+"]").addClass("sortDisabled");return this.disableButtonsIfNoneSelected()},e.prototype.onReAddMovedSlides=function(t,e){return 0===this.selectedSlideIndex?this.$container.prepend(e.slides):this.$container.find(".importer-slide").eq(this.selectedSlideIndex).after(e.slides)},e.prototype.onDestroySortable=function(){if(void 0!==this.sortable&&null!=this.sortable)return this.sortable.destroy()},e.prototype.onPopulateSlides=function(t,e){return this.getSlideImporterTray(e)},e.prototype.wire=function(){return e.__super__.wire.apply(this,arguments),this.slideDeckId=this.$container.data("slidedeckId"),this.wireDragDrop(),this.setWidth()},e.prototype.moveSelected=function(){var t;if((t=this.$container.find(".importer-slide.selected:not(.sortDisabled)").map(function(){return $(this).data("id")}).get()).length)return this.$el.trigger("Editor.importSlides",{slides:t,slideDeckId:this.slideDeckId}),this.deselectAll()},e.prototype.onPopulateContent=function(t,e){return this.importedDeckMediaId=e.data[0].media.id,this.$el.off("Media.processed").on("Media."+this.importedDeckMediaId+".processed",this.onMediaProcessed),this.$el.find(".slideDeck-importer-body").html(e.data[0].html),this.unwire()},e.prototype.onMediaProcessed=function(){return this.$el.off("Media."+this.importedDeckMediaId+".processed",this.onMediaProcessed),this.getSlideImporterTray(this.importedDeckMediaId)},e.prototype.getSlideImporterTray=function(t){return Echo.routes.Library.getImportSlideDeckTray(t).ajax({success:this.updateImporterSlides,error:this.fetchTrayError})},e.prototype.fetchTrayError=function(){return alertify.error(this.i18n("Errors.fetchTrayError"))},e.prototype.updateImporterSlides=function(t){return this.$(".mediaList-item").trigger("dispose"),this.$el.find(".slideDeck-importer-body").html(t),this.wire(),this.$el.trigger("Editor.rewireSortable"),this.disableButtonsIfNoneSelected()},e.prototype.setWidth=function(){var t;return t=this.$container.find(".importer-slide").length,this.$container.css("width",t*(this.SLIDE_WIDTH+this.SLIDE_GUTTER)+2*this.MARGIN+10)},e.prototype.onSlideUpdate=function(t){var e,i;if(i=$(t.item),void 0!==(e=$(t.target).data("multiple")))return i.after(e),e.show(),this.deselectAll()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.studyGuide.DownloadNotesModal=function(t){function e(){return this.onDownloadNotes=i(this.onDownloadNotes,this),this.onModalOpen=i(this.onModalOpen,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.sectionId=t.sectionId,this.$lessonSelect=this.$("select[name=downloadLessonNotes]"),this.$studyGuideSelect=$(".lesson-select select"),this.$body.on("Modal.downloadNotes.onOpen",this.onModalOpen),this.$el.on("StudyGuide.notes.download",this.onDownloadNotes)},e.prototype.onModalOpen=function(){return this.$lessonSelect.trigger("Select.updateSelected",this.$studyGuideSelect.val())},e.prototype.onDownloadNotes=function(){var t,e,i;return e=""===(t=this.$lessonSelect.val())?Echo.routes.Notes.downloadForSection(this.sectionId):Echo.routes.Notes.downloadForLesson(t),window.location=e.url,setTimeout((i=this,function(){return i.$el.trigger("Modal.downloadNotes.close"),alertify.success(i.i18n("Classroom.notesDownloadedSuccessfully"))}),100)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.studyGuide.Index=function(t){function e(){return this.onDeleteQuestion=i(this.onDeleteQuestion,this),this.onNoteContentRefNavigate=i(this.onNoteContentRefNavigate,this),this.onQuestionLoaded=i(this.onQuestionLoaded,this),this.onQuestionSelected=i(this.onQuestionSelected,this),this.onNoteSelected=i(this.onNoteSelected,this),this.onLessonContentUpdated=i(this.onLessonContentUpdated,this),this.onEdit=i(this.onEdit,this),this.onDoneEditing=i(this.onDoneEditing,this),this.onUpdateBookmark=i(this.onUpdateBookmark,this),this.onUpdateLike=i(this.onUpdateLike,this),this.togglePlaceholder=i(this.togglePlaceholder,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.editing=!1,this.contentRef=null,this.$editButton=this.$("[data-action=edit]"),this.$doneEditingButton=this.$("[data-action=done-editing]"),this.$questionsListTitle=this.$(".questions-list-title"),this.$selectedContent=this.$(".selected-content"),this.$selectedPlaceholder=this.$(".selected-placeholder"),this.$editButton.on("click",this.onEdit),this.$doneEditingButton.on("click",this.onDoneEditing),this.$body.on("LessonContent.updated",this.onLessonContentUpdated).on("Notebook.selectedNote",this.onNoteSelected).on("ContentRef.navigate",this.onNoteContentRefNavigate).on("setSelected.question",this.onQuestionSelected).on("reload.expandedQuestion",this.onQuestionLoaded).on("delete.question",this.onDeleteQuestion).on("toggle.placeholder",this.togglePlaceholder).on("update.like",this.onUpdateLike).on("update.bookmark",this.onUpdateBookmark),this.render()},e.prototype.togglePlaceholder=function(){var t,e;return 0===(null!=(t=this.$(".questions-list"))&&null!=(e=t.children())?e.length:void 0)?this.$questionsListTitle.hide():this.$questionsListTitle.show()},e.prototype.clearSelected=function(){return this.$selectedContent.hide(),this.$selectedPlaceholder.show()},e.prototype.onUpdateLike=function(t,e){return this.getTarget(e).trigger("update.like",{count:e.count,liked:e.liked})},e.prototype.onUpdateBookmark=function(t,e){return this.getTarget(e).trigger("update.bookmark",e.bookmarked)},e.prototype.onDoneEditing=function(){return this.editing=!1,this.render()},e.prototype.onEdit=function(){return this.editing=!0,this.render()},e.prototype.onLessonContentUpdated=function(){return this.editing=!1,this.render(),this.clearSelected()},e.prototype.onNoteSelected=function(t,e){var i;if(this.updateSelectedLeft(e.id),e.id!==this.currNoteId&&!this.editing)return this.currNoteId=e.id,Echo.routes.StudyGuide.getNoteContent(e.id).ajax({success:(i=this,function(t){if(i.updateSelectedRight(t),i.contentRef)return i.focusReferencedMedia()})})},e.prototype.onQuestionSelected=function(t,e){return this.updateSelectedLeft(e),this.onDoneEditing(),this.currNoteId=""},e.prototype.onQuestionLoaded=function(t,e){return this.updateSelectedRight(e.data[0].html)},e.prototype.render=function(){var t;return this.$editButton.toggle(!this.editing),this.$doneEditingButton.toggle(this.editing),t=this.editing?"edit":"view",this.$body.trigger("Notebook."+t+"Mode")},e.prototype.updateSelectedLeft=function(t){return this.$(".selected").removeClass("selected"),this.$("#"+t).addClass("selected")},e.prototype.updateSelectedRight=function(t){return this.$body.trigger("Stage.destroy"),this.$selectedContent.html(t).show(),this.$selectedPlaceholder.hide()},e.prototype.onNoteContentRefNavigate=function(t,e){if(null!=e.noteId)return this.contentRef=e,this.$el.trigger("Notebook.selectedNote",{id:e.noteId})},e.prototype.focusReferencedMedia=function(){return null!=this.contentRef.slideDeckId?this.$el.trigger("SlideDeck."+this.contentRef.slideDeckId+".focus"):null!=this.contentRef.videoId&&this.$el.trigger("Video.focus",{videoId:this.contentRef.videoId}),this.contentRef=null},e.prototype.onDeleteQuestion=function(t,e){var i,o;if(null!=e)return this.getTarget(e).trigger("delete.question"),this.$body.trigger("destroy.expandedView",e.id),0===(null!=(i=this.$(".questions-list"))&&null!=(o=i.children())?o.length:void 0)?this.$questionsListTitle.text(this.i18n("StudyGuide.noQuestions")):void 0},e.prototype.getTarget=function(t){return"small"===t.sendTo?this.$(".single-question[data-id="+t.id+"]"):this.$(".questions-expanded-view > .single-question[data-id="+t.id+"]")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.support.UserEmailMismatchForm=function(t){function i(){var t,e;return this.onError=(t=this.onError,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("AjaxForm.userEmailMismatch.error",this.onError)},i.prototype.onError=function(t,e){if("string"==typeof e)return alertify.alert(e)},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.videos.Editor=function(t){function e(){return this.onSaveAsError=i(this.onSaveAsError,this),this.onSaveError=i(this.onSaveError,this),this.onSaveAsSuccess=i(this.onSaveAsSuccess,this),this.onSaveSuccess=i(this.onSaveSuccess,this),this.onSaveAs=i(this.onSaveAs,this),this.onSave=i(this.onSave,this),this.onFetchError=i(this.onFetchError,this),this.onFetchSuccess=i(this.onFetchSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.name=t.name,this.saveRedirectUrl=t.saveRedirectUrl,this.messages=t.messages,this.$editorContent=this.$(".editor-content"),this.$placeholderText=this.$(".video-placeholder-text"),this.$saveConfirmation=this.$(".save-confirmation"),this.$el.on("VideoEditor.submitSave",this.onSave),this.$el.on("VideoEditor.submitSaveAs",this.onSaveAs),this.fetchContent()},e.prototype.fetchContent=function(){return Echo.routes.Videos.getVideoForEditing(this.mediaId).ajax({beforeSend:(t=this,function(){return t.loadingOn(null,{selector:".editor-content"})}),success:this.onFetchSuccess,error:this.onFetchError});var t},e.prototype.onFetchSuccess=function(t){var e;return this.$el.removeClass("locked"),this.loadingOff(null,{selector:".editor-content",callback:(e=this,function(){return e.$editorContent.append(t)})}),this.$el.trigger("Mutex.getKey")},e.prototype.onFetchError=function(t){return this.$placeholderText.text(t.responseJSON.message),this.$el.addClass("locked"),this.loadingOff(null,{selector:".editor-content"})},e.prototype.onSave=function(t,e){return this._save(Echo.routes.Videos.edit(this.mediaId),e,this.onSaveSuccess,this.onSaveError)},e.prototype.onSaveAs=function(t,e){return this._save(Echo.routes.Videos.saveAs(this.mediaId),e,this.onSaveAsSuccess,this.onSaveAsError)},e.prototype._save=function(t,e,i,o){return this.$el.trigger("loading.on",{fixed:!0}),this.ajax(t,{data:e,success:i,error:o,complete:(n=this,function(){return n.$el.trigger("loading.off",{fixed:!0})})});var n},e.prototype.onSaveSuccess=function(){var t,e;return t=this.saveRedirectUrl?(e=this.saveRedirectUrl+"?status=Processing&mediaType=VideoPresentation",this.name?e+"#searchText="+this.name:e):void 0,this.$saveConfirmation.trigger("SaveConfirmation.update",{url:t,message:this.messages.save}),this.$el.trigger("Modal.saveConfirmation.open")},e.prototype.onSaveAsSuccess=function(){return this.$saveConfirmation.trigger("SaveConfirmation.update",{message:this.messages.saveAs}),this.$el.trigger("Modal.saveConfirmation.open"),this.$el.trigger("Modal.saveAs.close")},e.prototype.onSaveError=function(){return alertify.error(this.i18n("Alert.genericError"))},e.prototype.onSaveAsError=function(){return alertify.error(this.i18n("Errors.saveAs"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.videos.SaveAsModal=function(t){function e(){return this.onSubmit=i(this.onSubmit,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$name=this.$el.find("input[name=name]"),this.$description=this.$el.find("textarea[name=description]"),this.$tags=this.$el.find("input[name=tags]"),this.$el.on("AjaxForm.submit",this.onSubmit)},e.prototype.onSubmit=function(){var t;return t={name:this.$name.val(),description:this.$description.val(),tags:""!==this.$tags.val()?this.$tags.val().split(/,/):[]},this.$el.trigger("VideoEditor.saveAs",t)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.videos.SaveConfirmation=function(t){function i(){var t,e;return this.onUpdate=(t=this.onUpdate,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$ok=this.$(".ok"),this.$message=this.$(".redirect-information"),this.$el.on("SaveConfirmation.update",this.onUpdate)},i.prototype.onUpdate=function(t,e){var i,o;if(i=e.message,o=e.url,i&&this.$message.text(i),o)return this.$ok.attr("href",o)},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.accordion.AccordionSegment=function(t){function i(){var t,e;return this.toggleSegment=(t=this.toggleSegment,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){if(this.$toggleLink=this.$(".toggle-segment"),this.$segmentContent=this.$(".segment-content"),this.$toggleLink.on("click",this.toggleSegment),!this.$el.hasClass("opened"))return this.closeSegment()},i.prototype.closeSegment=function(){return this.$el.removeClass("opened"),this.$segmentContent.slideUp()},i.prototype.openSegment=function(){return this.$el.addClass("opened"),this.$segmentContent.slideDown()},i.prototype.toggleSegment=function(t){return t.preventDefault(),this.$el.hasClass("opened")?this.closeSegment():this.openSegment()},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.CampusBuildingRoomSelect=function(t){function e(){return this.onCampusChange=i(this.onCampusChange,this),this.onBuildingChange=i(this.onBuildingChange,this),this.onRoomChange=i(this.onRoomChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.buildingSelectRoute=t.buildingSelectRoute,this.roomSelectRoute=t.roomSelectRoute,this.campusSelect=this.$(".campusSelect"),this.campusSelect.on("change",this.onCampusChange),this.bindBuildingSelect(),this.bindRoomSelect()},e.prototype.bindBuildingSelect=function(){return this.buildingSelect=this.$(".buildingSelect"),this.buildingSelect.on("change",this.onBuildingChange)},e.prototype.bindRoomSelect=function(){return this.roomSelect=this.$(".roomSelect"),this.roomSelect.on("change",this.onRoomChange)},e.prototype.onRoomChange=function(t){var e;return e=t.target.value,this.$el.trigger("CampusBuildingRoomSelect.roomChange",e)},e.prototype.onBuildingChange=function(t){var e;if(e=t.target.value,this.roomSelect.find("select").trigger("disable").trigger("empty"),this.$el.trigger("CampusBuildingRoomSelect.buildingChange",e),e)return this.changeBuilding(e)},e.prototype.changeBuilding=function(t){var e,i;return e={buildingId:t},$.get(this.roomSelectRoute,e,(i=this,function(t){return i.roomSelect.replaceWith(t.data[0].html),i.bindRoomSelect()}))},e.prototype.onCampusChange=function(t){var e;if(e=t.target.value,this.buildingSelect.find("select").trigger("disable").trigger("empty"),this.roomSelect.find("select").trigger("disable").trigger("empty"),this.$el.trigger("CampusBuildingRoomSelect.campusChange",e),e)return this.changeCampus(e)},e.prototype.changeCampus=function(t){var e,i;return e={campusId:t},$.get(this.buildingSelectRoute,e,(i=this,function(t){return i.buildingSelect.replaceWith(t.data[0].html),i.bindBuildingSelect()}))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty;Echo.widgets.captureModal.CaptureModal=function(t){function e(){return this.campusOffsetFor=i(this.campusOffsetFor,this),this.redrawEventInCaptureDayView=i(this.redrawEventInCaptureDayView,this),this.onSubmitError=i(this.onSubmitError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onRoomChange=i(this.onRoomChange,this),this.onBuildingChange=i(this.onBuildingChange,this),this.onCampusChange=i(this.onCampusChange,this),this.onInstructorOptionsSuccess=i(this.onInstructorOptionsSuccess,this),this.onTermChanged=i(this.onTermChanged,this),this.onRecurringChange=i(this.onRecurringChange,this),this.onSwitchChange=i(this.onSwitchChange,this),this.onStartDateChange=i(this.onStartDateChange,this),this.onSectionRemoved=i(this.onSectionRemoved,this),this.onSectionSelected=i(this.onSectionSelected,this),this.getSelectedSections=i(this.getSelectedSections,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)l.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.campusOffsets=t.campusOffsets,this.eventSummary=t.eventSummary,this.dayNames=t.dayNames,this.newEventColor=t.newEventColor,this.updateSchedule=t.updateSchedule,this.published=t.published,null==this.campusOffsets&&(this.campusOffsets={}),this.dom={recurring:this.$('[name="recurring"]'),recurringInterval:this.$('[name="interval"]'),startTime:this.$('[name="startTimeIso8601"]'),endTime:this.$('[name="endTimeIso8601"]'),startDate:this.$('[name="startDate"]'),endDate:this.$('[name="endDate"]').not(":disabled"),instructorSelect:this.$(".captureModalInstructorFilter"),dayCheckboxes:this.$(".days input"),configurations:this.$(".configurations"),deviceInput:this.$(".deviceInputSelect"),streamLiveSwitch:this.$(".streamLiveSwitch"),deviceCaptureQuality:this.$(".deviceCaptureQualitySelect")},this.$el.on("CampusBuildingRoomSelect.campusChange",this.onCampusChange).on("CampusBuildingRoomSelect.buildingChange",this.onBuildingChange).on("CampusBuildingRoomSelect.roomChange",this.onRoomChange).on("AjaxForm.captureModal.success",this.onSubmitSuccess).on("AjaxForm.captureModal.error",this.onSubmitError).on("change",this.redrawEventInCaptureDayView).on("termChanged",this.onTermChanged).on("change",".switch",this.onSwitchChange).on("change","[name=startDate]",this.onStartDateChange).on("PublishRow.selectSection",this.onSectionSelected).on("InputList.itemRemoved",this.onSectionRemoved),this.dom.recurring.on("change",this.onRecurringChange),this.redrawEventInCaptureDayView(),this.onRecurringChange()},e.prototype.getSelectedSections=function(){var i;return this.$el.find('.list .entry [name="sectionId"]').map((i=this,function(t,e){return i.$(e).val()})).filter(function(t,e){return""!==e})},e.prototype.onSectionSelected=function(){return this.published=0<this.getSelectedSections().length,this.dom.streamLiveSwitch.trigger("Switch.streamLive.published",{published:this.published})},e.prototype.onSectionRemoved=function(){return this.onSectionSelected()},e.prototype.onStartDateChange=function(){return this.dom.startDate.val()>this.dom.endDate.val()&&this.dom.endDate.val(this.dom.startDate.val()).trigger("change"),new Date(this.dom.startDate.val())},e.prototype.onSwitchChange=function(){return this.dom.recurringInterval.trigger("Input.clearError")},e.prototype.getRRuleString=function(){var n;return this.isRecurring()?new RRule({freq:RRule[this.dom.recurring.val()],byweekday:function(){var t,e,i,o;for(o=[],t=0,e=(i=this.getSelectedDays()).length;t<e;t++)n=i[t],o.push(RRule[n]);return o}.call(this),until:Echo.core.helpers.getDateFromISODateString(this.dom.endDate.val()),interval:this.dom.recurringInterval.val()}).toString():null},e.prototype.getSelectedDays=function(){var t,e,i,o,n;for(n=[],i=0,o=(e=["SU","MO","TU","WE","TH","FR","SA"]).length;i<o;i++)t=e[i],this.$("[name='"+t+"']").is(":checked")&&n.push(t);return n},e.prototype.isRecurring=function(){return null!=RRule[this.dom.recurring.val()]},e.prototype.onRecurringChange=function(){return this.isRecurring()?this.$el.addClass("is-recurring-event"):this.$el.removeClass("is-recurring-event")},e.prototype.onTermChanged=function(t,e){return""===e?this.getAllInstructors():this.getInstructorsForTerm(e)},e.prototype.getAllInstructors=function(){return Echo.routes.InstitutionUsers.getInstructorOptionsByInstitution.ajax({success:this.onInstructorOptionsSuccess})},e.prototype.getInstructorsForTerm=function(t){return Echo.routes.InstitutionUsers.getInstructorOptionsByTerm(t).ajax({success:this.onInstructorOptionsSuccess})},e.prototype.onInstructorOptionsSuccess=function(t){var e;return e=t.data,this.updateInstructorOptions(e[0].html)},e.prototype.updateInstructorOptions=function(t){var e;return e={options:t,keepEmptyOption:!0},this.dom.instructorSelect.trigger("Select.updateOptions",e)},e.prototype.onCampusChange=function(t,e){return this.dom.deviceInput.trigger("campusChange",[e,this.campusOffsetFor(e)])},e.prototype.onBuildingChange=function(t,e){return this.dom.deviceInput.trigger("buildingChange",e)},e.prototype.onRoomChange=function(t,e){return this.dom.deviceInput.trigger("roomChange",e),this.dom.deviceCaptureQuality.trigger("roomChange",e),this.dom.streamLiveSwitch.trigger("roomChange",e)},e.prototype.onSubmitSuccess=function(t,e){var i,o,n,s;if(this.updateSchedule)for(o=0,n=(s=e.html).length;o<n;o++)i=s[o],this.$el.trigger("Capture."+i.captureId.split("_")[0]+".edited",i);return this.$el.trigger("Captures.addCapture.success",e),this.$el.trigger("Modal.addCapture.close"),alertify.success(this.i18n("Admin.captures.captureCreated"))},e.prototype.onSubmitError=function(t,e){var i,o,n,s,r,a,h;for(o in a=[],i=e.formErrors)l.call(i,o)&&(h=i[o],"obj.event"===o&&"Errors.scheduleDateTooFarInFuture"===(null!=h&&null!=(s=h[0])?s.msg:void 0)?(n=this.i18n(h[0].msg,h[0].args[0]),a.push(this.dom[h[0].args[1]].trigger("Input.setError",n))):"Errors.scheduleHasActiveOccurrence"===(null!=h&&null!=(r=h[0])?r.msg:void 0)?a.push(alertify.error(this.i18n("Errors.scheduleHasActiveOccurrence"))):a.push(void 0));return a},e.prototype.redrawEventInCaptureDayView=function(){var n;if(this.dom.startTime&&this.dom.endTime)return this.$(".captureDayView").trigger("CaptureDayView.clear").trigger("CaptureDayView.addEvent",{startTime:this.dom.startTime.val(),endTime:this.dom.endTime.val(),currentDate:new Date,days:function(){var t,e,i,o;for(o=[],t=0,e=(i=this.getSelectedDays()).length;t<e;t++)n=i[t],o.push(this.dayNames[n]);return o}.call(this).join(" "),summary:this.eventSummary,color:this.newEventColor})},e.prototype.campusOffsetFor=function(t){return this.campusOffsets[t]||0},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,o=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.widgets.captureModal.LiveStreamingOptions=function(t){function e(){return this.onPublished=i(this.onPublished,this),this.onFetchRoomDeviceTypeSuccess=i(this.onFetchRoomDeviceTypeSuccess,this),this.onRoomChange=i(this.onRoomChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.roomId=t.roomId,this.streamLiveEnabled=t.streamLiveEnabled,this.shouldStreamLive=t.shouldStreamLive,this.published=t.published,this.wifiSupportedDevices=t.wifiSupportedDevices,this.liveStreamingDisabledWarning=this.i18n("Warnings.liveStreamingNotSupported",this.i18n("Labels.institution")),this.liveStreamingDeviceUnsupportedWarning=this.i18n("Warnings.liveStreamingNotSupported",this.i18n("Labels.device")),this.sectionUnselectedWarning=this.i18n("Captures.captureModal.liveStreamingNeedsSection"),this.liveStreamingRequiresADevice=this.i18n("Warnings.liveStreamNeedsADevice"),this.wifiWarning=this.i18n("Warnings.liveStreamingNotSupportedOverWifi"),this.canStream=this.shouldStreamLive,this.$checkbox=this.$(".switch input"),this.$warning=this.$el.find("span.warning"),this.$el.on("roomChange",this.onRoomChange).on("Switch.streamLive.published",this.onPublished),this.initView()},e.prototype.initView=function(){return this.fetchRoomDeviceType()},e.prototype.getWarningMessage=function(){return this.roomId&&!this.canStream?this.liveStreamingDeviceUnsupportedWarning:this.roomId?this.published?void 0:this.sectionUnselectedWarning:this.liveStreamingRequiresADevice},e.prototype.disableAndShowWarning=function(t){return this.$warning.text(t).removeAttr("data-tooltip").show(),this.$checkbox.trigger("disable")},e.prototype.enableAndHideWarning=function(){return this.$checkbox.trigger("enable"),this.checkIfWifiSupported()},e.prototype.checkIfWifiSupported=function(){var t;return t=this.deviceType,0<=o.call(this.wifiSupportedDevices,t)?(this.$warning.text("").attr("data-tooltip",this.wifiWarning).show(),this.$warning.trigger("Tooltip.flash")):this.$warning.hide()},e.prototype.updateView=function(){var t;return this.streamLiveEnabled?this.canStream&&this.published?this.canStream?this.enableAndHideWarning():void 0:(this.$checkbox.prop("checked")&&this.$checkbox.trigger("click"),t=this.getWarningMessage(),this.disableAndShowWarning(t)):this.disableAndShowWarning(this.liveStreamingDisabledWarning)},e.prototype.onRoomChange=function(t,e){return this.roomId=e,this.fetchRoomDeviceType()},e.prototype.fetchRoomDeviceType=function(){return this.roomId?Echo.routes.RoomConfigurations.getDeviceType(this.roomId).ajax({success:this.onFetchRoomDeviceTypeSuccess}):(this.canStream=!1,this.updateView())},e.prototype.onFetchRoomDeviceTypeSuccess=function(t){var e,i,o;return e=t.data,this.canStream=null!=(i=e[0])?i.supportsLiveStreaming:void 0,this.deviceType=null!=(o=e[0])?o.deviceType:void 0,this.updateView()},e.prototype.onPublished=function(t,e){var i;return i=e.published,this.published=i,this.$el.toggleClass("published",this.published),this.updateView()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.captureModal.PublishRow=function(t){function e(){return this.onUnavailabilityDelayChange=i(this.onUnavailabilityDelayChange,this),this.onRelativeDelayChange=i(this.onRelativeDelayChange,this),this.onUnavailableChange=i(this.onUnavailableChange,this),this.onAvailableChange=i(this.onAvailableChange,this),this.onTermCourseChange=i(this.onTermCourseChange,this),this.getSections=i(this.getSections,this),this.onSectionUpdateSuccess=i(this.onSectionUpdateSuccess,this),this.onSectionChange=i(this.onSectionChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.id=t.id,this.$course=this.$el.find(".courseSelector select"),this.$term=this.$el.find(".termSelector select"),this.$section=this.$el.find(".sectionSelector select"),this.$makeAvailable=this.$el.find("[name='makeAvailable_"+this.id+"']"),this.$makeUnavailable=this.$el.find("[name='makeUnavailable_"+this.id+"']"),this.$relativeDelay=this.$el.find("[name='makeAvailableAfter']"),this.$unavailabilityDelay=this.$el.find("[name='makeUnavailableAfter']"),this.$availabilityInput=this.$el.find("[name='availability']"),this.$relativeDelayInput=this.$el.find("[name='relativeDelay']"),this.$unavailabilityDelayInput=this.$el.find("[name='unavailabilityDelay']"),this.$course.on("change",this.onTermCourseChange),this.$term.on("change",this.onTermCourseChange),this.$section.on("change",this.onSectionChange),this.$makeAvailable.on("change",this.onAvailableChange),this.$makeUnavailable.on("change",this.onUnavailableChange),this.$relativeDelay.on("change",this.onRelativeDelayChange),this.$unavailabilityDelay.on("change",this.onUnavailabilityDelayChange),this.onTermCourseChange(),this.initializeAvailabilityState()},e.prototype.onSectionChange=function(){var t;return t=this.$section.value(),this.$el.trigger("PublishRow.selectSection",{section:t}),t?this.$makeAvailable.removeAttr("disabled"):(this.$makeAvailable.attr("disabled",!0),this.$relativeDelay.attr("disabled",!0),this.$unavailabilityDelay.attr("disabled",!0),this.$makeUnavailable.attr("disabled",!0)),!0},e.prototype.onSectionUpdateSuccess=function(t){return this.$section.trigger("Select.updateOptions",{options:t.data[0].html,keepEmptyOption:!0,maintainSelection:!0}).trigger("enable")},e.prototype.getSections=function(t,e){return this.ajax(Echo.routes.Sections.getSectionFilterOptions(t,e),{dataType:"json",data:{courseId:t,termId:e},success:this.onSectionUpdateSuccess,error:this.onAjaxError})},e.prototype.onTermCourseChange=function(){var t,e;return e=this.$term.value(),null!=(t=this.$course.value())&&null!=e?this.getSections(t,e):this.disableSection()},e.prototype.disableSection=function(){return this.$section.trigger("Select.updateSelected","").trigger("disable"),this.$makeAvailable.attr("disabled",!0)},e.prototype.disableUnavailability=function(){return this.$makeUnavailable.filter(":checked").prop("checked",!1),this.$makeUnavailable.attr("disabled",!0),this.$unavailabilityDelay.val(""),this.$unavailabilityDelayInput.val(""),this.$unavailabilityDelay.attr("disabled",!0)},e.prototype.initializeAvailabilityState=function(){if("Unavailable"===this.$makeAvailable.filter(":checked").val())return this.disableUnavailability()},e.prototype.onAvailableChange=function(t){var e,i;if("Unavailable"===(e=t.target.value)&&this.disableUnavailability(),"Relative"===(i=this.$makeUnavailable.filter(":checked").value())?this.$availabilityInput.val("Relative"):this.$availabilityInput.val(e),"Relative"===e?this.$relativeDelay.removeAttr("disabled"):(this.$relativeDelay.attr("disabled",!0),this.$relativeDelay.val(""),this.$relativeDelayInput.val("")),"Unavailable"!==e&&(this.$makeUnavailable.removeAttr("disabled"),"Relative"===i))return this.$unavailabilityDelay.removeAttr("disabled")},e.prototype.onUnavailableChange=function(t){var e;return"Relative"===(e=t.target.value)?(this.$availabilityInput.val(e),this.$unavailabilityDelay.removeAttr("disabled")):(this.$availabilityInput.val(this.$makeAvailable.filter(":checked").value()),this.$unavailabilityDelay.val(""),this.$unavailabilityDelayInput.val(""),this.$unavailabilityDelay.attr("disabled",!0))},e.prototype.onRelativeDelayChange=function(t){return this.$relativeDelayInput.val(t.target.value)},e.prototype.onUnavailabilityDelayChange=function(t){return this.$unavailabilityDelayInput.val(t.target.value)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=[].slice;Echo.widgets.captures.Captures=function(t){function e(){return this.onUpdateCaptureStatus=i(this.onUpdateCaptureStatus,this),this.onCaptureModalDelete=i(this.onCaptureModalDelete,this),this.onCaptureReprocessStarted=i(this.onCaptureReprocessStarted,this),this.onIncrementCount=i(this.onIncrementCount,this),this.onDecrementCount=i(this.onDecrementCount,this),this.onAddCaptureOpen=i(this.onAddCaptureOpen,this),this.onAddCaptureSuccess=i(this.onAddCaptureSuccess,this),this.onSearchResults=i(this.onSearchResults,this),this.onUpdateSortOptions=i(this.onUpdateSortOptions,this),this._onFiltersUpdate=i(this._onFiltersUpdate,this),this.onStatusFilterClick=i(this.onStatusFilterClick,this),this.onBulkActionButtonToggle=i(this.onBulkActionButtonToggle,this),this.onItemsAddedSuccess=i(this.onItemsAddedSuccess,this),this.onDeleteError=i(this.onDeleteError,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.onDeleteComplete=i(this.onDeleteComplete,this),this.onDeleteConfirmation=i(this.onDeleteConfirmation,this),this.onCapturesDelete=i(this.onCapturesDelete,this),this.onUpdateSelected=i(this.onUpdateSelected,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.selectedCaptures=[],this.sortOptions={Complete:{sortCategory:"start_date_time",sortDirection:"desc"},Processing:{sortCategory:"start_date_time",sortDirection:"desc"},Capturing:{sortCategory:"start_date_time",sortDirection:"desc"},Scheduled:{sortCategory:"start_date_time",sortDirection:"asc"},Error:{sortCategory:"start_date_time",sortDirection:"desc"},all:{sortCategory:"start_date_time",sortDirection:"asc"}},this.$bulkActions=this.$(".bulk-actions"),this.$statusFilters=this.$(".status-filter"),this.$table=this.$(".adminList-table"),this.$el.on("click",".status-filter",this.onStatusFilterClick).on("AdminListTable.decrementCount",this.onDecrementCount).on("AdminListTable.incrementCount",this.onIncrementCount).on("AdminListTable.itemsAddedSuccess",this.onItemsAddedSuccess).on("AdminListTable.searchResults",this.onSearchResults).on("AdminListTable.updateSelected",this.onUpdateSelected).on("AdminListTable.updateSortOptions",this.onUpdateSortOptions).on("BulkActionButton.toggle",this.onBulkActionButtonToggle).on("CaptureItem.reprocessStarted",this.onCaptureReprocessStarted).on("Captures.addCapture.open",this.onAddCaptureOpen).on("Captures.delete",this.onCapturesDelete).on("Captures.updateCaptureStatus",this.onUpdateCaptureStatus).on("FilterBar.update",".captures-sidebar",this.onFilterBarUpdate),this.$body.on("Captures.addCapture.success",this.onAddCaptureSuccess).on("Captures.captureModal.deleteCapture",this.onCaptureModalDelete),this.onFiltersUpdate=_.debounce(this._onFiltersUpdate,250),this.initView()},e.prototype.onUpdateSelected=function(){var t,e,i,o,n,s;for(arguments[0],s=2<=arguments.length?r.call(arguments,1):[],this.selectedCaptures={occurrenceIds:[],scheduledIds:[]},n=[],e=0,i=s.length;e<i;e++)t=(o=s[e]).id,"occurrenceId"===o.type?n.push(this.selectedCaptures.occurrenceIds.push(t)):n.push(this.selectedCaptures.scheduledIds.push(t));return n},e.prototype.onCapturesDelete=function(){var t;return t=1<this.selectedCaptures.occurrenceIds.length+this.selectedCaptures.scheduledIds.length?"Admin.captures.deleteConfirmation":"Admin.captures.deleteConfirmationSingle",this.confirm(t,this.onDeleteConfirmation)},e.prototype.onDeleteConfirmation=function(){return this.$el.trigger("loading.on",{selector:".adminList-table",theme:"light",opacity:"transparent"}),this.$bulkActions.find(".btn").trigger("disable"),this.ajax(Echo.routes.Captures.delete(),{data:this.selectedCaptures,success:this.onDeleteSuccess,error:this.onDeleteError,complete:this.onDeleteComplete})},e.prototype.onDeleteComplete=function(){return this.$el.trigger("loading.off",{selector:".adminList-table"}),this.$bulkActions.find(".btn").trigger("enable")},e.prototype.onDeleteSuccess=function(t){var e,i,o;return e=t.data,this.$table.trigger("AdminListTable.deleteItems",_.union(null!=(i=e[0])?i.scheduledIds:void 0,null!=(o=e[0])?o.occurrenceIds:void 0)),alertify.success(this.i18n("Admin.captures.deleteSuccess"))},e.prototype.onDeleteError=function(){return alertify.error(this.i18n("Admin.captures.deleteError"))},e.prototype.onItemsAddedSuccess=function(t,e){return this.adjustStatusCounts(e.captureStatus,e.count)},e.prototype.onBulkActionButtonToggle=function(t,e){var i;return i=e?"slideDown":"slideUp",this.$bulkActions[i](200)},e.prototype.getActiveStatus=function(){return this.$statusFilters.filter(".active").data("status")},e.prototype.onStatusFilterClick=function(t){var e;return t.preventDefault(),e=this.$(t.currentTarget),this.$statusFilters.removeClass("active"),e.addClass("active"),Echo.helpers.Location.upsertHash({status:this.getActiveStatus()}),this.onFiltersUpdate()},e.prototype._onFiltersUpdate=function(){var t;return t=$.extend({},this.filters,this.getSearchFilters()),_.isEqual(t,this.previousFilters)||(this.$table.trigger("AdminListTable.search",{url:this.searchUrl,filters:t}),this.previousFilters=t),null!=this.previousFilters?this.previousFilters:this.previousFilters=t},e.prototype.onUpdateSortOptions=function(t,e){var i;return i=this.$(".status-filter.active").data("status"),this.sortOptions[i]={sortCategory:e.sortCategory,sortDirection:e.sortDirection}},e.prototype.onSearchResults=function(t,e){return this.statusCounts=e.results.statusCounts,this.updateStatusCounts()},e.prototype.formatBy1000=function(t){return 1e3<t?Math.round(10*t/1e3)/10+"K":t},e.prototype.onAddCaptureSuccess=function(t,e){var i,o;if(i={html:_.map(e.html,function(t){return t.html}),captureStatus:"Scheduled",count:e.html.length},"Scheduled"===(o=this.getActiveStatus())||"all"===o)return this.$table.trigger("AdminListTable.itemsAdded",i)},e.prototype.onAddCaptureOpen=function(){return this.injectFromUrl(Echo.routes.CaptureSchedules.createModal())},e.prototype.onDecrementCount=function(t,e){var i;return i=e.captureStatus,this.adjustStatusCounts(i,-1)},e.prototype.onIncrementCount=function(t,e){var i;return i=e.captureStatus,this.adjustStatusCounts(i,1)},e.prototype.adjustStatusCounts=function(t,e){var i,o,n,s,r;if(null!=t){for(i=o=0,n=(s=this.statusCounts).length;o<n;i=++o)(r=s[i]).value===t&&0<=r.count+e&&(this.statusCounts[i].count+=e);return this.updateStatusCounts()}},e.prototype.onCaptureReprocessStarted=function(t,e){return this.updateCapture(e)},e.prototype.updateCapture=function(t){var e,i;return i=(e=this.getActiveStatus())===t.captureStatus||"all"===e,this.$body.trigger("CaptureItem."+t.captureId+".replace",{data:t,replace:i})},e.prototype.onCaptureModalDelete=function(t,e){return this.selectedCaptures={occurrenceIds:[e],scheduledIds:[]},this.onCapturesDelete()},e.prototype.onUpdateCaptureStatus=function(t,e){return this.updateCapture(e)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.captures.Dashboard=function(t){function e(){return this.onFilterBarUpdate=i(this.onFilterBarUpdate,this),this.onNextDateClick=i(this.onNextDateClick,this),this.onPreviousDateClick=i(this.onPreviousDateClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.captures.Captures),e.prototype.days=["ViewHelpers.weekdayToDayName.full.su","ViewHelpers.weekdayToDayName.full.mo","ViewHelpers.weekdayToDayName.full.tu","ViewHelpers.weekdayToDayName.full.we","ViewHelpers.weekdayToDayName.full.th","ViewHelpers.weekdayToDayName.full.fr","ViewHelpers.weekdayToDayName.full.sa"],e.prototype.months=["ViewHelpers.monthNumToMonthName.january","ViewHelpers.monthNumToMonthName.february","ViewHelpers.monthNumToMonthName.march","ViewHelpers.monthNumToMonthName.april","ViewHelpers.monthNumToMonthName.may","ViewHelpers.monthNumToMonthName.june","ViewHelpers.monthNumToMonthName.july","ViewHelpers.monthNumToMonthName.august","ViewHelpers.monthNumToMonthName.september","ViewHelpers.monthNumToMonthName.october","ViewHelpers.monthNumToMonthName.november","ViewHelpers.monthNumToMonthName.december"],e.prototype.initialize=function(t){return this.captureStatuses=t.captureStatuses,this.$dateSelector=this.$(".date-selector-date"),this.searchUrl=Echo.routes.Captures.search(),this.$el.on("click",".date-selector.previous",this.onPreviousDateClick).on("click",".date-selector.next",this.onNextDateClick),e.__super__.initialize.apply(this,arguments)},e.prototype.onPreviousDateClick=function(){var t;return t=this.getDate(this.$dateSelector.data("date")),t=new Date(t.valueOf()-864e5),this.updateDate(t)},e.prototype.onNextDateClick=function(){var t;return t=this.getDate(this.$dateSelector.data("date")),t=new Date(t.valueOf()+864e5),this.updateDate(t)},e.prototype.updateDate=function(t){return this.$dateSelector.data("date",t.getTime()),this.$dateSelector.text(this.i18n(this.days[t.getDay()])+", "+this.i18n(this.months[t.getMonth()])+" "+t.getDate()),this.onFiltersUpdate()},e.prototype.initView=function(){var t;return t=this.getDate(),this.updateDate(t),this.$statusFilters.filter(".active").trigger("click")},e.prototype.getDate=function(t){return(t=null!=t?new Date(t):new Date).setHours(0,0,0,0),t},e.prototype.onFilterBarUpdate=function(t,e){return this.filters=e,this.onFiltersUpdate()},e.prototype.getSearchFilters=function(){var t;return t=this.$(".status-filter.active").data("status"),{sortCategory:this.sortOptions[t].sortCategory,sortDirection:this.sortOptions[t].sortDirection,statuses:"all"===t?this.captureStatuses:[t],startDate:this.getStartDateString(),endDate:this.getEndDateString()}},e.prototype.getStartDateString=function(){return this.$dateSelector.data("date")},e.prototype.getEndDateString=function(){var t;return(t=new Date(this.getStartDateString())).setHours(23,59,59,999),t.getTime()},e.prototype.updateStatusCounts=function(){var t,e,i,o,n;for(t=n=0,e=(i=this.statusCounts).length;t<e;t++)n+=(o=i[t]).count,this.updateStatusCount(this.$statusFilters.filter("[data-status="+o.value+"]"),o.count);return this.updateStatusCount(this.$statusFilters.filter("[data-status=all]"),n)},e.prototype.updateStatusCount=function(t,e){return t.find(".filter-count").text(this.formatBy1000(e))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.captures.Index=function(t){function e(){return this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onSubmitError=i(this.onSubmitError,this),this.onFileUploadSuccess=i(this.onFileUploadSuccess,this),this.onFilterBarUpdate=i(this.onFilterBarUpdate,this),this.onSearchBarUpdate=i(this.onSearchBarUpdate,this),this.onSidebarFilterInitialization=i(this.onSidebarFilterInitialization,this),this.initView=i(this.initView,this),this.onDropdownOpen=i(this.onDropdownOpen,this),this.onDropdownClose=i(this.onDropdownClose,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.captures.Captures),e.prototype.initialize=function(){return this.$sidebar=this.$(".captures-sidebar"),this.searchUrl=Echo.routes.Captures.search(),this.$searchInput=this.$(".captures-search input[name=searchText]"),this.dateFilter={},e.__super__.initialize.apply(this,arguments),this.$el.on("Captures.initializeFilter",this.onSidebarFilterInitialization).on("FileStack.success",this.onFileUploadSuccess).on("select2:open",this.onDropdownOpen).on("select2:close",this.onDropdownClose).on("chosen:showing_dropdown",this.onDropdownOpen).on("chosen:hiding_dropdown",this.onDropdownClose),$(".nav .tabs .nav-tab a").eq(1).on("click",function(t){return t.preventDefault(),window.location.assign(Echo.routes.Captures.index().url+"#dateRange=today"),window.location.reload()}),this.$searchInput.trigger("change")},e.prototype.onDropdownClose=function(){return this.$sidebar.css({overflow:"auto"})},e.prototype.onDropdownOpen=function(){return this.$sidebar.css({overflow:"visible"})},e.prototype.initView=function(){var t;if(this.$el.on("FilterBar.update",".captures-search",this.onSearchBarUpdate),0<(null!=(t=Echo.helpers.Location.parseHash().status)?t.length:void 0))return this.$statusFilters.filter("."+t).click()},e.prototype.updateFiltersAndSearch=function(){return this.sideFilters=this.processFilters(this.sideFilters),this.filters=$.extend({},this.topFilters,this.sideFilters),this.onFiltersUpdate()},e.prototype.onSidebarFilterInitialization=function(t,e){return this.setDateStringValues(e),this.sideFilters=$.extend({},this.sideFilters,e),this.updateFiltersAndSearch()},e.prototype.onSearchBarUpdate=function(t,e){return this.topFilters={searchText:e.searchText},this.updateFiltersAndSearch()},e.prototype.onFilterBarUpdate=function(t,e){var i,o,n,s;for(this.sideFilters=e,this.setDateStringValues(this.sideFilters),o=0,n=(s=["searchText","status"]).length;o<n;o++)i=s[o],delete this.sideFilters[i];return this.updateFiltersAndSearch()},e.prototype.setDateStringValues=function(t){if(null!=t.startDate&&(this.dateFilter.startDate=t.startDate),null!=t.endDate)return this.dateFilter.endDate=t.endDate},e.prototype.clearDates=function(t){return delete t.startDate,delete t.endDate,delete this.dateFilter.startDate,delete this.dateFilter.endDate},e.prototype.processFilters=function(t){if(null!=t)return null==t.dateRange||"allTime"===t.dateRange?this.clearDates(t):(t.startDate=this.getDateString(this.dateFilter.startDate),t.endDate=this.getDateString(this.dateFilter.endDate,!0)),t},e.prototype.getDateString=function(t,e){var i;return null==e&&(e=!1),null!=t?(i=new Date(t),e?i.setUTCHours(23,59,59,999):i.setUTCHours(0,0,0,0),(i=new Date(i.getTime()+6e4*i.getTimezoneOffset())).getTime()):void 0},e.prototype.getSearchFilters=function(){var t;return{statuses:[t=this.$(".status-filter.active").data("status")],sortCategory:this.sortOptions[t].sortCategory,sortDirection:this.sortOptions[t].sortDirection}},e.prototype.updateStatusCounts=function(){var t,e,i,o,n;for(o=[],t=0,e=(i=this.statusCounts).length;t<e;t++)n=i[t],o.push(this.updateFilterText(this.$statusFilters.filter("."+n.value),n.count));return o},e.prototype.updateFilterText=function(t,e){var i;return i=t.find("span.label").text(),t.attr("title",i+" "+this.formatBy1000(e)),t.find(".captures-count").text(this.formatBy1000(e))},e.prototype.onFileUploadSuccess=function(t,e){return this.ajax(Echo.routes.MediaUpload.processCapture(),{data:{name:e.fileBlob.filename,fileBlob:e.fileBlob},success:this.onSubmitSuccess,error:this.onSubmitError})},e.prototype.onSubmitError=function(t){return alertify.alert(this.i18n("Errors.submitMediaError"))},e.prototype.onSubmitSuccess=function(t){var e;if(e=t.data,"Processing"===this.$statusFilters.filter(".active").data("status"))return this.$table.trigger("AdminListTable.itemsAdded",$.extend({count:1},e[0]))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.createSection.Main=function(t){function e(){return this.renderForm=i(this.renderForm,this),this.getElem=i(this.getElem,this),this.onSubmitError=i(this.onSubmitError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onTermOptionChange=i(this.onTermOptionChange,this),this.onCourseOptionChange=i(this.onCourseOptionChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){var t;return this.$form=this.$("form"),this.$courseOption=this.$("[name=courseOption]"),this.$courseIdentifier=this.$("[name=courseIdentifier]"),this.$courseName=this.$("[name=courseName]"),this.$termOption=this.$("[name=termOption]"),this.$termName=this.$("[name=termName]"),this.$startDate=this.$("[name=startDate]"),this.$endDate=this.$("[name=endDate]"),this.$sectionNumber=this.$("[name=sectionNumber]"),this.$newCourseRow=this.$(".newCourseRow"),this.$newTermRow=this.$(".newTermRow"),this.$course=this.$("fieldset[data-name=course]"),this.$term=this.$("fieldset[data-name=term]"),this.$courseOption.on("change",this.onCourseOptionChange),this.$termOption.on("change",this.onTermOptionChange),t=_.debounce(this.renderForm,30),this.$("input, select").on("change",t),this.$("input, select").on("input",t),this.$el.on("AjaxForm.addSection.success",this.onSubmitSuccess).on("AjaxForm.addSection.error",this.onSubmitError)},e.prototype.onCourseOptionChange=function(t,e){return this.$newCourseRow.toggle("NEW"===this.$courseOption.val())},e.prototype.onTermOptionChange=function(t,e){return this.$newTermRow.toggle("NEW"===this.$termOption.val())},e.prototype.onSubmitSuccess=function(t,e){return this.$el.trigger("CreateSection.success",{sectionId:e.sectionId})},e.prototype.onSubmitError=function(t,e){return _.each(e.formErrors,(n=this,function(t,e){var i,o;return i=n.i18n(t[0].msg),null!=(o=n.getElem(e))?o.trigger("Input.setError",i):void 0}));var n},e.prototype.getElem=function(t){switch(t){case"obj.course.courseId":return this.$courseOption;case"obj.course.course.courseName":return this.$courseName;case"obj.course.course.courseIdentifier":return this.$courseIdentifier;case"obj.term.termId":return this.$termOption;case"obj.term.term.name":return this.$termName;case"obj.sectionNumber":return this.$sectionNumber}},e.prototype.renderForm=function(){return this.renderCourseForm(),this.renderTermForm()},e.prototype.renderCourseForm=function(){switch(this.$courseOption.val()){case"NEW":return this.renderNewCourseForm();default:return this.renderExistingCourseForm()}},e.prototype.renderNewCourseForm=function(){return this.$course.html("<input type='hidden' name='type' value='New'> <fieldset data-type='hash' data-name='course'> <input type='hidden' name='courseName' value='"+this.$courseName.val()+"'> <input type='hidden' name='courseIdentifier' value='"+this.$courseIdentifier.val()+"'> </fieldset>")},e.prototype.renderExistingCourseForm=function(){return this.$course.html("<input type='hidden' name='type' value='Existing'> <input type='hidden' name='courseId' value='"+this.$courseOption.val()+"'>")},e.prototype.renderTermForm=function(t){switch(this.$termOption.val()){case"NEW":return this.renderNewTermForm();default:return this.renderExistingTermForm()}},e.prototype.renderNewTermForm=function(){return this.$term.html("<input type='hidden' name='type' value='New'> <fieldset data-type='hash' data-name='term'> <input type='hidden' name='name' value='"+this.$termName.val()+"'> <fieldset data-type='hash' data-name='session'> <input type='hidden' name='startDate' value='"+this.$startDate.val()+"'> <input type='hidden' name='endDate' value='"+this.$endDate.val()+"'> </fieldset> <fieldset data-type='array' data-name='exceptions'></fieldset> </fieldset>")},e.prototype.renderExistingTermForm=function(){return this.$term.html("<input type='hidden' name='type' value='Existing'> <input type='hidden' name='termId' value='"+this.$termOption.val()+"'>")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.csvUploads.CsvUploadItem=function(t){function e(){return this.onProgress=i(this.onProgress,this),this.bodyListeners=i(this.bodyListeners,this),this.onClearSuccess=i(this.onClearSuccess,this),this.onClearClick=i(this.onClearClick,this),this.onDetailsClick=i(this.onDetailsClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.complete=!1,e.prototype.completed=0,e.prototype.initialize=function(t){return this.job=t.job,this.filename=t.filename,this.throttleParams=t.throttleParams,e.__super__.initialize.apply(this,arguments),this.$text=this.$(".csv-filename"),this.$status=this.$(".csv-status"),this.$details=this.$(".csv-details"),this.$progressWrapper=this.$(".progress-bar-wrapper"),this.$progress=this.$(".progress-bar div"),this.$clear=this.$(".csv-clear"),this.$details.on("click",this.onDetailsClick),this.$clear.on("click",this.onClearClick),this.updateDisplay(this.job.completed,this.job.errors,this.job.size),this.totalTime=this.job.size*this.throttleParams.duration/this.throttleParams.limit*1e3*1.2,this.checkForProgress()},e.prototype.checkForProgress=function(){var t,e,i;if(!this.complete)return t=Date.now(),e=new Date(this.job.createdAt).getTime(),Math.abs(t-e)>=this.totalTime&&this.updateFlags(this.job.size,this.job.size),setTimeout((i=this,function(){return i.checkForProgress()}),5e3)},e.prototype.statusText=function(t,e,i){var o;return o=this.i18n("Import.processed",t,i),1<e?o=o+"; "+this.i18n("Import.errorsCount",e):1===e&&(o=o+"; "+this.i18n("Import.errorCount",e)),o},e.prototype.updateDisplay=function(t,e,i){return t=Math.min(t,i),this.$status.text(this.statusText(t,e,i)),this.$progress.width(t/i*100+"%"),this.updateFlags(t,i)},e.prototype.updateFlags=function(t,e){var i;if(this.completed=t,this.complete=e<=t,i=this.i18n(this.complete?"Labels.importOfFileCompleted":"Labels.importing",this.filename),this.$text.html(i),this.$details.toggle(this.complete),this.$clear.toggle(this.complete),this.complete)return this.$progressWrapper.remove()},e.prototype.onDetailsClick=function(){return this.injectFromUrl(Echo.routes.BatchProcessingJobs.getOne(this.job.jobId))},e.prototype.onClearClick=function(){return Echo.routes.BatchProcessingJobs.clear(this.job.jobId).ajax({success:this.onClearSuccess,error:this.onError})},e.prototype.onClearSuccess=function(){return this.$el.addClass("toBeDeleted").trigger("CsvUpload.removed"),this.dispose()},e.prototype.bodyListeners=function(){var t;return(t={})["CsvUpload."+this.options.job.jobId+".updateProgress"]=this.onProgress,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onProgress=function(t,e){var i;if(!(this.complete||e.completed<this.completed))return i=Math.min(e.completed,e.size),this.updateDisplay(i,e.errors,e.size)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,o=[].slice;Echo.widgets.csvUploads.CsvUploadManager=function(t){function e(){return this.onCsvUploadsFetchError=i(this.onCsvUploadsFetchError,this),this.onCsvUploadsFetchSuccess=i(this.onCsvUploadsFetchSuccess,this),this.onCsvItemRemoved=i(this.onCsvItemRemoved,this),this.onMessage=i(this.onMessage,this),this.onImported=i(this.onImported,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.csvItemTemplate='<div class="csv-upload-item" id="<%=id%>">\n  <div class="csv-main">\n    <div class="csv-filename"></div>\n    <div class="progress-bar-wrapper">\n      <div class="progress-bar"><div></div></div>\n    </div>\n  </div>\n    <div class="csv-actions">\n    <div class="csv-count">\n      <span class="csv-status"></span>\n    </div>\n    <a class="csv-details"><%=details%></a>\n    <div class="csv-clear"></div>\n  </div>\n</div>',e.prototype.initialize=function(t){return this.institutionId=t.institutionId,this.userId=t.userId,this.batchProcessingJobType=t.batchProcessingJobType,this.throttleParams=t.throttleParams,this.$body.on("ImportModal."+this.batchProcessingJobType+".imported",this.onImported),this.$el.on("CsvUpload.removed",this.onCsvItemRemoved),this.subscribeTo("admin-"+this.institutionId,this.onMessage),this.fetchCsvItems()},e.prototype.onImported=function(){var t;return arguments[0],t=2<=arguments.length?o.call(arguments,1):[],this.renderItems(t)},e.prototype.onMessage=function(t){if("batchJobStatus"===t.messageType&&t.userId===this.userId)return this.$el.trigger("CsvUpload."+t.jobId+".updateProgress",t)},e.prototype.onCsvItemRemoved=function(){return this.updateCsvDisplay()},e.prototype.fetchCsvItems=function(){return Echo.routes.BatchProcessingJobs.getForUser().ajax({data:{jobType:this.batchProcessingJobType},success:this.onCsvUploadsFetchSuccess,error:this.onCsvUploadsFetchError})},e.prototype.onCsvUploadsFetchSuccess=function(t){return this.$el.empty(),this.renderItems(t.data)},e.prototype.updateCsvDisplay=function(){var t,e,i;return t=0<(e=this.$el.find(".csv-upload-item:not(.toBeDeleted)").length)?"show":"hide",this.$el[t](),setTimeout((i=this,function(){return i.$el.trigger("CsvUploadManager.updateDisplay",{count:e})}),1)},e.prototype.onCsvUploadsFetchError=function(){return this.updateCsvDisplay()},e.prototype.renderItems=function(t){var e,i,o;for(e=0,o=t.length;e<o;e++)i=t[e],this.renderItem(i);return this.updateCsvDisplay()},e.prototype.renderItem=function(t){var e;return e=Echo.core.helpers.uuid(),this.template=_.template(this.csvItemTemplate),this.$el.append(this.template(_.extend(t,{id:e,details:this.i18n("Labels.details")}))),new Echo.widgets.csvUploads.CsvUploadItem({el:"#"+e,job:t,filename:t.filename,throttleParams:this.throttleParams})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.csvUploads.ImportModal=function(t){function e(){return this.onError=i(this.onError,this),this.onSuccess=i(this.onSuccess,this),this.onFilepickerSuccess=i(this.onFilepickerSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$el.on("FileStack.success",this.onFilepickerSuccess)},e.prototype.onFilepickerSuccess=function(t,e){return this.$el.trigger("Modal.uploadCsv.close"),e={url:e.fileBlob.s3Url,filename:e.fileBlob.filename,uploadType:$("[name=uploadType]").val()},$.ajax({contentType:"application/json",data:JSON.stringify(e),type:"POST",url:"/data_import/test",success:this.onSuccess,error:this.onError})},e.prototype.onSuccess=function(t){return this.$el.trigger("ImportModal.uploadCsv.imported",t.data)},e.prototype.onError=function(t,e,i){var o,n,s,r;return o=null!=(s=null!=(n=Echo.core.form.getErrorJSON(t))&&null!=(r=n["obj."][0])?r.msg:void 0)?s:this.i18n("Alert.genericError"),alertify.alert(o)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.departments.AddDepartmentModal=function(t){function i(){var t,e;return this.onAddAjaxSuccess=(t=this.onAddAjaxSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("AjaxForm.addDepartment.success",this.onAddAjaxSuccess)},i.prototype.onAddAjaxSuccess=function(t,e){return this.$el.trigger("Department.created",e),alertify.success(this.i18n("Admin.organizations.createDepartment.success")),this.$el.trigger("Modal.addDepartment.close")},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.departments.EditDepartmentModal=function(t){function i(){var t,e;return this.onEditAjaxSuccess=(t=this.onEditAjaxSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("AjaxForm.editDepartment.success",this.onEditAjaxSuccess)},i.prototype.onEditAjaxSuccess=function(t,e){return alertify.success(this.i18n("Admin.organizations.editDepartment.success")),this.$el.trigger("Department.edited",e),this.$el.trigger("Modal.editDepartment.close")},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.lessonContent.Engagement=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.LessonContent),e.prototype.initialize=function(){return this.lessonRoute=Echo.routes.SectionAnalytics.lessonEngagement,this.sectionRoute=Echo.routes.SectionAnalytics.sectionEngagement,e.__super__.initialize.apply(this,arguments)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.lessonContent.Polling=function(t){function e(){return this.onLessonChangeError=i(this.onLessonChangeError,this),this.onLessonChangeSuccess=i(this.onLessonChangeSuccess,this),this.onLessonChange=i(this.onLessonChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.sectionId=t.sectionId,this.lessonRoute=Echo.routes.SectionAnalytics.lessonActivity,this.$body.on("LessonSelect.change",this.onLessonChange)},e.prototype.onLessonChange=function(t,e){var i,o;if(void 0!==(i=e.lessonId))return this.loadingOn(),this.ajax(this.route(i),{success:(o=this,function(t){return o.onLessonChangeSuccess(t,i)}),error:this.onLessonChangeError})},e.prototype.onLessonChangeSuccess=function(t,e){return this.$el.html(t).trigger("LessonContent.updated",e)},e.prototype.onLessonChangeError=function(t){return this.loadingOff()},e.prototype.route=function(t){return this.lessonRoute(this.sectionId,t)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.lessonContent.StudyGuide=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.LessonContent),e.prototype.initialize=function(){return this.lessonRoute=Echo.routes.StudyGuide.getLessonView,this.sectionRoute=Echo.routes.StudyGuide.getSectionView,e.__super__.initialize.apply(this,arguments)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.BaseStage=function(t){function e(){return this.onDestroy=i(this.onDestroy,this),this.onFullScreenChange=i(this.onFullScreenChange,this),this.toggleFullScreen=i(this.toggleFullScreen,this),this.restoreCaptionsPosition=i(this.restoreCaptionsPosition,this),this.hideControls=i(this.hideControls,this),this.showControls=i(this.showControls,this),this.flashControls=i(this.flashControls,this),this._onMouseOver=i(this._onMouseOver,this),this._onMouseMove=i(this._onMouseMove,this),this.onClick=i(this.onClick,this),this.onFocusOut=i(this.onFocusOut,this),this.onFocusIn=i(this.onFocusIn,this),this.onResize=i(this.onResize,this),this.resize=i(this.resize,this),this.onBodyFocusIn=i(this.onBodyFocusIn,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.THUMBS_WIDTH=180,e.prototype.THUMBS_HEIGHT=135,e.prototype.THUMBS_RIGHT_MARGIN=20,e.prototype.THUMBS_TOP_MARGIN=15,e.prototype.THUMBS_INNER_MARGIN=15,e.prototype.MAX_CONTROLS_HEIGHT=200,e.prototype.FADEOUT_DELAY=2e3,e.prototype.TRANSITION_DURATION=200,e.prototype.TRANSITION_SHOW=200,e.prototype.TRANSITION_HIDE=400,e.prototype.audioCount=0,e.prototype.videoCount=0,e.prototype.deckCount=0,e.prototype.mousePos={x:0,y:0},e.prototype.initialize=function(t){var e,i;if(this.mediaType=t.mediaType,this.$classroomHeader=this.$(".classroom-header"),this.$classroomActions=this.$(".classroom-actions"),this.$videoControls=this.$(".videoControls"),this.$videoControlsFullScreenBtn=this.$videoControls.find(".video-fullscreen-btn"),this.$videoCaptions=this.$(".video-captions"),this.$deckControls=this.$(".slideDeckControls"),"classroom"===this.mode&&(this.$bottomControls=$('<div class="bottom-controls">'),this.$bottomControls.append(this.$videoCaptions,this.$deckControls,this.$videoControls),this.$el.append(this.$bottomControls)),this.$screenEls=this.$("> .media.video , > .media.slideDeck , > .media.audio"),this.findMediaEls(),this.videoCount+this.deckCount===0&&(this.$el.trigger("Classroom.questions.toggle"),this.moveCaptions()),0!==this.screens.length)return this.$doc.on("fullscreenchange",this.onFullScreenChange),this.$body.on("Stage.destroy",this.onDestroy).on("focusin",this.onBodyFocusIn),this.$el.on("click",this.onClick).on("focusin",this.onFocusIn).on("focusout",this.onFocusOut).on("mouseover",this._onMouseOver).on("mousemove",this._onMouseMove).on("resize",this.onResize).on("Stage.toggleFullScreen",this.toggleFullScreen),e=_.findWhere(this.screens,{primary:!0}),this.TRANSITION_DURATION=0,i=null!=e?e.id:this.screens[0].id,this.refocus(i)},e.prototype.onBodyFocusIn=function(t){var e;if($(document.activeElement).hasClass("media")&&(null===t.relatedTarget||"HTML"===(e=t.relatedTarget.tagName)||"BODY"===e))return this.handleFocus(t)},e.prototype.handleFocus=function(t){if(t.preventDefault(),this.showControls(),!$(document.activeElement).hasClass("touch"))return this.$(".classroom-nav-btn").focus()},e.prototype.findMediaEls=function(){return this.screens=_.map(this.$screenEls,(s=this,function(e){var i,t,o,n;switch(e=$(e),i=e.attr("id"),o=function(t){return s.refocus(i)},n=function(t,e){return s.updateDimensions(i,e),s.resize()},t=function(t){switch(t.which){case s.KEYS.ENTER:case s.KEYS.SPACE_BAR:return t.stopPropagation(),e.click()}},"classroom"===s.mode&&e.on("click.Classroom.refocus",o),e.on("Stage.media.updateDimensions",n),e.on("keypress",t),e.data("mediatype")){case"video":case"audio":return s.processMediaEl(e);case"slideDeck":return s.processSlideDeckEl(e)}}));var s},e.prototype.numVideos=function(){return _.filter(this.screens,function(t){return"video"===t.$el.data("mediatype")}).length},e.prototype.processMediaEl=function(t){return"video"===t.attr("data-mediatype")?this.videoCount++:this.audioCount++,{id:t.attr("id"),mediaType:t.attr("data-mediatype"),primary:t.data("primary"),aspectRatio:t.data("aspectratio"),$el:t}},e.prototype.processSlideDeckEl=function(t){return this.deckCount++,{id:t.attr("id"),mediaType:"slideDeck",primary:!1,aspectRatio:1.333,$el:t}},e.prototype.updateDimensions=function(t,e){var i;if(null!=(i=_.findWhere(this.screens,{id:t}))&&null!=e)return i.width=e.width,i.height=e.height,i.aspectRatio=e.width/e.height,i.id===this.focused?this.resize():void 0},e.prototype.refocus=function(t){var e;if(null!=(e=this.screenById(t))&&this.focused!==t)return this.focused=t,this.$screenEls.removeClass("active"),e.$el.addClass("active"),this.resize(),this.$el.trigger("Stage.refocus",{type:e.mediaType}),window.isMobile&&"video"===e.$el.data("mediatype")&&this.$screenEls.trigger("Video.reset"),this.$screenEls.trigger("Stage.refocused",t)},e.prototype.resize=function(){return null!=this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.render,10)},e.prototype.onResize=function(t){if($(t.target).hasClass("stage"))return this.resize()},e.prototype.onFocusIn=function(t){return clearTimeout(this.hideTimeout),this.showControls()},e.prototype.onFocusOut=function(){return this.flashControls()},e.prototype.onClick=function(){return this.flashControls()},e.prototype._onMouseMove=function(t){var e,i;if(!this.mouseOver)return e=t.clientX,i=t.clientY,this.mousePos.x===e&&this.mousePos.y===i||this.flashControls(),this.mousePos={x:e,y:i};this.mouseOver=!1},e.prototype._onMouseOver=function(){return this.mouseOver=!0},e.prototype.flashControls=function(){return clearTimeout(this.hideTimeout),this.showControls(),this.hideTimeout=setTimeout(this.hideControls,this.FADEOUT_DELAY)},e.prototype.showControls=function(){return this.$el.removeClass("hideCursor"),this.fullScreen||(this.$classroomHeader.clearQueue().show(),this.$classroomActions.clearQueue().show()),this.$videoControls.clearQueue().show(),"slideDeck"===this.screenByFocus().mediaType&&this.$deckControls.clearQueue().show(),this.moveCaptions()},e.prototype.hideControls=function(t){if(null==t&&(t=this.TRANSITION_HIDE),!(0<this.$("ul.classroomDropdown-menu:visible").length))return this.$el.addClass("hideCursor"),this.$classroomHeader.clearQueue().fadeOut(t),this.$classroomActions.clearQueue().fadeOut(t),this.$videoControls.clearQueue().fadeOut(t),this.$deckControls.clearQueue().fadeOut(t),this.captionsTimeout=setTimeout(this.restoreCaptionsPosition,t);this.flashControls()},e.prototype.resetControls=function(){return this.hideControls(0),this.showControls()},e.prototype.moveCaptions=function(){return null!=this.captionsTimeout&&clearTimeout(this.captionsTimeout),this.$videoCaptions.addClass("pull-top")},e.prototype.restoreCaptionsPosition=function(){return this.$videoCaptions.removeClass("pull-top")},e.prototype.screenById=function(t){return _.findWhere(this.screens,{id:t})},e.prototype.screenByFocus=function(){return _.findWhere(this.screens,{id:this.focused})},e.prototype.getTotalAspectRatio=function(){var t;return t=function(t,e){return t+e.aspectRatio},_.reduce(this.screens,t,0)},e.prototype.getTitle=function(t,e){return e?this.getMainTitle(t):"slideDeck"===t.data("mediatype")?this.i18n("Classroom.screen.presentationPreview"):t.data("primary")?this.i18n("Classroom.screen.displayPreview"):1<this.numVideos()?this.i18n("Classroom.screen.instructorVideoFeedPreview"):this.i18n("Classroom.screen.videoPreview")},e.prototype.getMainTitle=function(t){return"slideDeck"===t.data("mediatype")?this.i18n("Classroom.screen.presentationMainView"):t.data("primary")?this.i18n("Classroom.screen.displayMainView"):1<this.numVideos()?this.i18n("Classroom.screen.instructorVideoFeedMainView"):this.i18n("Classroom.screen.videoMainView")},e.prototype.toggleFullScreen=function(){return this.$el.toggleFullScreen()},e.prototype.onFullScreenChange=function(){return this.fullScreen=this.$el.fullScreen(),this.resetControls(),this.resize()},e.prototype.onDestroy=function(){var t,e,i,o;for(t=0,e=(i=this.$("video")).length;t<e;t++)(o=i[t]).pause(),o.src="";return this.dispose()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.ClassroomStage=function(t){function e(){return this.onTimelineDisplay=i(this.onTimelineDisplay,this),this.onNoteContentRefNavigate=i(this.onNoteContentRefNavigate,this),this.onJumpToSlide=i(this.onJumpToSlide,this),this.onJumpToTime=i(this.onJumpToTime,this),this.onRenderThumbnails=i(this.onRenderThumbnails,this),this.render=i(this.render,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.media.BaseStage),e.prototype.mode="classroom",e.prototype.initialize=function(t){return this.focus=t.focus,e.__super__.initialize.apply(this,arguments),this.$displayTime=this.$(".display-time"),this.$body.on("Stage.videoPlayer.jumpToTime",this.onJumpToTime).on("Stage.slideDeck.jumpToSlide",this.onJumpToSlide).on("ContentRef.navigate",this.onNoteContentRefNavigate).on("LivePlayer.resume",this.onRenderThumbnails).on("LivePlayer.pause",this.onRenderThumbnails).on("Timeline.display",this.onTimelineDisplay),this.focusScreen()},e.prototype.render=function(){var t,e,i,o,n,s,r,a,h,l;return n=this.$el.width(),o=this.$el.height(),i=this.screenByFocus(),h=(s=Echo.helpers.Layout.fitDimensions(i.aspectRatio,n,o,i.width,i.height))[0],t=s[1],e=0,Echo.helpers.Layout.isHeightLimiting(i,n,o)&&(e=(n-h)/2),i.$el.attr("aria-label",this.getTitle(i.$el,!0)).clearQueue().animate({top:0,left:e,width:h,height:t},this.TRANSITION_DURATION),i.$el.hasClass("liveplayer")&&i.$el.find("iframe").height(t).width(h),r=_.filter(this.screens,(l=this,function(t){return t.id!==l.focused})),this.fullScreen?(_.each(r,function(t){return t.$el.hide()}),a=!1):(a=!0,this.renderThumbnails(r)),this.renderControls(a),this.resetControls(),setTimeout(this.flashControls,1e3)},e.prototype.focusScreen=function(){var t;return t=this.$("> .media.video"),"Presentation"===this.focus||0===t.length?this.$("> .media.slideDeck").trigger("click"):t.filter("[data-primary=true]").trigger("click")},e.prototype.renderThumbnails=function(t){var r,a,h,l,c;return a=this.$el.height(),h=this.$el.width(),r=(l=0)<this.$el.find(".liveplayer.active.playing").length?50:20,_.each(t,(c=this,function(t,e){var i,o,n,s;return s=(o=Echo.helpers.Layout.fitDimensions(t.aspectRatio,c.THUMBS_WIDTH,c.THUMBS_HEIGHT,t.width,t.height))[0],i=o[1],t.$el.hasClass("liveplayer")&&(n=t.$el.find(".live-control"),t.$el.hasClass("playing")?(s<n.width()&&(s=n.width()),t.$el.find("iframe").height(i).width(s),i+=n.height()):t.$el.hasClass("started")?(s=n.width(),i=n.height()):(s=140,i=130,t.$el.find("iframe").height(i).width(s))),t.$el.attr("aria-label",c.getTitle(t.$el,!1)).clearQueue().show().animate({top:a-l-i-r,left:h-s-c.THUMBS_RIGHT_MARGIN,width:s,height:i},100),l+=i+c.THUMBS_INNER_MARGIN}))},e.prototype.renderControls=function(t){var e;if(0===this.deckCount||"slideDeck"!==this.screenByFocus().mediaType?this.$videoControlsFullScreenBtn.trigger("enable"):this.$videoControlsFullScreenBtn.trigger("disable"),1<this.screens.length)return e=20,t&&(e+=this.THUMBS_WIDTH+20),this.$bottomControls.css({right:e+"px"})},e.prototype.onRenderThumbnails=function(t){var e,i;return e=_.filter(this.screens,(i=this,function(t){return t.id!==i.focused})),this.renderThumbnails(e)},e.prototype.onJumpToTime=function(t,e){return this.jumpToTime(e)},e.prototype.onJumpToSlide=function(t,e){return this.jumpToSlide(e)},e.prototype.jumpToTime=function(t){return this.$el.trigger("VideoPlayer."+t.videoId+".seekToTime",{time:t.timestamp,videoId:t.videoId})},e.prototype.jumpToSlide=function(t){return this.$el.trigger("SlideDeck."+t.slideDeckId+".goToSlide",{slideId:t.slideId,focus:!0})},e.prototype.onNoteContentRefNavigate=function(t,e){if(null!=e.videoId&&this.jumpToTime(e),null!=e.slideDeckId&&null!=e.slideId)return this.jumpToSlide(e)},e.prototype.onTimelineDisplay=function(t,e){var i,o;return o=e.text,null!=(i=this.$displayTime)?i.text(o):void 0},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.DownloadModal=function(t){function e(){return this.onClick=i(this.onClick,this),this.updateLink=i(this.updateLink,this),this.onSourceChange=i(this.onSourceChange,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.currSource=t.currSource,this.namespace=t.namespace,this.downloadBtn=this.$("a.downloadBtn"),this.downloadBtn.on("click",this.onClick),this.$el.on("DownloadModal.sourceChange",this.onSourceChange),this.$el.on("change","select",this.updateLink),this.$screenOptions=this.$(".screenOption"),this.$downloadOptions=this.$(".downloadOption"),this.onSourceChange(null,this.currSource),this.updateLink()},e.prototype.onSourceChange=function(t,e){return this.currSource=e,this.$downloadOptions.hide(),this.$(".downloadOption[data-source='"+e+"']").show(),this.$screenOptions.removeClass("active"),this.$(".screenOption[data-source='"+e+"']").addClass("active"),this.updateLink()},e.prototype.updateLink=function(){var t,e,i,o,n;return o=(i=null!=(e=this.$("select[name='"+this.currSource+"-files']").val())?e.split(" || "):void 0)[0],i[1],t=i[2],n=Echo.routes.MediaDownload.downloadFile(o,t).url,this.downloadBtn.attr("href",n)},e.prototype.onClick=function(){return this.$el.trigger("Modal."+this.namespace+".close")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.ImportFromLibraryModalContent=function(t){function e(){return this.onSearchChange=i(this.onSearchChange,this),this.selectItem=i(this.selectItem,this),this.onCreateBtnClick=i(this.onCreateBtnClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$mediaList=this.$(".mediaList:not(.header)"),this.$mediaList.find("li.mediaList-item").on("click",this.selectItem),this.$emptyMessage=this.$(".emptyMessage"),this.$search=this.$(".search input"),this.$search.on("change input",this.onSearchChange),this.$createBtn=this.$(".creation-submit-btn"),this.$createBtn.on("click",this.onCreateBtnClick),this.$createBtn.trigger("disable")},e.prototype.onCreateBtnClick=function(t){return t.stopPropagation(),this.$createBtn.trigger("disable"),this.$el.trigger("ImportFromLibrary.mediaSelected",this.$mediaList.find("li.selected").data("id")),this.$el.trigger("Modal.close")},e.prototype.selectItem=function(t){if(!$(t.target).closest("li").hasClass("selected"))return this.$mediaList.find("li").removeClass("selected"),$(t.target).closest("li").addClass("selected"),this.$(".creation-submit-btn").trigger("enable")},e.prototype.onSearchChange=function(t){var e,i,o,n,s;for(n=this.$search.val().toLowerCase(),this.$emptyMessage.hide(),e=0,o=(s=this.$mediaList.find("li.mediaList-item")).length;e<o;e++)i=s[e],$(i).toggle(0<=$(i).data("searchable").indexOf(n));if(0===this.$mediaList.find("li.mediaList-item:visible").length)return this.$emptyMessage.show()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.InfoEditorModal=function(t){function e(){return this.onModalClose=i(this.onModalClose,this),this.onSubmitError=i(this.onSubmitError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onSubmit=i(this.onSubmit,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.namespace=t.namespace,this.$name=this.$el.find("input[name=name]"),this.$description=this.$el.find("textarea[name=description]"),this.$tags=this.$el.find("input[name=tags]"),this.$el.on("AjaxForm."+this.namespace+".success",this.onSubmitSuccess).on("AjaxForm."+this.namespace+".error",this.onSubmitError).on("Modal.close",this.onModalClose).on("submit",this.onSubmit)},e.prototype.onSubmit=function(){var t;return t={name:this.$name.val(),description:this.$description.val(),tags:""!==this.$tags.val()?this.$tags.val().split(/,/):[]},this.$el.trigger("AjaxForm.submitWithData",t)},e.prototype.onSubmitSuccess=function(t,e){var i;return alertify.success(this.i18n("Media.edit.success")),this.$el.trigger("Media."+this.mediaId+".edited",{id:this.mediaId,updatedMedia:e.updatedMedia}),(null!=(i=e.updatedMedia)?i.captureOccurrenceId:void 0)&&this.$el.trigger("CaptureItem."+e.updatedMedia.captureOccurrenceId+".updated",e.updatedMedia),this.$el.trigger("Modal."+this.namespace+".close")},e.prototype.onSubmitError=function(){return alertify.error(this.i18n("Media.error.editError"))},e.prototype.onModalClose=function(t){return t.stopPropagation(),this.$el.trigger("Modal."+this.namespace+".close")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.InstructorPublishModal=function(t){function e(){return this.onLessonChange=i(this.onLessonChange,this),this.onSubmitError=i(this.onSubmitError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.submit=i(this.submit,this),this.onSubmit=i(this.onSubmit,this),this.onPublishTypeChange=i(this.onPublishTypeChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.mediaType=t.mediaType,this.namespace=t.namespace,this.availability={},this.existingLesson={},this.deletionDate=null,this.$availabilityDate=this.$("input[name=availabilityDate]"),this.$availabilityType=this.$("input[name=availabilityType]"),this.$deletionDate=this.$("input[name=deletionDate]"),this.$deletionType=this.$("input[name=deletionType]"),this.$newLesson=this.$("input[name=lessonType][value=new]"),this.$newLessonInfo=this.$("textarea[name=info]"),this.$section=this.$("select[name=section]"),this.$el.on("MediaPublisher.publishType.change",this.onPublishTypeChange).on("MediaPublisher.lesson.change",this.onLessonChange).on("AjaxForm."+this.namespace+".success",this.onSubmitSuccess).on("AjaxForm."+this.namespace+".error",this.onSubmitError).on("submit",this.onSubmit)},e.prototype.onPublishTypeChange=function(t){var e;return e=function(){switch($(t.target).val()){case"person":return Echo.routes.Publish.publishToPeople(this.mediaId).url;case"new":return Echo.routes.Publish.publishToNewLesson(this.mediaId).url;default:return Echo.routes.Publish.publishToLesson(this.mediaId).url}}.call(this),this.$el.trigger("AjaxForm."+this.namespace+".changeAction",{method:"POST",url:e})},e.prototype.getAvailability=function(){var t,e;return e=this.$availabilityType.filter(":checked").val(),t=function(){switch(e){case"Immediate":return Echo.core.helpers.getISODateStringFromDate(new Date);default:return this.$availabilityDate.val()}}.call(this),this.availability={type:"Immediate"===e?"Concrete":e,body:"Unavailable"===e?{}:{date:t}}},e.prototype.getDeletionDate=function(){var t;return t=this.$deletionType.filter(":checked").val(),function(){switch(t){case"Never":return this.$deletionDate.val(null),null;default:return this.$deletionDate.val()}}.call(this)},e.prototype.onSubmit=function(){var t;return this.lessonHasMedia()?(t=function(){switch(this.mediaType){case"VideoPresentation":return"Media.publish.warning.lessonHasVideo";case"SlideDeckInfo":return"Media.publish.warning.lessonHasPresentation"}}.call(this),this.confirm(t,this.submit)):this.submit()},e.prototype.submit=function(){var t,e;if(t={sectionId:this.$section.val(),availability:this.getAvailability(),deletionDate:this.getDeletionDate()},this.$newLesson.is(":checked")){if(!this.isValidLessonData())return;(e={lesson:{timing:this.$("input[name=timing]").val()}}).lesson.timingInfo=this.getTimingInfo(e.lesson.timingInfo),e.lesson.info=function(){switch(this.$newLessonInfo.val()){case"":return null;default:return this.$newLessonInfo.val()}}.call(this),e.lesson.name=function(){switch(this.$("input[name=name]").val().trim()){case"":return null;default:return this.$("input[name=name]").val()}}.call(this),t=$.extend(t,e)}return this.$el.trigger("AjaxForm.submitWithData",t)},e.prototype.isValidLessonData=function(){return Echo.core.ValidationHelpers.validatePublishModal(this.$("input[name=date]").val(),this.$("input[name=durationMilliseconds]").val(),this.$('input[name="startTimeHours"]').val(),this.$('input[name="startTimeMinutes"]').val(),this.$("input[name=name]").val())},e.prototype.getTimingInfo=function(t){return null===(t={date:this.$("input[name=date]").val()?this.$("input[name=date]").val():null,startTimeIso8601:this.$("input[name=startTimeIso8601]").val()?this.$("input[name=startTimeIso8601]").val():null,durationMilliseconds:this.$("input[name=durationMilliseconds]").val()?parseInt(this.$("input[name=durationMilliseconds]").val(),10):null}).date&&null===t.startTimeIso8601&&null===t.durationMilliseconds?null:t},e.prototype.onSubmitSuccess=function(t,e){return alertify.success(e.message),e.hasOwnProperty("warning")&&alertify.error(e.warning),e.hasOwnProperty("lessonId")&&this.$el.trigger("Lesson."+e.lessonId+".mediaPublished"),this.$el.trigger("Media."+this.mediaId+".published",{html:e.html}).trigger("Modal."+this.namespace+".close")},e.prototype.onSubmitError=function(t,e){return""===this.$section.val()?this.$section.trigger("Input.setError",this.i18n("Media.publish.error.forgotSection")):null!=e&&"string"==typeof e?alertify.error(this.i18n(e)):void 0},e.prototype.onLessonChange=function(t,e){return this.existingLesson=e},e.prototype.lessonHasMedia=function(){var t,e;switch(this.mediaType){case"VideoPresentation":return null!=(null!=(t=this.existingLesson)?t.video:void 0);case"SlideDeckInfo":return null!=(null!=(e=this.existingLesson)?e.slideDeck:void 0)}},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.PreviewModal=function(t){function e(){return this.onKeyUp=i(this.onKeyUp,this),this.close=i(this.close,this),this.onOpen=i(this.onOpen,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.namespace=t.namespace,this.playerId=t.playerId,this.$info=this.$(".media-info"),this.$publishing=this.$(".media-publishes"),this.$backdrop=this.$(".stage-backdrop"),this.$close=this.$(".close"),this.$stage=this.$(".stage"),this.$close.on("click",this.close),this.$body.on("Modal."+this.namespace+".onOpen",this.onOpen),this.$body.on("keyup",this.onKeyUp)},e.prototype.onOpen=function(){return this.$el.addClass("open")},e.prototype.close=function(){return"undefined"!=typeof ReactDOM&&null!==ReactDOM&&ReactDOM.unmountComponentAtNode(this.$el.find("#"+this.playerId).get(0)),this.$body.trigger("Stage.destroy"),this.$body.trigger("Modal."+this.namespace+".close")},e.prototype.onKeyUp=function(t){if(t.keyCode===this.KEYS.ESC)return this.close()},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.media.PreviewStage=function(t){function i(){var t,e;return this.render=(t=this.render,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.media.BaseStage),i.prototype.mode="preview",i.prototype.render=function(){var t,e,i,o,n,s,r,a;switch(n=this.$el.width(),o=this.$el.height(),t=this.getTotalAspectRatio(),a=(s=Echo.helpers.Layout.fitDimensions(t,n,o))[0],e=s[1],i=0,t<n/o&&(i=(n-a)/2),r=Math.max(o-e-60,0)/2,this.mediaType){case"slideDeck":return this.resizeSlideDeck(a,e,r,i);case"video":return this.resizeVideo(a,e,r,i)}},i.prototype.resizeSlideDeck=function(t,e,i,o){return this.$screenEls.clearQueue().animate({top:i,right:"auto",bottom:0,left:o,width:t,height:e},this.TRANSITION_DURATION)},i.prototype.resizeVideo=function(t,e,i,o){var n,s,r,a,h,l;for(a=[],n=0,s=(r=this.screens).length;n<s;n++)l=e*(h=r[n]).aspectRatio,h.$el.clearQueue().animate({top:i,right:"auto",bottom:"auto",left:o,width:l,height:e},this.TRANSITION_DURATION),a.push(o+=l);return a},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.PublishedOptionsModal=function(t){function e(){return this.onModalClose=i(this.onModalClose,this),this.onSubmitError=i(this.onSubmitError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onSubmit=i(this.onSubmit,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.lessonId=t.lessonId,this.namespace=t.namespace,this.availability={},this.deletionDate=null,this.$availabilityType=this.$el.find("input[name=availabilityType]"),this.$availabilityDate=this.$el.find("input[name=availabilityDate]"),this.$deletionType=this.$el.find("input[name=deletionType]"),this.$deletionDate=this.$el.find("input[name=deletionDate]"),this.$el.on("AjaxForm."+this.namespace+".success",this.onSubmitSuccess).on("AjaxForm."+this.namespace+".error",this.onSubmitError).on("Modal.close",this.onModalClose).on("submit",this.onSubmit)},e.prototype.getAvailability=function(){var t,e;return e=this.$availabilityType.filter(":checked").val(),t=function(){switch(e){case"Immediate":return Echo.core.helpers.getISODateStringFromDate(new Date);default:return this.$availabilityDate.val()}}.call(this),this.availability={type:"Immediate"===e?"Concrete":e,body:"Unavailable"===e?{}:{date:t}}},e.prototype.getDeletionDate=function(){var t;return t=this.$deletionType.filter(":checked").val(),function(){switch(t){case"Never":return this.$deletionDate.val(null),null;default:return this.$deletionDate.val()}}.call(this)},e.prototype.onSubmit=function(){var t;return t={availability:this.getAvailability(),deletionDate:this.getDeletionDate()},this.$el.trigger("AjaxForm.submitWithData",t)},e.prototype.onSubmitSuccess=function(t,e){return alertify.success(e.message),this.$el.trigger("Media."+this.mediaId+".lesson."+this.lessonId+".republished",e).trigger("Media."+this.mediaId+".republished",e).trigger("Modal."+this.namespace+".close")},e.prototype.onSubmitError=function(){return alertify.error(this.i18n("Media.publish.error.publishOptionsError"))},e.prototype.onModalClose=function(t){return t.stopPropagation(),this.$el.trigger("Modal."+this.namespace+".close")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.PublisherAvailabilityOptions=function(t){function e(){return this.reset=i(this.reset,this),this.onLocationChange=i(this.onLocationChange,this),this.onDeletionTypeChange=i(this.onDeletionTypeChange,this),this.onAvailabilityTypeChange=i(this.onAvailabilityTypeChange,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$availabilityType=this.$("input[name=availabilityType]"),this.$availabilityDate=this.$(".availabilityDate"),this.$deletionType=this.$("input[name=deletionType]"),this.$deletionTypeNever=this.$("input[value=Never]"),this.$deletionDate=this.$(".deletionDate"),this.$unavailableOptions=this.$(".unavailableOptions"),this.$el.on("reset",this.reset),this.$availabilityType.on("change",this.onAvailabilityTypeChange).trigger("change"),this.$deletionType.on("change",this.onDeletionTypeChange).trigger("change"),this.$body.on("MediaPublisher.changeLocation",this.onLocationChange)},e.prototype.onAvailabilityTypeChange=function(){switch(this.enableOptions(this.$unavailableOptions),this.$availabilityType.filter(":checked").val()){case"Concrete":return this.$availabilityDate.show();case"Unavailable":return this.$deletionTypeNever.prop("checked",!0),this.disableOptions(this.$unavailableOptions),this.$availabilityDate.hide();default:return this.$availabilityDate.hide()}},e.prototype.onDeletionTypeChange=function(){switch(this.$deletionType.filter(":checked").val()){case"Concrete":return this.$deletionDate.show();default:return this.$deletionDate.hide()}},e.prototype.onLocationChange=function(t,e){switch(e.locationType){case"person":return this.disableOptions(this.$el);default:return this.enableOptions(this.$el)}},e.prototype.reset=function(){return this.$availabilityType.filter("[value=Immediate]").prop("checked",!0),this.$deletionTypeNever.prop("checked",!0),this.$availabilityDate.hide(),this.$deletionDate.hide()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.PublisherLessonOptions=function(t){function e(){return this.reset=i(this.reset,this),this.onLessonChange=i(this.onLessonChange,this),this.onTypeChange=i(this.onTypeChange,this),this.getLessonOptionsError=i(this.getLessonOptionsError,this),this.getLessonOptionsSuccess=i(this.getLessonOptionsSuccess,this),this.onSectionChange=i(this.onSectionChange,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.existingLessons={},e.prototype.preventChange=!1,e.prototype.initialize=function(){return this.$lessonType=this.$("input[name=lessonType]"),this.$lesson=this.$("select[name=lessonId]"),this.$existingLessonDiv=this.$(".existingLesson"),this.$existingLessonSelect=this.$(".existingLesson select"),this.$newLessonDiv=this.$(".lessonInputs"),this.$lessonType.on("change",this.onTypeChange),this.$existingLessonSelect.on("change",this.onLessonChange),this.$body.on("MediaPublisher.changeSection",this.onSectionChange),this.$el.on("reset",this.reset),this.showExistingOptions()},e.prototype.onSectionChange=function(t,e){return 0===e.sectionId.length?this.hide():(this.$el.show(),this.sectionId!==e.sectionId?(this.sectionId=e.sectionId,this.updateLessons()):void 0)},e.prototype.updateLessons=function(){return Echo.routes.Publish.lessonOptions(this.sectionId).ajax({contentType:"application/json",type:"GET",success:this.getLessonOptionsSuccess,error:this.getLessonOptionsError})},e.prototype.getLessonOptionsSuccess=function(t){var e,i,o,n;for(e=0,i=(n=t.data[0].existingLessons).length;e<i;e++)o=n[e],this.existingLessons[o.id]={slideDeck:o.slideDeck,video:o.video};return this.preventChange||this.$lesson.trigger("change"),this.$lesson.trigger("Select.updateOptions",{options:t.data[0].html})},e.prototype.getLessonOptionsError=function(){return alertify.error(this.i18n("Media.publish.error.getLessonsError"))},e.prototype.onTypeChange=function(){return"existing"===this.$lessonType.filter(":checked").val()?this.showExistingOptions():this.showNewForm()},e.prototype.showExistingOptions=function(){return this.$newLessonDiv.hide(),this.$existingLessonDiv.show(),this.enableLessonNameInput(!1)},e.prototype.showNewForm=function(){return this.$existingLessonDiv.hide(),this.$newLessonDiv.show(),this.enableLessonNameInput(!0)},e.prototype.onLessonChange=function(){var t;if(!this.preventChange)return t=this.$existingLessonSelect.val(),this.$el.trigger("MediaPublisher.lesson.change",this.existingLessons[t])},e.prototype.hide=function(){return this.$el.hide()},e.prototype.enableLessonNameInput=function(t){return this.$(".lesson-name").trigger(t?"enable":"disable")},e.prototype.reset=function(){return this.showExistingOptions(),this.$lessonType.filter('[value="existing"]').prop("checked",!0),this.$lesson.val("").trigger("change")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.PublisherLocationOptions=function(t){function e(){return this.reset=i(this.reset,this),this.onSectionInput=i(this.onSectionInput,this),this.onTypeChange=i(this.onTypeChange,this),this.onSectionFilterUpdateSuccess=i(this.onSectionFilterUpdateSuccess,this),this.onSectionFilterUpdateError=i(this.onSectionFilterUpdateError,this),this.onCourseChange=i(this.onCourseChange,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$publishType=this.$("input[name=publishType]"),this.$section=this.$("select[name=section]"),this.$email=this.$("input[name=email]"),this.$course=this.$("select[name=course]"),this.$sectionDiv=this.$(".section-group"),this.$emailDiv=this.$(".emailInput"),this.$publishType.on("change",this.onTypeChange),this.$section.on("change",this.onSectionInput),this.$course.on("change",this.onCourseChange),this.$el.on("reset",this.reset),this.showSectionSelect()},e.prototype.onCourseChange=function(){var t;if(t=this.$course.val())return Echo.routes.Sections.getSectionFilterOptions(t).ajax({success:this.onSectionFilterUpdateSuccess,error:this.onSectionFilterUpdateError})},e.prototype.onSectionFilterUpdateError=function(){return this.$section.trigger("Select.updateSelected","").trigger("disable")},e.prototype.onSectionFilterUpdateSuccess=function(t){var e,i;if(null!=(null!=(e=t.data)?e[0]:void 0))return this.$section.trigger("Select.updateOptions",{options:e[0].html,keepEmptyOption:!0,selectFirstOption:!0,maintainSelection:!0}),i=0===e[0].sectionCount?"disable":"enable",this.$section.trigger(i)},e.prototype.onTypeChange=function(){return"section"===this.$publishType.filter(":checked").val()?this.showSectionSelect():this.showEmailInput()},e.prototype.showSectionSelect=function(){return this.$emailDiv.hide(),this.$sectionDiv.show(),this.$el.trigger("MediaPublisher.changeSection",{sectionId:this.$section.val()}).trigger("MediaPublisher.changeLocation",{locationType:"section"})},e.prototype.showEmailInput=function(){return this.$sectionDiv.hide(),this.$emailDiv.show(),this.$el.trigger("MediaPublisher.changeSection",{sectionId:""}).trigger("MediaPublisher.changeLocation",{locationType:"person"})},e.prototype.onSectionInput=function(){return this.$el.trigger("MediaPublisher.changeSection",{sectionId:this.$section.val()})},e.prototype.reset=function(){return this.$publishType.filter('[value="section"]').prop("checked",!0),this.$section.val("").trigger("change"),this.$email.val("").trigger("input"),this.showSectionSelect()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.ShareModal=function(t){function e(){return this.onModalClose=i(this.onModalClose,this),this.onSubmitError=i(this.onSubmitError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.namespace=t.namespace,this.mediaId=t.mediaId,this.$el.on("AjaxForm."+this.namespace+".success",this.onSubmitSuccess).on("AjaxForm."+this.namespace+".error",this.onSubmitError).on("Modal.close",this.onModalClose)},e.prototype.onSubmitSuccess=function(t,e){return alertify.success(e.message),this.$el.trigger("Media."+this.mediaId+".shared").trigger("Modal."+this.namespace+".close")},e.prototype.onSubmitError=function(){return alertify.error(this.i18n("Media.publish.error.sharingError"))},e.prototype.onModalClose=function(t){return t.stopPropagation(),this.$el.trigger("Modal."+this.namespace+".close")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.media.StaticStage=function(t){function i(){var t,e;return this.render=(t=this.render,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.media.BaseStage),i.prototype.mode="preview",i.prototype.render=function(){var t,e,i,o,n,s,r,a;switch(75,60,n=this.$el.width(),o=this.$el.height()-75,t=this.getTotalAspectRatio(),a=(s=Echo.helpers.Layout.fitDimensions(t,n,o))[0],e=s[1],i=0,t<n/o&&(i=(n-a)/2),r=Math.max(o-e-60,0)/2,this.mediaType){case"slideDeck":return this.resizeSlideDeck(a,e,r,i);case"video":return this.resizeVideo(e,r,i)}},i.prototype.resizeSlideDeck=function(t,e,i,o){return this.$screenEls.clearQueue().animate({top:i,right:"auto",bottom:0,left:o,width:t,height:e},this.TRANSITION_DURATION)},i.prototype.resizeVideo=function(t,e,i){var o,n,s,r,a,h;for(this.$videoControls.animate({width:"100%",left:0},this.TRANSITION_DURATION),r=[],o=0,n=(s=this.screens).length;o<n;o++)h=t*(a=s[o]).aspectRatio,a.$el.clearQueue().animate({top:e,right:"auto",bottom:"auto",left:i,width:h,height:t},this.TRANSITION_DURATION),r.push(i+=h);return r},i.prototype.hideControls=function(){},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.media.StudentPublishModal=function(t){function i(){var t,e;return this.onAjaxSuccess=(t=this.onAjaxSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.$el.on("AjaxForm.success",this.onAjaxSuccess),this.$el.on("AjaxForm.error",this.onAjaxError)},i.prototype.onAjaxSuccess=function(t,e){return alertify.success(e.message),this.$el.trigger("Media."+this.mediaId+".published",{html:e.html}).trigger("Modal.close")},i.prototype.onAjaxError=function(t){var e;if(null!=(null!=(e=null!=t?t.responseJSON:void 0)?e.message:void 0))return alertify.alert(e.message)},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.media.VideoEditorStage=function(t){function i(){var t,e;return this.render=(t=this.render,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.media.BaseStage),i.prototype.mode="editor",i.prototype.videoPadding=15,i.prototype.render=function(){var t,e,i,o,n,s,r;return this.$el.css({height:"auto",bottom:0}),n=this.$el.width(),1<this.screens.length&&(n-=this.videoPadding),o=this.$el.height(),t=this.getTotalAspectRatio(),r=(s=Echo.helpers.Layout.fitDimensions(t,n,o))[0],e=s[1],i=0,t<n/o&&(i=(n-r)/2),i+=2*this.videoPadding,this.resizeVideo(r,e,2*this.videoPadding,i),this.$el.height(e)},i.prototype.resizeVideo=function(t,e,i,o){var n,s,r,a,h,l;for(a=[],n=0,s=(r=this.screens).length;n<s;n++)l=e*(h=r[n]).aspectRatio,h.$el.clearQueue().animate({top:i,right:"auto",bottom:"auto",left:o,width:l,height:e},this.TRANSITION_DURATION),a.push(o+=l+this.videoPadding);return a},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.notes.BaseNotebook=function(t){function e(){return this.onSetInactiveNote=i(this.onSetInactiveNote,this),this.onSetActiveNote=i(this.onSetActiveNote,this),this.onNotebookClick=i(this.onNotebookClick,this),this.onNewNote=i(this.onNewNote,this),this.onUpdateSlides=i(this.onUpdateSlides,this),this.onSlideUpdate=i(this.onSlideUpdate,this),this.onTimeUpdate=i(this.onTimeUpdate,this),this.onToggle=i(this.onToggle,this),this._onDeleteBookmark=i(this._onDeleteBookmark,this),this.onDeleteBookmark=i(this.onDeleteBookmark,this),this.newBookmark=i(this.newBookmark,this),this.addNote=i(this.addNote,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.currentVideoTime=null,this.currentSlideId=this.config.startSlide,this.activeNote=null,this.$notesListContent=this.$(".notes-list-content"),this.$el.on("click",this.onNotebookClick).on("Notebook.newNote",this.onNewNote).on("Notebook.setActiveNote",this.onSetActiveNote).on("Notebook.setInActiveNote",this.onSetInActiveNote),this.$body.on("Notebook.notes.toggle",this.onToggle),null!=this.config.videoId&&this.$body.on("Video.mediaEvent.timeUpdate."+this.config.lessonId,this.onTimeUpdate),null!=this.config.slideDeckId&&this.$body.on("SlideDeck."+this.config.slideDeckId+".navigate",this.onSlideUpdate),null!=this.config.slideDeckId&&this.$body.on("SlideDeck."+this.config.slideDeckId+".updateSlides",this.onUpdateSlides),this.render()},e.prototype.render=function(){var n,s;if(this.$notesListContent.empty(),n=null,n=function(){var t,e,i,o;for(o=[],t=0,e=(i=this.notes).length;t<e;t++)s=i[t],o.push(this.addNote(s,n));return o}.call(this),null!=this.startNote)return window.location.hash=this.startNote},e.prototype.addNote=function(t,e,i,o,n,s){var r,a,h,l,c,u,p;return null==e&&(e=null),null==i&&(i=!0),null==o&&(o=0),null==s&&(s=!1),r=null==e?0:(null!=e?e.getPosition():void 0)+1,p={config:this.config,note:t.note,position:r,prev:e,next:null!=e?e.next:void 0,bookmarkType:n,slideDeckId:this.config.slideDeckId,videoId:this.config.videoId,showUnavailableBookmarks:this.showUnavailableBookmarks,editing:this.editing},c={ref:t.videoContentRef,timestamp:this.currentVideoTime},l={ref:t.slideContentRef,slideId:this.currentSlideId},null!=n?("video-ref"===n&&(p.videoRef=c),"slide-ref"===n&&(p.slideRef=l)):(s&&!this.config.videoAvailable||(p.videoRef=c),s&&!this.config.slideDeckAvailable||(p.slideRef=l)),null!=(a=(u=new Echo.widgets.notes.NoteView(p)).next)&&(a.prev=u),null!=(h=u.prev)&&(h.next=u),(null!=e?e.$el.is(":visible"):void 0)?null!=e&&e.$el.after(u.$el):this.$notesListContent.append(u.$el),i&&u.focusDown(o),u},e.prototype.newNote=function(t,e,i,o){var n;return null==t&&(t=""),null==e&&(e=null),null==i&&(i=!0),null==o&&(o=0),n={note:{lessonId:this.config.lessonId,publishableMediaId:this.config.publishableMediaId,text:t,bookmark:!1}},this.addNote(n,e,i,o,null,!0)},e.prototype.newBookmark=function(t,e){var i;return i={note:{lessonId:this.config.lessonId,publishableMediaId:this.config.publishableMediaId,text:"bookmark",bookmark:!0}},this.activeNote=this.addNote(i,this.activeNote,!0,0,e,!0)},e.prototype.onDeleteBookmark=function(t,e){return this.$el.trigger("Bookmark.delete",e)},e.prototype._onDeleteBookmark=function(t){return this.$el.trigger("Bookmark.delete",t)},e.prototype.onToggle=function(){if(0===this.$notesListContent.find(".note").length)return this.newNote("",null,!1)},e.prototype.onTimeUpdate=function(t,e){return this.currentVideoTime=e.currentTime},e.prototype.onSlideUpdate=function(t,e){return this.currentSlideId=e.slideId},e.prototype.onUpdateSlides=function(t,e){var i,o;return o=e.slideIds,i=e.currentSlide,this.currentSlideId=o[i]},e.prototype.onNewNote=function(t,e){return this.newNote(e.text,e.relativeNote,e.focus,e.focusOffset)},e.prototype.onNotebookClick=function(t){var e;if(!(0<$(t.target).closest(".note").length))return 0===(e=this.$notesListContent.find(".note")).length||e.last().hasClass("bookmark")?this.newNote():e.last().trigger("Note.focus")},e.prototype.onSetActiveNote=function(t,e){return this.activeNote=e},e.prototype.onSetInactiveNote=function(){return this.activeNote=null},e.prototype.notesListHasNotes=function(){var t;return 1<=this.$notesListContent.length&&0<(null!=(t=this.$notesListContent.children().first().attr("id"))?t.length:void 0)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.notes.ClassroomNotebook=function(t){function e(){return this.onRequestSlideId=i(this.onRequestSlideId,this),this.onDeleteBookmark=i(this.onDeleteBookmark,this),this.onBookmarkSlide=i(this.onBookmarkSlide,this),this.onBookmarkVideo=i(this.onBookmarkVideo,this),this.onNoteSaved=i(this.onNoteSaved,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.notes.BaseNotebook),e.prototype.initialize=function(t){return this.notes=t.notes,this.config=t.config,this.startNote=t.startNote,this.showUnavailableBookmarks=!1,this.editing=!0,this.$el.on("Note.saved",this.onNoteSaved),this.$body.on("Notebook.bookmarkSlide",this.onBookmarkSlide).on("Notebook.bookmarkVideo",this.onBookmarkVideo).on("Notebook.deleteBookmark",this.onDeleteBookmark),this.request("slideId",this.onRequestSlideId),e.__super__.initialize.apply(this,arguments)},e.prototype.onNoteSaved=function(t,e){if(null!=(null!=e?e.bookmarkType:void 0)&&!this.$el.is(":visible"))return function(){switch(e.bookmarkType){case"slide-ref":return alertify.success(this.i18n("Notifications.slideBookmarked"));case"video-ref":return alertify.success(this.i18n("Notifications.videoBookmarked"))}}.call(this)},e.prototype.onBookmarkVideo=function(){return this.newBookmark(null,"video-ref")},e.prototype.onBookmarkSlide=function(){return this.newBookmark(null,"slide-ref")},e.prototype.onDeleteBookmark=function(t,e){return this._onDeleteBookmark(e)},e.prototype.onRequestSlideId=function(t){return this.$el.trigger("StudentBookmark.manualSlideUpdate",t)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.notes.ContentRef=function(t){function e(){return this.onValidated=i(this.onValidated,this),this.createDropdown=i(this.createDropdown,this),this.onUpdateError=i(this.onUpdateError,this),this.onUpdateSuccess=i(this.onUpdateSuccess,this),this.update=i(this.update,this),this.onNoteDeleted=i(this.onNoteDeleted,this),this.selectElementContents=i(this.selectElementContents,this),this.stopEditing=i(this.stopEditing,this),this.onDeleteOptionClick=i(this.onDeleteOptionClick,this),this.onEditOptionClick=i(this.onEditOptionClick,this),this.hidePopover=i(this.hidePopover,this),this.showPopover=i(this.showPopover,this),this.onEditingActive=i(this.onEditingActive,this),this.onStopEditing=i(this.onStopEditing,this),this.onCreateBtnClick=i(this.onCreateBtnClick,this),this.onPopoverClick=i(this.onPopoverClick,this),this.onEditorKeyUp=i(this.onEditorKeyUp,this),this.onEditorKeyDown=i(this.onEditorKeyDown,this),this.onEditorBlur=i(this.onEditorBlur,this),this.onEditorClick=i(this.onEditorClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){var t;return this.editable=!0,this.editing=!1,this.preventMouseover=!1,this.template=_.template($(".content-ref-template").html()),this.$el.append(this.template({refType:this.refType,contentUnavailable:this.contentUnavailable})),this.$val=this.$(".ref-value"),this.$editor=this.$(".editor"),this.$popover=this.$(".popover"),this.$createBtn=this.$(".ref-create"),this.contentUnavailable||this.setupEventListeners(),null!=(null!=(t=this.ref)?t.ref:void 0)?(this.setVal(),this.triggerContentRefUpdated()):this.contentUnavailable||this.showCreateButton(),null!=this.noteId?(this.$el.show(),this.setRoutes()):this.$el.hide(),this.contentUnavailable||this.createDropdown(),this.updateReferenceEditableState(this.readOnly),this.updateTooltip()},e.prototype.updateTooltip=function(){var t,e;return t="slide-ref"===this.refType?this.i18n("Labels.presentation"):this.i18n("Labels.video"),e=this.isBookmarkUnavailable()&&this.hasOtherAvailableContent()?this.i18n("Errors.noLongerAvailable",t.toLowerCase()):"",this.$val.attr("data-tooltip",e)},e.prototype.setupEventListeners=function(){return this.$createBtn.on("click",this.onCreateBtnClick),this.$el.on("mouseenter",this.showPopover).on("validate",this.onValidate).on("validated",this.onValidated),this.$popover.on("mouseleave",this.hidePopover).on("click",this.onPopoverClick),this.$editor.on("click",this.onEditorClick).on("blur",this.onEditorBlur).on("keydown",this.onEditorKeyDown).on("keyup",this.onEditorKeyUp),this.$body.on("ContentRef.editingActive",this.onEditingActive).on("ContentRef.stopEditing",this.onStopEditing)},e.prototype.onEditorClick=function(t){if("true"===this.$editor.attr("contenteditable"))return t.stopPropagation()},e.prototype.onEditorBlur=function(t){return t.stopPropagation(),this.$editor.html(Echo.core.helpers.stripHtml(this.$editor.html())),this.editing?this.revert():this.$el.trigger("validate",this.$editor.html())},e.prototype.onEditorKeyDown=function(t){if(t.keyCode===this.KEYS.ENTER)return t.preventDefault()},e.prototype.onEditorKeyUp=function(t){switch(t.keyCode){case this.KEYS.ESC:return this.editing=!1,this.hidePopover(),this.revert();case this.KEYS.ENTER:return t.preventDefault(),t.stopPropagation(),this.$editor.html(Echo.core.helpers.stripHtml(this.$editor.html())),this.editing=!1,this.$editor.trigger("blur")}},e.prototype.onPopoverClick=function(t){return t.stopPropagation(),this.$el.trigger("ContentRef.navigate",this.getReference(Echo.core.helpers.stripHtml(this.$editor.html()))),this.showPopover(t)},e.prototype.onCreateBtnClick=function(t){return t.stopPropagation(),this.hidePopover(t),this.hideCreateButton(),this.update(this.setVal())},e.prototype.onStopEditing=function(){return this.preventMouseover=!1,this.stopEditing()},e.prototype.onEditingActive=function(){if(!this.editing)return this.preventMouseover=!0},e.prototype.showPopover=function(t){if(!this.editing&&!this.preventMouseover&&this.editable)return t.stopPropagation(),this.$el.trigger("ContentRef.stopEditing"),this.$body.on("click",this.hidePopover),this.$popover.addClass("show")},e.prototype.hidePopover=function(t){if(null==t&&(t=null),!this.editing)return null!=t&&t.stopPropagation(),this.$el.trigger("ContentRef.stopEditing"),this.$body.off("click",this.hidePopover),this.$(".dropdown").trigger("Dropdown.close")},e.prototype.onEditOptionClick=function(){return this.$popover.addClass("editing"),this.$editor.attr("contenteditable",!0),this.$editor.caret(-1),this.selectElementContents(this.$editor.get(0)),this.$el.find("a.dropdown-toggle").removeClass("open").addClass("close"),this.editing=!0,this.$el.trigger("ContentRef.editingActive")},e.prototype.onDeleteOptionClick=function(){return this.hidePopover(),this.showCreateButton(),this.ajax(this.deleteRefRoute,this.noteId),this.triggerContentRefDeleted()},e.prototype.stopEditing=function(){return this.$popover.removeClass("show editing"),this.$editor.attr("contenteditable",!1),this.$el.find("a.dropdown-toggle").removeClass("close open"),this.editing=!1},e.prototype.showCreateButton=function(){return this.$val.hide(),this.$popover.removeClass("show"),this.$createBtn.show(),this.editable=!1},e.prototype.hideCreateButton=function(){return this.$val.show(),this.$createBtn.hide(),this.editable=!0},e.prototype.selectElementContents=function(t){var e,i;return document.body.createTextRange?((e=document.body.createTextRange()).moveToElementText(t),e.select()):window.getSelection?(i=window.getSelection(),(e=document.createRange()).selectNodeContents(t),i.removeAllRanges(),i.addRange(e)):void 0},e.prototype.onNoteSaved=function(t,e){return null!=e&&e!==this.refType||this.hideCreateButton(),this.setVal(),this.noteId=t,this.setRoutes(),this.$el.show(),this.triggerContentRefUpdated()},e.prototype.onNoteDeleted=function(t){if(t===this.noteId)return this.triggerContentRefDeleted(),this.dispose()},e.prototype.update=function(t){if(!this.submitting)return this.submitting=!0,this.ajax(this.updateRefRoute,{data:this.giftWrap($.trim(t)),success:this.onUpdateSuccess,error:this.onUpdateError})},e.prototype.onUpdateSuccess=function(t){var e,i;return e=t.data,this.submitting=!1,this.ref=null!=(i=this.ref)?i:{},this.ref.ref=e[0],this.updateTooltip(),this.triggerContentRefUpdated()},e.prototype.onUpdateError=function(){return alertify.error(this.i18n("Notes.error.updateContentRefError"))},e.prototype.setVal=function(){var t;return t=this.getRefVal(),this.$val.html(t),this.$editor.html(t),t},e.prototype.isEditing=function(){if(this.$popover.hasClass("editing"))return!0},e.prototype.createDropdown=function(){var t,e,i;return(i=this.$popover.find(".ref-dropdown")).append($(".notes .content-ref-dropdown").html()),t=i.find(".dropdown"),i.find('script[type="text/javascript"]').remove(),t.attr("id",Echo.core.helpers.uuid),Echo.core.helpers.replaceIds(t),this.dropdown=new Echo.widgets.Dropdown({id:"#"+t.attr("id"),el:t}),(e=t.find(".dropdown-menu li a")).filter(".edit").on("click",this.onEditOptionClick),e.filter(".delete").on("click",this.onDeleteOptionClick),t.find("a.dropdown-toggle").on("click",this.onDropdownToggleClick)},e.prototype.onDropdownToggleClick=function(){return $(this).hasClass("close")?$(this).toggleClass("close").trigger("ContentRef.stopEditing"):$(this).toggleClass("open")},e.prototype.revert=function(){return this.$editor.html(this.$val.html())},e.prototype.onValidated=function(t,e){return e.valid?(this.stopEditing(),this.$val.html(e.val),this.update(e.val)):(this.editing=!0,this.$editor.caret(-1))},e.prototype.triggerContentRefUpdated=function(){return this.$el.trigger("Note.contentReferenceUpdated",this.getReference(Echo.core.helpers.stripHtml(this.$val.html())))},e.prototype.triggerContentRefDeleted=function(){var t,e;return null!=(e=this.ref)&&delete e.ref,this.updateTooltip(),t=this.$val.html(),this.$val.html(""),this.$el.trigger("Note.contentReferenceDeleted",this.getReference(Echo.core.helpers.stripHtml(t)))},e.prototype.updateReferenceEditableState=function(t){return t||this.contentUnavailable?(this.editable=!1,this.$createBtn.hide()):""===this.$val.html()?(this.$createBtn.show(),this.editable=!1):(this.editable=!0,this.$createBtn.hide())},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.notes.NoteText=function(t){function e(){return this.onDeleteError=i(this.onDeleteError,this),this._delete=i(this._delete,this),this._update=i(this._update,this),this.createError=i(this.createError,this),this.createSuccess=i(this.createSuccess,this),this.postAjax=i(this.postAjax,this),this.onClick=i(this.onClick,this),this.onKeyup=i(this.onKeyup,this),this.onKeyDown=i(this.onKeyDown,this),this.onInput=i(this.onInput,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.config=t.config,this.note=t.note,this.prev=t.prev,this.position=t.position,this.videoRefView=t.videoRefView,this.slideRefView=t.slideRefView,this.bookmarkType=t.bookmarkType,this.readOnly=t.readOnly,this.xhr=null,this.submitting=!1,this.deleting=!1,this.dirty=!1,this.$note=this.$el.parents(".note"),this.note.bookmark?(null==this.note.id&&this.create(),void this.$note.find(".bookmark-delete").on("click",this._delete)):(this.$textarea=this.$("textarea"),this.$textareaMirror=this.$(".textarea-mirror"),this.$textarea.on("keydown",this.onKeyDown).on("keyup",this.onKeyup).on("input",this.onInput).on("click",this.onClick),this.updateTextArea(this.readOnly),this.$textarea.trigger("input"))},e.prototype.updateTextArea=function(t){var e;return null!=(e=this.$textarea)?e.prop("readonly",t):void 0},e.prototype.focusUp=function(t){null==t&&(t=0);try{return this.$textarea.focus().caret(this.getLength()-t)}catch(t){return t,!1}},e.prototype.focusDown=function(t){null==t&&(t=0);try{return this.$textarea.focus().caret(t)}catch(t){return t,!1}},e.prototype.getPosition=function(){var t;return-1===(t=this.$note.parent().find(".note").index(this.$note))?this.position:t},e.prototype.isCaretAtFront=function(){return 0===this.$textarea.caret()},e.prototype.isCaretAtEnd=function(){return this.$textarea.caret()>=this.getLength()},e.prototype.isTextHighlighted=function(){var t;return"number"==typeof(t=this.$textarea.get(0)).selectionStart?t.selectionStart!==t.selectionEnd:null!=document.selection?(this.$textarea.focus(),-1!==this.$textarea.val().search(document.selection.createRange().text)):void 0},e.prototype.value=function(){var t;return null!=(t=this.$textarea)?t.val():void 0},e.prototype.getLength=function(){var t;return null!=(t=this.value())?t.length:void 0},e.prototype.isEmpty=function(){return 0===this.getLength()},e.prototype.hasTrailingNewline=function(){var t;if(null!=(t=this.value()))return"\n"===t[t.length-1]},e.prototype.splitText=function(t){var e;return[(e=this.value()).substring(0,t),e.substring(t)]},e.prototype.setText=function(t){return this.$textarea.val(t).trigger("input")},e.prototype.append=function(t){var e;return e=this.value(),this.setText(e+t),this.$textarea.focus().caret(e.length)},e.prototype.padBottom=function(){var t;if(!this.note.bookmark)return t=this.$textarea.val(),this.setText(t+"\n")},e.prototype.unpadBottom=function(){return this.setText(this.value().replace(/\n$/,""))},e.prototype.onInput=function(){var t,e,i,o,n,s;return s=this.value(),2<this.$textarea.caret()&&(e=s.match(/\n[ ]*?\S/))?(i=(o=this.splitText(e.index+1))[0],n=o[1],i=i.replace(/\n[ ]*?$/,""),this.setText(i),this.$el.trigger("Note.newNote",{text:n,focus:!0,focusOffset:1})):(t=this.encodeHTML(s).replace(/\n/g,"<br/>").replace(/\s/g,"&nbsp;"),this.$textareaMirror.html(t+"<br/>"),null!=this.note.id?this.update():this.create())},e.prototype.onKeyDown=function(t){switch(t.which){case this.KEYS.ENTER:return this.onEnterKey(t);case this.KEYS.BACKSPACE:return this.onBackspaceKey(t);case this.KEYS.ARROW_LEFT:case this.KEYS.ARROW_UP:return this.onNavigateUp(t);case this.KEYS.ARROW_RIGHT:case this.KEYS.ARROW_DOWN:return this.onNavigateDown(t)}},e.prototype.onKeyup=function(t){if(t.which===this.KEYS.BACKSPACE)return this.isEmpty()?this.onBackspaceKey(t):void 0},e.prototype.onClick=function(){return this.$el.trigger("Note.activeNote")},e.prototype.onEnterKey=function(t){if(!t.shiftKey)return this.isEmpty()?this.onEmptyEntryKey(t):this.onNonEmptyEnterKey(t)},e.prototype.onEmptyEntryKey=function(t){var e;return t.preventDefault(),null!=(e=this.prev)?e.padBottom():void 0},e.prototype.onNonEmptyEnterKey=function(t){var e,i,o,n;if(!this.isCaretAtEnd()){if(this.isCaretAtFront())return t.preventDefault(),void(null!=(i=this.prev)&&i.padBottom());if(e=(o=this.splitText(this.$textarea.caret()))[0],n=o[1],"\n"!==e[e.length-1]||"\n"!==n[0])return t.preventDefault(),this.setText(e),this.$el.trigger("Note.newNote",{text:n,focus:!0,focusOffset:0})}},e.prototype.onBackspaceKey=function(t){var e;if(!this.isTextHighlighted()&&this.isCaretAtFront())return t.preventDefault(),this.isEmpty()?this._delete():(null!=(e=this.prev)?e.hasTrailingNewline():void 0)?this.prev.unpadBottom():null!=this.prev?(this.prev.append(this.value()),this._delete()):void 0},e.prototype.onNavigateUp=function(t){if(this.isCaretAtFront())return t.preventDefault(),this.$el.trigger("Note.pushUp")},e.prototype.onNavigateDown=function(t){if(this.isCaretAtEnd())return t.preventDefault(),this.$el.trigger("Note.pushDown")},e.prototype.validate=function(){return!(!this.note.bookmark&&""===this.$textarea.val())},e.prototype.giftWrapText=function(){return this.note.bookmark?"bookmark":this.$textarea.val()},e.prototype.giftWrapCreate=function(){var t,e,i;return t={lessonId:this.note.lessonId,publishableMediaId:this.note.publishableMediaId,num:this.getPosition(),text:this.giftWrapText(),bookmark:this.note.bookmark},null!=this.bookmarkType&&"slide-ref"!==this.bookmarkType||!this.config.slideDeckAvailable||$.extend(t,{slideRef:null!=(e=this.slideRefView)?e.giftWrap():void 0}),null!=this.bookmarkType&&"video-ref"!==this.bookmarkType||!this.config.videoAvailable||$.extend(t,{videoRef:null!=(i=this.videoRefView)?i.giftWrap():void 0}),t},e.prototype.giftWrapUpdate=function(){return{text:this.giftWrapText(),bookmark:this.note.bookmark}},e.prototype.postAjax=function(){return this.submitting=!1,this.xhr=null},e.prototype.create=function(){if(!this.submitting&&this.validate())return this.submitting=!0,this.xhr=this.ajax(Echo.routes.Notes.create(),{data:this.giftWrapCreate(),success:this.createSuccess,error:this.createError})},e.prototype.createSuccess=function(t){if(this.postAjax(),null!=t.data)return this.note=t.data[0],this.$el.trigger("Note.saved",{noteId:this.note.id,bookmarkType:this.bookmarkType})},e.prototype.createError=function(t){return this.postAjax(),alertify.alert(this.i18n("Notes.error.createNoteError"))},e.prototype.update=function(){return clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(this._update,300)},e.prototype._update=function(){var e;if(!this.submitting&&this.validate())return this.submitting=!0,this.xhr=this.ajax(Echo.routes.Notes.update(this.note.id),{data:this.giftWrapUpdate(),success:this.postAjax,error:(e=this,function(t){return e.postAjax(),alertify.alert(e.i18n("Notes.error.updateNoteError"))})})},e.prototype._delete=function(t){var e;if(null!=t&&"function"==typeof t.preventDefault&&t.preventDefault(),null!=t&&"function"==typeof t.stopPropagation&&t.stopPropagation(),!this.deleting)return null!=(e=this.xhr)&&e.abort(),(null!=t?t.silent:void 0)||this.$el.trigger("Note.deleted",{noteId:this.note.id}),this.submitting=!0,this.deleting=!0,null!=this.note.id?Echo.routes.Notes.delete(this.note.id).ajax({error:this.onDeleteError}):void 0},e.prototype.onDeleteError=function(){return this.postAjax(),this.deleting=!1,alertify.error(this.i18n("Notes.error.deleteNoteError"))},e}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.notes.NoteView=function(t){function i(){return this.setActiveNote=e(this.setActiveNote,this),this.dispose=e(this.dispose,this),this.onNewNote=e(this.onNewNote,this),this.onNoteDeleted=e(this.onNoteDeleted,this),this.onNoteSaved=e(this.onNoteSaved,this),this.focusDown=e(this.focusDown,this),this.focusUp=e(this.focusUp,this),this.focus=e(this.focus,this),this.pushDown=e(this.pushDown,this),this.pushUp=e(this.pushUp,this),this.onBookmarkDelete=e(this.onBookmarkDelete,this),this.onClick=e(this.onClick,this),this.updateRefSeparatorDisplay=e(this.updateRefSeparatorDisplay,this),this.onNotebookEditMode=e(this.onNotebookEditMode,this),this.onNotebookViewMode=e(this.onNotebookViewMode,this),this.onNoteContentRefDeleted=e(this.onNoteContentRefDeleted,this),this.onNoteContentRefUpdated=e(this.onNoteContentRefUpdated,this),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){return this.config=t.config,this.note=t.note,this.position=t.position,this.prev=t.prev,this.next=t.next,this.bookmarkType=t.bookmarkType,this.videoRef=t.videoRef,this.slideRef=t.slideRef,this.slideDeckId=t.slideDeckId,this.videoId=t.videoId,this.showUnavailableBookmarks=t.showUnavailableBookmarks,this.editing=t.editing,this.noteTmpl=_.template($(".note-template").html()),this.bookmarkTmpl=_.template($(".bookmark-note-template").html()),this.render()},i.prototype.hasAvailableVideo=function(){return null!=this.config.videoId&&this.config.videoAvailable},i.prototype.hasAvailableSlides=function(){return null!=this.config.slideDeckId&&this.config.slideDeckAvailable},i.prototype.hasBookmarks=function(){var t,e;return null!=(null!=(t=this.videoRef)?t.ref:void 0)||null!=(null!=(e=this.slideRef)?e.ref:void 0)},i.prototype.hasAvailableBookmarks=function(){var t,e;return this.hasAvailableVideo()&&null!=(null!=(t=this.videoRef)?t.ref:void 0)||this.hasAvailableSlides()&&null!=(null!=(e=this.slideRef)?e.ref:void 0)},i.prototype.allBookmarksUnavailable=function(){return this.hasBookmarks()&&!this.hasAvailableBookmarks()},i.prototype.constructNote=function(){var t;return t=(this.note.bookmark?this.bookmarkTmpl:this.noteTmpl)({note:this.note,config:this.config}),this.$el=$(t),this.updateTooltip()},i.prototype.addTooltip=function(){return this.$el.addClass("read-only").attr("data-tooltip",this.i18n("Errors.contentUnavailable")).attr("data-tooltip-wrap",!0).attr("data-tooltip-pos","top")},i.prototype.removeTooltip=function(){return this.$el.removeClass("read-only").removeAttr("data-tooltip")},i.prototype.updateTooltip=function(){return this.$el.toggleClass("view",!this.editing),this.allBookmarksUnavailable()&&!this.editing&&this.showUnavailableBookmarks?this.addTooltip():this.showUnavailableBookmarks?this.removeTooltip():this.$el},i.prototype.onNoteContentRefUpdated=function(t,e){var i,o;if("slide-ref"===e.refType?null!=(i=this.slideRef)&&(i.ref=e.ref):"video-ref"===e.refType&&null!=(o=this.videoRef)&&(o.ref=e.ref),this.updateDisplayForEditability(),this.note.bookmark)return this.$body.trigger("Bookmark.withContentRef.updated",e)},i.prototype.onNoteContentRefDeleted=function(t,e){var i,o;if("slide-ref"===e.refType?null!=(i=this.slideRef)&&delete i.ref:"video-ref"===e.refType&&null!=(o=this.videoRef)&&delete o.ref,this.updateDisplayForEditability(),this.note.bookmark)return this.$body.trigger("Bookmark.withContentRef.deleted",e)},i.prototype.render=function(){var t,e;return this.$el=this.constructNote(),this.registerListeners(),this.$refSeparator=this.$el.find(".separator"),null!=this.videoRef&&null!=this.config.videoId&&(this.videoRefView=this.renderVideoRef()),null!=this.slideRef&&null!=this.config.slideDeckId&&(this.slideRefView=this.renderSlideRef()),this.textView=new Echo.widgets.notes.NoteText({el:this.$(".note-content"),config:this.config,note:this.note,position:this.position,videoRefView:this.videoRefView,slideRefView:this.slideRefView,prev:null!=(t=this.prev)?t.textView:void 0,next:null!=(e=this.next)?e.textView:void 0,bookmarkType:this.bookmarkType,readOnly:!this.editing}),this.updateRefSeparatorDisplay()},i.prototype.registerListeners=function(){return this.$el.on("click",this.onClick).on("Note.saved",this.onNoteSaved).on("Note.deleted",this.onNoteDeleted).on("Note.focus",this.focus).on("Note.focusUp",this.focusUp).on("Note.focusDown",this.focusDown).on("Note.newNote",this.onNewNote).on("Note.pushUp",this.pushUp).on("Note.pushDown",this.pushDown).on("Note.activeNote",this.setActiveNote).on("Note.contentReferenceUpdated",this.onNoteContentRefUpdated).on("Note.contentReferenceDeleted",this.onNoteContentRefDeleted),this.$body.on("Notebook.editMode",this.onNotebookEditMode).on("Notebook.viewMode",this.onNotebookViewMode).on("Bookmark.delete",this.onBookmarkDelete)},i.prototype.updateDisplayForEditability=function(){var t,e,i;return this.updateRefSeparatorDisplay(),null!=(t=this.textView)&&t.updateTextArea(!this.editing),null!=(e=this.videoRefView)&&e.updateReferenceEditableState(!this.editing),null!=(i=this.slideRefView)&&i.updateReferenceEditableState(!this.editing),this.updateTooltip()},i.prototype.onNotebookViewMode=function(){return this.editing=!1,this.updateDisplayForEditability()},i.prototype.onNotebookEditMode=function(){return this.editing=!0,this.updateDisplayForEditability()},i.prototype.getPosition=function(){var t;return-1===(t=this.$el.parent().find(".note").index(this.$el))?null:t},i.prototype.renderVideoRef=function(){return new Echo.widgets.notes.VideoRef({el:this.$(".video-reference"),config:this.config,noteId:this.note.id,ref:this.videoRef,readOnly:!this.editing})},i.prototype.renderSlideRef=function(){return new Echo.widgets.notes.SlideRef({el:this.$(".slide-reference"),config:this.config,noteId:this.note.id,ref:this.slideRef,readOnly:!this.editing})},i.prototype.updateRefSeparatorDisplay=function(){var t,e,i,o;return null!=(null!=(t=this.videoRef)?t.ref:void 0)&&null!=(null!=(e=this.slideRef)?e.ref:void 0)?this.$refSeparator.toggle(null!=this.slideDeckId&&null!=this.videoId):this.editing&&(null!=(null!=(i=this.videoRef)?i.ref:void 0)&&this.hasAvailableSlides()||null!=(null!=(o=this.slideRef)?o.ref:void 0)&&this.hasAvailableVideo())?this.$refSeparator.toggle(null!=this.slideDeckId&&null!=this.videoId):this.editing&&this.hasAvailableVideo()&&this.hasAvailableSlides()?this.$refSeparator.toggle(null!=this.slideDeckId&&null!=this.videoId):this.$refSeparator.toggle(!1)},i.prototype.onClick=function(){if(!this.allBookmarksUnavailable()&&!this.editing)return this.$el.trigger("Notebook.selectedNote",{id:this.note.id})},i.prototype.onBookmarkDelete=function(t,e){if(e.noteId===this.note.id)return this.textView._delete()},i.prototype.pushUp=function(){var t;return null!=(t=this.prev)?t.focusUp():void 0},i.prototype.pushDown=function(){var t;return null!=(t=this.next)?t.focusDown():void 0},i.prototype.focus=function(){return this.textView.focusUp()},i.prototype.focusUp=function(t){var e;return null==t&&(t=0),this.note.bookmark?null!=(e=this.prev)?e.focusUp(t):void 0:(this.textView.focusUp(t),this.$el.trigger("Notebook.setActiveNote",this))},i.prototype.focusDown=function(t){var e;return null==t&&(t=0),this.note.bookmark?null!=(e=this.next)?e.focusDown(t):void 0:(this.textView.focusDown(t),this.$el.trigger("Notebook.setActiveNote",this))},i.prototype.passFocus=function(){return null!=this.prev?this.prev.$el.trigger("Note.focusUp"):null!=this.next?this.next.$el.trigger("Note.focusUp"):this.$el.trigger("Notebook.setInActivateNote")},i.prototype.onNoteSaved=function(t,e){var i,o;return this.note.id=e.noteId,this.$el.attr("id",this.note.id),null!=(i=this.videoRefView)&&i.onNoteSaved(e.noteId,this.bookmarkType),null!=(o=this.slideRefView)?o.onNoteSaved(e.noteId,this.bookmarkType):void 0},i.prototype.onNoteDeleted=function(t,e){var i,o;return 0===this.$el.siblings().length?this.$el.trigger("Notebook.newNote",{}):this.passFocus(),null!=(i=this.videoRefView)&&i.onNoteDeleted(e.noteId),null!=(o=this.slideRefView)&&o.onNoteDeleted(e.noteId),this.dispose()},i.prototype.onNewNote=function(t,e){return(e.relativeNote=this).$el.trigger("Notebook.newNote",e)},i.prototype.dispose=function(){var t,e;return null!=(t=this.prev)&&(t.next=this.next),null!=(e=this.next)&&(e.prev=this.prev),i.__super__.dispose.apply(this,arguments)},i.prototype.setActiveNote=function(){return this.$el.trigger("Notebook.setActiveNote",this)},i}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.notes.SlideRef=function(t){function i(){return this.onValidate=e(this.onValidate,this),this.getReference=e(this.getReference,this),this.onSlideDeckUpdate=e(this.onSlideDeckUpdate,this),this.onSlideUpdate=e(this.onSlideUpdate,this),this.getCurrentSlideNumber=e(this.getCurrentSlideNumber,this),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.notes.ContentRef),i.prototype.initialize=function(t){var e;return this.config=t.config,this.noteId=t.noteId,this.ref=t.ref,this.readOnly=t.readOnly,this.currentSlideId=null!=(e=this.ref)?e.slideId:void 0,this.refType="slide-ref",this.contentUnavailable=!this.config.slideDeckAvailable,this.slideIds=this.config.slideIds,null!=this.config.slideDeckId&&(this.$body.on("SlideDeck."+this.config.slideDeckId+".navigate",this.onSlideUpdate),this.$body.on("SlideDeck."+this.config.slideDeckId+".updateSlides",this.onSlideDeckUpdate)),i.__super__.initialize.apply(this,arguments)},i.prototype.isBookmarkUnavailable=function(){var t;return null!=this.config.slideDeckId&&null!=(null!=(t=this.ref)?t.ref:void 0)&&this.contentUnavailable},i.prototype.hasOtherAvailableContent=function(){return null!=this.config.videoId&&this.config.videoAvailable},i.prototype.getSlideNumber=function(t,e){var i;return null==e&&(e=!1),i=(i=this.config.slideIds.indexOf(t))<0?0:i,e?i+1:i},i.prototype.getCurrentSlideNumber=function(t){return null==t&&(t=!1),this.getSlideNumber(this.currentSlideId,t)},i.prototype.getRefVal=function(){var t;return null!=(null!=(t=this.ref)?t.ref:void 0)?this.formatVal(this.getSlideNumber(this.ref.ref.content.slide.slide.id,!0)):this.formatVal(this.getCurrentSlideNumber(!0))},i.prototype.formatVal=function(t){return String(t)},i.prototype.convertToRawVal=function(t){return Number(t)},i.prototype.onSlideUpdate=function(t,e){return this.currentSlideId=e.slideId},i.prototype.onSlideDeckUpdate=function(t,e){var i,o;return o=e.slideIds,i=e.currentSlide,this.config.slideIds=o,this.currentSlideId=o[i],this.setVal()},i.prototype.setRoutes=function(){return this.updateRefRoute=Echo.routes.Notes.updateSlideRef(this.noteId),this.deleteRefRoute=Echo.routes.Notes.deleteSlideRef(this.noteId)},i.prototype.giftWrap=function(t){var e;if(null==t&&(t=null),t=null!=t?this.convertToRawVal(t)-1:this.getCurrentSlideNumber(),null!=(e=this.getCurrentSlideId(t)))return{type:"Slide",slideDeckId:this.config.slideDeckId,slideId:e,slideNum:t}},i.prototype.getCurrentSlideId=function(t){return null!=this.config.slideIds&&0<this.config.slideIds.length?this.config.slideIds[t]:null},i.prototype.getIdFromSlideIds=function(t){return 0===this.config.slideIds.length?0:this.config.slideIds[Number(t)-1]},i.prototype.getReference=function(t){return{noteId:this.noteId,slideDeckId:this.config.slideDeckId,slideId:this.getIdFromSlideIds(t),focus:!0,type:this.refType}},i.prototype.onValidate=function(t,e){var i;return t.stopPropagation(),i=Echo.core.ValidationHelpers.validateSlideReference(e,this.config.slideIds.length),this.$el.trigger("validated",{valid:i,val:e})},i}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.notes.StudyGuideNotebook=function(t){function i(){return this.onNotebookViewMode=e(this.onNotebookViewMode,this),this.onNotesChanged=e(this.onNotesChanged,this),this.onNotebookClick=e(this.onNotebookClick,this),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.notes.BaseNotebook),i.prototype.initialize=function(t){var e;return this.notes=t.notes,this.config=t.config,this.showUnavailableBookmarks=!0,this.editing=!1,this.$notesHeader=this.$(".notes-header"),this.$el.on("Note.saved Note.deleted",this.onNotesChanged).trigger("Notebook.notes.toggle"),this.$body.on("Notebook.editMode",(e=this,function(){return e.editing=!0})).on("Notebook.viewMode",this.onNotebookViewMode),i.__super__.initialize.apply(this,arguments)},i.prototype.onNotebookClick=function(t){if(this.editing)return this.notesListHasNotes()||this.hideNotesHeader(),i.__super__.onNotebookClick.apply(this,arguments)},i.prototype.onNotesChanged=function(){return this.notesListHasNotes()?this.hideNotesHeader():this.$notesHeader.show()},i.prototype.hideNotesHeader=function(){return this.$notesHeader.hide()},i.prototype.onNotebookViewMode=function(){return this.editing=!1,this.onNotesChanged()},i}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.notes.VideoRef=function(t){function i(){return this.onValidate=e(this.onValidate,this),this.getReference=e(this.getReference,this),this.onTimeUpdate=e(this.onTimeUpdate,this),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.notes.ContentRef),i.prototype.initialize=function(t){var e;return this.config=t.config,this.noteId=t.noteId,this.ref=t.ref,this.readOnly=t.readOnly,this.currentVideoTime=null!=(null!=(e=this.ref)?e.timestamp:void 0)?this.ref.timestamp:0,this.refType="video-ref",this.contentUnavailable=!this.config.videoAvailable,null!=this.config.videoId&&this.$body.on("Video.mediaEvent.timeUpdate."+this.config.lessonId,this.onTimeUpdate),i.__super__.initialize.apply(this,arguments)},i.prototype.isBookmarkUnavailable=function(){var t;return null!=this.config.videoId&&null!=(null!=(t=this.ref)?t.ref:void 0)&&this.contentUnavailable},i.prototype.hasOtherAvailableContent=function(){return null!=this.config.slideDeckId&&this.config.slideDeckAvailable},i.prototype.getRefVal=function(){var t,e;return null!=(null!=(t=this.ref)?t.ref:void 0)?this.formatVal(this.ref.ref.content.timestamp):null!=(null!=(e=this.ref)?e.timestamp:void 0)?this.formatVal(this.ref.timestamp):this.formatVal(this.currentVideoTime)},i.prototype.formatVal=function(t){return Echo.core.helpers.msToTime(t,{hideZeroHours:!0})},i.prototype.convertToRawVal=function(t){return Echo.core.helpers.timeToMs(t)},i.prototype.onTimeUpdate=function(t,e){return this.currentVideoTime=e.currentTime},i.prototype.setRoutes=function(){return this.updateRefRoute=Echo.routes.Notes.updateVideoRef(this.noteId),this.deleteRefRoute=Echo.routes.Notes.deleteVideoRef(this.noteId)},i.prototype.giftWrap=function(t){return null==t&&(t=null),t=null!=t?this.convertToRawVal(t):Math.floor(this.currentVideoTime),{type:"Video",videoId:this.config.videoId,timestamp:t}},i.prototype.getReference=function(t){return{noteId:this.noteId,videoId:this.config.videoId,timestamp:this.convertToRawVal(t),type:this.refType}},i.prototype.onValidate=function(t,e){var i;return t.stopPropagation(),i=Echo.core.ValidationHelpers.validateVideoReference(e,this.config.videoDuration),this.$el.trigger("validated",{valid:i,val:e})},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.organizations.AddOrganizationModal=function(t){function i(){var t,e;return this.onAddAjaxSuccess=(t=this.onAddAjaxSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("AjaxForm.addOrganization.success",this.onAddAjaxSuccess)},i.prototype.onAddAjaxSuccess=function(t,e){return this.$el.trigger("Organization.created",e.html),alertify.success(this.i18n("Admin.organizations.createOrganization.success")),this.$el.trigger("Modal.addOrganization.close")},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.organizations.EditOrganizationModal=function(t){function i(){var t,e;return this.onEditAjaxSuccess=(t=this.onEditAjaxSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("AjaxForm.editOrganization.success",this.onEditAjaxSuccess)},i.prototype.onEditAjaxSuccess=function(t,e){return alertify.success(this.i18n("Admin.organizations.editOrganization.success")),this.$el.trigger("Organization.edited",e),this.$el.trigger("Modal.editOrganization.close")},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.pubnub.CapturesSync=function(t){function e(){return this.onCaptureEventError=i(this.onCaptureEventError,this),this.onCaptureEvents=i(this.onCaptureEvents,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.institutionId=t.institutionId,this.subscribeTo(this.institutionId+"-captures",this.onCaptureEvents)},e.prototype.onCaptureEvents=function(e){return this.ajax(Echo.routes.Captures.show(e.captureId),{success:(i=this,function(t){return i.onCaptureEventSuccess(e.captureId,t)}),error:(t=this,function(){return t.onCaptureEventError(e.captureId)})});var t,i},e.prototype.onCaptureEventSuccess=function(t,e){return this.$el.trigger("Capture."+t+".updateCapture",e.data[0])},e.prototype.onCaptureEventError=function(t){return this.sendToAirbrake({captureId:t},"Error fetching capture for pubnub update")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.pubnub.LessonSync=function(t){function i(){var t,e;return this.onMessage=(t=this.onMessage,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(t){if(this.sectionId=t.sectionId,this.lessonId=t.lessonId,this.isStudent=t.isStudent,this.subscribeTo("section-"+this.sectionId,this.onMessage),!this.isStudent)return this.subscribeTo("sectionInstructor-"+this.sectionId,this.onMessage)},i.prototype.broadcast=function(t,e){return this.$body.trigger(t,e)},i.prototype.onMessage=function(t){return"activity"===t.eventType.substring(0,8)?this.onActivityMessage(t):"slide"===t.eventType.substring(0,5)?this.onSlideDeckMessage(t):"student"===t.eventType.substring(0,7)?this.onConfusionHiddenMessage(t):"question"===t.eventType.substring(0,8)?this.$body.trigger("LessonSync.questionEvent",t):void 0},i.prototype.onActivityMessage=function(t){return this.broadcast("Lesson."+this.lessonId+".Activity."+t.activityId+".message",t)},i.prototype.onSlideDeckMessage=function(t){if(this.lessonId===t.lessonId)switch(t.eventType){case"slideHidden":case"slideUnhidden":return this.broadcast("Lesson."+this.lessonId+".SlideDeck."+t.slideDeckId+".slideVisibility",{slideId:t.slideId,isHidden:t.isHidden});case"slidesAdded":case"slidesDeleted":case"slidesReordered":return this.$el.trigger("Classroom.notify",{message:"Notifications."+t.eventType,confirm:!0})}},i.prototype.onConfusionHiddenMessage=function(t){switch(t.mediaType){case"slide":return this.broadcast("Lesson."+this.lessonId+".slideConfusion",t);case"video":return this.broadcast("Lesson."+this.lessonId+".videoConfusion",t)}},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.pubnub.QuestionsSync=function(t){function e(){return this.onQuestionFetchSuccess=i(this.onQuestionFetchSuccess,this),this.onMessage=i(this.onMessage,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.sectionId=t.sectionId,this.lessonId=t.lessonId,this.isClassroom=t.isClassroom,this.isNewClassroom=t.isNewClassroom,null==this.isClassroom&&(this.isClassroom=!1),this.isClassroom&&!this.isNewClassroom?this.$body.on("LessonSync.questionEvent",(i=this,function(t,e){return i.onMessage(e)})):this.subscribeTo("section-"+this.sectionId,this.onMessage);var i},e.prototype.broadcast=function(t,e){return this.$body.trigger(t,e)},e.prototype.onMessage=function(t){if(null==this.lessonId||this.lessonId===t.lessonId)switch(t.commentType){case"question":return this.onQuestionUpdate(t);case"response":return this.onQuestionResponseUpdate(t)}},e.prototype.onQuestionUpdate=function(t){switch(t.eventType){case"questionCreated":case"questionEdited":return this.onNewQuestionUpdate(t.questionId,t.eventType);case"questionDeleted":return this.broadcast("question."+t.questionId+".deleted",t);case"questionStatus":return this.broadcast("question."+t.questionId+".status",t)}},e.prototype.onQuestionResponseUpdate=function(t){switch(t.eventType){case"questionResponseCreated":case"questionResponseEdited":return this.onNewQuestionResponseUpdate(t);case"questionResponseDeleted":return this.broadcast("questionResponse."+t.questionResponseId+".deleted",t);case"questionResponseStatus":return this.broadcast("questionResponse."+t.questionResponseId+".status",t);case"questionResponseEndorsed":return this.broadcast("questionResponse."+t.questionResponseId+".endorsed",t);case"questionResponseUnendorsed":return this.broadcast("questionResponse."+t.questionResponseId+".unendorsed",t)}},e.prototype.onNewQuestionUpdate=function(t,e){return Echo.routes.Questions.getOne().ajax({success:(i=this,function(t){return i.onQuestionFetchSuccess(t,e)}),data:{questionId:t,isClassroom:this.isClassroom||this.isNewClassroom}});var i},e.prototype.onQuestionFetchSuccess=function(t,e){var i;switch(i=t.data,e){case"questionCreated":return this.broadcast("Section."+this.sectionId+".question.created",i[0]);case"questionEdited":return this.broadcast("question."+i[0].id+".edited",i[0])}},e.prototype.onNewQuestionResponseUpdate=function(e){return Echo.routes.QuestionResponses.getOne().ajax({success:(i=this,function(t){return i.onQuestionResponseFetchSuccess(t,e)}),data:{responseId:e.questionResponseId}});var i},e.prototype.onQuestionResponseFetchSuccess=function(t,e){var i;switch(i=t.data,e.eventType){case"questionResponseCreated":return this.broadcast("question."+e.questionId+".newResponse",i[0]);case"questionResponseEdited":return this.broadcast("questionResponse."+e.questionResponseId+".edited",i[0])}},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.questions.Attachments=function(t){function i(){var t,e;return this.onClickImage=(t=this.onClickImage,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$img=this.$("img"),this.$img.on("click",this.onClickImage)},i.prototype.onClickImage=function(t){var e,i;return t.stopPropagation(),(e=$("<img>").addClass("lightbox-image")).on("load",(i=this,function(){return i.$el.trigger("Modal.imageLightBox.replaceContent",e),i.$el.trigger("Modal.imageLightBox.open")})),e.attr("src",this.$img.attr("src"))},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.questions.ContentReferenceEditor=function(t){function e(){return this.render=i(this.render,this),this.reset=i(this.reset,this),this.onSlideDeckNavigate=i(this.onSlideDeckNavigate,this),this.onVideoTimeUpdate=i(this.onVideoTimeUpdate,this),this.onStageRefocus=i(this.onStageRefocus,this),this.onToggle=i(this.onToggle,this),this.onFormError=i(this.onFormError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.isClassroom=t.isClassroom,this.videoId=t.videoId,this.videoDuration=t.videoDuration,this.slideDeckId=t.slideDeckId,this.slideIds=t.slideIds,this.$switch=this.$("[name=contentReference]"),this.$refType=this.$("[name=refType]"),this.$videoTime=this.$("[name=videoTime]"),this.$slideNum=this.$("[name=slideNumber]"),this.$videoTime.on("change",this.render),this.$slideNum.on("change",this.render),this.$slideReferenceWrapper=this.$(".slideReference"),this.$videoReferenceWrapper=this.$(".videoReference"),this.elId=Echo.core.helpers.uuid(),this.$embedContainer=this.$(".embedContainer"),this.$el.on("ContentReferenceEditor.reset",this.reset),this.$switch.on("change",this.onToggle),this.$refType.on("change",this.onToggle),this.$el.closest("form").on("AjaxForm.addQuestion.error",this.onFormError),null==this.slideIds&&(this.slideIds=[]),this.isClassroom&&(this.$body.on("Stage.refocus",this.onStageRefocus),this.$body.on("Video.mediaEvent."+this.videoId+".timeUpdate",this.onVideoTimeUpdate),this.$body.on("SlideDeck."+this.slideDeckId+".navigate",this.onSlideDeckNavigate)),this.reset()},e.prototype.onFormError=function(t,e){var i,o,n,s;if(null!=(null!=e?e.formErrors:void 0)){for(i in s=[],n=e.formErrors)o=n[i],"obj.contentRef.timestamp"===i&&(this.$videoTime.trigger("Input.setError",this.i18n(o[0].msg,o[0].args)),s.push(alertify.error(null!=e?e.error:void 0)));return s}},e.prototype.onToggle=function(){return this.toggleInputs(),this.render()},e.prototype.onStageRefocus=function(t,e){var i;if(i=e.type,this.lastContentType="video"===i?"Video":"Slide",!this.$switch.is(":checked"))return this.selectContentReferenceType(this.lastContentType)},e.prototype.onVideoTimeUpdate=function(t,e){if(this.lastVideoTime=Echo.core.helpers.msToTime(e.currentTime),!this.$switch.is(":checked"))return this.$videoTime.val(this.lastVideoTime)},e.prototype.onSlideDeckNavigate=function(t,e){if(this.lastSlideNum=e.slideNum,!this.$switch.is(":checked"))return this.$slideNum.val(this.lastSlideNum+1)},e.prototype.reset=function(t,e){return this.clearForm(),null!=e&&this.populateForm(e),this.toggleInputs(),this.toggleInterface(),this.render()},e.prototype.clearForm=function(){var t,e;return this.clearErrors(),this.$switch.prop("checked",!1),this.$refType.prop("checked",!1),this.selectContentReferenceType(null!=(t=this.lastContentType)?t:"Video"),this.$videoTime.val(null!=(e=this.lastVideoTime)?e:"00:00:00"),this.$slideNum.val(null!=this.lastSlideNum?this.lastSlideNum+1:"1")},e.prototype.populateForm=function(t){return this.$switch.prop("checked",!0),this.selectContentReferenceType(null!=t?t.content.type:void 0),"Video"===t.content.type?this.$videoTime.val(Echo.core.helpers.msToTime(null!=t?t.content.timestamp:void 0)):"Slide"===t.content.type&&this.$slideNum.val(t.content.slideNum+1),this.isClassroom||this.mockRefData(t),this.isClassroom?this.$switch.trigger("enable"):this.$switch.trigger("disable")},e.prototype.mockRefData=function(t){return"Video"===t.content.type?(this.videoId=t.content.pubMedia.id,this.slideDeckId=null):"Slide"===t.content.type?(this.videoId=null,this.slideDeckId=t.content.slideDeck.id,this.slideIds[t.content.slideNum]=t.content.slide.slide.id):void 0},e.prototype.toggleInputs=function(){var t;return t=this.shouldDisableInputs()?"disable":"enable",this.$refType.trigger(t),this.$videoTime.trigger(t),this.$slideNum.trigger(t)},e.prototype.shouldDisableInputs=function(){return!this.isClassroom||this.$switch.is(":disabled")||!this.$switch.is(":checked")},e.prototype.toggleInterface=function(){return this.$slideReferenceWrapper.toggle(null!=this.slideDeckId),this.$videoReferenceWrapper.toggle(null!=this.videoId),null!=this.slideDeckId&&null==this.videoId?this.selectContentReferenceType("Slide"):null==this.slideDeckId&&null!=this.videoId?this.selectContentReferenceType("Video"):void 0},e.prototype.selectContentReferenceType=function(t){return this.$refType.filter("[value='"+t+"']").prop("checked",!0)},e.prototype.render=function(){return this.$switch.is(":checked")?this.$embedContainer.html(this.generateFormHtml()):this.$embedContainer.empty()},e.prototype.generateFormHtml=function(){if(!this.$switch.is(":checked"))return"";switch(this.$refType.filter(":checked").val()){case"Video":return this.generateVideoHtml();case"Slide":return this.generateSlideHtml();default:return""}},e.prototype.generateVideoHtml=function(){var t;return t=Echo.core.helpers.timeToMs(this.$videoTime.val()),"<fieldset data-type='hash' data-name='contentRef'> <input type='hidden' name='type' value='Video'> <input type='hidden' name='videoId' value='"+this.videoId+"'> <input type='hidden' name='timestamp' value='"+t+"' data-type='number'> </fieldset>"},e.prototype.generateSlideHtml=function(){return"<fieldset data-type='hash' data-name='contentRef'> <input type='hidden' name='type' value='Slide'> <input type='hidden' name='slideId' value='"+this.slideIds[this.$slideNum.val()-1]+"'> <input type='hidden' name='slideDeckId' value='"+this.slideDeckId+"'> </fieldset>"},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,s=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.widgets.questions.ContentReferencePreview=function(t){function e(){return this.onClickSlide=i(this.onClickSlide,this),this.fetchPreviewSuccess=i(this.fetchPreviewSuccess,this),this.onContentModalFetch=i(this.onContentModalFetch,this),this.onClickVideo=i(this.onClickVideo,this),this.onUpdateSlides=i(this.onUpdateSlides,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){switch(this.refType=t.refType,this.questionId=t.questionId,this.slideDeckId=t.slideDeckId,this.slideIds=t.slideIds,this.slideId=t.slideId,this.lessonId=t.lessonId,this.timestamp=t.timestamp,this.videoId=t.videoId,this.isClassroom=t.isClassroom,this.referenceDisabled=t.referenceDisabled,this.$num=this.$(".slideRef-slideNum"),this.$body.on("SlideDeck."+this.slideDeckId+".updateSlides",this.onUpdateSlides),this.refType){case"Video":this.videoRefInit();break;case"Slide":this.slideRefInit()}return this.initTooltip()},e.prototype.initTooltip=function(){if(this.referenceDisabled)return this.$el.attr("data-tooltip",this.i18n("Errors.noLongerAvailable",this.refType.toLowerCase())).attr("data-tooltip-pos","top")},e.prototype.onUpdateSlides=function(t,e){var i,o,n;if(o=e.slideIds,i=this.slideId,!(s.call(o,i)<0))return n=(n=o.indexOf(this.slideId))<0?1:n+1,this.$num.text(this.i18n("Labels.slide")+" "+n)},e.prototype.videoRefInit=function(){if(this.$("img").load(function(){return $(this).siblings(".overlay").css({height:$(this).height(),width:$(this).width()})}),!this.referenceDisabled)return this.$el.on("click",this.onClickVideo)},e.prototype.onClickVideo=function(){return this.isClassroom?(this.$el.trigger("Stage.videoPlayer.jumpToTime",{videoId:this.videoId,timestamp:this.timestamp}),this.$el.trigger("ContentRef.navigate",{timestamp:this.timestamp})):this.getVideoModal()},e.prototype.getVideoModal=function(){return Echo.routes.Media.lightVideoModal(this.videoId).ajax({success:this.onContentModalFetch,data:{time:this.timestamp,contextId:this.questionId,contextType:"Question"}})},e.prototype.onContentModalFetch=function(t){return this.$el.parent().append(t.data[0].html)},e.prototype.slideRefInit=function(){return Echo.routes.Slides.getSlideWithImage().ajax({success:this.fetchPreviewSuccess,data:{lessonId:this.lessonId,slideDeckId:this.slideDeckId,slideId:this.slideId}})},e.prototype.fetchPreviewSuccess=function(t){if(this.$el.prepend(t.data[0].html),!this.referenceDisabled)return this.$el.on("click",this.onClickSlide)},e.prototype.onClickSlide=function(){return this.isClassroom?(this.$el.trigger("Stage.slideDeck.jumpToSlide",{slideId:this.slideId,slideDeckId:this.slideDeckId}),this.$el.trigger("ContentRef.navigate",{slideId:this.slideId})):this.getSlideModal()},e.prototype.getSlideModal=function(){var t;return t={slideId:this.slideId,slideDeckId:this.slideDeckId},null!=this.lessonId&&(t=$.extend(t,{lessonId:this.lessonId})),Echo.routes.Slides.getSlidePreview().ajax({data:t,success:this.onContentModalFetch})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.questions.FileUploadPreview=function(t){function e(){return this.reset=i(this.reset,this),this.onUploadSuccess=i(this.onUploadSuccess,this),this.onImageLoad=i(this.onImageLoad,this),this.onUpdateAttachments=i(this.onUpdateAttachments,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$img=this.$("img"),this.$title=this.$("span.title"),this.$closeBtn=this.$(".close-fileUploadPreview"),this.$parent=this.$el.parent(),this.$desc=this.$(".desc-wrapper"),this.$closeBtn.on("click",this.reset),this.$parent.on("FileStack.success",this.onUploadSuccess),this.$el.on("Attachments.update",this.onUpdateAttachments),this.$img.on("load",this.onImageLoad),this.reset()},e.prototype.onUpdateAttachments=function(t,e){return null!=(null!=e?e.file:void 0)||null!=(null!=e?e.image:void 0)?this.updateAttachments(e):this.reset()},e.prototype.updateAttachments=function(t){return this.$desc.css("margin-left",0),null!=t.image?(this.$img.attr("src",t.image.original.url),this.$title.text(t.image.original.name)):this.$title.text(t.filename),this.$el.show()},e.prototype.onImageLoad=function(){var t;return t=this.$img.width(),this.$desc.css("margin-left",t)},e.prototype.onUploadSuccess=function(t,e){var i;return this.$desc.css("margin-left",0),-1!==(null!=(i=e.fileBlob.mimetype)?i.indexOf("image"):void 0)?this.$img.attr("src",e.fileBlob.url):this.$img.attr("src",""),this.$title.text(e.fileBlob.filename),this.$el.trigger("FileUpload.success"),this.$el.show()},e.prototype.reset=function(t){if(null==t||this.closable)return this.$img.attr("src",""),this.$title.text(""),this.$el.hide(),this.$desc.css("margin-left",0),this.$el.trigger("FileUpload.remove"),this.closable=!0,this.$closeBtn.attr("title","")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.questions.QuestionCreator=function(t){function e(){return this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onTextareaUpdate=i(this.onTextareaUpdate,this),this.onUploadAttachment=i(this.onUploadAttachment,this),this.onRemoveAttachment=i(this.onRemoveAttachment,this),this.onClose=i(this.onClose,this),this.onOpen=i(this.onOpen,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.sectionId=t.sectionId,this.lessonId=t.lessonId,this.videoId=t.videoId,this.slideDeckId=t.slideDeckId,this.$form=this.$("form"),this.$textarea=this.$("[name=body]"),this.$lessonSelect=this.$("select[name=lessonId]"),this.$anonymousSwitch=this.$("[name=anonymous]"),this.$filePickerWrapper=this.$(".fileStack-wrapper"),this.$contentReferenceWrapper=this.$(".content-reference-wrapper"),this.$previewWrapper=this.$(".embed-preview-wrapper"),this.$attachFile=this.$(".attach-file"),this.$fileUploadPreview=this.$(".file-upload-preview"),this.$removeAttachmentWrapper=this.$(".remove-existing-attachment"),this.$fakeInput=this.createFakeInput(),this.$firstInput=this.$textarea,this.$textarea.on("keydown paste cut",this.onTextareaUpdate),this.$body.on("QuestionCreator.open",this.onOpen).on("QuestionCreator.edit",this.onOpen).on("QuestionCreator.close",this.onClose),this.$el.on("FileUpload.remove",this.onRemoveAttachment).on("FileUpload.success",this.onUploadAttachment).on("AjaxForm.addQuestion.success",this.onSubmitSuccess),this.onClose()},e.prototype.onOpen=function(t,e){var i;return this.reset(e),this.enableTabbing(),this.embedify(),null!=e&&this.$el.addClass("edit"),this.$el.slideDown(200,(i=this,function(){return i.focusFirstInput()})),this.focusFirstInput()},e.prototype.onClose=function(){return this.disableTabbing(),this.$el.removeClass("edit"),this.$el.slideUp(200),this.reset()},e.prototype.onRemoveAttachment=function(t){return this.$removeAttachmentWrapper.html(this.removeAttachmentElement("true")),this.showUploadButton(),this.$filePickerWrapper.trigger("FileUploader.reset")},e.prototype.onUploadAttachment=function(t){return this.$removeAttachmentWrapper.empty(),this.hideUploadButton()},e.prototype.onTextareaUpdate=function(){return this.embedify()},e.prototype.onSubmitSuccess=function(t,e){return this.$el.trigger("QuestionCreator.submitSuccess",e),this.$el.trigger("QuestionCreator.close")},e.prototype.reset=function(t){return this.clearErrors(),this.$removeAttachmentWrapper.empty(),null!=t?this.resetFormForEdit(t):this.resetForm()},e.prototype.resetForm=function(){return this.$textarea.val(""),this.resetFileAttachments(),this.$lessonSelect.val("").trigger("change"),this.$anonymousSwitch.prop("checked",!1),this.$previewWrapper.hide().find("div").remove(),this.$form.trigger("AjaxForm.addQuestion.changeAction",{url:Echo.routes.Questions.create().url,method:"POST"}),this.$contentReferenceWrapper.trigger("ContentReferenceEditor.reset").toggle(this.showContentReferenceWrapper())},e.prototype.showContentReferenceWrapper=function(){return null!=this.lessonId&&(null!=this.videoId||null!=this.slideDeckId)},e.prototype.resetFormForEdit=function(t){return this.$textarea.val(t.html),null==t.file&&null==t.image||this.renderAttachment(t),this.$lessonSelect.val(t.lessonId).trigger("change"),this.$anonymousSwitch.prop("checked",t.anonymous),this.$previewWrapper.hide().find("div").remove(),this.$form.trigger("AjaxForm.addQuestion.changeAction",{url:Echo.routes.Questions.update(t.id).url,method:"PUT"}),this.$contentReferenceWrapper.trigger("ContentReferenceEditor.reset",t.contentRef).toggle(null!=t.contentRef||this.showContentReferenceWrapper())},e.prototype.hideUploadButton=function(){return this.$attachFile.hide()},e.prototype.showUploadButton=function(){return this.$attachFile.show()},e.prototype.resetFileAttachments=function(){return this.showUploadButton(),this.$fileUploadPreview.trigger("Attachments.update")},e.prototype.renderAttachment=function(t){return this.hideUploadButton(),this.$fileUploadPreview.trigger("Attachments.update",t)},e.prototype.removeAttachmentElement=function(t){return"<input type='hidden' name='removeExistingAttachment' value='"+t+"' data-type='boolean'>"},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.questions.QuestionWithResponses=function(t){function e(){return this.toggleTrigger=i(this.toggleTrigger,this),this.onCloseResponseCreator=i(this.onCloseResponseCreator,this),this.onOpenResponseEditor=i(this.onOpenResponseEditor,this),this.onOpenResponseCreator=i(this.onOpenResponseCreator,this),this.closeExpanded=i(this.closeExpanded,this),this.onNewQuestionResponse=i(this.onNewQuestionResponse,this),this.onUpdateResponseCount=i(this.onUpdateResponseCount,this),this.onScrollIntoView=i(this.onScrollIntoView,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.questionId=t.questionId,this.$responsesList=this.$(".responses-list"),this.question=this.$(".single-question"),this.$trigger=this.$(".response-creator-trigger"),this.$responseCreator=this.$(".response-creator"),this.$el.on("ResponseCreator.submitSuccess",this.onNewQuestionResponse).on("QuestionWithResponse.openResponseCreator",this.onOpenResponseCreator).on("QuestionWithResponse.openResponseEditor",this.onOpenResponseEditor).on("ResponseCreator.close",this.onCloseResponseCreator).on("update.responseCount",this.onUpdateResponseCount),this.$el.trigger("Question."+this.questionId+".loadedWithResponses")},e.prototype.bodyListeners=function(){var t;return(t={})["destroy.expandedView"]=this.closeExpanded,t["question."+this.options.questionId+".newResponse"]=this.onNewQuestionResponse,t["questionResponse.scrollIntoView"]=this.onScrollIntoView,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onScrollIntoView=function(t,e){var i;if(null!=e)return i=this.$(".single-response[data-id='"+e+"']"),this.$el.animate({scrollTop:i.position().top})},e.prototype.onUpdateResponseCount=function(){return this.$body.trigger("question."+this.questionId+".status",{responseCount:this.$el.find(".single-response:not(.toBeDeleted)").length})},e.prototype.onNewQuestionResponse=function(t,e){var i;if(null!=e)return(i=this.$(".single-response[data-id="+e.id+"]")).length?i.trigger("replaceContent",e.html):(this.$responsesList.append(e.html),this.onUpdateResponseCount())},e.prototype.closeExpanded=function(t,e){if(this.question.data("id")===e)return this.dispose()},e.prototype.onOpenResponseCreator=function(){return this.toggleTrigger(),this.$responseCreator.trigger("ResponseCreator.open")},e.prototype.onOpenResponseEditor=function(t,e){return this.toggleTrigger(),this.$responseCreator.trigger("ResponseCreator.edit",e)},e.prototype.onCloseResponseCreator=function(){return this.toggleTrigger()},e.prototype.toggleTrigger=function(){return this.$trigger.slideToggle(200)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.questions.Questions=function(t){function e(){return this.onUpdateBookmark=i(this.onUpdateBookmark,this),this.onDeleteQuestion=i(this.onDeleteQuestion,this),this.updateLike=i(this.updateLike,this),this.reloadExpandedQuestion=i(this.reloadExpandedQuestion,this),this.onNewQuestion=i(this.onNewQuestion,this),this.updateUnreadQuestionCount=i(this.updateUnreadQuestionCount,this),this.onSearchSuccess=i(this.onSearchSuccess,this),this.showHidePlaceholders=i(this.showHidePlaceholders,this),this.onUpdateLessonSelect=i(this.onUpdateLessonSelect,this),this.onToggleQuestionSearch=i(this.onToggleQuestionSearch,this),this.onSearchComplete=i(this.onSearchComplete,this),this.onFilterBarUpdate=i(this.onFilterBarUpdate,this),this.clearContent=i(this.clearContent,this),this.loadMore=i(this.loadMore,this),this.onScroll=i(this.onScroll,this),this.onResize=i(this.onResize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.currentPage=0,e.prototype.infiniteScroll=!0,e.prototype.searched=!1,e.prototype.initialize=function(t){var e;return this.sectionId=t.sectionId,this.lessonId=t.lessonId,this.isClassroom=t.isClassroom,this.$questionsPanel=this.$(".questions-split-panel"),this.$questionsList=this.$(".questions-list"),this.$leftPanel=this.$questionsPanel.find(".left-panel .panel-content"),this.$rightPanel=this.$questionsPanel.find(".right-panel .panel-content"),this.$unreadQuestionCountEl=this.$(".unread-question-count"),this.$questionsListPlaceholder=this.$(".left-panel .questionsList-placeholder"),this.$expandedQuestionPlaceholder=this.$(".right-panel .startDiscussion-placeholder"),this.$questionsFilterBar=this.$(".questions-topBar"),this.$lessonFilter=this.$questionsFilterBar.find("[name=lessonId]"),this.$loadingSection=this.$(".loading-section"),this.$el.on("delete.question",this.onDeleteQuestion).on("update.bookmark",this.onUpdateBookmark).on("reload.expandedQuestion",this.reloadExpandedQuestion).on("QuestionCreator.submitSuccess",this.onNewQuestion).on("toggle.placeholder",this.showHidePlaceholders).on("update.like",this.updateLike).on("update.unreadQuestionCount",this.updateUnreadQuestionCount).on("toggleSearch.QuestionHeader",this.onToggleQuestionSearch).on("Questions.updateLessonSelect",this.onUpdateLessonSelect).on("FilterBar.update",this.onFilterBarUpdate),this.$unreadQuestionCountEl.toggle(0<+this.$unreadQuestionCountEl.find(".count").text()),this.$doc.ready((e=this,function(){return e.showHidePlaceholders()})),this.$el.trigger("FilterBar.requestUpdate"),this.$leftPanel.on("resize",this.onResize).on("scroll",this.onScroll)},e.prototype.onResize=function(){if(this.searched)return this.fillContent()},e.prototype.onScroll=function(t){if(this.infiniteScroll)return this.$questionsList.height()-this.$leftPanel.height()-this.$leftPanel.scrollTop()<=0?this.loadMore():void 0},e.prototype.loadMore=function(){if(null==this.xhr)return this.currentPage=this.currentPage+1,this.$loadingSection.show(),this.$el.trigger("loading.on",{selector:".loading-section",theme:"light",opacity:"transparent"}),this.search()},e.prototype.clearContent=function(){return this.searched=!1,this.$questionsList.empty(),this.currentPage=0},e.prototype.onFilterBarUpdate=function(t,e){if(this.filters=e,null!=this.filters)return null!=this.filters.lessonId&&"all"===this.filters.lessonId&&delete this.filters.lessonId,this.clearContent(),this.$el.trigger("loading.on",{selector:".panel-content",theme:"dark",opacity:"transparent"}),this.search()},e.prototype.queryDefaults=function(){var t;return t={sectionId:this.sectionId,isClassroom:this.isClassroom,sortDirection:"desc",pageNumber:this.currentPage},null!=this.lessonId?$.extend(t,{lessonId:this.lessonId}):t},e.prototype.search=function(){var t;return null!=(t=this.xhr)&&t.abort(),this.xhr=this.ajax(Echo.routes.Questions.search(),{data:$.extend(this.queryDefaults(),this.filters),success:this.onSearchSuccess,error:this.onSearchComplete})},e.prototype.onSearchComplete=function(){return this.xhr=null,this.$el.trigger("loading.off",{selector:".panel-content"})},e.prototype.onToggleQuestionSearch=function(){return this.$el.toggleClass("open-search")},e.prototype.onUpdateLessonSelect=function(t,e){return this.$lessonFilter.trigger("Select.updateSelected",e||"__EMPTY__")},e.prototype.showHidePlaceholders=function(){return this.$questionsListPlaceholder.toggle(0===this.$questionsList.find(".single-question:not(.toBeDeleted)").length),this.$expandedQuestionPlaceholder.toggle(0===this.$rightPanel.find(".questions-expanded-view:not(.toBeDeleted)").length)},e.prototype.onSearchSuccess=function(t){var e,i,o,n,s,r,a,h,l;return 0<(e=this.$questionsPanel.find(".questions-expanded-view > .single-question")).length&&this.$body.trigger("destroy.expandedView",e.data("id")),this.$questionsList.trigger("reset.questions",{html:null!=(i=t.data)&&null!=(o=i[0])?o.html:void 0,append:this.searched}),l=this.$questionsList.find(".single-question:not(.toBeDeleted)").length,this.infiniteScroll=l<(null!=(n=null!=(s=t.data)&&null!=(r=s[0])?r.total:void 0)?n:0)&&(null!=(a=t.data)&&null!=(h=a[0])?h.num:void 0),this.showHidePlaceholders(),this.searched=!0,this.fillContent()},e.prototype.updateUnreadQuestionCount=function(){var t;return t=this.$questionsList.find(".single-question.new").length,this.$unreadQuestionCountEl.toggle(0<t).find(".count").text(t)},e.prototype.onNewQuestion=function(t,e){var i;if(null!=e)return(i=this.$questionsList.find(".single-question[data-id="+e.id+"]")).length?i.trigger("replaceContent",e.html):(this.$questionsList.prepend(e.html),this.$questionsList.animate({scrollTop:0},300),this.$questionsList.trigger("QuestionsList.selectQuestion"),this.showHidePlaceholders())},e.prototype.reloadExpandedQuestion=function(t,e){var i;return i=this.$questionsPanel.find(".questions-expanded-view > .single-question"),this.$body.trigger("destroy.expandedView",i.data("id")),this.$el.removeClass("open"),this.$rightPanel.append(e.data[0].html),this.$el.addClass("open"),this.showHidePlaceholders()},e.prototype.getTarget=function(t){return"small"===t.sendTo?this.$questionsList.find(".single-question[data-id="+t.id+"]"):this.$questionsPanel.find(".questions-expanded-view > .single-question[data-id="+t.id+"]")},e.prototype.updateLike=function(t,e){return this.getTarget(e).trigger("update.like",{count:e.count,liked:e.liked})},e.prototype.onDeleteQuestion=function(t,e){if(null!=e)return this.getTarget(e).trigger("delete.question"),this.$body.trigger("destroy.expandedView",e.id),this.$el.removeClass("open")},e.prototype.onUpdateBookmark=function(t,e){var i;return null!=(i=this.getTarget(e))?i.trigger("update.bookmark",e.bookmarked):void 0},e.prototype.fillContent=function(){if(this.onSearchComplete(),this.$leftPanel.height()>=this.$questionsList.height()&&this.infiniteScroll)return this.loadMore()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.questions.QuestionsList=function(t){function e(){return this.selectIfUnselected=i(this.selectIfUnselected,this),this.closeQuestion=i(this.closeQuestion,this),this.setSelected=i(this.setSelected,this),this.onNewQuestionUpdate=i(this.onNewQuestionUpdate,this),this.question=i(this.question,this),this.onQuestionsLoaded=i(this.onQuestionsLoaded,this),this.onQuestionsReset=i(this.onQuestionsReset,this),this.onKeyUp=i(this.onKeyUp,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialLoad=!0,e.prototype.initialize=function(t){if(this.sectionId=t.sectionId,this.lessonId=t.lessonId,this.isClassroom=t.isClassroom,this.questionId=t.questionId,this.questionResponseId=t.questionResponseId,this.$panel=this.$el.closest(".questions-content"),this.$rightPanel=this.$panel.find(".right-panel"),this.$el.on("setSelected.question",this.setSelected).on("reset.questions",this.onQuestionsReset).on("QuestionsList.selectQuestion",this.selectIfUnselected),this.$panel.on("close.question",this.closeQuestion),this.$body.on("Section."+this.sectionId+".question.created",this.onNewQuestionUpdate),this.$el.trigger("toggle.placeholder"),!this.isClassroom)return this.setUpArrowKeyNavigation()},e.prototype.setUpArrowKeyNavigation=function(){return this.$body.on("keyup",this.onKeyUp)},e.prototype.onKeyUp=function(t){if(0!==$(document.activeElement).closest(".questions-list").length)switch(t.stopPropagation(),t.which){case this.KEYS.ARROW_UP:return this.goToPreviousQuestion();case this.KEYS.ARROW_DOWN:return this.goToNextQuestion()}},e.prototype.goToNextQuestion=function(){var t;return(t=this.getSelectedQuestion()).length?t.next(".single-question").trigger("click"):this.$(".single-question").first().trigger("click")},e.prototype.goToPreviousQuestion=function(){var t;return(t=this.getSelectedQuestion()).length?t.prev(".single-question").trigger("click"):this.$(".single-question").first().trigger("click")},e.prototype.getSelectedQuestion=function(){return this.$el.find(".single-question.selected")},e.prototype.onQuestionsReset=function(t,e){return t.stopPropagation(),e.append||this.initialLoad&&null!=this.questionId||this.$(".single-question").trigger("destroy"),this.$el.append(e.html),null!=this.questionId&&this.initialLoad?(this.$body.on("Question."+this.questionId+".loadedWithResponses",this.onQuestionsLoaded),this.scrollQuestionIntoView()):this.selectIfUnselected(),this.$el.trigger("toggle.placeholder"),this.initialLoad=!1},e.prototype.scrollQuestionIntoView=function(){var t;if(0!==(t=this.question(this.questionId)).length)return this.$el.parent().animate({scrollTop:t.position().top}),t.trigger("click")},e.prototype.onQuestionsLoaded=function(){if(this.$body.off("Question."+this.questionId+".loadedWithResponses",this.onQuestionsLoaded),null!=this.questionResponseId)return this.$body.trigger("questionResponse.scrollIntoView",this.questionResponseId)},e.prototype.question=function(t){return this.$("[data-type=question][data-id="+t+"]")},e.prototype.onNewQuestionUpdate=function(t,e){if(0===this.question(e.id).length)return this.$el.prepend(e.html),this.selectIfUnselected(),this.$el.trigger("toggle.placeholder")},e.prototype.listeningFor=function(t){return null==this.lessonId||t===this.lessonId},e.prototype.setSelected=function(t,e){return this.$("[data-type=question]").removeClass("selected"),this.$("#"+e).addClass("selected"),this.isClassroom&&this.$rightPanel.show(),this.$panel.addClass("open")},e.prototype.closeQuestion=function(){if(this.$panel.removeClass("open"),this.isClassroom)return this.$rightPanel.hide()},e.prototype.selectIfUnselected=function(t,e){var i;if(null!=(null!=e?e.exclude:void 0)&&this.$(".single-question#"+e.exclude).addClass("toBeDeleted"),!this.isClassroom&&(null==e||e.selected))return 0===(i=null!=e?this.$(".single-question:not(#"+e.exclude+")"):this.$(".single-question")).filter(".selected").length&&0<i.length?i.first().trigger("click"):void 0},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.questions.ResponseCreator=function(t){function e(){return this.open=i(this.open,this),this.close=i(this.close,this),this.onUploadAttachment=i(this.onUploadAttachment,this),this.onRemoveAttachment=i(this.onRemoveAttachment,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.questionId=t.questionId,this.$form=this.$("form"),this.$textarea=this.$("[name=body]"),this.$anonymousSwitch=this.$("[name=anonymous]"),this.$filePicker=this.$(".fileStack-wrapper"),this.$attachFile=this.$(".attach-file"),this.$fileUploadPreview=this.$(".file-upload-preview"),this.$removeAttachmentWrapper=this.$(".remove-existing-attachment"),this.$fakeInput=this.createFakeInput(),this.$firstInput=this.$textarea,this.$el.on("ResponseCreator.close",this.close).on("ResponseCreator.open",this.open).on("ResponseCreator.edit",this.open).on("AjaxForm.addResponse.success",this.onSubmitSuccess).on("FileUpload.remove",this.onRemoveAttachment).on("FileUpload.success",this.onUploadAttachment),this.reset(),this.disableTabbing()},e.prototype.onSubmitSuccess=function(t,e){return this.$el.trigger("ResponseCreator.submitSuccess",e),this.$el.trigger("ResponseCreator.close")},e.prototype.onRemoveAttachment=function(t){return this.$removeAttachmentWrapper.html(this.removeAttachmentElement("true")),this.showUploadButton(),this.$filePicker.trigger("FileUploader.reset")},e.prototype.onUploadAttachment=function(t){return this.$removeAttachmentWrapper.empty(),this.hideUploadButton()},e.prototype.close=function(){return this.disableTabbing(),this.$el.removeClass("edit").slideToggle(200),this.reset()},e.prototype.open=function(t,e){return this.reset(e),this.enableTabbing(),null!=e&&this.$el.addClass("edit"),this.$el.slideToggle(200),this.focusFirstInput()},e.prototype.reset=function(t){return this.clearErrors(),null!=t?this.resetFormForEdit(t):this.resetForm()},e.prototype.resetForm=function(){return this.$textarea.val("").trigger("change"),this.$anonymousSwitch.prop("checked",!1),this.resetFileAttachments(),this.$form.trigger("AjaxForm.addResponse.changeAction",{url:Echo.routes.QuestionResponses.create(this.questionId).url,method:"POST"})},e.prototype.resetFormForEdit=function(t){return this.$textarea.val(t.html).trigger("change"),t.anonymous&&this.$anonymousSwitch.prop("checked","checked"),null==t.image&&null==t.file||this.renderAttachment(t),this.$form.trigger("AjaxForm.addResponse.changeAction",{url:Echo.routes.QuestionResponses.update(t.id).url,method:"PUT"})},e.prototype.hideUploadButton=function(){return this.$attachFile.hide()},e.prototype.showUploadButton=function(){return this.$attachFile.show()},e.prototype.resetFileAttachments=function(){return this.showUploadButton(),this.$fileUploadPreview.trigger("Attachments.update")},e.prototype.renderAttachment=function(t){return this.$removeAttachmentWrapper.empty(),this.hideUploadButton(),this.$fileUploadPreview.trigger("Attachments.update",t)},e.prototype.removeAttachmentElement=function(t){return"<input type='hidden' name='removeExistingAttachment' value='"+t+"' data-type='boolean'>"},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.roomConfiguration.RoomCommonConfiguration=function(t){function i(){var t,e;return this.onChangeProxyRadio=(t=this.onChangeProxyRadio,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.proxyFields={},i.prototype.initialize=function(){return this.$proxyRadios=this.$("input[name=proxy-select]:checked"),this.$proxyRows=this.$(".section.outboundProxy .section-row:not(:first-child)"),this.$el.on("change","input[type=radio][name=proxy-select]",this.onChangeProxyRadio),this.initView()},i.prototype.onChangeProxyRadio=function(t){return this.toggleRadioView($(t.currentTarget).attr("value"))},i.prototype.initView=function(){return this.toggleRadioView(this.$proxyRadios.val())},i.prototype.toggleRadioView=function(t){return""===t?(this.$proxyRows.hide(),this.clearAndCacheProxyFields(this.$proxyRows)):"unauthenticated"===t?(this.restoreProxyFields(this.$proxyRows.filter(".host-row")),this.$proxyRows.filter(".user-row").hide(),this.$proxyRows.filter(".host-row").show(),this.clearAndCacheProxyFields(this.$proxyRows.filter(".user-row"))):"authenticated"===t?(this.restoreProxyFields(this.$proxyRows),this.$proxyRows.show()):void 0},i.prototype.clearAndCacheProxyFields=function(t){var e;return e=this.proxyFields,t.find("input").each(function(){return e[$(this).attr("name")]=$(this).val(),$(this).val("")})},i.prototype.restoreProxyFields=function(t){var e;return e=this.proxyFields,t.find("input").each(function(){var t;if((t=$(this).attr("name"))in e)return $(this).val(e[t]),delete e[t]})},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.roomConfiguration.RoomConfiguration=function(t){function e(){return this.onDownloadClick=i(this.onDownloadClick,this),this.onAjaxFormSuccess=i(this.onAjaxFormSuccess,this),this.onAjaxFormError=i(this.onAjaxFormError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.deviceXmlDownloadUrl=t.deviceXmlDownloadUrl,this.$downloadBtn=this.$(".download-button"),this.$el.on("RoomConfiguration.download.download",this.onDownloadClick).on("AjaxForm.editRoomConfiguration.success",this.onAjaxFormSuccess).on("AjaxForm.editRoomConfiguration.error",this.onAjaxFormError)},e.prototype.onAjaxFormError=function(){return this.$downloadBtn.trigger("disable")},e.prototype.onAjaxFormSuccess=function(t,e){return this.$downloadBtn.trigger("enable"),this.deviceXmlDownloadUrl=e.deviceXml,this.$el.trigger("Modal.close"),alertify.success(this.i18n("Configurations.device.successfullySaved"))},e.prototype.onDownloadClick=function(){if(!this.clicked)return this.clicked=!0,null!=this.deviceXmlDownloadUrl&&(window.location=this.deviceXmlDownloadUrl),this.clicked=!1},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.roomConfiguration.RoomConfigurationForm=function(t){function e(){return this.onChange=i(this.onChange,this),this.onInputAdded=i(this.onInputAdded,this),this.onAjaxFormSuccess=i(this.onAjaxFormSuccess,this),this.onFormSubmit=i(this.onFormSubmit,this),this.onAjaxFormError=i(this.onAjaxFormError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$el.on("change","input, select",this.onChange).on("RoomForm.inputAdded",this.onInputAdded).on("AjaxForm.editRoomConfiguration.success",this.onAjaxFormSuccess).on("AjaxForm.editRoomConfiguration.error",this.onAjaxFormError).on("AjaxForm.submit",this.onFormSubmit),setTimeout(this.onChange,100),this.setDataOnce=_.once((t=this,function(){return t.oldFormData=t.$el.serialize()}));var t},e.prototype.onAjaxFormError=function(){return this.hideLoading()},e.prototype.onFormSubmit=function(){return this.$el.closest(".modal").trigger("loading.on",{selector:".modal-body",theme:"light"}),this.$el.closest(".main-content").trigger("loading.on",{selector:".content-with-sidebar",theme:"light"})},e.prototype.onAjaxFormSuccess=function(){return this.oldFormData=this.$el.serialize(),this.onChange(),this.hideLoading()},e.prototype.hideLoading=function(){return this.$el.closest(".modal").trigger("loading.off",{selector:".modal-body"}),this.$el.closest(".main-content").trigger("loading.off",{selector:".content-with-sidebar"})},e.prototype.onInputAdded=function(){return this.setDataOnce(),this.onChange()},e.prototype.onChange=function(t){var e,i,o;if(null==t||!this.$(null!=t?t.target:void 0).is(":checkbox")||1!==this.$(null!=t?t.target:void 0).closest(".passwordWithShow").length)return null!=t&&t.stopPropagation(),this.oldFormData=null!=(o=this.oldFormData)?o:this.$el.serialize(),i=this.$el.serialize(),(e=this.oldFormData===i)?(this.$("[type=submit]").trigger("disable"),this.$(".download-button").trigger("enable")):(this.$("[type=submit]").trigger("enable"),this.$(".download-button").trigger("disable")),this.$el.attr("data-dirty",e)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.roomConfiguration.RoomHardware2Configuration=function(t){function e(){return this.onSuccess=i(this.onSuccess,this),this.onRoomConfigurationChange=i(this.onRoomConfigurationChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e;return this.hardware2OneTouchInputs=t.hardware2OneTouchInputs,this.$oneTouchInputSelect=this.$("[name=hardware2OneTouchInputs]"),e=_.debounce(this.onRoomConfigurationChange,250),this.$el.on("RoomHardware2Video.change",e).on("change","[name=inputConnector]",e)},e.prototype.onRoomConfigurationChange=function(){return this.ajax(Echo.routes.RoomConfigurations.logicalInputsHardware2Default(),{data:Echo.core.form.getData(this.$el),success:this.onSuccess})},e.prototype.onSuccess=function(t){var e;return e=t.data,this.$oneTouchInputSelect.trigger("Select.updateOptions",{options:e[0].options,maintainSelection:!0,selectFirstOption:!0}),this.hardware2OneTouchInputs&&(this.$oneTouchInputSelect.trigger("Select.updateSelected",this.hardware2OneTouchInputs),this.hardware2OneTouchInputs=null),this.$el.trigger("RoomForm.inputAdded")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.roomConfiguration.RoomHardware2VideoForm=function(t){function e(){return this.renderHtml=i(this.renderHtml,this),this.hasVideoLabelBeenEdited=i(this.hasVideoLabelBeenEdited,this),this.hasDisplayLabelBeenEdited=i(this.hasDisplayLabelBeenEdited,this),this.setVideoLabelOnInputChange=i(this.setVideoLabelOnInputChange,this),this.setDisplayLabelOnInputChange=i(this.setDisplayLabelOnInputChange,this),this.setVideoLabelEdited=i(this.setVideoLabelEdited,this),this.setDisplayLabelEdited=i(this.setDisplayLabelEdited,this),this.onDocumentReady=i(this.onDocumentReady,this),this.onAjaxFormError=i(this.onAjaxFormError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e;return this.displayLabel=t.displayLabel,this.videoLabel=t.videoLabel,this.$display=this.$(".section-column").first(),this.$video=this.$(".section-column").last(),this.$displayInputSelect=this.$display.find("[name=graphicsInput]"),this.$videoInputSelect=this.$video.find("[name=graphicsInput]"),this.$displayAspectRatioSelect=this.$display.find("[name=aspectRatio]"),this.$videoAspectRatioSelect=this.$video.find("[name=aspectRatio]"),this.$displayCompositeStandardSelect=this.$display.find("[name=compositeStandard]"),this.$videoCompositeStandardSelect=this.$video.find("[name=compositeStandard]"),this.$displayMixAudio=this.$display.find("[name=mixAudio]"),this.$videoMixAudio=this.$video.find("[name=mixAudio]"),this.$displaySourceType=this.$display.find("[name=sourceType]"),this.$videoSourceType=this.$video.find("[name=sourceType]"),this.$displayLabelHeader=this.$display.find("[name=labelHeader]"),this.$displayLabelTextInput=this.$display.find("[name=label]"),this.$displayLabelIsCustom=!1,this.$videoLabelHeader=this.$video.find("[name=labelHeader]"),this.$videoLabelTextInput=this.$video.find("[name=label]"),this.$videoLabelIsCustom=!1,this.$html=this.$(".rendered-html"),this.maxInputLength=15,this.$el.on("change",'select, input[type="checkbox"], input[name="label"]',this.renderHtml),this.$doc.on("AjaxForm.editRoomConfiguration.error",this.onAjaxFormError),this.$doc.ready((e=this,function(){return e.onDocumentReady()})),this.$displayInputSelect.on("change",this.setDisplayLabelOnInputChange),this.$videoInputSelect.on("change",this.setVideoLabelOnInputChange),this.$displayLabelTextInput.on("input",this.setDisplayLabelEdited),this.$videoLabelTextInput.on("input",this.setVideoLabelEdited),this.renderHtml()},e.prototype.onAjaxFormError=function(){return this.$displayLabelTextInput.val().length>this.maxInputLength?(this.$displayLabelTextInput.attr("aria-invalid","true"),this.$displayLabelTextInput.hasClass("error")||this.$displayLabelTextInput.parent().parent().trigger("Input.onError",!0),this.$displayLabelTextInput.parent().parent().addClass("error").find("span.error").text(this.i18n("Input.error.exceedsMaxLength",this.maxInputLength)).show()):this.$videoLabelTextInput.val().length>this.maxInputLength?(this.$displayLabelTextInput.attr("aria-invalid","true"),this.$videoLabelTextInput.hasClass("error")||this.$videoLabelTextInput.parent().parent().trigger("Input.onError",!0),this.$videoLabelTextInput.parent().parent().addClass("error").find("span.error").text(this.i18n("Input.error.exceedsMaxLength",this.maxInputLength)).show()):void 0},e.prototype.onDocumentReady=function(){if(""!==this.displayLabel&&(this.$displayLabelIsCustom=!0,this.$displayLabelTextInput.trigger("change")),""!==this.videoLabel)return this.$videoLabelIsCustom=!0,this.$videoLabelTextInput.trigger("change")},e.prototype.setDisplayLabelEdited=function(){if(this.hasDisplayLabelBeenEdited())return this.$displayLabelIsCustom=!0},e.prototype.setVideoLabelEdited=function(){if(this.hasVideoLabelBeenEdited())return this.$videoLabelIsCustom=!0},e.prototype.setDisplayLabelOnInputChange=function(){if(!0===this.$displayLabelIsCustom&&""===this.$displayLabelTextInput.val()&&(this.$displayLabelIsCustom=!1),""===this.$displayInputSelect.val()?(this.$displayLabelHeader.hide(),this.$displayLabelTextInput.hide()):this.$displayLabelHeader.is(":hidden")&&(this.$displayLabelHeader.show(),this.$displayLabelTextInput.show()),this.$displayLabelHeader.is(":visible")&&!1===this.$displayLabelIsCustom)return this.$displayLabelTextInput.val("")},e.prototype.setVideoLabelOnInputChange=function(){if(!0===this.$videoLabelIsCustom&&""===this.$videoLabelTextInput.val()&&(this.$videoLabelIsCustom=!1),""===this.$videoInputSelect.val()?(this.$videoLabelHeader.hide(),this.$videoLabelTextInput.hide()):this.$videoLabelHeader.is(":hidden")&&(this.$videoLabelHeader.show(),this.$videoLabelTextInput.show()),this.$videoLabelHeader.is(":visible")&&!1===this.$videoLabelIsCustom)return this.$videoLabelTextInput.val("")},e.prototype.hasDisplayLabelBeenEdited=function(){return this.$displayLabelTextInput.val()!==this.displayLabel},e.prototype.hasVideoLabelBeenEdited=function(){return this.$videoLabelTextInput.val()!==this.videoLabel},e.prototype.renderHtml=function(){var t,e,i;return this.inputs=[this.getDisplayConfig(),this.getVideoConfig()],e="<input type='hidden' name='hdmiEnabled' value='"+(t={hdmi:this.getInputConfig("hdmi"),sdi:this.getInputConfig("sdi"),vga:this.getInputConfig("vga"),composite:this.getInputConfig("composite")}).hdmi.enabled+"' data-type='boolean'>\n<fieldset data-type='hash' data-name='hdmi'>\n  <input type='hidden' name='sourceType' value='"+t.hdmi.connector.sourceType+"'>\n  <input type='hidden' name='mixAudio' value='"+t.hdmi.connector.mixAudio+"' data-type='boolean'>\n  <input type='hidden' name='aspectRatio' value='"+t.hdmi.connector.aspectRatio+"'>\n  <input type='hidden' name='label' value='"+t.hdmi.connector.label+"'>\n</fieldset>\n<input type='hidden' name='vgaEnabled' value='"+t.vga.enabled+"' data-type='boolean'>\n<fieldset data-type='hash' data-name='vga'>\n  <input type='hidden' name='sourceType' value='"+t.vga.connector.sourceType+"'>\n  <input type='hidden' name='aspectRatio' value='"+t.vga.connector.aspectRatio+"'>\n  <input type='hidden' name='label' value='"+t.vga.connector.label+"'>\n</fieldset>\n<input type='hidden' name='sdiEnabled' value='"+t.sdi.enabled+"' data-type='boolean'>\n<fieldset data-type='hash' data-name='sdi'>\n  <input type='hidden' name='sourceType' value='"+t.sdi.connector.sourceType+"'>\n  <input type='hidden' name='aspectRatio' value='"+t.sdi.connector.aspectRatio+"'>\n  <input type='hidden' name='label' value='"+t.sdi.connector.label+"'>\n</fieldset>\n<input type='hidden' name='compositeEnabled' value='"+t.composite.enabled+"' data-type='boolean'>\n<fieldset data-type='hash' data-name='composite'>\n  <input type='hidden' name='sourceType' value='"+t.composite.connector.sourceType+"'>\n  <input type='hidden' name='standard' value='"+t.composite.connector.standard+"'>\n  <input type='hidden' name='label' value='"+t.composite.connector.label+"'>\n</fieldset>",this.$html.html(e),setTimeout((i=this,function(){return i.$el.trigger("RoomHardware2Video.change")}),100)},e.prototype.getInputConfig=function(e){var t,i,o;return o=(t=0!==(o=_.filter(this.inputs,function(t){return t.graphicsInput===e})).length)?o[0]:this.inputs[0],i=function(){switch(e){case"hdmi":return{mixAudio:o.mixAudio,aspectRatio:o.aspectRatio};case"composite":return{standard:o.compositeStandard};default:return{aspectRatio:o.aspectRatio}}}(),{enabled:t,connector:$.extend(i,{sourceType:o.sourceType,label:t?o.label:""})}},e.prototype.getDisplayConfig=function(){return{sourceType:this.$displaySourceType.attr("value"),graphicsInput:this.$displayInputSelect.val(),aspectRatio:this.$displayAspectRatioSelect.val(),compositeStandard:this.$displayCompositeStandardSelect.val(),mixAudio:this.$displayMixAudio.prop("checked"),label:this.$displayLabelTextInput.val()}},e.prototype.getVideoConfig=function(){return{sourceType:this.$videoSourceType.attr("value"),graphicsInput:this.$videoInputSelect.val(),aspectRatio:this.$videoAspectRatioSelect.val(),compositeStandard:this.$videoCompositeStandardSelect.val(),mixAudio:this.$videoMixAudio.prop("checked"),label:this.$videoLabelTextInput.val()}},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.roomConfiguration.RoomHardware3Configuration=function(t){function e(){return this.onInputOptionsChange=i(this.onInputOptionsChange,this),this.onUsbMixAudio=i(this.onUsbMixAudio,this),this.onSuccess=i(this.onSuccess,this),this.onRoomConfigurationChange=i(this.onRoomConfigurationChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e;return this.hardware3OneTouchInputs=t.hardware3OneTouchInputs,this.$audioInputSelect=this.$("[name=inputConnector]"),this.$hdmi2Input=this.$(".hdmi-input").last(),this.$hdmi2InputEnabled=this.$hdmi2Input.find("[name=hdmiEnabled]"),this.$hdmi2InputSourceType=this.$hdmi2Input.find("[name=sourceType]"),this.$usbInput=this.$(".usb-input").last(),this.$usbInputEnabled=this.$usbInput.find("[name=usbEnabled]"),this.$usbInputSourceType=this.$usbInput.find("[name=sourceType]"),this.$usbInputMixAudio=this.$usbInput.find("[name=mixAudio]"),this.$hdmi2InputEnabled.on("change",this.onInputOptionsChange),this.$hdmi2InputSourceType.on("change",this.onInputOptionsChange),this.$usbInputEnabled.on("change",this.onInputOptionsChange),this.$usbInputSourceType.on("change",this.onInputOptionsChange),this.$usbInputMixAudio.on("change",this.onUsbMixAudio),this.$oneTouchInputSelect=this.$("[name=hardware3OneTouchInputs]"),e=_.debounce(this.onRoomConfigurationChange,250),this.$el.on("RoomHardware3Video.change",e).on("change","[name=inputConnector]",e)},e.prototype.onRoomConfigurationChange=function(){return this.ajax(Echo.routes.RoomConfigurations.logicalInputsHardware3Default(),{data:Echo.core.form.getData(this.$el),success:this.onSuccess})},e.prototype.onSuccess=function(t){var e;return e=t.data,this.$oneTouchInputSelect.trigger("Select.updateOptions",{options:e[0].options,maintainSelection:!0,selectFirstOption:!0}),this.hardware3OneTouchInputs&&(this.$oneTouchInputSelect.trigger("Select.updateSelected",this.hardware3OneTouchInputs),this.hardware3OneTouchInputs=null),this.$el.trigger("RoomForm.inputAdded")},e.prototype.onUsbMixAudio=function(){if(this.$usbInputMixAudio.prop("checked")&&"none"!==this.$audioInputSelect.val())return this.$audioInputSelect.trigger("Select.updateSelected","none")},e.prototype.onInputOptionsChange=function(t){var e;if(e=this.$(t.target),this.$hdmi2InputEnabled.prop("checked")&&this.$usbInputEnabled.prop("checked")&&("display"===this.$hdmi2InputSourceType.val()&&"display"===this.$usbInputSourceType.val()&&(e.parent().parent().hasClass("usb-source-type")||e.hasClass("hdmi-enabled")?this.$hdmi2InputSourceType.trigger("Select.updateSelected","video"):this.$usbInputSourceType.trigger("Select.updateSelected","video")),"video"===this.$hdmi2InputSourceType.val()&&"video"===this.$usbInputSourceType.val()))return e.parent().parent().hasClass("usb-source-type")||e.hasClass("hdmi-enabled")?this.$hdmi2InputSourceType.trigger("Select.updateSelected","display"):this.$usbInputSourceType.trigger("Select.updateSelected","display")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.roomConfiguration.RoomHardware3VideoForm=function(t){function i(){var t,e;return this.onInputChange=(t=this.onInputChange,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("change",'select, input[type="checkbox"], input[name="label"]',this.onInputChange),setTimeout((t=this,function(){return t.$el.trigger("RoomHardware3Video.change",100)}));var t},i.prototype.onInputChange=function(){return this.$el.trigger("RoomHardware3Video.change")},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.roomConfiguration.RoomProHardware2Configuration=function(t){function e(){return this.onSuccess=i(this.onSuccess,this),this.onRoomConfigurationChange=i(this.onRoomConfigurationChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e;return this.hardware2OneTouchInputs=t.hardware2OneTouchInputs,this.$oneTouchInputSelect=this.$("[name=hardware2OneTouchInputs]"),e=_.debounce(this.onRoomConfigurationChange,250),this.$el.on("RoomHardware2Video.change",e).on("change","[name=inputConnector]",e)},e.prototype.onRoomConfigurationChange=function(){return this.ajax(Echo.routes.RoomConfigurations.logicalInputsHardware2Default(),{data:Echo.core.form.getData(this.$el),success:this.onSuccess})},e.prototype.onSuccess=function(t){var e;return e=t.data,this.$oneTouchInputSelect.trigger("Select.updateOptions",{options:e[0].options,maintainSelection:!0,selectFirstOption:!0}),this.hardware2OneTouchInputs&&(this.$oneTouchInputSelect.trigger("Select.updateSelected",this.hardware2OneTouchInputs),this.hardware2OneTouchInputs=null),this.$el.trigger("RoomForm.inputAdded")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.roomConfiguration.RoomProHardware2VideoForm=function(t){function i(){var t,e;return this.renderHtml=(t=this.renderHtml,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$display=this.$(".section-column").first(),this.$video=this.$(".section-column").last(),this.$displayInputSelect=this.$display.find("[name=graphicsInput]"),this.$videoInputSelect=this.$video.find("[name=graphicsInput]"),this.$displayAspectRatioSelect=this.$display.find("[name=aspectRatio]"),this.$videoAspectRatioSelect=this.$video.find("[name=aspectRatio]"),this.$displayCompositeStandardSelect=this.$display.find("[name=compositeStandard]"),this.$videoCompositeStandardSelect=this.$video.find("[name=compositeStandard]"),this.$displayMixAudio=this.$display.find("[name=mixAudio]"),this.$videoMixAudio=this.$video.find("[name=mixAudio]"),this.$displaySourceType=this.$display.find("[name=sourceType]"),this.$videoSourceType=this.$video.find("[name=sourceType]"),this.$html=this.$(".rendered-html"),this.$el.on("change",'select, input[type="checkbox"]',this.renderHtml).on("AjaxForm.editRoomConfiguration.error",this.onAjaxFormError),this.renderHtml()},i.prototype.renderHtml=function(){var t,e,i;return this.inputs=[this.getDisplayConfig(),this.getVideoConfig()],e="<input type='hidden' name='hdmiEnabled' value='"+(t={hdmi:this.getInputConfig("hdmi"),sdi:this.getInputConfig("sdi"),vga:this.getInputConfig("vga"),composite:this.getInputConfig("composite")}).hdmi.enabled+"' data-type='boolean'>\n<fieldset data-type='hash' data-name='hdmi'>\n  <input type='hidden' name='sourceType' value='"+t.hdmi.connector.sourceType+"'>\n  <input type='hidden' name='mixAudio' value='"+t.hdmi.connector.mixAudio+"' data-type='boolean'>\n  <input type='hidden' name='aspectRatio' value='"+t.hdmi.connector.aspectRatio+"'>\n</fieldset>\n<input type='hidden' name='vgaEnabled' value='"+t.vga.enabled+"' data-type='boolean'>\n<fieldset data-type='hash' data-name='vga'>\n  <input type='hidden' name='sourceType' value='"+t.vga.connector.sourceType+"'>\n  <input type='hidden' name='aspectRatio' value='"+t.vga.connector.aspectRatio+"'>\n</fieldset>\n<input type='hidden' name='sdiEnabled' value='"+t.sdi.enabled+"' data-type='boolean'>\n<fieldset data-type='hash' data-name='sdi'>\n  <input type='hidden' name='sourceType' value='"+t.sdi.connector.sourceType+"'>\n  <input type='hidden' name='aspectRatio' value='"+t.sdi.connector.aspectRatio+"'>\n</fieldset>\n<input type='hidden' name='compositeEnabled' value='"+t.composite.enabled+"' data-type='boolean'>\n<fieldset data-type='hash' data-name='composite'>\n  <input type='hidden' name='sourceType' value='"+t.composite.connector.sourceType+"'>\n  <input type='hidden' name='standard' value='"+t.composite.connector.standard+"'>\n</fieldset>",this.$html.html(e),setTimeout((i=this,function(){return i.$el.trigger("RoomHardware2Video.change")}),100)},i.prototype.getInputConfig=function(e){var t,i,o;return o=(t=0!==(o=_.filter(this.inputs,function(t){return t.graphicsInput===e})).length)?o[0]:this.inputs[0],i=function(){switch(e){case"hdmi":return{mixAudio:o.mixAudio,aspectRatio:o.aspectRatio};case"composite":return{standard:o.compositeStandard};default:return{aspectRatio:o.aspectRatio}}}(),{enabled:t,connector:$.extend(i,{sourceType:o.sourceType})}},i.prototype.getDisplayConfig=function(){return{sourceType:this.$displaySourceType.attr("value"),graphicsInput:this.$displayInputSelect.val(),aspectRatio:this.$displayAspectRatioSelect.val(),compositeStandard:this.$displayCompositeStandardSelect.val(),mixAudio:this.$displayMixAudio.prop("checked")}},i.prototype.getVideoConfig=function(){return{sourceType:this.$videoSourceType.attr("value"),graphicsInput:this.$videoInputSelect.val(),aspectRatio:this.$videoAspectRatioSelect.val(),compositeStandard:this.$videoCompositeStandardSelect.val(),mixAudio:this.$videoMixAudio.prop("checked")}},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.roomConfiguration.RoomProHardware3Configuration=function(t){function e(){return this.onInputOptionsChange=i(this.onInputOptionsChange,this),this.onUsbMixAudio=i(this.onUsbMixAudio,this),this.onSuccess=i(this.onSuccess,this),this.onRoomConfigurationChange=i(this.onRoomConfigurationChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e;return this.hardware3OneTouchInputs=t.hardware3OneTouchInputs,this.$audioInputSelect=this.$("[name=inputConnector]"),this.$hdmi2Input=this.$(".hdmi-input").last(),this.$hdmi2InputEnabled=this.$hdmi2Input.find("[name=hdmiEnabled]"),this.$hdmi2InputSourceType=this.$hdmi2Input.find("[name=sourceType]"),this.$usbInput=this.$(".usb-input").last(),this.$usbInputEnabled=this.$usbInput.find("[name=usbEnabled]"),this.$usbInputSourceType=this.$usbInput.find("[name=sourceType]"),this.$usbInputMixAudio=this.$usbInput.find("[name=mixAudio]"),this.$hdmi2InputEnabled.on("change",this.onInputOptionsChange),this.$hdmi2InputSourceType.on("change",this.onInputOptionsChange),this.$usbInputEnabled.on("change",this.onInputOptionsChange),this.$usbInputSourceType.on("change",this.onInputOptionsChange),this.$usbInputMixAudio.on("change",this.onUsbMixAudio),this.$oneTouchInputSelect=this.$("[name=hardware3OneTouchInputs]"),e=_.debounce(this.onRoomConfigurationChange,250),this.$el.on("RoomHardware3Video.change",e).on("change","[name=inputConnector]",e)},e.prototype.onRoomConfigurationChange=function(){return this.ajax(Echo.routes.RoomConfigurations.logicalInputsHardware3Default(),{data:Echo.core.form.getData(this.$el),success:this.onSuccess})},e.prototype.onSuccess=function(t){var e;return e=t.data,this.$oneTouchInputSelect.trigger("Select.updateOptions",{options:e[0].options,maintainSelection:!0,selectFirstOption:!0}),this.hardware3OneTouchInputs&&(this.$oneTouchInputSelect.trigger("Select.updateSelected",this.hardware3OneTouchInputs),this.hardware3OneTouchInputs=null),this.$el.trigger("RoomForm.inputAdded")},e.prototype.onUsbMixAudio=function(){if(this.$usbInputMixAudio.prop("checked")&&"none"!==this.$audioInputSelect.val())return this.$audioInputSelect.trigger("Select.updateSelected","none")},e.prototype.onInputOptionsChange=function(t){var e;if(e=this.$(t.target),this.$hdmi2InputEnabled.prop("checked")&&this.$usbInputEnabled.prop("checked")&&("display"===this.$hdmi2InputSourceType.val()&&"display"===this.$usbInputSourceType.val()&&(e.parent().parent().hasClass("usb-source-type")||e.hasClass("hdmi-enabled")?this.$hdmi2InputSourceType.trigger("Select.updateSelected","video"):this.$usbInputSourceType.trigger("Select.updateSelected","video")),"video"===this.$hdmi2InputSourceType.val()&&"video"===this.$usbInputSourceType.val()))return e.parent().parent().hasClass("usb-source-type")||e.hasClass("hdmi-enabled")?this.$hdmi2InputSourceType.trigger("Select.updateSelected","display"):this.$usbInputSourceType.trigger("Select.updateSelected","display")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.roomConfiguration.RoomProHardware3VideoForm=function(t){function i(){var t,e;return this.onInputChange=(t=this.onInputChange,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("change",'select, input[type="checkbox"]',this.onInputChange),setTimeout((t=this,function(){return t.$el.trigger("RoomHardware3Video.change",100)}));var t},i.prototype.onInputChange=function(){return this.$el.trigger("RoomHardware3Video.change")},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.roomConfiguration.VideoChannelSection=function(t){function i(){var t,e;return this.onInputChange=(t=this.onInputChange,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$inputSelect=this.$("[name=graphicsInput]"),this.$aspectRatioSelect=this.$("[name=aspectRatio]"),this.$standardSelect=this.$("[name=compositeStandard]"),this.$hdmiAudioSwitch=this.$(".switch"),this.$inputSelect.on("change",this.onInputChange),this.initView()},i.prototype.initView=function(){return this.onInputChange()},i.prototype.onInputChange=function(){var t;return t=this.$inputSelect.val(),this.toggleSelect(this.$aspectRatioSelect,"composite"!==t&&""!==t),this.toggleSelect(this.$standardSelect,"composite"===t),this.$hdmiAudioSwitch.toggle("hdmi"===t)},i.prototype.toggleSelect=function(t,e){return this.$(t).closest(".select").toggle(e).prev("label").toggle(e)},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.slideDeck.SlideVisibility=function(t){function e(){return this.onToggleVisibility=i(this.onToggleVisibility,this),this.onSlideChange=i(this.onSlideChange,this),this.onSlideVisibilityUpdate=i(this.onSlideVisibilityUpdate,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){var e;return this.lessonId=t.lessonId,this.slideDeckId=t.slideDeckId,this.lessonSlides=t.lessonSlides,this.slideId=null,this.isHidden={},_.each(this.lessonSlides,(e=this,function(t){return e.isHidden[t.slideId]=t.isHidden})),this.$body.on("SlideDeck."+this.slideDeckId+".toggleSlideVisibility",this.onToggleVisibility).on("SlideDeck."+this.slideDeckId+".navigate",this.onSlideChange).on("Lesson."+this.lessonId+".SlideDeck."+this.slideDeckId+".slideVisibility",this.onSlideVisibilityUpdate)},e.prototype.onSlideVisibilityUpdate=function(t,e){if(null!=this.isHidden[this.slideId])return this.isHidden[this.slideId]=e.isHidden,this.render()},e.prototype.render=function(){return this.$el.toggleClass("isHidden",this.isHidden[this.slideId])},e.prototype.onSlideChange=function(t,e){return this.slideId=e.slideId,this.render()},e.prototype.onToggleVisibility=function(){return this.isHidden[this.slideId]?this.unhide():this.hide()},e.prototype.unhide=function(){return this.isHidden[this.slideId]=!1,this.render(),Echo.routes.LessonSlides.showSlide(this.lessonId,this.slideId).ajax()},e.prototype.hide=function(){return this.isHidden[this.slideId]=!0,this.render(),Echo.routes.LessonSlides.hideSlide(this.lessonId,this.slideId).ajax()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.table.Table=function(t){function e(){return this.makeTableSortable=i(this.makeTableSortable,this),this.sortRows=i(this.sortRows,this),this.updateSortOrder=i(this.updateSortOrder,this),this.onSort=i(this.onSort,this),this.resizeTable=i(this.resizeTable,this),this.triggerSelectionChanged=i(this.triggerSelectionChanged,this),this.onToggleCheckboxes=i(this.onToggleCheckboxes,this),this.onMultiSelect=i(this.onMultiSelect,this),this.onRowSelect=i(this.onRowSelect,this),this.onKeyUpRow=i(this.onKeyUpRow,this),this.allCheckboxesChecked=i(this.allCheckboxesChecked,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){if(this.fillPage=t.fillPage,this.sortable=t.sortable,this.$tableContent=this.$("tbody"),this.toggleAllCheckbox=this.$("thead input[type=checkbox]"),this.toggleAllCheckbox.on("change",this.onToggleCheckboxes),this.$el.on("click","tbody tr",this.onRowSelect).on("keyup","tbody tr",this.onKeyUpRow).on("change","tbody tr",this.onMultiSelect).on("Table.contentChanged",this.triggerSelectionChanged),this.updateToggleAllCheckbox(),this.selectCheckedRows(),this.triggerSelectionChanged(),this.fillPage&&(this.paddingBottom=20,this.$el.on("Table.resize",_.throttle(this.resizeTable,100)),this.$el.trigger("Table.resize")),this.sortable)return this.makeTableSortable()},e.prototype.allCheckboxesChecked=function(){var t;return 0!==(t=this.getCheckboxes()).length&&0===t.not(":checked").length},e.prototype.getCheckboxes=function(){return this.$("tbody input[type=checkbox]")},e.prototype.onKeyUpRow=function(t){if(t.which===this.KEYS.ENTER)return this.onRowSelect(t)},e.prototype.onRowSelect=function(t){var e,i;if(!$(t.target).is("input[type=checkbox]"))return i=!(e=$(t.currentTarget).find("input[type=checkbox]")).is(":checked")||1<this.$("tr.selected").length,this.getCheckboxes().prop({checked:!1}),i&&e.prop({checked:i}),this.selectCheckedRows(),this.updateToggleAllCheckbox(),this.triggerSelectionChanged()},e.prototype.onMultiSelect=function(t){return $(t.currentTarget).toggleClass("selected"),this.updateToggleAllCheckbox(),this.triggerSelectionChanged()},e.prototype.onToggleCheckboxes=function(){return this.getCheckboxes().prop({checked:this.toggleAllCheckbox.is(":checked")}),this.selectCheckedRows(),this.triggerSelectionChanged()},e.prototype.selectCheckedRows=function(){return this.getCheckboxes().each(function(t,e){var i;return i=$(e).closest("tr"),$(e).is(":checked")?i.addClass("selected"):i.removeClass("selected")})},e.prototype.triggerSelectionChanged=function(){var o,t,e,n;return n=this.$("tr.selected"),e=function(){var t,e,i;for(i=[],t=0,e=n.length;t<e;t++)o=n[t],i.push($(o).attr("id"));return i}(),t=_.chain(n).map(function(t){return $(t).attr("data-batch")}).uniq().value(),this.$el.trigger("Table.selectionChanged",{ids:e,batches:t})},e.prototype.updateToggleAllCheckbox=function(){return this.toggleAllCheckbox.prop({checked:this.allCheckboxesChecked()})},e.prototype.resizeTable=function(){var t;return t=$(window).height()-this.$tableContent.offset().top-this.paddingBottom,this.$tableContent.height(t)},e.prototype.onSort=function(t){var e,i,o;return e=$(t.target),i=this.$headings.index(e),o=this.updateSortOrder(e,e.attr("data-sort-dir")),this.sortRows(i,o)},e.prototype.updateSortOrder=function(t,e){return void 0===e?this.defaultSortOrder(t):"desc"===e?"asc":"desc"},e.prototype.sortRows=function(i,t){var e,o;return e=_.sortBy(this.$el.find("tbody tr"),(o=this,function(t){var e;return e=$(t).find("td:eq("+i+")").text(),o.makeTextSortable(e)})),"desc"===t&&e.reverse(),this.renderTable(i,t,e)},e.prototype.renderTable=function(t,e,i){var o,n,s,r;for(this.$headings.removeAttr("data-sort-dir").filter("th:eq('"+t+"')").attr("data-sort-dir",e),s=[],o=0,n=i.length;o<n;o++)r=i[o],s.push(this.$("tbody").append(r));return s},e.prototype.defaultSortColumn=function(t){return this.$el.attr("data-sort-column-default")||this.$headings.index(t)||"1"},e.prototype.defaultSortOrder=function(t){return t.attr("data-sort-dir-default")||"asc"},e.prototype.makeTableSortable=function(){var t,e,i;if(this.$tableHeading=this.$("thead"),this.$tableHeading.on("click","[data-sortable]",this.onSort),this.$headings=this.$tableHeading.find("th"),t=$(_.find(this.$headings,function(t){return $(t).is("[data-sortable]")})),i=this.defaultSortOrder(t),(e=this.defaultSortColumn(t))&&i)return this.sortRows(e,i)},e.prototype.makeTextSortable=function(t){var e,i,o,n,s,r,a,h,l,c,u,p,d;return h=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/g,l=/(^[ ]*|[ ]*$)/g,a=/(^\d{1,3}[%]$)/,o=/(^\d{1,3}[%][\n][\s]*[\/][\n][\s]*\d{1,3}[%])/,e=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,i=/^0x[0-9a-f]+$/i,n=/^\d+$/,r=/^0/,p=(c=$.trim(t.toLowerCase().replace(l,"")||"")).replace(h,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),u=parseInt(c.match(i),16)||1!==p.length&&c.match(e)&&Date.parse(c),s=!(p[0]||"").match(r)&&parseFloat(p[0]),d=(c.match(a)||c.match(o))&&(0===parseInt(p[0])?"0":parseInt(p[0])),u||isNaN(s)&&s||c.match(n)&&parseInt(c)||d||c},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.userEnrollmentModal.Main=function(t){function e(){return this.onUserSectionUpdated=i(this.onUserSectionUpdated,this),this.onEnrollUserSuccess=i(this.onEnrollUserSuccess,this),this.onUserSectionRevoked=i(this.onUserSectionRevoked,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$table=this.$(".adminList-table"),this.$count=this.$(".modal-subHeader.count"),this.$el.on("AjaxForm.enrollUser.success",this.onEnrollUserSuccess).on("UserSection.updated",this.onUserSectionUpdated).on("UserSection.revoked",this.onUserSectionRevoked)},e.prototype.onUserSectionRevoked=function(){return this.$table.trigger("AdminListItem.deleted"),this.$count.text(this.i18n("Admin.Users.numberOfEnrolledSections",this.$(".adminList-item:not(.toBeDeleted)").length)),alertify.success(this.i18n("Admin.Users.successfullyRevoked"))},e.prototype.onEnrollUserSuccess=function(t,e){return this.$table.trigger("AdminListTable.itemsAdded",e),this.$count.text(this.i18n("Admin.Users.numberOfEnrolledSections",this.$(".adminList-item:not(.toBeDeleted)").length))},e.prototype.onUserSectionUpdated=function(t,e){return this.$("[data-id="+e.sectionId+"]").replaceWith(e.html)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.userEnrollmentModal.UserEnrollmentForm=function(t){function e(){return this.updateButton=i(this.updateButton,this),this.onSectionUpdateSuccess=i(this.onSectionUpdateSuccess,this),this.onTermCourseChange=i(this.onTermCourseChange,this),this.onEnrollUserError=i(this.onEnrollUserError,this),this.onEnrollUserSuccess=i(this.onEnrollUserSuccess,this),this.reset=i(this.reset,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$termId=this.$("[name=termId]"),this.$courseId=this.$("[name=courseId]"),this.$sectionId=this.$("[name=sectionId]"),this.$role=this.$("[name=role]"),this.$button=this.$("[type=submit]"),this.$termId.on("change",this.onTermCourseChange),this.$courseId.on("change",this.onTermCourseChange),this.$el.on("UserEnrollment.sectionFilterChanged",this.updateButton).on("UserEnrollment.roleFilterChanged",this.updateButton).on("AjaxForm.enrollUser.success",this.onEnrollUserSuccess).on("AjaxForm.enrollUser.error",this.onEnrollUserError),this.onTermCourseChange()},e.prototype.vals=function(){return{term:this.$termId.value(),course:this.$courseId.value(),section:this.$sectionId.value(),role:this.$role.value()}},e.prototype.reset=function(){return this.$termId.trigger("Select.updateSelected",""),this.$courseId.trigger("Select.updateSelected",""),this.$role.trigger("Select.updateSelected","")},e.prototype.onEnrollUserSuccess=function(){return alertify.success(this.i18n("Admin.Users.successfullyEnrolled")),this.reset()},e.prototype.onEnrollUserError=function(t,e){return alertify.error(e.responseJSON.message)},e.prototype.onTermCourseChange=function(){var t,e;return e=this.$termId.value(),null!=(t=this.$courseId.value())?this.ajax(Echo.routes.Sections.getSectionFilterOptions(t,e),{dataType:"json",data:{courseId:t,termId:e},success:this.onSectionUpdateSuccess,error:this.onAjaxError}):(this.disableSection(),this.updateButton())},e.prototype.onSectionUpdateSuccess=function(t){return this.$sectionId.trigger("Select.updateOptions",{options:t.data[0].html,keepEmptyOption:!0}).trigger("enable"),this.updateButton()},e.prototype.disableSection=function(){return this.$sectionId.trigger("Select.updateSelected","").trigger("disable")},e.prototype.updateButton=function(){var t;return null!=(t=this.vals()).term&&null!=t.course&&null!=t.section&&null!=t.role?this.$button.trigger("enable"):this.$button.trigger("disable")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.userEnrollmentModal.UserSection=function(t){function e(){return this.onSubmitError=i(this.onSubmitError,this),this.onRevokeSuccess=i(this.onRevokeSuccess,this),this.revokeEnrollment=i(this.revokeEnrollment,this),this.onRevoke=i(this.onRevoke,this),this.onRoleChangeSuccess=i(this.onRoleChangeSuccess,this),this.onMakeTeachingAssistant=i(this.onMakeTeachingAssistant,this),this.onMakeInstructor=i(this.onMakeInstructor,this),this.onMakeStudent=i(this.onMakeStudent,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.userId=t.userId,this.sectionId=t.sectionId,this.$el.on("UserSection.makeStudent",this.onMakeStudent).on("UserSection.makeInstructor",this.onMakeInstructor).on("UserSection.makeTeachingAssistant",this.onMakeTeachingAssistant).on("UserSection.revoke",this.onRevoke)},e.prototype.onMakeStudent=function(){return this.ajax(Echo.routes.UserSections.makeStudent(this.sectionId,this.userId),{success:this.onRoleChangeSuccess,error:this.onSubmitError})},e.prototype.onMakeInstructor=function(){return this.ajax(Echo.routes.UserSections.makeInstructor(this.sectionId,this.userId),{success:this.onRoleChangeSuccess,error:this.onSubmitError})},e.prototype.onMakeTeachingAssistant=function(){return this.ajax(Echo.routes.UserSections.makeTeachingAssistant(this.sectionId,this.userId),{success:this.onRoleChangeSuccess,error:this.onSubmitError})},e.prototype.onRoleChangeSuccess=function(t){return this.$el.trigger("UserSection.updated",t.data[0])},e.prototype.onRevoke=function(t){return null!=t&&t.stopPropagation(),this.confirm("Admin.Users.revokeEnrollmentConfirmation",(e=this,function(){return e.revokeEnrollment()}));var e},e.prototype.revokeEnrollment=function(){return this.ajax(Echo.routes.UserSections.revoke(this.sectionId,this.userId),{success:this.onRevokeSuccess,error:this.onSubmitError})},e.prototype.onRevokeSuccess=function(){return this.$el.animate({height:"0px",opacity:"0"},600,(t=this,function(){return t.$el.addClass("toBeDeleted").trigger("UserSection.revoked"),t.$el.remove()}));var t},e.prototype.onSubmitError=function(t){var e,i;return e=Echo.core.form.getErrorJSON(t),_.each(e,(i=this,function(t,e){if("obj.roles.Instructor"===e)return alertify.error(i.i18n(t[0].msg))}))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.videoEditor.Cut=function(t){function e(){return this.onModify=i(this.onModify,this),this.onRevert=i(this.onRevert,this),this.onTrim=i(this.onTrim,this),this.onTimelineUpdate=i(this.onTimelineUpdate,this),this.onMouseover=i(this.onMouseover,this),this.onMouseout=i(this.onMouseout,this),this.onMarkerMousemove=i(this.onMarkerMousemove,this),this.onMarkerMouseup=i(this.onMarkerMouseup,this),this.onMarkerMousedown=i(this.onMarkerMousedown,this),this.onTimelineUnfreeze=i(this.onTimelineUnfreeze,this),this.onTimelineFreeze=i(this.onTimelineFreeze,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.minimumLength=500,e.prototype.initialize=function(t){return this.start=t.start,this.end=t.end,this.duration=t.duration,this.trimmed=t.trimmed,this.currentTime=t.currentTime,this.namespace=t.namespace,this.getTrimDragBounds=t.getTrimDragBounds,this.id=this.$el.attr("id"),this.$timeline=this.$el.closest(".timeline"),this.$cutPlaceholder=this.$(".cut-placeholder"),this.$startMarker=this.$(".start-marker"),this.$endMarker=this.$(".end-marker"),this.$cutMarker=this.$(".cut-marker"),this.render(),this.initEvents()},e.prototype.render=function(){var t,e;return e=(this.end-this.start)/this.duration*100,t=100*(1-(this.duration-this.start)/this.duration),this.$el.css({width:e+"%",left:t+"%"}).toggleClass("trimmed",this.trimmed),this.toggleActive(),this.$startMarker.css({left:-2,right:"auto"}),this.$endMarker.css({right:-2,left:"auto"})},e.prototype.initEvents=function(){return this.$el.on("Cut.modify",this.onModify).on("Cut.trim",this.onTrim).on("Cut.revert",this.onRevert).on("mouseover",this.onMouseover).on("mouseout",this.onMouseout).closest(".editor-timeline").on("Timeline.update",this.onTimelineUpdate).on("Timeline.freezeUpdate",this.onTimelineFreeze).on("Timeline.unfreezeUpdate",this.onTimelineUnfreeze),this.$cutMarker.on("mousedown",this.onMarkerMousedown)},e.prototype.onTimelineFreeze=function(){return this.freeze=!0},e.prototype.onTimelineUnfreeze=function(){return this.freeze=!1,this.onMouseout()},e.prototype.onMarkerMousedown=function(t){var e,i,o;return this.$marker=this.$(t.target),t.stopPropagation(),this.$el.trigger("Timeline.freezeUpdate"),o=(i=this.getTrimDragBounds(this.id))[0],e=i[1],this.startTrimDragBound=this.$marker.hasClass("start-marker")?o:this.start,this.endTrimDragBound=this.$marker.hasClass("start-marker")?this.end:e,this.$body.on("mousemove.Marker.scrub",this.onMarkerMousemove).on("mouseup.Marker.scrub",this.onMarkerMouseup),this.seekToOffset(t)},e.prototype.seekToOffset=function(t){var e,i;return e=this.getLeftOffset(t),e=this.adjustOffset(e),i=this.getTimeFromOffset(e),this.seekToTime(i),this.updateMarker(e)},e.prototype.getLeftOffset=function(t){return t.pageX-this.$timeline.position().left},e.prototype.adjustOffset=function(t){var e,i;return t<(i=this.getOffsetFromTime(this.startTrimDragBound))&&(t=i),(e=this.getOffsetFromTime(this.endTrimDragBound))<t&&(t=e),t},e.prototype.updateMarker=function(t){var e;return e=(t-=this.$el.position().left)/this.$el.width()*100,this.$marker.css("left",e+"%"),0===this.$cutPlaceholder.length&&(this.$cutPlaceholder=$("<div>").addClass("cut-placeholder").appendTo(this.$el)),this.$marker.hasClass("start-marker")?this.$cutPlaceholder.css({left:0,width:(t-1)/this.$el.width()*100+"%",right:"auto"}):this.$cutPlaceholder.css({left:(t+1)/this.$el.width()*100+"%",right:0,width:"auto"})},e.prototype.seekToTime=function(t){return this.$el.trigger("VideoPlayer."+this.namespace+".seekToTime",{time:t})},e.prototype.getTimeFromOffset=function(t){return this.duration*t/this.$timeline.width()},e.prototype.getOffsetFromTime=function(t){return+t/this.duration*this.$timeline.width()},e.prototype.onMarkerMouseup=function(t){return t.stopPropagation(),this.$body.off("mousemove.Marker.scrub").off("mouseup.Marker.scrub"),this.$cutPlaceholder.remove(),this.$cutPlaceholder=this.$(".cut-placeholder"),this.$marker.hasClass("start-marker")&&this.end-this.currentTime>=this.minimumLength?this.$el.trigger("Cut.dragTrim",{time:this.currentTime,id:this.id,type:"start"}):this.$marker.hasClass("end-marker")&&this.currentTime-this.start>=this.minimumLength?this.$el.trigger("Cut.dragTrim",{time:this.currentTime,id:this.id,type:"end"}):this.toggleTrimmed(!0),this.$el.trigger("Timeline.unfreezeUpdate")},e.prototype.onMarkerMousemove=function(t){return this.seekToOffset(t)},e.prototype.onMouseout=function(){if(!this.freeze)return this.$el.removeClass("hover")},e.prototype.onMouseover=function(){if(!this.freeze)return this.$el.addClass("hover")},e.prototype.onTimelineUpdate=function(t,e){if(this.currentTime=e.currentTime,!this.freeze)return this.toggleActive()},e.prototype.onTrim=function(t){return this.toggleTrimmed(!0)},e.prototype.onRevert=function(t){return this.toggleTrimmed(!1),this.$el.trigger("Cut.reverted",this.id)},e.prototype.toggleTrimmed=function(t){return this.trimmed=t,this.$el.toggleClass("trimmed",this.trimmed)},e.prototype.toggleActive=function(){var t;return this.$el.toggleClass("active",this.start<=(t=this.currentTime)&&t<this.end)},e.prototype.onModify=function(t,e){var i;return i=[e.start,e.end,e.trimmed],this.start=i[0],this.end=i[1],this.trimmed=i[2],this.render()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.videoPlayer.Captions=function(t){function e(){return this.findCaption=i(this.findCaption,this),this.onTimeUpdate=i(this.onTimeUpdate,this),this.captionsOff=i(this.captionsOff,this),this.captionsOn=i(this.captionsOn,this),this.toggle=i(this.toggle,this),this.onCaptionsLoaded=i(this.onCaptionsLoaded,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.captions=[],e.prototype.active=!1,e.prototype.currCaption=null,e.prototype.initialize=function(t){return this.namespace=t.namespace,this.duration=t.duration,this.s3File=t.s3File,this.captionsOff(),this.$text=this.$(".video-caption-text"),this.$body.on("Video.mediaEvent.timeUpdate."+this.namespace,this.onTimeUpdate).on("Video.controls.timeUpdate."+this.namespace,this.onTimeUpdate),this.$el.parent().on("Video.control.toggleCaptions",this.toggle),""===this.s3File?this.$el.trigger("View.fetchCaptions.error"):this.fetch(this.s3File,"Video.errorLoadingCaptionsFile",this.onCaptionsLoaded,!0,"fetchCaptions")},e.prototype.onCaptionsLoaded=function(t){var e;if(e=new WebVTTParser,this.captions=e.parse(t,"subtitles"),0<this.captions.errors.length)return this.sendToAirbrake(_.extend(this.captions.errors,{file:this.s3File}),"Error parsing captions")},e.prototype.toggle=function(){return this.active?this.captionsOff():this.captionsOn()},e.prototype.captionsOn=function(){return this.active=!0,this.$el.trigger("Video.mediaEvent.captionsOn."+this.namespace)},e.prototype.captionsOff=function(){return this.active=!1,this.currCaption=null,this.$el.hide(),this.$el.trigger("Video.mediaEvent.captionsOff."+this.namespace)},e.prototype.onTimeUpdate=function(t,e){var i;return this.active?null!=(i=this.findCaption(e.currentTime))&&i!==this.currCaption?(this.$text.html(i.text),this.$el.show(),this.currCaption=i):void 0:this.$el.hide()},e.prototype.findCaption=function(t){var e;return e=t/1e3,_.filter(this.captions.cues,function(t){return(null!=t?t.startTime:void 0)<=e&&e<=(null!=t?t.endTime:void 0)}).reverse()[0]},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.videoPlayer.CommonControls=function(t){function e(){return this.onUnmuted=i(this.onUnmuted,this),this.onMuted=i(this.onMuted,this),this.onVolumeChange=i(this.onVolumeChange,this),this.setVolume=i(this.setVolume,this),this.onPause=i(this.onPause,this),this.onPlay=i(this.onPlay,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.namespace=t.namespace,this.$playBtn=this.$("a.video-play-btn"),this.$volumeBtn=this.$("a.video-volume-btn"),this.$volumeMenuBar=this.$("div.volume-menu-bar"),this.$volumeMenuBarIndicator=this.$("div.volume-menu-bar-indicator"),this.$volumeMenuBarHoverIndicator=this.$("div.volume-menu-bar-hoverIndicator"),this.$volumeMenuBar.on("click",this.setVolume),this.wireVideoEvent("play",this.onPlay),this.wireVideoEvent("pause",this.onPause),this.wireVideoEvent("volumeChange",this.onVolumeChange),this.wireVideoEvent("muted",this.onMuted),this.wireVideoEvent("unmuted",this.onUnmuted)},e.prototype.wireVideoEvent=function(t,e){return this.$el.parent().on("Video.mediaEvent."+t+"."+this.namespace,e)},e.prototype.onPlay=function(){return this.$playBtn.addClass("playing").attr("aria-label",this.i18n("VideoPlayer.pause"))},e.prototype.onPause=function(){return this.$playBtn.removeClass("playing").attr("aria-label",this.i18n("VideoPlayer.play"))},e.prototype.setVolume=function(t){var e,i,o;return t.stopPropagation(),o=this.getOffsetY(t),$(t.target).hasClass("volume-menu-bar-indicator")&&(o+=$(t.target).position().top),i=((e=this.$volumeMenuBar.height())-o)/e,this.$el.trigger("Video.control.setVolume",{volume:i})},e.prototype.onVolumeChange=function(t,e){var i;return i=100-100*e.volume,this.$volumeMenuBarIndicator.css({top:i})},e.prototype.onMuted=function(){return this.$volumeBtn.addClass("muted")},e.prototype.onUnmuted=function(){return this.$volumeBtn.removeClass("muted")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.videoPlayer.CommonTimeline=function(t){function e(){return this.previewPosition=i(this.previewPosition,this),this.onTimelineMouseout=i(this.onTimelineMouseout,this),this.onTimelineMouseover=i(this.onTimelineMouseover,this),this.scrubUp=i(this.scrubUp,this),this.onTimelineMousedown=i(this.onTimelineMousedown,this),this.onUpdate=i(this.onUpdate,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.listening=!0,e.prototype.initialize=function(t){return this.namespace=t.namespace,this.duration=t.duration,this.thumbs=t.thumbs,this.$timeline=this.$(".timeline"),this.$bar=this.$(".timeline-bar"),this.$handle=this.$(".timeline-handle"),window.isMobile?this.$timeline.on("click.Timeline",this.scrubMove):this.$timeline.on("mouseover.Timeline",this.onTimelineMouseover).on("mouseout.Timeline",this.onTimelineMouseout).on("mousedown.Timeline",this.onTimelineMousedown)},e.prototype.onUpdate=function(t,e){return this.currentTime=e.currentTime,this.updateDisplay(e.currentTime)},e.prototype.onTimelineMousedown=function(t){var e,i;return this.listening=!1,e=this.getLeftOffset(t),i=this.getTimeFromOffset(e),this.$body.on("mousemove.Timeline.scrub",this.scrubMove),this.$body.on("mouseup.Timeline.scrub",this.scrubUp),this.$el.trigger("VideoPlayer."+this.namespace+".seekToTime",{time:i})},e.prototype.scrubUp=function(t){return this.$body.off("mousemove.Timeline.scrub"),this.$body.off("mouseup.Timeline.scrub"),this.listening=!0},e.prototype.onTimelineMouseover=function(t){return this.previewPosition(t),this.$timeline.on("mousemove.Timeline.hover",this.previewPosition)},e.prototype.onTimelineMouseout=function(){var t;return this.$timeline.off("mousemove.Timeline.hover"),null!=(t=this.$thumbnail)&&t.clearQueue().remove(),this.$thumbnail=null},e.prototype.previewPosition=function(t){var e,i;return e=this.getLeftOffset(t),(i=Math.floor(this.getTimeFromOffset(e)))<0&&(i=0),null!=this.$thumbnail&&this.$thumbnail.remove(),this.renderThumbnail(i,e)},e.prototype.getTimeFromOffset=function(t){return this.duration*t/this.$timeline.width()},e.prototype.getOffsetFromTime=function(t){return+t/this.duration*this.$timeline.width()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.videoPlayer.EditorControls=function(t){function e(){return this.onForwardMouseup=i(this.onForwardMouseup,this),this.onForwardMousedown=i(this.onForwardMousedown,this),this.onRewindMouseup=i(this.onRewindMouseup,this),this.onRewindMousedown=i(this.onRewindMousedown,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.videoPlayer.CommonControls),e.prototype.initialize=function(t){return this.namespace=t.namespace,this.duration=t.duration,e.__super__.initialize.apply(this,arguments),this.$rewindBtn=this.$(".video-rewind-btn"),this.$forwardBtn=this.$(".video-forward-btn"),this.$rewindBtn.on("mousedown",this.onRewindMousedown).on("mouseup",this.onRewindMouseup),this.$forwardBtn.on("mousedown",this.onForwardMousedown).on("mouseup",this.onForwardMouseup)},e.prototype.onRewindMousedown=function(){return this.$el.trigger("VideoPlayer.stepBack"),this.rewindTimeout=setTimeout(this.onRewindMousedown,250)},e.prototype.onRewindMouseup=function(){return clearTimeout(this.rewindTimeout)},e.prototype.onForwardMousedown=function(){return this.$el.trigger("VideoPlayer.stepForward"),this.forwardTimeout=setTimeout(this.onForwardMousedown,250)},e.prototype.onForwardMouseup=function(){return clearTimeout(this.forwardTimeout)},e.prototype.wireVideoEvent=function(t,e){return this.$el.closest(".stage").on("Video.mediaEvent."+t+"."+this.namespace,e)},e}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty;Echo.widgets.videoPlayer.EditorTimeline=function(t){function n(){return this.onCutDragTrim=e(this.onCutDragTrim,this),this.restoreVideo=e(this.restoreVideo,this),this.onRestoreConfirmation=e(this.onRestoreConfirmation,this),this.onRestore=e(this.onRestore,this),this.onSave=e(this.onSave,this),this.onSaveAs=e(this.onSaveAs,this),this.onCut=e(this.onCut,this),this.onRevert=e(this.onRevert,this),this.onTrim=e(this.onTrim,this),this.onCutReverted=e(this.onCutReverted,this),this.onUpdate=e(this.onUpdate,this),this.onTimelineMousedown=e(this.onTimelineMousedown,this),this.getTrimDragBounds=e(this.getTrimDragBounds,this),this.scrubMove=e(this.scrubMove,this),this.onMouseout=e(this.onMouseout,this),this.onMouseover=e(this.onMouseover,this),this.onBeforeUnload=e(this.onBeforeUnload,this),this.onFreeze=e(this.onFreeze,this),this.onUnfreeze=e(this.onUnfreeze,this),n.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(n,Echo.widgets.videoPlayer.CommonTimeline),n.prototype.thumbnailTemplate=_.template('<div class="timeline-popup">\n  <p><%=text%></p>\n</div>'),n.prototype.cutTemplate=_.template('<div class="timeline-cut" id="<%=id%>">\n  <div class="start-marker cut-marker"></div>\n  <div class="end-marker cut-marker"></div>\n</div>'),n.prototype.initialize=function(t){var e;return this.mediaId=t.mediaId,this.namespace=t.namespace,this.duration=t.duration,this.thumbs=t.thumbs,this.clips=t.clips,this.unsavedEditsPresent=t.unsavedEditsPresent,n.__super__.initialize.apply(this,arguments),this.original,this.currentTime=0,this.cuts=[],this.defaultClip=[{start:0,end:this.duration}],this.options.clips=this.clips=null!=(e=this.clips)?e:this.defaultClip,this.previousClips=this.clips,this.$videoEditor=this.$el.closest(".video-editor"),this.$videoEditorControls=this.$el.closest(".video-editor-controls"),this.$cutBtn=this.$videoEditorControls.find(".editor-cut-btn"),this.$deleteBtn=this.$videoEditorControls.find(".editor-delete-btn"),this.$revertBtn=this.$videoEditorControls.find(".editor-revert-btn"),this.$currentTime=this.$videoEditorControls.find(".time-display span").first(),this.$duration=this.$videoEditorControls.find(".time-display span").last(),this.$timeline=this.$videoEditorControls.find(".timeline"),this.$restoreBtn=this.$videoEditor.find(".restore-btn"),this.$saveBtn=this.$videoEditor.find(".save-btn"),this.$saveAsBtn=this.$videoEditor.find(".save-as-btn"),this.applyClips(this.clips),this.initializeEvents(),this.updateDisplay(0)},n.prototype.updateDisplay=function(t){var e;if(!(t<0))return this.$currentTime.text(Echo.core.helpers.msToTime(t,{hideZeroHours:!0,showMilliseconds:!0})),this.$duration.text(Echo.core.helpers.msToTime(this.duration,{hideZeroHours:!0})),e=100*(1-(this.duration-t)/this.duration),this.$handle.css("left",e+"%")},n.prototype.initializeEvents=function(){return this.$el.on("Cut.dragTrim",this.onCutDragTrim).on("Cut.reverted",this.onCutReverted).on("Timeline.freezeUpdate",this.onFreeze).on("Timeline.unfreezeUpdate",this.onUnfreeze),this.$videoEditorControls.on("VideoEditor.cut",this.onCut).on("VideoEditor.revert",this.onRevert).on("VideoEditor.trim",this.onTrim),this.$body.on("VideoEditor.restore",this.onRestore).on("VideoEditor.save",this.onSave).on("VideoEditor.saveAs",this.onSaveAs),this.$el.closest(".stage").on("Video.mediaEvent.timeUpdate."+this.namespace,this.onUpdate),$(window).on("beforeunload",this.onBeforeUnload),this.$handle.on("mouseover",this.onMouseover).on("mouseout",this.onMouseout)},n.prototype.onUnfreeze=function(t){return this.$el.trigger("VideoPlayer."+this.namespace+".seekToTime",{time:this.currentTime}),this.freeze=!1},n.prototype.onFreeze=function(){return this.$el.trigger("VideoPlayer.pause"),this.freeze=!0},n.prototype.onBeforeUnload=function(t){this.isDirty()&&this.savePendingEdits()},n.prototype.onMouseover=function(){var t;if(!this.freeze)return null!=(t=this.findCutByTime(this.currentTime))?t.$el.addClass("hover"):void 0},n.prototype.onMouseout=function(){var t;if(!this.freeze)return null!=(t=this.findCutByTime(this.currentTime))?t.$el.removeClass("hover"):void 0},n.prototype.scrubMove=function(t){var e,i;return(e=this.getLeftOffset(t))<0&&(e=0),e>this.$timeline.width()&&(e=this.$timeline.width()),i=this.getTimeFromOffset(e),this.seeked=!0,this.$el.trigger("VideoPlayer."+this.namespace+".seekToTime",{time:i})},n.prototype.getTrimDragBounds=function(t){var e,i,o,n,s,r;return s=this.sortByTimestamp(),e=(n=this.findCutById(t,s))[0],r=0<=(o=n[1])-1&&s[o-1].trimmed!==e.trimmed?o-1:o,i=o+1<s.length&&s[o+1].trimmed!==e.trimmed?o+1:o,[s[r].start,s[i].end]},n.prototype.renderThumbnail=function(t,e){var i;return i=this.thumbnailTemplate({src:Echo.core.helpers.getThumbnailImage(this.thumbs,t),text:Echo.core.helpers.msToTime(t,{showMilliseconds:!0})}),this.$thumbnail=$(i).css({left:e-25,bottom:50}).appendTo(this.$el).show()},n.prototype.getLeftOffset=function(t){var e,i;return i=this.getOffsetX(t),(i=(e=$(t.target)).hasClass("tick")?e.position().left+2:e.hasClass("timeline-popup")?i-164:e.hasClass("timeline-handle")?this.$handle.position().left+i-2:e.hasClass("cut-marker")?e.parent().position().left+e.position().left+i:i+this.cutOffset(e))-1},n.prototype.onTimelineMousedown=function(t){return this.seeked=!0,n.__super__.onTimelineMousedown.call(this,t)},n.prototype.onUpdate=function(t,e){var i,o;if(this.$el.trigger("Timeline.update",e),!(!window.isMobile&&$(t.target).data("follow")||this.freeze)&&(n.__super__.onUpdate.call(this,t,e),o=this.sortByTimestamp(),null!=(i=this.findCutByTime(this.currentTime))))return!i.trimmed||this.seeked||this.freeze||this.skipTrimmedClips(i,o),i.trimmed||(this.seeked=!1),this.renderButtons()},n.prototype.cutOffset=function(t){return $(t).hasClass("timeline")||!$(t).hasClass("timeline-cut")?0:this.$(t).position().left},n.prototype.onCutReverted=function(t,e){var i,o,n,s,r,a,h,l;if(a=this.sortByTimestamp(),i=(s=this.findCutById(e,a))[0],n=s[1],null!=i&&(h=(r=[i.start,i.end,i.trimmed])[0],o=r[1],!(l=r[2])))return 0<n&&(h=this.mergeCuts(a[n-1],"start",h)),n<a.length-1&&(o=this.mergeCuts(a[n+1],"end",o)),i.$el.trigger("Cut.modify",{start:h,end:o,trimmed:l}),this.renderButtons(),this.savePendingEdits()},n.prototype.mergeCuts=function(t,e,i){var o,n,s;return t.trimmed?i:(n=t[e],(s=this.findCutById(t.id,this.cuts))[0],o=s[1],this.cuts.splice(o,1),t.dispose(),n)},n.prototype.sortByTimestamp=function(t){return t=t||this.cuts,_.sortBy(t,function(t){return t.start})},n.prototype.onTrim=function(){var t,e;return e=this.currentTime,null!=(t=this.findCutByTime(e))&&t.$el.trigger("Cut.trim"),this.renderButtons(),this.savePendingEdits()},n.prototype.onRevert=function(){var t,e;return e=this.currentTime,null!=(t=this.findCutByTime(e))?t.$el.trigger("Cut.revert"):void 0},n.prototype.findCutById=function(t,e){var i,o,n,s;for(null==e&&(e=this.cuts),o=n=0,s=e.length;n<s;o=++n)if((i=e[o]).id===t)return[i,o]},n.prototype.findCutByTime=function(t){var e,i,o,n,s;for(i=o=0,n=(s=this.cuts).length;o<n;i=++o)if((e=s[i]).start<=t&&t<e.end)return e},n.prototype.onCut=function(){var t;if(null!=(t=this.findCutByTime(this.currentTime))&&!(this.currentTime-t.start<500))return this.createCut(this.currentTime,t.end,t.trimmed),t.$el.trigger("Cut.modify",{start:t.start,end:this.currentTime,trimmed:t.trimmed}),this.renderButtons()},n.prototype.renderButtons=function(){var t;if(null!=(t=this.findCutByTime(this.currentTime)))return this.$revertBtn.toggle(t.trimmed),this.$deleteBtn.toggle(!t.trimmed),this.enableOrDisableButtons(this.$deleteBtn,this.otherCutsPresent(t)),this.enableOrDisableButtons(this.$restoreBtn,!this.isWhole()),this.enableOrDisableButtons(this.$saveBtn,this.isDirty()||this.unsavedEditsPresent),this.enableOrDisableButtons(this.$saveAsBtn,this.isDirty()||this.unsavedEditsPresent)},n.prototype.enableOrDisableButtons=function(t,e){var i;return i=e?"enable":"disable",t.trigger(i)},n.prototype.isWhole=function(){return 1===this.cuts.length&&0===this.cuts[0].start&&this.cuts[0].end===this.duration&&!1===this.cuts[0].trimmed},n.prototype.otherCutsPresent=function(e){return 0<_.filter(this.cuts,function(t){return t.id!==e.id&&!1===t.trimmed}).length},n.prototype.skipTrimmedClips=function(t,e){var i,o,n,s,r,a;for((a=this.findCutById(t.id,e))[0],n=a[1],o=s=0,r=e.length;s<r;o=++s)if(i=e[o],n<o){if(!i.trimmed)return this.seekToTime(Math.ceil(i.start)),!1;o===e.length-1&&this.seekToTime(Math.ceil(i.end))}if(n===e.length-1)return this.seekToTime(t.end)},n.prototype.seekToTime=function(t){return this.$el.trigger("VideoPlayer."+this.namespace+".seekToTime",{time:t})},n.prototype.createCut=function(t,e,i){var o,n,s;return s=Echo.core.helpers.uuid(),n=this.cutTemplate({id:s}),$(n).appendTo(this.$bar),o=new Echo.widgets.videoEditor.Cut({el:"#"+s,start:t,end:e,duration:this.duration,trimmed:i,currentTime:this.currentTime,namespace:this.namespace,getTrimDragBounds:this.getTrimDragBounds}),this.cuts.push(o)},n.prototype.onSaveAs=function(t,e){var i;return i=_.extend(this.getSaveClipData(),e),this.$el.trigger("VideoEditor.submitSaveAs",i)},n.prototype.onSave=function(){var t;return t=this.getSaveClipData(),this.$el.trigger("VideoEditor.submitSave",t)},n.prototype.isUncut=function(t){return 0===t.length||1===t.length&&0===t[0].start&&t[0].end===this.duration},n.prototype.getSaveClipData=function(){var t;return t=this.getClips(),this.isUncut(t)?{clips:[]}:{clips:this.packageClipData(t)}},n.prototype.packageClipData=function(t){return _.map(t,(e=this,function(t){return{mediaId:e.mediaId,clip:t}}));var e},n.prototype.sanitizeClipTimestamps=function(t){var e,i,o,n;for(i=o=0,n=t.length;o<n;i=++o)e=t[i],t[i].start=Math.floor(e.start),t[i].end=Math.floor(e.end);return t},n.prototype.savePendingEdits=function(){var t;if(0!==(t=this.getSaveClipData()).length)return this.ajax(Echo.routes.Videos.savePendingEdits(this.mediaId),{data:t})},n.prototype.getClips=function(){var t,e;return e=this.sortByTimestamp(),t=_.map(_.filter(e,function(t){return!t.trimmed}),function(t){return{start:t.start,end:t.end}}),t=this.sanitizeClipTimestamps(t),this.flattenClips(t)},n.prototype.onRestore=function(){return this.confirm("VideoEditor.confirmRestore",this.onRestoreConfirmation)},n.prototype.onRestoreConfirmation=function(){return this.compareClips(this.previousClips,this.defaultClip,!0)?this.persistRestore():this.restoreVideo()},n.prototype.restoreVideo=function(){return this.disposeCuts(),this.createCut(0,this.duration,!1),this.previousClips=this.defaultClip,this.renderButtons(),this.savePendingEdits(),alertify.success(this.i18n("VideoEditor.restoredSuccessfully"))},n.prototype.persistRestore=function(){return Echo.routes.Videos.restoreUnedited(this.mediaId).ajax({success:this.restoreVideo,error:(t=this,function(){return alertify.error(t.i18n("VideoEditor.restoreError"))})});var t},n.prototype.disposeCuts=function(){var t,e,i;for(t=0,e=(i=this.cuts).length;t<e;t++)i[t].dispose();return this.cuts=[]},n.prototype.isDirty=function(){return this.compareClips(this.getClips(),this.previousClips)},n.prototype.flattenClips=function(t){var e,i,o,n,s,r;for(r=[],s=t[0].start,i=o=0,n=t.length;o<n;i=++o)e=t[i],i<=t.length-1&&(i!==t.length-1&&e.end===t[i+1].start||(r.push({start:s,end:e.end}),i<t.length-1&&(s=t[i+1].start)));return 0===r.length?t:r},n.prototype.compareClips=function(t,e,i){var o,n,s,r,a,h;if(t.length!==e.length)return!0;for(n=!1,s=r=h=0,a=t.length;r<a;s=++r)if(h+=(o=t[s]).end-o.start,n=o.start!==e[s].start||o.end!==e[s].end)return n;return n||i&&h!==this.duration},n.prototype.applyClips=function(t){var e,i,o,n,s,r;for(r=this.sortByTimestamp(t),this.disposeCuts(),i=o=s=0,n=r.length;o<n;i=++o)(e=r[i]).start!==s&&this.createCut(s,e.start,!0),this.createCut(e.start,e.end,!1),s=e.end,i===r.length-1&&s!==this.duration&&this.createCut(s,this.duration,!0);return this.renderButtons()},n.prototype.onCutDragTrim=function(t,e){var i,o,n,s,r,a,h,l;return h=this.sortByTimestamp(),n=(a=this.findCutById(e.id,h))[0],r=a[1],0<=(o="start"===e.type?r-1:r+1)&&o<h.length&&(i=h[o]),null!=i&&i.trimmed?(l="start"===e.type?i.start:e.time,s="start"===e.type?e.time:i.end,i.$el.trigger("Cut.modify",{start:l,end:s,trimmed:i.trimmed})):(l="start"===e.type?n.start:e.time,s="start"===e.type?e.time:n.end,this.createCut(l,s,!0)),l="start"===e.type?e.time:n.start,s="start"===e.type?n.end:e.time,n.$el.trigger("Cut.modify",{start:l,end:s,trimmed:n.trimmed}),this.savePendingEdits(),this.renderButtons()},n}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.videoPlayer.Player=function(t){function e(){return this.onStepForward=i(this.onStepForward,this),this.onStepBack=i(this.onStepBack,this),this.decreasePlaybackSpeed=i(this.decreasePlaybackSpeed,this),this.increasePlaybackSpeed=i(this.increasePlaybackSpeed,this),this.rewindVideo=i(this.rewindVideo,this),this.restartVideo=i(this.restartVideo,this),this.fastForwardVideo=i(this.fastForwardVideo,this),this.togglePlay=i(this.togglePlay,this),this.pause=i(this.pause,this),this.play=i(this.play,this),this.videoEvent=i(this.videoEvent,this),this.onBackupTen=i(this.onBackupTen,this),this.onSeekToTime=i(this.onSeekToTime,this),this.onToggleResolution=i(this.onToggleResolution,this),this.onTogglePlay=i(this.onTogglePlay,this),this.onRightKey=i(this.onRightKey,this),this.onLeftKey=i(this.onLeftKey,this),this.shouldNavigateVideo=i(this.shouldNavigateVideo,this),this.onKeyup=i(this.onKeyup,this),this.onKeypress=i(this.onKeypress,this),this.onRequestForVideoTimeInSeconds=i(this.onRequestForVideoTimeInSeconds,this),this.onCanPlayThrough=i(this.onCanPlayThrough,this),this.onTimeUpdate=i(this.onTimeUpdate,this),this.initVideo=i(this.initVideo,this),this.loadVideo=i(this.loadVideo,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.SYNC_THRESHOLD=1e3,e.prototype.AUTO_RESOLUTION=!0,e.prototype.initialize=function(t){if(this.autoStart=t.autoStart,this.numScreens=t.numScreens,this.videoId=t.videoId,this.files=t.files,this.duration=t.duration,this.audioOnly=t.audioOnly,this.startTime=t.startTime,this.isMobile=t.isMobile,this.currBitrate=0,this.playing=this.autoStart,this.loadingOn(null,{theme:"dark content-modal",selector:".loading-area",opacity:"solid"}),this.findVideos(),this.$parent=this.$el.parent(),this.$videoControls=this.$(".videoControls"),this.$el.on("VideoPlayer.pause",this.pause).on("VideoPlayer.play",this.play).on("VideoPlayer.togglePlay",this.onTogglePlay).on("VideoPlayer.toggleResolution",this.onToggleResolution).on("VideoPlayer.backupTen",this.onBackupTen).on("VideoPlayer.stepForward",this.onStepForward).on("VideoPlayer.stepBack",this.onStepBack),this.$parent.on("keypress",this.onKeypress).on("keyup",this.onKeyup),this.$body.on("VideoPlayer."+this.videoId+".seekToTime",this.onSeekToTime),this.respondTo("videoTimeInSeconds",this.onRequestForVideoTimeInSeconds),this.audioOnly?Echo.core.helpers.canPlayMP3($("audio").get(0))||this.onBrowserNotSupported():Echo.core.helpers.canPlayH264($("video").get(0))||this.onBrowserNotSupported(),this.isMobile)return this.removeLoader()},e.prototype.findVideos=function(){return this.videos=_.map(this.$(".media.video , .media.audio"),this.loadVideo),this.video1=_.filter(this.videos,function(t){return t.primary}),this.video1=this.video1[0],this.video2=_.filter(this.videos,function(t){return!t.primary}),this.video2=this.video2[0],this.currBitrate=this.getBitrate(this.files.shift()),_.each(this.videos,this.initVideo)},e.prototype.loadVideo=function(t){var e;return{id:(e=$(t)).attr("id"),primary:e.data("primary"),aspectRatio:e.data("aspectratio"),$el:e,canPlayThrough:!1,time:this.startTime,packets:[]}},e.prototype.initVideo=function(i){var t,o;return i.$el.on("Video.mediaEvent.canPlayThrough",(t=this,function(){return i.canPlayThrough=!0,t.onCanPlayThrough()})),i.$el.on("Video.mediaEvent.timeUpdate",(o=this,function(t,e){return o.onTimeUpdate(t,e,i)}))},e.prototype.onTimeUpdate=function(t,e,i){if(i.time=e.currentTime,!i.primary)return this.checkSynchronization(i)},e.prototype.onCanPlayThrough=function(){if(this.canPlayThrough()&&(this.playing&&this.play(),this.removeLoader(),0!==this.$(".loading-background").length))return this.loadingOff()},e.prototype.removeLoader=function(){return this.$(".loading-area").fadeOut(300,function(){return $(this).remove()})},e.prototype.onRequestForVideoTimeInSeconds=function(){return{videoId:this.videoId,time:this.getPrimaryTime()}},e.prototype.onBrowserNotSupported=function(){if(this.$(".loading-background").hide().attr("aria-hidden",!0),this.$(".videoControls").remove(),this.audioOnly)return alertify.alert(this.i18n("Errors.audioPlaybackNotSupportedOnFirefoxMac"))},e.prototype.onKeypress=function(t){switch(t.which){case this.KEYS.HOME:return this.restartVideo();case this.KEYS.SPACE_BAR:return this.togglePlay()}},e.prototype.onKeyup=function(t){switch(t.which){case this.KEYS.ARROW_DOWN:return this.decreasePlaybackSpeed();case this.KEYS.ARROW_LEFT:return this.onLeftKey();case this.KEYS.ARROW_RIGHT:return this.onRightKey();case this.KEYS.ARROW_UP:return this.increasePlaybackSpeed()}},e.prototype.shouldNavigateVideo=function(){var t;return 0<(t=$(document.activeElement).closest(".stage")).length&&(0<t.find(".video.active").length||t.hasClass("preview-stage"))},e.prototype.onLeftKey=function(){if(this.shouldNavigateVideo())return this.rewindVideo()},e.prototype.onRightKey=function(){if(this.shouldNavigateVideo())return this.fastForwardVideo()},e.prototype.checkSynchronization=function(t){if(Math.abs(t.time-this.getPrimaryTime())>this.SYNC_THRESHOLD)return this.onSeekToTime(null,{time:this.getPrimaryTime()})},e.prototype.getPrimaryVideo=function(){return _.filter(this.videos,function(t){return t.primary}).shift()},e.prototype.getPrimaryTime=function(){return this.getPrimaryVideo().time},e.prototype.canPlayThrough=function(){return _.filter(this.videos,function(t){return t.canPlayThrough}).length===this.videos.length},e.prototype.getBitrate=function(t){var e;if(null!=(null!=t?t.primaryFile:void 0))return e=t.primaryFile.size,null!=t.secondaryFile&&(e+=t.secondaryFile.size),e/this.duration},e.prototype.getNextBiggestView=function(e){var t;return t=_.filter(this.files,function(t){return t.bitrate<e}),(t=_.sort(t,function(t){return t.size})).pop()},e.prototype.onTogglePlay=function(){return this.playing?this.pause():this.play()},e.prototype.onToggleResolution=function(t,e){if(this.AUTO_RESOLUTION=0===e.length,0!==e.length)return e=JSON.parse(e),this.currSize=e.video1.size,this.setSources(e.video1,e.video2)},e.prototype.onSeekToTime=function(t,e){return this.resetPlayability(),this.videoEvent("Video.pause"),this.seekToTime(e)},e.prototype.onBackupTen=function(t){var e;return e=this.getPrimaryTime(),this.$el.trigger("VideoPlayer.seekToTime",{time:e-1e4})},e.prototype.videoEvent=function(e,i){var t;return t=_.filter(this.videos,function(t){return t.primary}),_.each(t,function(t){return t.$el.trigger(e,i)}),_.each(this.videos,function(t){if(!t.primary)return t.$el.trigger(e,i)})},e.prototype.play=function(){return this.playing=!0,this.videoEvent("Video.play")},e.prototype.pause=function(){return this.playing=!1,this.videoEvent("Video.pause")},e.prototype.seekToTime=function(t){var e,i;return e=Math.floor(t.time),isFinite(t.time)||(e=0),i=null!=t.videoId?t.videoId:null,this.videoEvent("Video.seekToTime",{videoId:i,time:e})},e.prototype.resetPlayability=function(){return _.each(this.videos,function(t){return t.canPlayThrough=!1})},e.prototype.togglePlay=function(){return this.$el.trigger("VideoPlayer.togglePlay")},e.prototype.fastForwardVideo=function(){return this.triggerVideoControl("fastForward")},e.prototype.restartVideo=function(){return this.triggerVideoControl("restart")},e.prototype.rewindVideo=function(){return this.triggerVideoControl("rewind")},e.prototype.increasePlaybackSpeed=function(){return this.triggerVideoControl("speedUp")},e.prototype.decreasePlaybackSpeed=function(){return this.triggerVideoControl("speedDown")},e.prototype.triggerVideoControl=function(t){return this.$videoControls.trigger("Video.control."+t)},e.prototype.setSources=function(t,e){if(this.resetPlayability(),null!=this.video2&&null!=e&&this.video2.$el.trigger("Video.setSource",e),null!=this.video1&&null!=t)return this.video1.$el.trigger("Video.setSource",t)},e.prototype.downgradeVideo=function(){var t;return t=this.getNextBiggestView(this.currBitrate),this.setSource(t.primaryFile,t.secondaryFile)},e.prototype.onStepBack=function(){var t;return t=this.getPrimaryTime(),this.$el.trigger("VideoPlayer.seekToTime",{time:t-250})},e.prototype.onStepForward=function(){var t;return t=this.getPrimaryTime(),this.$el.trigger("VideoPlayer.seekToTime",{time:t+250})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,h=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.widgets.videoPlayer.PlayerControls=function(t){function e(){return this.onToggleCaptions=i(this.onToggleCaptions,this),this.stopPropagationOnEnterAndSpace=i(this.stopPropagationOnEnterAndSpace,this),this.onVolumeKeyup=i(this.onVolumeKeyup,this),this.onResize=i(this.onResize,this),this.onToggleResolution=i(this.onToggleResolution,this),this.onTimelineDisplay=i(this.onTimelineDisplay,this),this.onSetSpeed=i(this.onSetSpeed,this),this.onFetchCaptionsError=i(this.onFetchCaptionsError,this),this.onCaptionsOff=i(this.onCaptionsOff,this),this.onCaptionsOn=i(this.onCaptionsOn,this),this.onTimeUpdate=i(this.onTimeUpdate,this),this.addTouchListeners=i(this.addTouchListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.videoPlayer.CommonControls),e.prototype.initialize=function(t){if(this.namespace=t.namespace,e.__super__.initialize.apply(this,arguments),this.$timeline=this.$("div.video-timeline"),this.$timelineDisplay=this.$("div.video-timeline-display"),this.$speedCtrl=this.$(".videoControls-speed"),this.$speedCtrlInfo=this.$(".speed-menu-info"),this.$speedMenu=this.$(".speed-menu"),this.$captionsBtn=this.$("a.video-captions-btn"),this.$fullscreenBtn=this.$("a.video-fullscreen-btn"),this.$rewindBtn=this.$("a.video-rewind-btn"),this.$resolutionOptions=this.$("a.resolutionOption"),this.$resolutionMenuItem=this.$(".settings-menu-info"),this.$el.keyboardFocusable("a.video-volume-btn"),this.$el.keyboardFocusable(".videoControls-speed"),this.$el.keyboardFocusable(".videoControls-settings"),this.$el.on("Timeline.display",this.onTimelineDisplay).on("VideoPlayer.toggleResolution",this.onToggleResolution).on("Video.control.toggleCaptions",this.onToggleCaptions).on("keypress",".video-volume-btn",this.stopPropagationOnEnterAndSpace).on("keypress",".video-captions-btn",this.stopPropagationOnEnterAndSpace).on("keypress",".video-fullscreen-btn",this.stopPropagationOnEnterAndSpace).on("keypress",".video-rewind-btn",this.stopPropagationOnEnterAndSpace).on("keypress",".video-play-btn",this.stopPropagationOnEnterAndSpace).on("keyup",".video-volume-btn",this.onVolumeKeyup),this.$doc.on("resize",this.onResize),this.$stage=this.$el.closest(".stage"),this.$stage.on("View.fetchCaptions.error",this.onFetchCaptionsError),this.wireVideoEvent("timeUpdate",this.onTimeUpdate),this.wireVideoEvent("captionsOn",this.onCaptionsOn),this.wireVideoEvent("captionsOff",this.onCaptionsOff),this.wireVideoEvent("setSpeed",this.onSetSpeed),window.isMobile)return this.addTouchListeners()},e.prototype.addTouchListeners=function(){return this.$("a").on("hover",(e=this,function(t){return e.$(t.target).trigger("click")}));var e},e.prototype.onTimeUpdate=function(t,e){if(window.isMobile||!$(t.target).data("follow"))return this.$timeline.trigger("Timeline.update",e)},e.prototype.onCaptionsOn=function(){return this.$captionsBtn.addClass("active")},e.prototype.onCaptionsOff=function(){return this.$captionsBtn.removeClass("active")},e.prototype.onFetchCaptionsError=function(){return this.$captionsBtn.remove(),this.$(".videoControls-spacer.captions").addClass("hide")},e.prototype.onSetSpeed=function(t,e){return this.$speedCtrlInfo.text(e.speed+"x").parent().attr("aria-label",this.i18n("VideoPlayer.speedLabel",e.speed+"x"))},e.prototype.onTimelineDisplay=function(t,e){return this.$timelineDisplay.text(e.text).attr("aria-label",this.i18n("VideoPlayer.timeLabel",e.text))},e.prototype.onToggleResolution=function(t,e){return e=JSON.parse(e),this.$resolutionOptions.removeClass("active"),$(t.target).addClass("active"),this.$resolutionMenuItem.toggleClass("hd",e.isHD)},e.prototype.onResize=function(t){var e,i,o,n,s,r,a;return i=window.innerWidth,e=0<=h.call(function(){r=[];for(var t=o=window.screen.width-5,e=window.screen.width;o<=e?t<=e:e<=t;o<=e?t++:t--)r.push(t);return r}.apply(this),i)&&(n=window.innerHeight,0<=h.call(function(){a=[];for(var t=s=window.screen.height-5,e=window.screen.height;s<=e?t<=e:e<=t;s<=e?t++:t--)a.push(t);return a}.apply(this),n)),this.$fullscreenBtn.toggleClass("fullscreen-on",e)},e.prototype.onVolumeKeyup=function(t){switch(t.which){case this.KEYS.ARROW_UP:return t.stopPropagation(),this.$el.trigger("Video.control.volumeUp");case this.KEYS.ARROW_DOWN:return t.stopPropagation(),this.$el.trigger("Video.control.volumeDown")}},e.prototype.stopPropagationOnEnterAndSpace=function(t){var e;if((e=t.which)===this.KEYS.ENTER||e===this.KEYS.SPACE_BAR)return t.stopPropagation()},e.prototype.onToggleCaptions=function(){return this.$captionsBtn.toggleClass("active")},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.videoPlayer.PlayerTimeline=function(t){function i(){var t,e;return this.scrubMove=(t=this.scrubMove,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.videoPlayer.CommonTimeline),i.prototype.thumbnailTemplate=_.template('<div class="timeline-popup">\n  <% if (src !== null) { %>\n    <div class="timeline-popup-image">\n      <img src="<%=src%>" alt="">\n      <div class=\'loading-background clear shown\'>\n        <div class=\'loading\'>\n          <div class=\'loading-group\'>\n            <span></span>\n            <span></span>\n            <span></span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <% } %>\n  <p><%=text%></p>\n</div>'),i.prototype.initialize=function(t){return this.namespace=t.namespace,this.duration=t.duration,this.thumbs=t.thumbs,i.__super__.initialize.apply(this,arguments),this.$el.on("Timeline.update",this.onUpdate),this.updateDisplay(0)},i.prototype.updateDisplay=function(t){var e,i,o;return i=100*(1-(this.duration-t)/this.duration),this.$bar.css("width",i+"%"),this.$handle.css("left",i+"%"),e=Echo.core.helpers.msToTime(t,{hideZeroHours:!0}),o=Echo.core.helpers.msToTime(this.duration,{hideZeroHours:!0}),this.$el.trigger("Timeline.display",{text:e+" / "+o})},i.prototype.scrubMove=function(t){var e,i;return(e=t.clientX-this.$timeline.offset().left)<0&&(e=0),e>this.$timeline.width()&&(e=this.$timeline.width()),i=this.getTimeFromOffset(e),this.$el.trigger("VideoPlayer."+this.namespace+".seekToTime",{time:i})},i.prototype.renderThumbnail=function(t,e){var i;return i=this.thumbnailTemplate({src:Echo.core.helpers.getThumbnailImage(this.thumbs,t),text:Echo.core.helpers.msToTime(t)}),this.$thumbnail=$(i).css({left:e-54}).appendTo(this.$el).show()},i.prototype.getLeftOffset=function(t){var e;return e=this.getOffsetX(t),$(t.target).hasClass("tick")?$(t.target).position().left+2:$(t.target).hasClass("timeline-popup")?e-164:e},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.videoPlayer.ResolutionSwitcher=function(t){function e(){return this.onSettingsBlur=i(this.onSettingsBlur,this),this.selectOption=i(this.selectOption,this),this.onSettingsKeypress=i(this.onSettingsKeypress,this),this.onSettingsKeyup=i(this.onSettingsKeyup,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$settingsMenu=this.$(".settings-menu"),this.$options=this.$("a.resolutionOption"),this.$el.on("keypress",this.onSettingsKeypress).on("keyup",this.onSettingsKeyup).on("keypress",".resolutionOption",this.selectOption).on("blur",this.onSettingsBlur),this.$options.removeClass("selected").filter(".active").addClass("selected")},e.prototype.onSettingsKeyup=function(t){var e;if((e=t.which)===this.KEYS.ARROW_UP||e===this.KEYS.ARROW_DOWN)return this.toggleResolution(t)},e.prototype.onSettingsKeypress=function(t){var e;if((e=t.which)===this.KEYS.ENTER||e===this.KEYS.SPACE_BAR)return t.stopPropagation(),this.$options.attr("tabindex",0)},e.prototype.selectOption=function(t){var e;if((e=t.which)===this.KEYS.ENTER||e===this.KEYS.SPACE_BAR)return t.stopPropagation(),this.$options.filter(".selected").trigger("click"),this.onSettingsBlur()},e.prototype.onSettingsBlur=function(){return this.$options.attr("tabindex",-1)},e.prototype.toggleResolution=function(t){var e,i;if("none"!==this.$settingsMenu.css("display")){if(t.stopPropagation(),e=this.$options.filter(".selected"),t.which===this.KEYS.ARROW_UP){if(0===this.$options.index(e))return;i=e.prev(".resolutionOption")}else{if(this.$options.index(e)===this.$options.length-1)return;i=e.next(".resolutionOption")}return this.$options.removeClass("selected"),i.addClass("selected").focus()}},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.videoPlayer.Video=function(t){function e(){return this.onFocus=i(this.onFocus,this),this.onVolumeChange=i(this.onVolumeChange,this),this.onTimeUpdate=i(this.onTimeUpdate,this),this.onSuspend=i(this.onSuspend,this),this.onSeeking=i(this.onSeeking,this),this.onSeeked=i(this.onSeeked,this),this.onPlaying=i(this.onPlaying,this),this.onPlay=i(this.onPlay,this),this.onPause=i(this.onPause,this),this.onLoadedMetadata=i(this.onLoadedMetadata,this),this.onCanPlayThrough=i(this.onCanPlayThrough,this),this.onCanPlay=i(this.onCanPlay,this),this.viewContinue=i(this.viewContinue,this),this.onRequestForVideoTimeInSeconds=i(this.onRequestForVideoTimeInSeconds,this),this.fastForward=i(this.fastForward,this),this.rewind=i(this.rewind,this),this.toggleFullScreen=i(this.toggleFullScreen,this),this.toggleMute=i(this.toggleMute,this),this.setVolumeDown=i(this.setVolumeDown,this),this.setVolumeUp=i(this.setVolumeUp,this),this.setVolume=i(this.setVolume,this),this._setVolume=i(this._setVolume,this),this.setSpeedDown=i(this.setSpeedDown,this),this.setSpeedUp=i(this.setSpeedUp,this),this.setSpeed=i(this.setSpeed,this),this._setSpeed=i(this._setSpeed,this),this._seekToTime=i(this._seekToTime,this),this.seekToTime=i(this.seekToTime,this),this.pause=i(this.pause,this),this.play=i(this.play,this),this.setSource=i(this.setSource,this),this.onInterval=i(this.onInterval,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.VIEW_INTERVAL=30,e.prototype.initialize=function(t){if(this.autoMute=t.autoMute,this.files=t.files,this.follow=t.follow,this.silent=t.silent,this.startTime=t.startTime,this.videoId=t.videoId,this.$loader=this.$(".loading-background"),this.$time=this.$(".time"),this.isAudio=0<this.$("audio").length,this.$media=this.isAudio?this.$("audio"):this.$("video"),this.mediaEl=this.$media.get(0),this.autoMute&&(this.mediaEl.muted="muted"),this.isAudio){if(!Echo.core.helpers.canPlayMP3(this.mediaEl))return void this.cannotPlay()}else if(!Echo.core.helpers.canPlayH264(this.mediaEl))return void this.cannotPlay();if(this.playing=!1,this.speed=1,this.currentTime=this.startTime?this.startTime/1e3:0,this.canPlayThrough=!1,this.metadataLoaded=!1,this.justLoaded=!0,this.firstFrameSeek=.1,this.seekTolerance=15,this.readyStateInterval=setInterval(this.onInterval,1e3),this.chooseFile(),this.mediaEl.volume=this.silent?0:1,this.$media.on("abort",this.onAbort).on("canplay",this.onCanPlay).on("canplaythrough",this.onCanPlayThrough).on("durationchange",this.onDurationChange).on("emptied",this.onEmptied).on("ended",this.onEnded).on("error",this.onError).on("loadeddata",this.onLoadedData).on("loadedmetadata",this.onLoadedMetadata).on("loadstart",this.onLoadStart).on("pause",this.onPause).on("play",this.onPlay).on("playing",this.onPlaying).on("progress",this.onProgress).on("ratechange",this.onRateChange).on("seeked",this.onSeeked).on("seeking",this.onSeeking).on("stalled",this.onStalled).on("suspend",this.onSuspend).on("timeupdate",this.onTimeUpdate).on("volumechange",this.onVolumeChange).on("waiting",this.onWaiting),this.$el.parent().on("Video.control.fastForward",this.fastForward).on("Video.control.setVolume",this.setVolume).on("Video.control.volumeDown",this.setVolumeDown).on("Video.control.volumeUp",this.setVolumeUp).on("Video.control.rewind",this.rewind).on("Video.control.setSpeed",this.setSpeed).on("Video.control.speedDown",this.setSpeedDown).on("Video.control.speedUp",this.setSpeedUp).on("Video.control.toggleFullScreen",this.toggleFullScreen).on("Video.control.toggleMute",this.toggleMute),this.$el.on("Video.seekToTime",this.seekToTime).on("Video.play",this.play).on("Video.pause",this.pause).on("Video.setSource",this.setSource).on("Video.focus",this.onFocus),!this.$el.data("follow"))return this.respondTo("videoTimeInSeconds",this.onRequestForVideoTimeInSeconds)},e.prototype.showLoader=function(){var t;if(null==this.loaderTimeout)return this.loaderTimeout=setTimeout((t=this,function(){return t.$el.trigger("loading.on",{theme:"dark",opacity:"transparent"})}),500)},e.prototype.hideLoader=function(){return clearTimeout(this.loaderTimeout),this.loaderTimeout=null,this.$el.trigger("loading.off")},e.prototype.onInterval=function(){if(4===this.mediaEl.readyState&&(this.justLoaded&&!this.isAudio&&(this._seekToTime(this.firstFrameSeek),this.justLoaded=!1),this.hideLoader(),!this.canPlayThrough))return this.onCanPlay(),this.onCanPlayThrough()},e.prototype.chooseFile=function(){var t;return t=_.sortBy(this.files,function(t){return-t.quality}),this.setSource(null,t.shift())},e.prototype.cannotPlay=function(){return this.hideLoader(),this.$time.hide(),this.$el.addClass("broken"),this.$el.trigger("Video.browserNotSupported")},e.prototype.setSource=function(t,e){return(this.currFile=e).uri?this.mediaEl.src=e.uri:this.$media.removeAttr("src")},e.prototype.play=function(){var t;if(this.mediaEl.src)return null!=(t=this.mediaEl.play())&&"function"==typeof t.then&&t.then(null,function(t){return{}}),this.follow?void 0:this.$el.trigger("Video.recordPlay",{time:this.mediaEl.currentTime})},e.prototype.pause=function(){return this.mediaEl.pause()},e.prototype.seekToTime=function(t,e){if(null==(null!=e?e.videoId:void 0)||(null!=e?e.videoId:void 0)===this.videoId)return this.canPlayThrough=!1,this.mediaEvent("timeUpdate",{currentTime:e.time}),this.showLoader(),this.currentTime=e.time/1e3,this._seekToTime(this.currentTime)},e.prototype._seekToTime=function(t){return t=Echo.core.helpers.clamp(t,{min:0}),this.viewStop(),0!==this.mediaEl.readyState&&this.mediaEl.duration&&(this.mediaEl.currentTime=t),this.viewStart()},e.prototype._setSpeed=function(t){return t=Echo.core.helpers.clamp(t,{min:.5,max:2}),t=Math.round(10*t)/10,this.mediaEl.playbackRate=this.speed=t,this.mediaEvent("setSpeed",{speed:t})},e.prototype.setSpeed=function(t,e){return this._setSpeed(e.speed)},e.prototype.setSpeedUp=function(){return this._setSpeed(this.speed+.1)},e.prototype.setSpeedDown=function(){return this._setSpeed(this.speed-.1)},e.prototype._setVolume=function(t){if(!this.silent)return t=Echo.core.helpers.clamp(t,{min:0,max:1}),this.mediaEl.volume=t,this.mediaEl.muted?(this.mediaEl.muted="",this.mediaEvent("unmuted")):void 0},e.prototype.setVolume=function(t,e){return this._setVolume(e.volume)},e.prototype.setVolumeUp=function(){return this._setVolume(this.mediaEl.volume+.1)},e.prototype.setVolumeDown=function(){return this._setVolume(this.mediaEl.volume-.1)},e.prototype.toggleMute=function(){var t;if(!this.silent)return t=this.mediaEl.muted?(this.mediaEl.muted="","unmuted"):this.mediaEl.muted="muted",this.mediaEvent(t)},e.prototype.toggleFullScreen=function(){if(this.$el.hasClass("active"))return this.$el.trigger("Stage.toggleFullScreen")},e.prototype.rewind=function(){return this._seekToTime(this.mediaEl.currentTime-5)},e.prototype.fastForward=function(){return this._seekToTime(this.mediaEl.currentTime+5)},e.prototype.onRequestForVideoTimeInSeconds=function(){return{videoId:this.videoId,time:this.mediaEl.currentTime}},e.prototype.viewStart=function(){if(!this.follow)return this.viewStartTime=this.mediaEl.currentTime,this.setViewTimeout()},e.prototype.viewStop=function(){if(!this.follow)return this.clearViewTimeout(),this.logView()},e.prototype.viewContinue=function(){if(!this.follow)return this.logView(),this.setViewTimeout()},e.prototype.setViewTimeout=function(){return this.clearViewTimeout(),this.viewTimeout=setTimeout(this.viewContinue,1e3*this.VIEW_INTERVAL)},e.prototype.clearViewTimeout=function(){return clearTimeout(this.viewTimeout)},e.prototype.logView=function(){var t;if(!((t=this.mediaEl.currentTime)-this.viewStartTime<10))return this.updateView(this.viewStartTime,t),this.viewStartTime=t},e.prototype.updateView=function(t,e){return this.triggerTimeView(t,e)},e.prototype.triggerTimeView=function(t,e){return this.$el.trigger("Video.timeView",{startTime:t,endTime:e,videoId:this.videoId})},e.prototype.mediaEvent=function(t,e){return this.$el.trigger("Video.mediaEvent."+t,e),this.$el.trigger("Video."+this.videoId+"."+t,e)},e.prototype.onCanPlay=function(){return this.mediaEvent("canPlay")},e.prototype.onCanPlayThrough=function(){return this.canPlayThrough=!0,this.hideLoader(),this.mediaEvent("canPlayThrough")},e.prototype.onLoadedMetadata=function(){return this.mediaEvent("loadedMetadata"),this.mediaEl.currentTime=this.currentTime,this.metadataLoaded=!0},e.prototype.onPause=function(){return this.viewStop(),this.playing=!1,this.mediaEvent("pause")},e.prototype.onPlay=function(){return this.hideLoader(),this.metadataLoaded&&(this.mediaEl.currentTime=this.currentTime),this.viewStart(),this.playing=!0,this.mediaEvent("play")},e.prototype.onPlaying=function(){return this.hideLoader(),this.playing=!0,this.mediaEvent("playing")},e.prototype.onSeeked=function(){return this.hideLoader(),this.mediaEvent("seeked")},e.prototype.onSeeking=function(){return this.showLoader(),this.mediaEvent("seeking")},e.prototype.onSuspend=function(){return this.hideLoader(),this.mediaEvent("suspend")},e.prototype.onTimeUpdate=function(t){var e;if(this.hideLoader(),null==(e=t.currentTarget)||!e.paused)return this.currentTime=t.currentTarget.currentTime,this.mediaEvent("timeUpdate",{currentTime:1e3*this.currentTime})},e.prototype.onVolumeChange=function(t){if(!this.silent)return this.mediaEvent("volumeChange",{volume:t.target.volume})},e.prototype.onFocus=function(t,e){if(null!=e.videoId)return this.$el.trigger("click")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,s=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.pages.admin.captures.CaptureItem=function(t){function e(){return this.onUpdateCapture=i(this.onUpdateCapture,this),this.getScheduleId=i(this.getScheduleId,this),this.resetHighlight=i(this.resetHighlight,this),this.onDeleteError=i(this.onDeleteError,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.onDeleteConfirmation=i(this.onDeleteConfirmation,this),this.onDelete=i(this.onDelete,this),this.onReplaceCaptureItem=i(this.onReplaceCaptureItem,this),this.onReprocessError=i(this.onReprocessError,this),this.onReprocessStarted=i(this.onReprocessStarted,this),this.onReprocess=i(this.onReprocess,this),this.onScheduleEdit=i(this.onScheduleEdit,this),this.onCaptureEdit=i(this.onCaptureEdit,this),this.onPublish=i(this.onPublish,this),this.onAdminListDelete=i(this.onAdminListDelete,this),this.onCaptureEdited=i(this.onCaptureEdited,this),this.onClick=i(this.onClick,this),this.onCopyError=i(this.onCopyError,this),this.onCopySuccess=i(this.onCopySuccess,this),this.onCopy=i(this.onCopy,this),this.onCaptureUpdated=i(this.onCaptureUpdated,this),this.wireClicks=i(this.wireClicks,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.captureId=t.captureId,this.captureStatus=t.captureStatus,this.mediaId=t.mediaId,this.$name=this.$(".publishInfo .secondary"),this.$el.on("AdminListItem.delete",this.onAdminListDelete).on("Captures.capture.view",this.onClick).on("Captures.capture.publish",this.onPublish).on("Captures.capture.edit",this.onCaptureEdit).on("Captures.capture.reprocess",this.onReprocess).on("Captures.capture.delete",this.onDelete).on("Captures.capture.copy",this.onCopy),this.wireClicks(),this.disposeIfExists()},e.prototype.bodyListeners=function(){var t;return(t={})["Capture."+this.getScheduleId()+".edited"]=this.onCaptureEdited,t["AjaxForm.captureModal.success"]=this.resetHighlight,t["CaptureItem.edited"]=this.resetHighlight,t["CaptureItem."+this.options.captureId+".updated"]=this.onCaptureUpdated,t["CaptureItem."+this.options.captureId+".replace"]=this.onReplaceCaptureItem,t["Capture."+this.options.captureId+".updateCapture"]=this.onUpdateCapture,t["Modal.addCapture.onClose"]=this.wireClicks,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.disposeIfExists=function(){if(0<this.$el.siblings("[data-id="+this.captureId+"]:not(.toBeDeleted)").length)return this.dispose()},e.prototype.wireClicks=function(){return this.$el.off("click").on("click",this.onClick)},e.prototype.onCaptureUpdated=function(t,e){return this.$body.trigger("CaptureItem.edited",{html:[{captureId:this.captureId}]}),e.name?this.$name.text(e.name):this.$name.html('<span class="untitled-capture">\n  '+this.i18n("Admin.captures.untitled")+"\n</span>"),this.$el.addClass("editedItem")},e.prototype.onCopy=function(){return this.confirm("Captures.createCopy.confirm",(t=this,function(){return Echo.routes.Media.copyCapture(t.captureId).ajax({beforeSend:function(){return t.loadingOn(null,{fixed:!0})},success:t.onCopySuccess,complete:t.loadingOff,error:t.onCopyError})}));var t},e.prototype.onCopySuccess=function(){return alertify.success(this.i18n("Captures.createCopy.success"))},e.prototype.onCopyError=function(){return alertify.error(this.i18n("Captures.createCopy.error"))},e.prototype.onClick=function(t){var e;if(!this.$(t.target).hasClass("adminTable-itemCheckbox")&&"Capturing"!==this.captureStatus)return this.$el.off("click"),"Scheduled"===this.captureStatus?this.onScheduleEdit():null!=this.mediaId?(e=$.param(Echo.helpers.Location.parseHash()),window.location.assign(Echo.routes.Media.details(this.mediaId).url+"?"+e)):void 0},e.prototype.onCaptureEdited=function(t,e){return this.$el.addClass("toBeDeleted"),this.dispose()},e.prototype.onAdminListDelete=function(){return this.$el.addClass("toBeDeleted").trigger("AdminListItem.deleted",{captureStatus:this.captureStatus}),this.dispose()},e.prototype.onPublish=function(){return this.injectFromUrl(Echo.routes.Publish.capturePublisherModal(this.captureId))},e.prototype.onCaptureEdit=function(){return this.injectFromUrl(Echo.routes.Media.captureEditorModal(this.captureId))},e.prototype.onScheduleEdit=function(){return this.injectFromUrl(Echo.routes.CaptureSchedules.editModal(this.getScheduleId()))},e.prototype.onReprocess=function(){return this.ajax(Echo.routes.MediaUpload.retryCapture(),{data:{captureId:this.captureId},success:this.onReprocessStarted,error:this.onReprocessError})},e.prototype.onReprocessStarted=function(t){return alertify.success(this.i18n("Admin.captures.reprocessStarted")),this.$el.trigger("CaptureItem.reprocessStarted",t.data[0])},e.prototype.onReprocessError=function(){return alertify.error(this.i18n("Admin.captures.reprocessError"))},e.prototype.onReplaceCaptureItem=function(t,e){return this.$el.trigger("AdminListTable.decrementCount",{captureStatus:this.captureStatus}),this.$el.trigger("AdminListTable.incrementCount",{captureStatus:e.data.captureStatus}),e.replace?this.$el.addClass("toBeDeleted").after(e.data.html):this.$el.addClass("toBeDeleted").trigger("CaptureItem.edited",{html:[e.data]}),this.dispose()},e.prototype.onDelete=function(){return this.confirm("Admin.captures.deleteConfirmationSingle",this.onDeleteConfirmation)},e.prototype.onDeleteConfirmation=function(){var t;return t={occurrenceIds:"Scheduled"!==this.captureStatus?[this.captureId]:[],scheduledIds:"Scheduled"===this.captureStatus?[this.captureId]:[]},this.$el.trigger("loading.on"),this.ajax(Echo.routes.Captures.delete(),{data:t,success:this.onDeleteSuccess,error:this.onDeleteError})},e.prototype.onDeleteSuccess=function(){return alertify.success(this.i18n("Admin.captures.single.deleteSuccess")),this.$el.addClass("toBeDeleted").trigger("AdminListItem.deleted",{captureStatus:this.captureStatus}),this.$el.trigger("loading.off"),this.dispose()},e.prototype.onDeleteError=function(t){var e,i,o;return e=null!=(i=null!=t&&null!=(o=t.responseJSON)?o.message:void 0)?i:"Admin.captures.single.deleteError",alertify.error(this.i18n(e)),this.$el.trigger("loading.off")},e.prototype.resetHighlight=function(t,e){var i,o;if(i=_.map(e.html,function(t){return t.captureId}),o=this.captureId,s.call(i,o)<0)return this.$el.removeClass("editedItem")},e.prototype.getScheduleId=function(){return this.options.captureId.split("_")[0]},e.prototype.onUpdateCapture=function(t,e){return this.$el.trigger("Captures.updateCaptureStatus",e)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.configurations.AddLmsProfileModal=function(t){function e(){return this.onAddAjaxError=i(this.onAddAjaxError,this),this.onlmsNameTextChange=i(this.onlmsNameTextChange,this),this.onlmsNameOptionChange=i(this.onlmsNameOptionChange,this),this.onAddAjaxSuccess=i(this.onAddAjaxSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$lmsNameOption=this.$('[name="lmsNameOption"]'),this.$lmsNameText=this.$('[name="lmsNameText"]'),this.$lmsNameTextField=this.$(".field.lmsName-text"),this.$lmsName=this.$('input[name="lmsName"]'),this.$el.on("AjaxForm.addLmsProfile.success",this.onAddAjaxSuccess).on("AjaxForm.addLmsProfile.error",this.onAddAjaxError),this.$lmsNameOption.on("change",this.onlmsNameOptionChange),this.$lmsNameText.on("input",this.onlmsNameTextChange),this.$lmsNameOption.trigger("change")},e.prototype.onAddAjaxSuccess=function(t,e){return alertify.success(this.i18n("LmsProfiles.createProfile.success")),this.$el.trigger("LmsProfiles.added",e.html),this.$el.trigger("Modal.addLmsProfile.close")},e.prototype.onlmsNameOptionChange=function(t){switch(this.$lmsNameOption.val()){case"Other":this.$lmsNameTextField.show();break;default:this.$lmsNameTextField.hide()}return this.onlmsNameTextChange()},e.prototype.onlmsNameTextChange=function(t){switch(this.$lmsNameOption.val()){case"Other":return this.$lmsName.val(this.$lmsNameText.val());default:return this.$lmsName.val(this.$lmsNameOption.val())}},e.prototype.onAddAjaxError=function(t,e){var i,o,n,s;if(null!=(null!=e?e.formErrors:void 0)){for(i in s=[],n=e.formErrors)switch("error.path.missing"===(o=n[i][0].msg)&&(o="LmsProfiles.error.noBlankLmsName"),o=this.i18n(o),i){case"obj.lmsName":switch(this.$lmsNameOption.val()){case"Other":s.push(this.$lmsNameText.trigger("Input.setError",o));break;default:s.push(this.$lmsNameOption.trigger("Input.setError",o))}break;default:s.push(alertify.error(this.i18n("LmsProfiles.editProfile.error")))}return s}},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.admin.configurations.AddZoomProfileModal=function(t){function i(){var t,e;return this.onAddAjaxSuccess=(t=this.onAddAjaxSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("AjaxForm.addZoomProfile.success",this.onAddAjaxSuccess)},i.prototype.onAddAjaxSuccess=function(t,e){return this.$el.trigger("ZoomProfiles.added",e.html),this.$el.trigger("Modal.addZoomProfile.close")},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.configurations.ApiClientConfigurations=function(t){function e(){return this.clearErrors=i(this.clearErrors,this),this.onDeleteError=i(this.onDeleteError,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.onOldDelete=i(this.onOldDelete,this),this.onDelete=i(this.onDelete,this),this.onError=i(this.onError,this),this.onSuccess=i(this.onSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$existingClients=this.$(".existing-clients ul"),this.$placeholder=this.$(".placeholder-text"),this.$switches=this.$("input[type=checkbox]"),this.$el.on("AjaxForm.success",this.onSuccess).on("AjaxForm.error",this.onError).on("OldClient.configuration.remove",this.onOldDelete).on("Client.configuration.remove",this.onDelete),this.$switches.on("change",this.clearErrors),this.toggleEmpty()},e.prototype.createMessage=function(t,e){return this.i18n("Admin.ApiClient.createMessage")+"<br/><br/><b>"+this.i18n("Admin.ApiClient.clientId")+":</b> "+t+"<br/><b>"+this.i18n("Admin.ApiClient.clientSecret")+":</b> "+e},e.prototype.onSuccess=function(t,e){return alertify.success(this.i18n("Admin.ApiClient.createSuccess")),alertify.confirm(this.createMessage(e.clientId,e.clientSecret)),this.$existingClients.append(e.html),this.$("form").trigger("AjaxForm.reset"),this.toggleEmpty()},e.prototype.onError=function(t,e){if(null==e.formErrors)return null!=(null!=e?e.error:void 0)?alertify.error(e.error):void 0},e.prototype.onDelete=function(t){return this.ajax(Echo.routes.Oauth2.deleteClient($(t.target).attr("id")),{success:this.onDeleteSuccess(t.target),error:this.onDeleteError})},e.prototype.onOldDelete=function(t){return this.ajax(Echo.routes.Oauth.deleteClient($(t.target).attr("id")),{success:this.onDeleteSuccess(t.target),error:this.onDeleteError})},e.prototype.onDeleteSuccess=function(t){return $(t).parent().remove(),alertify.success(this.i18n("Admin.ApiClient.deleteSuccess")),this.toggleEmpty()},e.prototype.onDeleteError=function(){return alertify.error(this.i18n("Admin.ApiClient.deleteError"))},e.prototype.toggleEmpty=function(){return 0===this.$existingClients.children().length?this.$placeholder.show():this.$placeholder.hide()},e.prototype.clearErrors=function(){return this.$switches.trigger("Input.clearError")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.configurations.CaptioningConfiguration=function(t){function e(){return this.onFidelityOptionsChange=i(this.onFidelityOptionsChange,this),this.onPriorityTypeChange=i(this.onPriorityTypeChange,this),this.onError=i(this.onError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$priorityType=this.$("input[name=defaultPriority]"),this.$priorityPriority=this.$priorityType.filter("[value=PRIORITY]"),this.$priorityStandard=this.$priorityType.filter("[value=STANDARD]"),this.$priorityEconomy=this.$priorityType.filter("[value=ECONOMY]"),this.$priorityDelayed=this.$priorityType.filter("[value=DELAYED]"),this.$priorityType.on("change",this.onPriorityTypeChange),this.$fidelityOptions=this.$("input[name=defaultFidelity]"),this.$fidelityMechanical=this.$fidelityOptions.filter("[value=MECHANICAL]"),this.$fidelityPremium=this.$fidelityOptions.filter("[value=PREMIUM]"),this.$fidelityProfessional=this.$fidelityOptions.filter("[value=PROFESSIONAL]"),this.$fidelityOptions.on("change",this.onFidelityOptionsChange),this.$el.on("AjaxForm.error",this.onError),this.onPriorityTypeChange()},e.prototype.onError=function(t,e){if(e)return alertify.error(e)},e.prototype.enableEvent=function(t){return t?"enable":"disable"},e.prototype.onPriorityTypeChange=function(){switch(this.$priorityType.filter(":checked").val()){case"DELAYED":case"ECONOMY":return this.updateFidelityOptions(!1,!0,!0);case"STANDARD":return this.updateFidelityOptions(!1,!0,!1);case"PRIORITY":return this.updateFidelityOptions(!0,!1,!1)}},e.prototype.updateFidelityOptions=function(t,e,i){return this.updateFidelitySelection(t,e,i),this.$fidelityMechanical.trigger(this.enableEvent(t)),this.$fidelityPremium.trigger(this.enableEvent(e)),this.$fidelityProfessional.trigger(this.enableEvent(i))},e.prototype.updateFidelitySelection=function(t,e,i){switch(this.$fidelityOptions.filter(":checked").val()){case"PROFESSIONAL":if(!i)return e?this.$fidelityPremium.prop("checked",!0):this.$fidelityMechanical.prop("checked",!0);break;case"PREMIUM":if(!e)return this.$fidelityMechanical.prop("checked",!0);break;case"MECHANICAL":if(!t)return this.$fidelityPremium.prop("checked",!0)}},e.prototype.onFidelityOptionsChange=function(){switch(this.$fidelityOptions.filter(":checked").val()){case"PROFESSIONAL":if(!this.$priorityDelayed.prop("checked"))return this.$priorityEconomy.prop("checked",!0);break;case"PREMIUM":if(this.$priorityPriority.prop("checked"))return this.$priorityStandard.prop("checked",!0)}},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.configurations.ClosedCaptioning=function(t){function e(){return this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.onDeleteProfile=i(this.onDeleteProfile,this),this.onChange=i(this.onChange,this),this.onFormError=i(this.onFormError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$providerSelect=this.$("select[name=provider]"),this.$aiMediaConfigForm=this.$("div.aimedia-config-form"),this.$astConfigForm=this.$("div.ast-config-form"),this.$cieloConfigForm=this.$("div.cielo-config-form"),this.$threePlayConfigForm=this.$("div.threeplay-config-form"),this.$cieloConfigForm.on("AjaxForm.error",this.onFormError),this.$providerSelect.on("change",this.onChange),this.$el.on("Captioning.deleteProfile",this.onDeleteProfile),this.onChange()},e.prototype.onFormError=function(t,e){var i;if(null!=(null!=e&&null!=(i=e.formErrors)?i["obj.defaultFidelity"]:void 0))return alertify.error(this.i18n(e.formErrors["obj.defaultFidelity"][0].msg))},e.prototype.onChange=function(){var t;return t=this.$providerSelect.val(),this.$aiMediaConfigForm.toggle("AiMedia"===t),this.$astConfigForm.toggle("AST"===t),this.$cieloConfigForm.toggle("Cielo24"===t),this.$threePlayConfigForm.toggle("ThreePlay"===t)},e.prototype.onDeleteProfile=function(){return this.ajax(Echo.routes.CaptioningProfiles.delete(),{success:this.onDeleteSuccess})},e.prototype.onDeleteSuccess=function(){return alertify.success(this.i18n("Captioning.deleteSuccess")),this.$el.find("input[type=text], textarea").val("")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.configurations.DeviceCertificate=function(t){function e(){return this.onAjaxError=i(this.onAjaxError,this),this.onAjaxSuccess=i(this.onAjaxSuccess,this),this.afterDeleteSuccess=i(this.afterDeleteSuccess,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.afterSubmitSuccess=i(this.afterSubmitSuccess,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onSelected=i(this.onSelected,this),this.onDelete=i(this.onDelete,this),this.onSubmit=i(this.onSubmit,this),this.onChoose=i(this.onChoose,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$chooseButton=this.$(".choose-device-certificate"),this.$submitButton=this.$(".submit-device-certificate"),this.$deleteButton=this.$(".delete-device-certificate"),this.$fileInput=this.$("input[name=certificateFile]"),this.$nameInput=this.$("input[name=certificateName]"),this.$patternInput=this.$("input[name=certificatePattern]"),this.$form=this.$("form"),this.$chooseButton.on("click",this.onChoose),this.$submitButton.on("click",this.onSubmit),this.$deleteButton.on("click",this.onDelete),this.$fileInput.on("change",this.onSelected)},e.prototype.onChoose=function(){return this.$fileInput.click()},e.prototype.onSubmit=function(){var t,e;return e=/^(\*\.)(?=.*\.).+$/,""===this.$patternInput.val()?alertify.error(this.i18n("Admin.deviceCertificate.patternEmptyAlert")):this.$patternInput.val().match(e)?(this.loadingOn(),t=new FormData(this.$form[0]),Echo.routes.Configurations.uploadDeviceCertificateOverride(this.$patternInput.val()).ajax({data:t,cache:!1,contentType:!1,processData:!1,success:this.onSubmitSuccess,error:this.onAjaxError})):alertify.error(this.i18n("Admin.deviceCertificate.invalidPatternAlert"))},e.prototype.onDelete=function(){return this.loadingOn(),Echo.routes.Configurations.deleteDeviceCertificateOverride().ajax({success:this.onDeleteSuccess,error:this.onAjaxError})},e.prototype.onSelected=function(){return this.$nameInput.val(this.$fileInput.val().split("\\").pop())},e.prototype.onSubmitSuccess=function(t){return this.onAjaxSuccess(t),this.afterSubmitSuccess()},e.prototype.afterSubmitSuccess=function(){return this.$deleteButton.removeAttr("disabled"),this.restoreDeleteEvent(),this.$submitButton.text(this.i18n("Admin.deviceCertificate.updateCertificateButton")),this.$nameInput.val(this.i18n("device_server.pem")),this.$fileInput.val("")},e.prototype.onDeleteSuccess=function(t){return this.onAjaxSuccess(t),this.afterDeleteSuccess()},e.prototype.afterDeleteSuccess=function(){return this.$deleteButton.attr("disabled",!0),this.$submitButton.text(this.i18n("Admin.deviceCertificate.addCertificateButton")),this.$nameInput.val(this.i18n("Admin.deviceCertificate.chooseCertificateText")),this.$fileInput.val(""),this.$patternInput.val("")},e.prototype.restoreDeleteEvent=function(){return this.$deleteButton.off("click"),this.$deleteButton.on("click",this.onDelete)},e.prototype.onAjaxSuccess=function(t){return alertify.success(t),this.loadingOff()},e.prototype.onAjaxError=function(t){return alertify.error(t.responseText),this.loadingOff()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.configurations.Index=function(t){function e(){return this.onClickSidebarLink=i(this.onClickSidebarLink,this),this.onTabClick=i(this.onTabClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$sidebarLinks=this.$("li"),this.$contentViews=this.$(".configuration-content"),this.$tabs=this.$(".tab"),this.$deviceConfigurationContents=this.$(".device-configuration-content"),this.$el.on("click","li a",this.onClickSidebarLink).on("click",".tab",this.onTabClick),this.initView()},e.prototype.onTabClick=function(t){var e;return e=this.$(t.currentTarget),this.$tabs.removeClass("active"),e.addClass("active"),this.showDeviceView(e.attr("data-target"))},e.prototype.showDeviceView=function(t){return this.$deviceConfigurationContents.hide().filter("."+t).show()},e.prototype.onClickSidebarLink=function(t){var e;return e=this.$(t.currentTarget),this.$sidebarLinks.removeClass("selected"),e.parent().addClass("selected"),this.showView(e.attr("data-target"))},e.prototype.initView=function(){return this.showView(this.$sidebarLinks.filter(".selected").find("a").attr("data-target")),this.showDeviceView(this.$tabs.filter(".active").attr("data-target"))},e.prototype.showView=function(t){return this.$contentViews.hide().filter("."+t).show()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.configurations.LmsSettings=function(t){function e(){return this.onAddedLmsProfile=i(this.onAddedLmsProfile,this),this.onAddLmsProfile=i(this.onAddLmsProfile,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$list=this.$(".lmsProfilesList"),this.$el.on("LmsProfiles.add",this.onAddLmsProfile),this.$body.on("LmsProfiles.added",this.onAddedLmsProfile)},e.prototype.onAddLmsProfile=function(){return this.injectFromUrl(Echo.routes.lti.LmsProfiles.getNewProfileModal())},e.prototype.onAddedLmsProfile=function(t,e){return this.$list.append(e)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.configurations.LmsSettingsProfile=function(t){function e(){return this.onEditAjaxError=i(this.onEditAjaxError,this),this.onEditAjaxSuccess=i(this.onEditAjaxSuccess,this),this.onDeleteError=i(this.onDeleteError,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.deleteLmsProfile=i(this.deleteLmsProfile,this),this.onTabClick=i(this.onTabClick,this),this.onSelectTab=i(this.onSelectTab,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.lmsProfileId=t.lmsProfileId,this.$tabbed=this.$(".tabbed"),this.$el.on("deleteLmsProfile",this.deleteLmsProfile).on("AjaxForm.editLmsProfile.success",this.onEditAjaxSuccess).on("AjaxForm.editLmsProfile.error",this.onEditAjaxError).on("Tabbed.clickTab",this.onTabClick).on("LmsProfile.selectTab",this.onSelectTab)},e.prototype.onSelectTab=function(t,e){return this.$tabbed.trigger("Tabbed.clickTab",e)},e.prototype.onTabClick=function(t,e){if(this.activeTab=e,this.$xml=this.$(".xml-container"),this.$xml.length)return this.setupClipboard(this.$xml)},e.prototype.deleteLmsProfile=function(){return alertify.confirm(this.i18n("LmsProfiles.deleteProfile.warning"),(e=this,function(t){if(t)return Echo.routes.lti.LmsProfiles.deleteLmsProfile(e.lmsProfileId).ajax({success:e.onDeleteSuccess,error:e.onDeleteError})}));var e},e.prototype.onDeleteSuccess=function(t){return alertify.success(this.i18n("LmsProfiles.deleteProfile.success")),this.dispose()},e.prototype.onDeleteError=function(t){return alertify.error(this.i18n("LmsProfiles.deleteProfile.error"))},e.prototype.onEditAjaxSuccess=function(t,e){var i;return i=e.html,this.replaceContent(t,i)},e.prototype.afterRespawn=function(){return this.$el.siblings("[data-lms-profile-id='"+this.lmsProfileId+"']").trigger("LmsProfile.selectTab",this.activeTab),alertify.success(this.i18n("LmsProfiles.editProfile.success"))},e.prototype.onEditAjaxError=function(){return alertify.error(this.i18n("LmsProfiles.editProfile.error"))},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.admin.configurations.PingoneConfiguration=function(t){function i(){var t,e;return this.onSuccess=(t=this.onSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("AjaxForm.success",this.onSuccess)},i.prototype.onSuccess=function(){return window.location.reload()},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.configurations.RoomSoftwareInput=function(t){function e(){return this.updateIpCamera=i(this.updateIpCamera,this),this.updateHiddenFields=i(this.updateHiddenFields,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.deviceInputs=t.deviceInputs,this.ipCameraKey=t.ipCameraKey,this.$name=this.$('[name="name"]'),this.$index=this.$('[name="index"]'),this.$externalId=this.$('[name="externalId"]'),this.$select=this.$(".deviceInput select").on("change",this.updateHiddenFields),this.$ipCameraSelect=this.$(".ipCameraInput select").on("change",this.updateIpCamera),this.updateHiddenFields()},e.prototype.updateHiddenFields=function(){var t;return t=this.$select.val(),this.$externalId.val(""),t?(this.$name.val(this.deviceInputs[t].name),this.$index.val(this.deviceInputs[t].index),t===this.ipCameraKey?(this.$name.val(this.ipCameraKey),this.updateIpCamera()):void 0):(this.$name.val(""),this.$index.val(""))},e.prototype.updateIpCamera=function(){var t;return(t=this.$ipCameraSelect.val())?this.$externalId.val(t):this.$externalId.val("")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.configurations.ZoomSettings=function(t){function e(){return this.onAddedZoomProfile=i(this.onAddedZoomProfile,this),this.onAddZoomProfile=i(this.onAddZoomProfile,this),this.onMarketClick=i(this.onMarketClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.zoomMarketUrl=t.zoomMarketUrl,this.$list=this.$(".zoomProfilesList"),this.$el.on("ZoomProfiles.market",this.onMarketClick),this.$el.on("ZoomProfiles.add",this.onAddZoomProfile),this.$body.on("ZoomProfiles.added",this.onAddedZoomProfile)},e.prototype.onMarketClick=function(){return window.open(this.zoomMarketUrl,"_blank")},e.prototype.onAddZoomProfile=function(){return this.injectFromUrl(Echo.routes.ZoomProfiles.getNewZoomConfigModal())},e.prototype.onAddedZoomProfile=function(t,e){return this.$list.append(e)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.configurations.ZoomSettingsProfile=function(t){function e(){return this.onDeleteError=i(this.onDeleteError,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.deleteZoomProfile=i(this.deleteZoomProfile,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.zoomProfileId=t.zoomProfileId,this.$el.on("deleteZoomProfile",this.deleteZoomProfile)},e.prototype.deleteZoomProfile=function(){return alertify.confirm(this.i18n("ZoomProfiles.deleteProfile.warning"),(e=this,function(t){if(t)return Echo.routes.ZoomProfiles.deleteZoomProfile(e.zoomProfileId).ajax({success:e.onDeleteSuccess,error:e.onDeleteError})}));var e},e.prototype.onDeleteSuccess=function(t){return alertify.success(this.i18n("ZoomProfiles.deleteProfile.success")),this.dispose()},e.prototype.onDeleteError=function(t){return alertify.error(this.i18n("ZoomProfiles.deleteProfile.error"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.courses.AddCourseModal=function(t){function e(){return this.onOrganizationChange=i(this.onOrganizationChange,this),this.onDepartmentChange=i(this.onDepartmentChange,this),this.onEditAjaxSuccess=i(this.onEditAjaxSuccess,this),this.onAddAjaxSuccess=i(this.onAddAjaxSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$departmentSelect=this.$("[name=departmentId]"),this.$organizationSelect=this.$("[name=organizationId]"),this.$el.on("AddCourseModal.organizationChange",this.onOrganizationChange).on("AddCourseModal.departmentChange",this.onDepartmentChange).on("AjaxForm.addCourse.success",this.onAddAjaxSuccess).on("AjaxForm.editCourse.success",this.onEditAjaxSuccess)},e.prototype.onAddAjaxSuccess=function(t,e){return this.$el.trigger("Course.added",e),alertify.success(this.i18n("Courses.CreateCourse.success")),this.$el.trigger("Modal.addCourse.close")},e.prototype.onEditAjaxSuccess=function(t,e){return this.$el.trigger("Course."+e.courseId+".edited",e),alertify.success(this.i18n("Courses.EditCourse.success")),this.$el.trigger("Modal.addCourse.close")},e.prototype.onDepartmentChange=function(t,e){if(""===this.$organizationSelect.val())return this.$organizationSelect.trigger("Select.updateSelectedSilent",this.$departmentSelect.find("option[value='"+e+"']").data("value"))},e.prototype.onOrganizationChange=function(t,e){return this.updateDepartmentOptions("",!0),this.getDepartmentOptions(e)},e.prototype.getDepartmentOptions=function(t){var e,i;return e=""===t?null:{organizationId:t},Echo.routes.Departments.options().ajax({data:e,success:(i=this,function(t){var e;return e=t.data,i.updateDepartmentOptions(e[0].html,e[0].hasPermissionToOrg)})})},e.prototype.updateDepartmentOptions=function(t,e){return this.$departmentSelect.trigger("Select.updateOptions",{options:t,keepEmptyOption:e}),this.$departmentSelect.trigger("Select.setOptional",e)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.courses.AddDepartmentModal=function(t){function e(){return this.onOrganizationFilterChange=i(this.onOrganizationFilterChange,this),this.onAjaxSuccess=i(this.onAjaxSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$organizationSelect=this.$("[name=organizationId]"),this.$body.on("Courses.organizationFilterChange",this.onOrganizationFilterChange),this.$el.on("AjaxForm.addDepartment.success",this.onAjaxSuccess)},e.prototype.onAjaxSuccess=function(t,e){return alertify.success(this.i18n("Courses.CreateDepartment.success")),this.$el.trigger("Modal.addDepartment.close").trigger("Courses.departmentAdded",{id:e.id,name:e.name})},e.prototype.onOrganizationFilterChange=function(t,e){return this.$organizationSelect.trigger("Select.updateSelected",e)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.courses.AddSectionModal=function(t){function e(){return this.onInstructorSelectChange=i(this.onInstructorSelectChange,this),this.onInputListChange=i(this.onInputListChange,this),this.onEditSectionSuccess=i(this.onEditSectionSuccess,this),this.onAddSectionSuccess=i(this.onAddSectionSuccess,this),this.onCheckRemoveItem=i(this.onCheckRemoveItem,this),this.onItemRemoved=i(this.onItemRemoved,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$primaryInstructorId=this.$("[name=primaryInstructorId]"),this.$list=this.$(".inputList"),this.$el.on("InputList.itemAdded",this.onInputListChange).on("InputList.itemRemoved",this.onItemRemoved).on("InputList.checkRemoveItem",this.onCheckRemoveItem).on("AjaxForm.addSection.success",this.onAddSectionSuccess).on("AjaxForm.editSection.success",this.onEditSectionSuccess).on("change",".list .instructor-id select",this.onInstructorSelectChange),this.$body.on("Modal.addSection.onOpen",this.onModalOpen)},e.prototype.renderPrimaryInstructorOptions=function(){var t,e,o;return t=_.uniq(_.filter(this.$(".list .instructor-id select"),function(t){return""!==$(t).val()})),e=_.map(t,(o=this,function(t){var e,i;return e=$(t).val(),i=$(t).find("option[value='"+e+"']").text(),"<option value='"+e+"'>"+o.encodeHTML(i)+"</option>"})),this.$primaryInstructorId.trigger("Select.updateOptions",{options:e.join(""),maintainSelection:!0}).trigger("change")},e.prototype.onItemRemoved=function(t,e){return this.onInputListChange(t,e),this.renderPrimaryInstructorOptions()},e.prototype.onCheckRemoveItem=function(t,e){return this.$(e).find("select").val()===this.$primaryInstructorId.val()?alertify.error(this.i18n("Errors.cannotRemovePrimaryInstructor")):this.$list.trigger("InputList.removeItem",e)},e.prototype.onAddSectionSuccess=function(t,e){return this.$el.trigger("Course."+e.courseId+".sectionUpdated",e).trigger("Modal.addSection.close"),alertify.success(this.i18n("Sections.CreateSection.success"))},e.prototype.onEditSectionSuccess=function(t,e){return this.$el.trigger("Course."+e.courseId+".sectionUpdated",e).trigger("Modal.editSection.close"),alertify.success(this.i18n("Sections.EditSection.success"))},e.prototype.onInputListChange=function(t,e){return $(e).find(".instructor-id").trigger("select2.reset")},e.prototype.onInstructorSelectChange=function(t){var e;return"NEW"===(e=this.$(t.target)).val()?e.closest(".instructor-id").siblings(".instructor-email").show():e.closest(".instructor-id").siblings(".instructor-email").hide().find("input").trigger("Input.updateValue",""),this.renderPrimaryInstructorOptions()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.courses.CourseListItem=function(t){function e(){return this.resetHighlight=i(this.resetHighlight,this),this.onToggleEdited=i(this.onToggleEdited,this),this.onSectionUpdated=i(this.onSectionUpdated,this),this.onSectionDeleted=i(this.onSectionDeleted,this),this.onCourseEdited=i(this.onCourseEdited,this),this.onDeleteError=i(this.onDeleteError,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.deleteAjax=i(this.deleteAjax,this),this.onCourseDelete=i(this.onCourseDelete,this),this.onCourseEdit=i(this.onCourseEdit,this),this.onSectionCreate=i(this.onSectionCreate,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.courseId=t.courseId,this.filtered=t.filtered,this.$courseName=this.$(".courseName"),this.$courseIdentifier=this.$(".courseIdentifier"),this.$department=this.$(".department"),this.$organization=this.$(".organization"),this.$sectionCount=this.$(".sectionCount"),this.$createPlaceholder=this.$(".newSection-placeholder"),this.$sections=this.$(".adminListItem-children.sections"),this.$el.on("Section.create",this.onSectionCreate).on("Section.deleted",this.onSectionDeleted).on("Course.delete",this.onCourseDelete).on("Course.edit",this.onCourseEdit).on("click",".newSection-placeholder",this.onSectionCreate),this.disposeIfExists(),this.updateSectionCount()},e.prototype.bodyListeners=function(){var t;return(t={})["Course."+this.options.courseId+".edited"]=this.onCourseEdited,t["Course."+this.options.courseId+".sectionUpdated"]=this.onSectionUpdated,t["Course."+this.options.courseId+".toggleEdited"]=this.onToggleEdited,t["Course.added"]=this.resetHighlight,t["CourseItem.edited"]=this.resetHighlight,t["Section.updated"]=this.resetHighlight,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.disposeIfExists=function(){if(0<this.$el.siblings("[data-id="+this.courseId+"]:not(.toBeDeleted)").length)return this.dispose()},e.prototype.getSectionCount=function(){return this.$(".adminList-item.section:not(.toBeDeleted, .newSection-placeholder)").length},e.prototype.updateSectionCount=function(){var t;return t=this.getSectionCount(),this.$sectionCount.text(t)},e.prototype.checkSectionCount=function(){var t;return 0===(t=this.getSectionCount())&&this.filtered?(this.$el.addClass("toBeDeleted").trigger("AdminListItem.deleted"),this.dispose()):this.$sectionCount.text(t)},e.prototype.onSectionCreate=function(t){return t.stopPropagation(),this.injectFromUrl(Echo.routes.Sections.getNewSectionsModal(this.courseId))},e.prototype.onCourseEdit=function(){return this.injectFromUrl(Echo.routes.Courses.getEditCourseModal(this.courseId))},e.prototype.onCourseDelete=function(){return this.confirm("Courses.DeleteCourse.confirm",this.deleteAjax)},e.prototype.deleteAjax=function(){return this.$el.closest(".adminList").trigger("loading.on",{theme:"dark"}),Echo.routes.Courses.deleteCourse(this.courseId).ajax({success:this.onDeleteSuccess,error:this.onDeleteError})},e.prototype.onDeleteSuccess=function(t){return this.$el.closest(".adminList").trigger("loading.off"),this.$el.addClass("toBeDeleted").trigger("AdminListItem.deleted"),alertify.success(this.i18n("Courses.DeleteCourse.success")),this.dispose()},e.prototype.onDeleteError=function(){return this.$el.closest(".adminList").trigger("loading.off"),alertify.error(this.i18n("Courses.DeleteCourse.error"))},e.prototype.onCourseEdited=function(t,e){return this.$el.addClass("toBeDeleted").after(e.html),this.$el.trigger("CourseItem.edited",e),this.dispose()},e.prototype.onSectionDeleted=function(){return this.checkSectionCount()},e.prototype.onSectionUpdated=function(t,e){return this.$el.addClass("toBeDeleted").after(e.html),this.$createPlaceholder.remove(),this.$el.trigger("Section.updated",e),this.dispose()},e.prototype.onToggleEdited=function(t,e){return this.$el.toggleClass("outdatedSearch",e)},e.prototype.resetHighlight=function(t,e){if(e.courseId!==this.courseId)return this.$el.removeClass("editedItem")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,s=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.pages.admin.courses.CourseListItemSection=function(t){function e(){return this.resetHighlight=i(this.resetHighlight,this),this.onToggleEdited=i(this.onToggleEdited,this),this.onEditSection=i(this.onEditSection,this),this.onDeleteError=i(this.onDeleteError,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.onConfirmDelete=i(this.onConfirmDelete,this),this.onDeleteSection=i(this.onDeleteSection,this),this.onCloneSection=i(this.onCloneSection,this),this.onClick=i(this.onClick,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.courseId=t.courseId,this.sectionId=t.sectionId,this.$sectionNumber=this.$(".sectionNumber"),this.$sectionInstructors=this.$(".sectionInstructors span"),this.$el.on("Section.edit",this.onEditSection).on("Section.delete",this.onDeleteSection).on("Section.clone",this.onCloneSection).on("click",this.onClick)},e.prototype.bodyListeners=function(){var t;return(t={})["Section."+this.options.sectionId+".toggleEdited"]=this.onToggleEdited,t["Course.added"]=this.resetHighlight,t["CourseItem.edited"]=this.resetHighlight,t["Section.updated"]=this.resetHighlight,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onClick=function(){return this.pageRefresh(Echo.routes.CaptureSchedules.index(this.sectionId).url)},e.prototype.onCloneSection=function(){return this.injectFromUrl(Echo.routes.Sections.sectionCloningModal(this.sectionId).url)},e.prototype.onDeleteSection=function(){return this.confirm("Sections.DeleteSection.confirm",this.onConfirmDelete)},e.prototype.onConfirmDelete=function(){return this.$el.closest(".adminList").trigger("loading.on",{theme:"dark"}),Echo.routes.Sections.deleteSection(this.courseId,this.sectionId).ajax({success:this.onDeleteSuccess,error:this.onDeleteError})},e.prototype.onDeleteSuccess=function(){return this.$el.closest(".adminList").trigger("loading.off"),this.$el.addClass("toBeDeleted").trigger("Section.deleted"),alertify.success(this.i18n("Sections.DeleteSection.success")),this.dispose()},e.prototype.onDeleteError=function(){return alertify.error(this.i18n("Sections.DeleteSection.error")),this.$el.closest(".adminList").trigger("loading.off")},e.prototype.onEditSection=function(){return this.injectFromUrl(Echo.routes.Sections.getEditSectionModal(this.courseId,this.sectionId))},e.prototype.onToggleEdited=function(t,e){if(this.$el.toggleClass("outdatedSearch",e.toggle),e.expand)return this.$el.closest(".courseList-item").addClass("expanded")},e.prototype.resetHighlight=function(t,e){var i,o;if(null!=e.sections&&(o=_.map(e.sections,function(t){return t.sectionId})),this.courseId!==e.courseId||null==e.sections||(i=this.sectionId,!(0<=s.call(o,i))))return this.$el.removeClass("editedItem")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.pages.admin.Courses=function(t){function e(){return this.onSectionUpdated=i(this.onSectionUpdated,this),this.onCourseEdited=i(this.onCourseEdited,this),this.onCourseAddedSuccess=i(this.onCourseAddedSuccess,this),this.onCourseAdded=i(this.onCourseAdded,this),this.onTermDeleted=i(this.onTermDeleted,this),this.onTermUpdated=i(this.onTermUpdated,this),this.onTermCreated=i(this.onTermCreated,this),this.onSearchResults=i(this.onSearchResults,this),this.onFilterBarUpdate=i(this.onFilterBarUpdate,this),this.setupSearchListeners=i(this.setupSearchListeners,this),this.onTermsManage=i(this.onTermsManage,this),this.onSectionCreate=i(this.onSectionCreate,this),this.onCourseCreate=i(this.onCourseCreate,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.selectParams={keepEmptyOption:!0,maintainSelection:!0},e.prototype.initialize=function(){return this.$organizationSelect=this.$(".admin-courses-header select[name=organizationId]"),this.$departmentSelect=this.$(".admin-courses-header select[name=departmentId]"),this.$termSelect=this.$(".admin-courses-header select[name=termId]"),this.$instructorSelect=this.$(".admin-courses-header select[name=instructorId]"),this.$search=this.$("[name=searchText]"),this.$table=this.$(".adminList-table"),this.$el.on("Course.create",this.onCourseCreate).on("Section.create",this.onSectionCreate).on("Terms.manage",this.onTermsManage).on("AdminListTable.searchResults",this.onSearchResults).on("AdminListTable.itemsAddedSuccess",this.onCourseAddedSuccess),this.$body.on("Course.added",this.onCourseAdded).on("CourseItem.edited",this.onCourseEdited).on("Section.updated",this.onSectionUpdated).on("CrudSelect.Terms.created",this.onTermCreated).on("CrudSelect.Terms.updated",this.onTermUpdated).on("CrudSelect.Terms.deleted",this.onTermDeleted),this.setupSearchListeners()},e.prototype.onCourseCreate=function(){return this.injectFromUrl(Echo.routes.Courses.getAddCourseModal())},e.prototype.onSectionCreate=function(){return this.injectFromUrl(Echo.routes.Sections.getNewSectionsModal())},e.prototype.onTermsManage=function(){return this.injectFromUrl(Echo.routes.Terms.getManageTermsModal())},e.prototype.setupSearchListeners=function(){return this.$el.on("FilterBar.update",this.onFilterBarUpdate),this.$el.trigger("FilterBar.requestUpdate")},e.prototype.onFilterBarUpdate=function(t,e){return this.filters=e,this.$table.trigger("AdminListTable.search",{url:Echo.routes.Courses.search(),filters:this.filters})},e.prototype.onSearchResults=function(t,e){return this.sameSearch=e.sameSearch,this.$el.keyboardFocusable(".adminList-item.course")},e.prototype.getOptions=function(t,e){var o,i,n;if(null!=t)return o=[],this.sameSearch&&this.$(e).find("option").not('[value=""]').each((n=this,function(t,e){var i;return i=n.$(e),o.push({id:i.attr("value"),label:i.text(),data:i.data("value")})})),i=this.buildOptions(t,o,e),$.extend({options:i},this.selectParams)},e.prototype.buildOptions=function(t,e,i){var o,n,s,r;return n="",o=[],_.each(t,(s=this,function(t){var e;return e=t.id,a.call(o,e)<0&&(n+=s.buildOption(t)),o.push(t.id)})),_.each(e,(r=this,function(t){var e;return e=t.id,a.call(o,e)<0&&(n+=r.buildOption(t)),o.push(t.id)})),n},e.prototype.buildOption=function(t){var e,i,o;return i=t.id,o=t.label,"<option value='"+i+"' data-value='"+(e=null!=(e=t.data)?e:"")+"'>"+o+"</option>"},e.prototype.onTermCreated=function(t,e){return this.$termSelect.trigger("Select.createOption",{value:e.id,text:e.name,optGroup:e.active?this.i18n("Labels.activeTerms"):this.i18n("Labels.inactiveTerms")}),alertify.success(this.i18n("Courses.CreateTerm.success"))},e.prototype.onTermUpdated=function(t,e){return this.$termSelect.trigger("Select.updateOptionText",{value:e.id,text:e.name}),alertify.success(this.i18n("Courses.EditTerm.success"))},e.prototype.onTermDeleted=function(t,e){return this.$termSelect.trigger("Select.deleteOption",e),alertify.success(this.i18n("Courses.DeleteTerm.success"))},e.prototype.onCourseAdded=function(t,e){return this.$table.trigger("AdminListTable.itemsAdded",e)},e.prototype.onCourseAddedSuccess=function(t,e){return this.$el.trigger("Course."+e.courseId+".toggleEdited",this.courseFilterMismatch(e,!1))},e.prototype.onCourseEdited=function(t,e){return this.$el.trigger("Course."+e.courseId+".toggleEdited",this.courseFilterMismatch(e,!1))},e.prototype.onSectionUpdated=function(t,e){return this.$el.trigger("Course."+e.courseId+".toggleEdited",this.courseFilterMismatch(e,!0))},e.prototype.sectionFilterMismatch=function(t){var e,i,o,n;return e=null!=this.filters.instructorId&&this.filters.instructorId!==t.instructorId&&(i=this.filters.instructorId,!(0<=a.call(t.secondaryInstructorIds,i))),n=null!=this.filters.termId&&this.filters.termId!==t.termId,o=this.searchTextMismatch([t.sectionNumber]),e||o||n},e.prototype.departmentMismatch=function(t){return null!=this.filters.departmentId&&(null==t||this.filters.departmentId!==t.id)},e.prototype.organizationMismatch=function(t){return null!=this.filters.organizationId&&(null==t||this.filters.organizationId!==t.id)},e.prototype.courseFilterMismatch=function(t,e){var i,o,n,s,r,a,h,l,c;if(i=this.departmentMismatch(t.department),r=this.organizationMismatch(t.organization),h=this.courseTextMismatch(t),c=!1,null!=t.sections)for(o=0,n=(a=t.sections).length;o<n;o++)l=a[o],s=this.sectionFilterMismatch(l),this.$el.trigger("Section."+l.sectionId+".toggleEdited",{toggle:s,expand:e}),!0===s&&(c=s);return i||r||h&&!c},e.prototype.courseTextMismatch=function(t){var e,i;return this.searchTextMismatch([t.courseIdentifier,t.courseName,null!=(e=t.department)?e.label:void 0,null!=(i=t.organization)?i.label:void 0])},e.prototype.searchTextMismatch=function(t){var e;return null!=this.filters.searchText&&(e=new RegExp(this.filters.searchText,"i"),0===_.filter(t,function(t){if(null!=t)return t.match(e)}).length)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.courses.CreateOrUpdateTermModal=function(t){function e(){return this.onReset=i(this.onReset,this),this.onEmitTermRange=i(this.onEmitTermRange,this),this.onFormSuccess=i(this.onFormSuccess,this),this.onNewDate=i(this.onNewDate,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$(".termRange").on("DateRange.change",this.onNewDate).trigger("DateRange.emitDates"),this.$el.on("CreateOrUpdateTermModal.emitTermRange",this.onEmitTermRange).closest("form").on("AjaxForm.addTerm.success",this.onFormSuccess).on("reset",this.onReset)},e.prototype.onNewDate=function(t,e){return this.startDate=e.startDate,this.endDate=e.endDate,null==this.initialStartDate&&(this.initialStartDate=this.startDate),null!=this.initialEndDate?this.initialEndDate:this.initialEndDate=this.endDate},e.prototype.onFormSuccess=function(t,e){return this.$el.trigger("CrudSelect.Terms.created",e).trigger("Modal.addTerm.close")},e.prototype.onEmitTermRange=function(){return this.$el.trigger(this.namespacedEventName("CreateOrUpdateTermModal","currentTermRange"),{startDate:this.startDate,endDate:this.endDate})},e.prototype.onReset=function(){return this.startDate=this.initialStartDate,this.endDate=this.initialEndDate},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.imports.Index=function(t){function e(){return this.onAddImportSuccess=i(this.onAddImportSuccess,this),this.onOpenCsvModal=i(this.onOpenCsvModal,this),this.onFilterBarUpdate=i(this.onFilterBarUpdate,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$filters=this.$(".filterBar"),this.$table=this.$(".jobList > .adminList-table"),this.$body.on("Modal.CsvImport.open",this.onOpenCsvModal).on("FilterBar.update",this.onFilterBarUpdate).on("AjaxForm.addImport.success",this.onAddImportSuccess),this.$table.trigger("AdminListTable.search",{url:Echo.routes.DataImports.getJobs(),filters:{}})},e.prototype.onFilterBarUpdate=function(t,e){return this.filters=e,this.$table.trigger("AdminListTable.filter",{filters:this.filters})},e.prototype.onOpenCsvModal=function(t,e){return this.injectFromUrl(Echo.routes.DataImports.csvImportModal())},e.prototype.onAddImportSuccess=function(t,e){},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.admin.imports.Job=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.jobId=t.jobId,this.$el.on("click",(i=this,function(t,e){return i.injectFromUrl(Echo.routes.DataImports.getJobModal(i.jobId))}));var i},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.institution.Index=function(t){function e(){return this.loadNoPermissionsMessage=i(this.loadNoPermissionsMessage,this),this.onLoadSettingsError=i(this.onLoadSettingsError,this),this.onLoadSettingsSuccess=i(this.onLoadSettingsSuccess,this),this.onOrgClick=i(this.onOrgClick,this),this.refreshOrgItems=i(this.refreshOrgItems,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.nodeId=t.nodeId,this.$hierarchy=this.$(".hierarchy"),this.$settings=this.$(".settings-panel"),this.$orgItems=this.$(".adminList-item"),this.$cachedSettings={},this.$body.on("AdminListTable.itemsAddedSuccess",this.refreshOrgItems),this.$el.on("AdminListItem.clicked",this.onOrgClick),this.nodeId?this.$doc.on("ready",(e=this,function(){return e.$el.trigger("AdminListItem.clicked",e.nodeId)})):this.loadNoPermissionsMessage();var e},e.prototype.refreshOrgItems=function(){return this.$orgItems=this.$(".adminList-item")},e.prototype.onOrgClick=function(t,e){return this.$orgItems.removeClass("selected"),this.$currItem=this.$orgItems.filter("[data-id='"+e+"']"),this.$currItem.addClass("selected"),this.$currItem.parents(".adminList-item").addClass("expanded"),this.loadOrgSettings(e,this.$currItem.data("type"))},e.prototype.loadOrgSettings=function(e,t){var i,o,n,s,r,a,h;return i=null!=(n=(r=function(){switch(t){case"institution":return Echo.routes.InstitutionSettings.getInstitutionSettings();case"none":return Echo.routes.InstitutionSettings.getNoAuthzPage();case"organization":return Echo.routes.Organizations.getSettings(e);default:return Echo.routes.Departments.getSettings(e)}}()).ajax)?n:$.ajax,o={url:r,beforeSend:(h=this,function(){return h.$el.trigger("loading.on",{selector:".settings-panel",theme:"light"})}),success:(a=this,function(t){return a.onLoadSettingsSuccess(t,e)}),error:this.onLoadSettingsError,complete:this.onInjectComplete},null!=(s=this.$settings.find("> .settings-content"))&&s.detach(),i(o)},e.prototype.onLoadSettingsSuccess=function(t,e){var i;return i=t.data[0].html,this.$cachedSettings[e]=i,this.setPanel(i)},e.prototype.onLoadSettingsError=function(){return alertify.error(this.i18n("Settings.error.loadSettingsError"))},e.prototype.setPanel=function(t){var e,i;return null!=(i=(e=this.$settings.find("> .settings-content")).data("node-id"))&&null!=e&&(this.$cachedSettings[i]=e.detach()),this.$settings.empty(),this.$settings.append(t)},e.prototype.loadNoPermissionsMessage=function(){return this.loadOrgSettings("","none")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.rooms.AddDeviceModal=function(t){function e(){return this.onOpen=i(this.onOpen,this),this.onDeviceChange=i(this.onDeviceChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.getDevicesRoute=t.getDevicesRoute,this.deviceSelect=this.$(".device-select"),this.roomInput=this.$("input.room-input"),this.saveButton=this.$("button[type=submit]"),this.$el.on("change",".device-select select",this.onDeviceChange),this.$body.on("Rooms.addDevice",this.onOpen)},e.prototype.onDeviceChange=function(t){return this.$(".device-select select").val()?this.saveButton.trigger("enable"):this.saveButton.trigger("disable")},e.prototype.onOpen=function(t,e){var i;return this.roomInput.val(e),$.getJSON(this.getDevicesRoute,(i=this,function(t){return i.deviceSelect.html(t.data[0].html)})),this.$el.trigger("Modal.addDevice.open")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.rooms.AddRoomModal=function(t){function e(){return this.onFqdnRadioChange=i(this.onFqdnRadioChange,this),this.onClose=i(this.onClose,this),this.onBuildingDeselected=i(this.onBuildingDeselected,this),this.onBuildingSelected=i(this.onBuildingSelected,this),this.onCampusDeselected=i(this.onCampusDeselected,this),this.onCampusSelected=i(this.onCampusSelected,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.campusSelect=this.$(".campus-select"),this.buildingSelect=this.$(".building-select"),this.nameInput=this.$(".new-room-name input[name=name]"),this.saveButton=this.$(".submit-button"),this.fqdnOverride=this.$("input[name=fqdnOverride]"),this.buildingSelect.on("AddableSelect.selected",this.onBuildingSelected).on("AddableSelect.deselected",this.onBuildingDeselected),this.campusSelect.on("AddableSelect.selected",this.onCampusSelected).on("AddableSelect.deselected",this.onCampusDeselected),this.$el.on("Modal."+this.namespace+".onClose",this.onClose),this.$el.on("change","input[type=radio][name=fqdn-override]",this.onFqdnRadioChange)},e.prototype.getBuildingName=function(){return this.buildingSelect.find("option:selected").text()},e.prototype.getBuildingId=function(){return this.buildingSelect.find("option:selected").val()},e.prototype.getCampusName=function(){return this.campusSelect.find("option:selected").text()},e.prototype.saveRoomMetadata=function(){return this.$("input[name=buildingName]").val(this.getBuildingName()),this.$("input[name=buildingId]").val(this.getBuildingId()),this.$("input[name=campusName]").val(this.getCampusName())},e.prototype.onCampusSelected=function(t,e){var i;return $.getJSON("/rooms/getBuildingsDropdown",{campusId:e},(i=this,function(t){return i.buildingSelect.html(t.data[0].html)})),this.buildingSelect.find("select").trigger("AddableSelect.deselect")},e.prototype.onCampusDeselected=function(){return this.buildingSelect.find("select").trigger("AddableSelect.deselect").trigger("disable")},e.prototype.onBuildingSelected=function(){return this.saveRoomMetadata(),this.nameInput.prop("readonly",!1),this.saveButton.trigger("enable")},e.prototype.onBuildingDeselected=function(){return this.nameInput.trigger("Input.updateValue",""),this.nameInput.prop("readonly",!0),this.saveButton.trigger("disable")},e.prototype.onClose=function(){return this.campusSelect.find("select").trigger("AddableSelect.deselect")},e.prototype.onFqdnRadioChange=function(t){var e,i;return e=this.fqdnOverride.attr("value"),"autoDetect"===(i=$(t.currentTarget).attr("value"))?this.fqdnOverride.val(""):"specify"===i?this.fqdnOverride.val(e):void 0},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.rooms.DeviceDropdown=function(t){function e(){return this.enableMacEntry=i(this.enableMacEntry,this),this.onChange=i(this.onChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.Select),e.prototype.initialize=function(t){return this.options=t.options,this.placeholder=t.placeholder,this.$select=this.$("select"),this.$select.on("change",this.onChange),this.$macEntry=this.$(".mac-entry"),this.onChange(),setTimeout((e=this,function(){return e.enableMacEntry(!1)}),120);var e},e.prototype.onChange=function(){var t;return t=this.$select.val(),this.enableMacEntry("new"===t)},e.prototype.enableMacEntry=function(t){return t?this.$macEntry.show().removeClass("disabled").find("input").attr("disabled",!1):this.$macEntry.hide().addClass("disabled").find("input").attr("disabled",!0)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.rooms.Index=function(t){function e(){return this.updateSegmentsCount=i(this.updateSegmentsCount,this),this.onOpConnect=i(this.onOpConnect,this),this.onOpDisconnectSuccess=i(this.onOpDisconnectSuccess,this),this.disconnectAjax=i(this.disconnectAjax,this),this.onOpDisconnect=i(this.onOpDisconnect,this),this.onOpDeleteSuccess=i(this.onOpDeleteSuccess,this),this.deleteAjax=i(this.deleteAjax,this),this.onOpDelete=i(this.onOpDelete,this),this.onOpEdit=i(this.onOpEdit,this),this.onOpConfigure=i(this.onOpConfigure,this),this.hideLoading=i(this.hideLoading,this),this.showLoading=i(this.showLoading,this),this.onSearchSuccess=i(this.onSearchSuccess,this),this.search=i(this.search,this),this.update=i(this.update,this),this.onFilterBarUpdate=i(this.onFilterBarUpdate,this),this.onAddDevice=i(this.onAddDevice,this),this.onEditRoom=i(this.onEditRoom,this),this.onAddRoom=i(this.onAddRoom,this),this.onAddRoomOpen=i(this.onAddRoomOpen,this),this.onConfigureRoomSuccess=i(this.onConfigureRoomSuccess,this),this.onCsvUploadsUpdate=i(this.onCsvUploadsUpdate,this),this.roomOperationListeners=i(this.roomOperationListeners,this),this.formSubmissionListeners=i(this.formSubmissionListeners,this),this.setupSearchListeners=i(this.setupSearchListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.deleteMessage=t.deleteMessage,this.disconnectMessage=t.disconnectMessage,this.connectTimeoutMillis=t.connectTimeoutMillis,this.$content=this.$(".rooms-content"),this.formSubmissionListeners(),this.setupSearchListeners(),this.roomOperationListeners(),this.updateSegmentsCount()},e.prototype.setupSearchListeners=function(){return this.$el.on("FilterBar.update",this.onFilterBarUpdate).on("Content.update",this.update).trigger("FilterBar.requestUpdate")},e.prototype.formSubmissionListeners=function(){return this.$body.on("AjaxForm.addRoom.success",this.onAddRoom).on("AjaxForm.configureRoom.success",this.onConfigureRoomSuccess).on("AjaxForm.editRoom.success",this.onEditRoom).on("AjaxForm.addDevice.success",this.onAddDevice)},e.prototype.roomOperationListeners=function(){return this.$el.on("AccordionSegment.refreshDisplay",this.updateSegmentsCount).on("Rooms.addRoom.open",this.onAddRoomOpen).on("Rooms.opConfigure",this.onOpConfigure).on("Rooms.opDelete",this.onOpDelete).on("Rooms.opEdit",this.onOpEdit).on("Rooms.opDisconnect",this.onOpDisconnect).on("Rooms.opConnect",this.onOpConnect).on("CsvUploadManager.updateDisplay",this.onCsvUploadsUpdate)},e.prototype.onCsvUploadsUpdate=function(t,e){return e.count,this.$content.css("top",this.$el.height()+"px")},e.prototype.onConfigureRoomSuccess=function(){return this.$el.trigger("Modal.close")},e.prototype.onAddRoomOpen=function(){return this.injectFromUrl(Echo.routes.Rooms.getAddRoomModal())},e.prototype.onAddRoom=function(t,e){return this.$(".grid-view").prepend(e.html.card),this.$el.trigger("Modal.close")},e.prototype.onEditRoom=function(t,e){return this.$el.trigger("Rooms.update",e).trigger("Modal.close")},e.prototype.onAddDevice=function(t,e){return this.$el.trigger("Rooms.connect",e).trigger("Modal.close"),alertify.success(this.i18n("Rooms.addDevice.success"))},e.prototype.onFilterBarUpdate=function(t,e){return this.query=e,this.search()},e.prototype.update=function(){return this.search(!1)},e.prototype.search=function(t){return null==t&&(t=!0),this.showLoading(),this.ajax(Echo.routes.Rooms.search(),{data:this.query,success:this.onSearchSuccess})},e.prototype.onSearchSuccess=function(t){return this.hideLoading(),this.$(".rooms-content").trigger("Rooms.destroyAll").trigger("Dropdowns.destroy").trigger("Clickables.roomCard.destroy").html(t.data[0].html),this.$body.trigger("ToggleView.refresh")},e.prototype.showLoading=function(){return this.$el.trigger("loading.on",{selector:".rooms-content"})},e.prototype.hideLoading=function(){return this.$el.trigger("loading.off",{selector:".rooms-content"})},e.prototype.onOpConfigure=function(t,e){return t.preventDefault(),this.injectFromUrl(Echo.routes.RoomConfigurations.edit(e))},e.prototype.onOpEdit=function(t,e){return t.preventDefault(),this.injectFromUrl(Echo.routes.Rooms.getUpdateForm(e))},e.prototype.onOpDelete=function(t,e){return alertify.confirm(this.deleteMessage,(i=this,function(t){if(t)return i.deleteAjax(e)}));var i},e.prototype.deleteAjax=function(t){return Echo.routes.Rooms.delete().ajax({contentType:"application/json",data:JSON.stringify({roomId:t}),dataType:"json",success:this.onOpDeleteSuccess,error:this.onOpDeleteError})},e.prototype.onOpDeleteSuccess=function(t,e,i){return this.$el.trigger("Rooms.delete",t.data[0].roomId),alertify.success(i.responseJSON.message)},e.prototype.onOpDeleteError=function(t){return alertify.error(t.responseJSON.message)},e.prototype.onOpDisconnect=function(t,e){return alertify.confirm(this.disconnectMessage,(i=this,function(t){if(t)return i.disconnectAjax(e)}));var i},e.prototype.disconnectAjax=function(t){return Echo.routes.Rooms.removeDevice(t).ajax({contentType:"application/json",data:JSON.stringify({roomId:t}),dataType:"json",success:this.onOpDisconnectSuccess,error:this.onOpDisconnectError})},e.prototype.onOpDisconnectSuccess=function(t){return this.$el.trigger("Rooms.disconnect",t.data[0]),alertify.success(this.i18n("Rooms.disconnectDevice.success"))},e.prototype.onOpDisconnectError=function(t){return alertify.error(t.responseJSON.message)},e.prototype.onOpConnect=function(t,e){return"#"===e?alertify.error(this.i18n("Errors.deviceConnectionError")):this.openInNewTab(e)},e.prototype.openInNewTab=function(t){return window.open(t,"_blank")},e.prototype.updateSegmentsCount=function(){return this.$(".accordion-segment-head .count").remove(),this.$(".accordion-segment").each(function(t,e){var i,o;return i=(e=$(e)).find("tr").not(":has(th)").length,(o=$("<span>",{class:"count"})).text("("+i+")"),o.appendTo(e.find(".accordion-segment-head"))})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.rooms.IndexNew=function(t){function e(){return this.showLegacy=i(this.showLegacy,this),this.hideLegacy=i(this.hideLegacy,this),this.updateSegmentsCount=i(this.updateSegmentsCount,this),this.onOpConnect=i(this.onOpConnect,this),this.onOpDisconnectSuccess=i(this.onOpDisconnectSuccess,this),this.disconnectAjax=i(this.disconnectAjax,this),this.onOpDisconnect=i(this.onOpDisconnect,this),this.onOpDeleteSuccess=i(this.onOpDeleteSuccess,this),this.deleteAjax=i(this.deleteAjax,this),this.onOpDelete=i(this.onOpDelete,this),this.onOpEdit=i(this.onOpEdit,this),this.onOpConfigure=i(this.onOpConfigure,this),this.hideLoading=i(this.hideLoading,this),this.showLoading=i(this.showLoading,this),this.onSearchSuccess=i(this.onSearchSuccess,this),this.search=i(this.search,this),this.update=i(this.update,this),this.onFilterBarUpdate=i(this.onFilterBarUpdate,this),this.onAddDevice=i(this.onAddDevice,this),this.onEditRoom=i(this.onEditRoom,this),this.onAddRoom=i(this.onAddRoom,this),this.onAddRoomOpen=i(this.onAddRoomOpen,this),this.onConfigureRoomSuccess=i(this.onConfigureRoomSuccess,this),this.onCsvUploadsUpdate=i(this.onCsvUploadsUpdate,this),this.roomOperationListeners=i(this.roomOperationListeners,this),this.formSubmissionListeners=i(this.formSubmissionListeners,this),this.setupSearchListeners=i(this.setupSearchListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.deleteMessage=t.deleteMessage,this.disconnectMessage=t.disconnectMessage,this.connectTimeoutMillis=t.connectTimeoutMillis,this.$content=this.$(".rooms-content"),this.formSubmissionListeners(),this.setupSearchListeners(),this.roomOperationListeners(),this.updateSegmentsCount(),this.$el.on("ToggleView.showList",(i=this,function(){return i.hideLegacy()})).on("ToggleView.showGrid",(e=this,function(){return e.showLegacy()}));var e,i},e.prototype.setupSearchListeners=function(){return this.$el.on("FilterBar.update",this.onFilterBarUpdate).on("Content.update",this.update).trigger("FilterBar.requestUpdate")},e.prototype.formSubmissionListeners=function(){return this.$body.on("AjaxForm.addRoom.success",this.onAddRoom).on("AjaxForm.configureRoom.success",this.onConfigureRoomSuccess).on("AjaxForm.editRoom.success",this.onEditRoom).on("AjaxForm.addDevice.success",this.onAddDevice)},e.prototype.roomOperationListeners=function(){return this.$el.on("AccordionSegment.refreshDisplay",this.updateSegmentsCount).on("Rooms.addRoom.open",this.onAddRoomOpen).on("Rooms.opConfigure",this.onOpConfigure).on("Rooms.opDelete",this.onOpDelete).on("Rooms.opEdit",this.onOpEdit).on("Rooms.opDisconnect",this.onOpDisconnect).on("Rooms.opConnect",this.onOpConnect).on("CsvUploadManager.updateDisplay",this.onCsvUploadsUpdate)},e.prototype.onCsvUploadsUpdate=function(t,e){return e.count,this.$content.css("top",this.$el.height()+"px")},e.prototype.onConfigureRoomSuccess=function(){return this.$el.trigger("Modal.close")},e.prototype.onAddRoomOpen=function(){return this.injectFromUrl(Echo.routes.Rooms.getAddRoomModal())},e.prototype.onAddRoom=function(t,e){return this.$(".grid-view").prepend(e.html.card),this.$el.trigger("Modal.close")},e.prototype.onEditRoom=function(t,e){return this.$el.trigger("Rooms.update",e).trigger("Modal.close")},e.prototype.onAddDevice=function(t,e){return this.$el.trigger("Rooms.connect",e).trigger("Modal.close"),alertify.success(this.i18n("Rooms.addDevice.success"))},e.prototype.onFilterBarUpdate=function(t,e){return this.query=e,this.search()},e.prototype.update=function(){return this.search(!1)},e.prototype.search=function(t){return null==t&&(t=!0),this.showLoading(),this.ajax(Echo.routes.Rooms.search(),{data:this.query,success:this.onSearchSuccess})},e.prototype.onSearchSuccess=function(t){return this.hideLoading(),this.$(".rooms-content").trigger("Rooms.destroyAll").trigger("Dropdowns.destroy").trigger("Clickables.roomCard.destroy").html(t.data[0].html),this.$body.trigger("ToggleView.refresh")},e.prototype.showLoading=function(){return this.$el.trigger("loading.on",{selector:".rooms-content"})},e.prototype.hideLoading=function(){return this.$el.trigger("loading.off",{selector:".rooms-content"})},e.prototype.onOpConfigure=function(t,e){return t.preventDefault(),this.injectFromUrl(Echo.routes.RoomConfigurations.edit(e))},e.prototype.onOpEdit=function(t,e){return t.preventDefault(),this.injectFromUrl(Echo.routes.Rooms.getUpdateForm(e))},e.prototype.onOpDelete=function(t,e){return alertify.confirm(this.deleteMessage,(i=this,function(t){if(t)return i.deleteAjax(e)}));var i},e.prototype.deleteAjax=function(t){return Echo.routes.Rooms.delete().ajax({contentType:"application/json",data:JSON.stringify({roomId:t}),dataType:"json",success:this.onOpDeleteSuccess,error:this.onOpDeleteError})},e.prototype.onOpDeleteSuccess=function(t,e,i){return this.$el.trigger("Rooms.delete",t.data[0].roomId),alertify.success(i.responseJSON.message)},e.prototype.onOpDeleteError=function(t){return alertify.error(t.responseJSON.message)},e.prototype.onOpDisconnect=function(t,e){return alertify.confirm(this.disconnectMessage,(i=this,function(t){if(t)return i.disconnectAjax(e)}));var i},e.prototype.disconnectAjax=function(t){return Echo.routes.Rooms.removeDevice(t).ajax({contentType:"application/json",data:JSON.stringify({roomId:t}),dataType:"json",success:this.onOpDisconnectSuccess,error:this.onOpDisconnectError})},e.prototype.onOpDisconnectSuccess=function(t){return this.$el.trigger("Rooms.disconnect",t.data[0]),alertify.success(this.i18n("Rooms.disconnectDevice.success"))},e.prototype.onOpDisconnectError=function(t){return alertify.error(t.responseJSON.message)},e.prototype.onOpConnect=function(t,e){return"#"===e?alertify.error(this.i18n("Errors.deviceConnectionError")):this.openInNewTab(e)},e.prototype.openInNewTab=function(t){return window.open(t,"_blank")},e.prototype.updateSegmentsCount=function(){return this.$(".accordion-segment-head .count").remove(),this.$(".accordion-segment").each(function(t,e){var i,o;return i=(e=$(e)).find("tr").not(":has(th)").length,(o=$("<span>",{class:"count"})).text("("+i+")"),o.appendTo(e.find(".accordion-segment-head"))})},e.prototype.hideLegacy=function(){return this.$(".rooms-content-react").show(),this.$(".rooms-content").hide(),this.$(".input-wrapper").hide(),this.$(".filterLabel").hide(),this.$(".filterSection").hide(),this.$(".clear-filters").hide()},e.prototype.showLegacy=function(){return this.$(".rooms-content-react").hide(),this.$(".rooms-content").show(),this.$(".input-wrapper").show(),this.$(".filterLabel").show(),this.$(".filterSection").show(),this.$(".clear-filters").show(),this.$content.css("top",this.$el.height()+"px")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.rooms.ManageCampusesAndBuildingsModal=function(t){function e(){return this.onClose=i(this.onClose,this),this.onCampusDeselected=i(this.onCampusDeselected,this),this.onCampusSelected=i(this.onCampusSelected,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.campusSelect=this.$(".campus-select"),this.buildingSelect=this.$(".building-select"),this.campusSelect.on("CrudSelect.selected",this.onCampusSelected).on("CrudSelect.deselected",this.onCampusDeselected),this.$el.on("Modal."+this.namespace+".onClose",this.onClose)},e.prototype.onCampusSelected=function(t,e){return this.ajax(Echo.routes.Buildings.buildingCrudSelect(e),{success:(o=this,function(t){return o.buildingSelect.html(t.data[0].html)}),complete:(i=this,function(){return i.buildingSelect.find("select").trigger("CrudSelect.deselect")})});var i,o},e.prototype.onCampusDeselected=function(){return this.buildingSelect.find("select").trigger("CrudSelect.deselect").trigger("disable")},e.prototype.onClose=function(){return this.campusSelect.find("select").trigger("CrudSelect.deselect"),this.$el.trigger("FilterBar.requestUpdate").trigger("RoomFilterBar.updateFilters")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.rooms.RoomCard=function(t){function e(){return this.onSubmitError=i(this.onSubmitError,this),this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.submitAjaxRemove=i(this.submitAjaxRemove,this),this.submitAjaxAdd=i(this.submitAjaxAdd,this),this.onDestroyAll=i(this.onDestroyAll,this),this.onDelete=i(this.onDelete,this),this.onDisconnect=i(this.onDisconnect,this),this.onUpdate=i(this.onUpdate,this),this.onUnsubscribe=i(this.onUnsubscribe,this),this.onSubscribe=i(this.onSubscribe,this),this.onFlipCard=i(this.onFlipCard,this),this.onFavoriteClicked=i(this.onFavoriteClicked,this),this.docListeners=i(this.docListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.roomId=t.roomId,this.roomName=t.roomName,this.$favoriteLink=this.$el.find(".favoriteRoom"),this.$el.on("click",".flipCard",this.onFlipCard),this.$el.on("click",".favoriteRoom",this.onFavoriteClicked)},e.prototype.docListeners=function(){return $.extend(e.__super__.docListeners.apply(this,arguments),{"Rooms.subscribe":this.onSubscribe,"Rooms.unsubscribe":this.onUnsubscribe,"Rooms.update":this.onUpdate,"Rooms.delete":this.onDelete,"Rooms.disconnect":this.onDisconnect,"Rooms.destroyAll":this.onDestroyAll})},e.prototype.onFavoriteClicked=function(t){return t.preventDefault(),t.stopPropagation(),this.$favoriteLink.hasClass("favorited")?(this.submitAjaxRemove(),this.$favoriteLink.trigger("Rooms.unsubscribe",this.roomId)):(this.submitAjaxAdd(),this.$el.trigger("Rooms.subscribe",this.roomId))},e.prototype.onFlipCard=function(t){return t.preventDefault(),this.$el.toggleClass("flipped")},e.prototype.onSubscribe=function(t,e){if(e===this.roomId)return this.$favoriteLink.addClass("favorited")},e.prototype.onUnsubscribe=function(t,e){if(e===this.roomId)return this.$favoriteLink.removeClass("favorited")},e.prototype.onUpdate=function(t,e){if(e.roomId===this.roomId)return this.$el.replaceWith(e.card),this.dispose()},e.prototype.onDisconnect=function(t,e){if(e.roomId===this.roomId)return this.$el.replaceWith(e.card),this.dispose()},e.prototype.onDelete=function(t,e){if(e===this.roomId)return this.dispose()},e.prototype.onDestroyAll=function(t){return this.dispose()},e.prototype.submitAjaxAdd=function(){return $.ajax({contentType:"application/json",url:"/rooms/subscribe",data:JSON.stringify({roomId:this.roomId}),dataType:"json",type:"POST",success:this.onSubmitSuccess,error:this.onSubmitError})},e.prototype.submitAjaxRemove=function(){return $.ajax({contentType:"application/json",url:"/rooms/unsubscribe",data:JSON.stringify({roomId:this.roomId}),dataType:"json",type:"POST",success:this.onSubmitSuccess,error:this.onSubmitError})},e.prototype.onSubmitSuccess=function(t){},e.prototype.onSubmitError=function(t){},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.rooms.RoomFilterBar=function(t){function e(){return this.onUpdateFiltersSuccess=i(this.onUpdateFiltersSuccess,this),this.onUpdateFilters=i(this.onUpdateFilters,this),this.getBuildingFilterOptionsSuccess=i(this.getBuildingFilterOptionsSuccess,this),this.onCampusFilterChange=i(this.onCampusFilterChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$buildingFilter=this.$("[name=buildingId]"),this.$campusFilter=this.$("[name=campusId]"),this.$el.on("RoomFilterBar.campusFilterChange",this.onCampusFilterChange),this.$body.on("RoomFilterBar.updateFilters",this.onUpdateFilters)},e.prototype.onCampusFilterChange=function(t,e){if(this.updateFilterOptions(this.$buildingFilter,""),""!==e)return this.getBuildingFilterOptions(e)},e.prototype.getBuildingFilterOptions=function(t){return Echo.routes.Rooms.getBuildingFilterOptions(t).ajax({success:this.getBuildingFilterOptionsSuccess})},e.prototype.getBuildingFilterOptionsSuccess=function(t){var e;return e=t.data,this.updateFilterOptions(this.$buildingFilter,e[0].html)},e.prototype.updateFilterOptions=function(t,e){var i;return i={options:e,keepEmptyOption:!0,maintainSelection:!0},t.trigger("Select.updateOptions",i)},e.prototype.onUpdateFilters=function(){var t;return""===(t=this.$campusFilter.val())&&(t=null),this.ajax(Echo.routes.Rooms.getCampusAndBuildingFilterOptions(t),{success:this.onUpdateFiltersSuccess})},e.prototype.onUpdateFiltersSuccess=function(t){var e;return e=t.data[0],this.updateFilterOptions(this.$campusFilter,e.campuses),this.updateFilterOptions(this.$buildingFilter,e.buildings)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty;Echo.pages.admin.rooms.RoomTableRow=function(t){var n;function e(){return this.submitAjaxUnsubscribe=i(this.submitAjaxUnsubscribe,this),this.submitAjaxSubscribe=i(this.submitAjaxSubscribe,this),this.onUnfavorited=i(this.onUnfavorited,this),this.onFavorited=i(this.onFavorited,this),this.onFavoriteClicked=i(this.onFavoriteClicked,this),this.removeEls=i(this.removeEls,this),this.onDestroyAll=i(this.onDestroyAll,this),this.onDelete=i(this.onDelete,this),this.onUpdate=i(this.onUpdate,this),this.onDisconnect=i(this.onDisconnect,this),this.onConnect=i(this.onConnect,this),this.removeEl=i(this.removeEl,this),this.addEl=i(this.addEl,this),this.onReady=i(this.onReady,this),this.docListeners=i(this.docListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.roomId=t.roomId,this.baseSegmentId=t.baseSegmentId,this.tableSegmentIds=t.tableSegmentIds,this.initialStatus=t.initialStatus,this.$el.on("click",".favoriteRoom",this.onFavoriteClicked),this.$el.detach(),this.tableSegmentEls={base:this.$el},this.$doc.ready(this.onReady)},e.prototype.docListeners=function(){return $.extend(e.__super__.docListeners.apply(this,arguments),{"Rooms.subscribe":this.onFavorited,"Rooms.unsubscribe":this.onUnfavorited,"Rooms.connect":this.onConnect,"Rooms.disconnect":this.onDisconnect,"Rooms.update":this.onUpdate,"Rooms.delete":this.onDelete,"Rooms.destroyAll":this.onDestroyAll})},e.prototype.onReady=function(){if(this.initialStatus.favorited&&this.addEl("favorites"),this.initialStatus.capturing&&this.addEl("capturing"),this.initialStatus.idle&&this.addEl("idle"),this.initialStatus.offline&&this.addEl("offline"),!this.initialStatus.connected)return this.addEl("unconnected")},e.prototype.addEl=function(t){if(!this.tableSegmentEls[t])return this.tableSegmentEls[t]=Echo.core.helpers.replaceIds(this.$el.clone(!0)),this.tableSegmentEls[t].appendTo(n(this.tableSegmentIds[t])),this.tableSegmentEls[t].trigger("AccordionSegment.refreshDisplay")},e.prototype.removeEl=function(t){var e;if(this.tableSegmentEls[t])return e=this.tableSegmentEls[t].closest(".accordion-segment"),this.tableSegmentEls[t].off().remove(),this.tableSegmentEls[t]=null,e.trigger("AccordionSegment.refreshDisplay")},e.prototype.onConnect=function(t,e){if(e.roomId===this.roomId)return this.removeEl("unconnected")},e.prototype.onDisconnect=function(t,e){if(e.roomId===this.roomId)return this.addEl("unconnected")},e.prototype.onUpdate=function(t,e){var i,o;if(e.roomId===this.roomId){for(i in o=this.tableSegmentEls)o[i],this.removeEl(i);return $(n(this.baseSegmentId)).append(e.tableRow),this.dispose()}},e.prototype.onDelete=function(t,e){if(e===this.roomId)return this.removeEls()},e.prototype.onDestroyAll=function(){return this.removeEls()},e.prototype.removeEls=function(){var t,e;for(t in e=this.tableSegmentEls)e[t],this.removeEl(t);return this.dispose()},e.prototype.onFavoriteClicked=function(t){var e;return t.preventDefault(),(e=$(t.target)).hasClass("favorited")?(this.submitAjaxUnsubscribe(),e.trigger("Rooms.unsubscribe",this.roomId)):(this.submitAjaxSubscribe(),e.trigger("Rooms.subscribe",this.roomId))},e.prototype.onFavorited=function(t,e){var i,o,n;if(e===this.roomId){for(i in n=this.tableSegmentEls)(o=n[i])&&o.find(".favoriteRoom").addClass("favorited");return this.addEl("favorites")}},e.prototype.onUnfavorited=function(t,e){var i,o,n;if(e===this.roomId){for(i in n=this.tableSegmentEls)(o=n[i])&&o.find(".favoriteRoom").removeClass("favorited");return this.removeEl("favorites")}},e.prototype.submitAjaxSubscribe=function(){return $.ajax({contentType:"application/json",url:"/rooms/subscribe",data:JSON.stringify({roomId:this.roomId}),dataType:"json",type:"POST",success:this.onSubmitSuccess,error:this.onSubmitError})},e.prototype.submitAjaxUnsubscribe=function(){return $.ajax({contentType:"application/json",url:"/rooms/unsubscribe",data:JSON.stringify({roomId:this.roomId}),dataType:"json",type:"POST",success:this.onSubmitSuccess,error:this.onSubmitError})},n=function(t){return"#"+t+" tbody"},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.rooms.UnconnectedRoomCard=function(t){function e(){return this.docListeners=i(this.docListeners,this),this.onConnect=i(this.onConnect,this),this.onAddClick=i(this.onAddClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.pages.admin.rooms.RoomCard),e.prototype.initialize=function(t){return this.roomId=t.roomId,this.roomName=t.roomName,e.__super__.initialize.apply(this,arguments),this.$el.on("click",".addDevice",this.onAddClick)},e.prototype.onAddClick=function(t){return t.preventDefault(),this.$el.trigger("Rooms.addDevice",this.roomId)},e.prototype.onConnect=function(t,e){if(e.roomId===this.roomId)return this.$el.replaceWith(e.card),this.dispose()},e.prototype.docListeners=function(){return $.extend(e.__super__.docListeners.apply(this,arguments),{"Rooms.connect":this.onConnect})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.scheduling.DeleteCaptureModal=function(t){function e(){return this.onOpen=i(this.onOpen,this),this.onDeleteSingle=i(this.onDeleteSingle,this),this.onDeleteAll=i(this.onDeleteAll,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$("[data-action=delete-all]").on("click",this.onDeleteAll),this.$("[data-action=delete-single]").on("click",this.onDeleteSingle),this.$body.on("Modal.deleteCapture.open",this.onOpen)},e.prototype.close=function(){return this.$el.trigger("Modal.close")},e.prototype.onDeleteAll=function(){return this.respondTo.trigger("DeleteCaptureModal.deleteAll"),this.close()},e.prototype.onDeleteSingle=function(){return this.respondTo.trigger("DeleteCaptureModal.deleteSingle"),this.close()},e.prototype.onOpen=function(t,e){this.respondTo=e.respondTo},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.scheduling.Index=function(t){function e(){return this.onAddCaptureSuccess=i(this.onAddCaptureSuccess,this),this.onAddCaptureForSectionOpen=i(this.onAddCaptureForSectionOpen,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$el.on("Modal.addCaptureForSection.open",this.onAddCaptureForSectionOpen),this.$body.on("AjaxForm.captureModal.success",this.onAddCaptureSuccess)},e.prototype.onAddCaptureForSectionOpen=function(t,e){return this.injectFromUrl(Echo.routes.CaptureSchedules.createModal(e))},e.prototype.onAddCaptureSuccess=function(){return window.location.reload()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.scheduling.SectionRuleRow=function(t){function e(){return this.onRuleResize=i(this.onRuleResize,this),this.onRuleOpen=i(this.onRuleOpen,this),this.onRuleClose=i(this.onRuleClose,this),this.onfetchRoomScheduleError=i(this.onfetchRoomScheduleError,this),this.fetchRoomSchedule=i(this.fetchRoomSchedule,this),this.onExpanderOpen=i(this.onExpanderOpen,this),this.onExpanderClose=i(this.onExpanderClose,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.sectionId=t.sectionId,this.captureScheduleId=t.captureScheduleId,this.roomId=t.roomId,this.$el.on("Expander.expandRule.opened",this.onExpanderOpen),this.$el.on("Expander.expandRule.closed",this.onExpanderClose),this.$el.on("SectionRuleRow.resize",this.onRuleResize),this.onEvent(this.namespacedEventName("SectionRuleRow","open"),this.onRuleOpen),this.onEvent(this.namespacedEventName("SectionRuleRow","close"),this.onRuleClose),this.onEvent(this.namespacedEventName("CalendarEvent","click"),this.onRuleOpen),this.ruleContent=this.$(".rule-content"),this.expander=this.$(".expander"),this.isLoaded=!1},e.prototype.resizeToFitContent=function(t){return null==t&&(t=this.ruleContent.prop("scrollHeight")),this.ruleContent.height(t)},e.prototype.onExpanderClose=function(){return this.ruleContent.height(0),this.$el.removeClass("expanded")},e.prototype.onExpanderOpen=function(){return this.fetchRoomSchedule(),this.resizeToFitContent(),this.$el.addClass("expanded")},e.prototype.fetchRoomSchedule=function(){if(!this.isLoaded)return this.isLoaded=!0,this.injectFromUrl(Echo.routes.CaptureSchedules.fetchRoomSchedule(this.sectionId,this.captureScheduleId,this.roomId),this.ruleContent,this.onfetchRoomScheduleError)},e.prototype.onfetchRoomScheduleError=function(){return this.isLoaded=!1,alertify.error(this.i18n("Alert.genericError"))},e.prototype.onRuleClose=function(){return this.expander.trigger("Expander.expandRule.closed")},e.prototype.onRuleOpen=function(){return this.expander.trigger("Expander.expandRule.opened")},e.prototype.onRuleResize=function(t,e){return this.resizeToFitContent(e)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,o=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.pages.admin.users.AddUserModal=function(t){function e(){return this.onAjaxError=i(this.onAjaxError,this),this.onAjaxSuccess=i(this.onAjaxSuccess,this),this.onRoleChange=i(this.onRoleChange,this),this.onClose=i(this.onClose,this),this.onBack=i(this.onBack,this),this.onNext=i(this.onNext,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.step1=this.$(".step1"),this.step2=this.$(".step2"),this.$body.on("addUserModal.next",this.onNext).on("addUserModal.back",this.onBack).on("Modal.addUser.onClose",this.onClose),this.$el.on("AjaxForm.addUser.success",this.onAjaxSuccess).on("AjaxForm.addUser.error",this.onAjaxError),this.$(".roles-wrapper input[type=checkbox]").on("change",this.onRoleChange),this.toggleCourseWrapper(),this.showStep(1)},e.prototype.onNext=function(){return this.updateSummary(),this.showStep(2)},e.prototype.onBack=function(){return this.showStep(1)},e.prototype.onClose=function(){return this.showStep(1)},e.prototype.onRoleChange=function(){return this.toggleCourseWrapper(),this.$(".enrollmentTable").trigger("setEnabledRoles",{enabledRoles:this.getRoles()})},e.prototype.onAjaxSuccess=function(){return this.$el.trigger("Modal.close")},e.prototype.onAjaxError=function(){return this.showStep(1)},e.prototype.getRoles=function(){var t,e,i,o,n;for(n=[],t=0,i=(o=this.$(".roles-wrapper input[type=checkbox]:checked")).length;t<i;t++)e=o[t],n.push({name:$("label[for='"+$(e).attr("id")+"']").text(),value:$(e).data("role")});return n},e.prototype.getFormattedRoles=function(){var t;return 0===(t=this.getRoles()).length?"None":t.map(function(t){return t.name}).join(" / ")},e.prototype.showStep=function(t){var e;return(e=this.$(".step"+t)).siblings().hide(),e.show()},e.prototype.toggleCourseWrapper=function(){var t,n,e;return e=function(){var t,e,i,o;for(o=[],t=0,e=(i=this.getRoles()).length;t<e;t++)n=i[t],o.push(n.value);return o}.call(this),t=0<=o.call(e,"Student")||0<=o.call(e,"Instructor")||0<=o.call(e,"TeachingAssistant")?"show":"hide",this.$(".courses-wrapper")[t]()},e.prototype.updateSummary=function(){return this.updateDetailSummary(),this.updateCourseSummary()},e.prototype.updateDetailSummary=function(){return this.$(".name").text([this.$("input[name=firstName]").val(),this.$("input[name=lastName]").val()].join(" ")),this.$(".email").text(this.$("input[name=email]").val()),this.$(".roles").text(this.getFormattedRoles())},e.prototype.updateCourseSummary=function(){var t;return this.$(".courses").html(""),(t=this.$(".courses-wrapper").clone()).find(".actions, .template, .addEntryButton, script").remove(),t.find(".select").replaceWith(function(){return $(this).find(".selection").text()||"&nbsp;"}),t.find(".select2-wrapper").replaceWith(function(){return $(this).find(".selection").text()||"&nbsp;"}),t.find("[data-type]").removeAttr("data-type"),this.$(".courses").append(t)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,o=[].slice;Echo.pages.admin.users.BatchActions=function(t){function e(){return this.resendInvitations=i(this.resendInvitations,this),this.onInvitationSubmit=i(this.onInvitationSubmit,this),this.undoChangeStatus=i(this.undoChangeStatus,this),this.changeStatus=i(this.changeStatus,this),this.onActiveSwitchChange=i(this.onActiveSwitchChange,this),this.changeRoles=i(this.changeRoles,this),this.onChangeRolesSubmit=i(this.onChangeRolesSubmit,this),this.onRoleChange=i(this.onRoleChange,this),this.onUpdateSelected=i(this.onUpdateSelected,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$table=$(".adminList-table"),this.$table.on("AdminListTable.updateSelected",this.onUpdateSelected),this.$activeSwitch=this.$("[name=activeSwitch]"),this.$invitationBtn=this.$(".resendInvitationsBtn"),this.$roleToggles=this.$(".roleSwitch input"),this.$adminToggle=this.$("[name=Admin]"),this.$schedulerToggle=this.$("[name=Scheduler]"),this.$teachingAssistantToggle=this.$("[name=TeachingAssistant]"),this.$instructorToggle=this.$("[name=Instructor]"),this.$studentToggle=this.$("[name=Student]"),this.$changeRoleBtn=this.$(".changeRolesBtn"),this.$roleToggles.on("change",this.onRoleChange),this.$changeRoleBtn.on("Admin.Users.changeRoles",this.onChangeRolesSubmit),this.$activeSwitch.on("change",this.onActiveSwitchChange),this.$invitationBtn.on("Admin.Users.resendInvitation",this.onInvitationSubmit),this.reset()},e.prototype.reset=function(){return this.$activeSwitch.trigger("disable"),this.$invitationBtn.trigger("disable"),this.$adminToggle.trigger("disable"),this.$schedulerToggle.trigger("disable"),this.$teachingAssistantToggle.trigger("disable"),this.$instructorToggle.trigger("disable"),this.$studentToggle.trigger("disable"),this.$changeRoleBtn.trigger("disable")},e.prototype.onUpdateSelected=function(){var t;return arguments[0],t=2<=arguments.length?o.call(arguments,1):[],this.selectedUsers=_.pluck(t,"data"),this.refresh()},e.prototype.refresh=function(){var t;return 0<(null!=(t=this.selectedUsers)?t.length:void 0)?(this.updateActiveToggle(),this.updateInvitationBtn(),this.updateRoles()):this.reset()},e.prototype.updateActiveToggle=function(){var t;return t=_.filter(this.selectedUsers,function(t){return"Active"===t.status}),_.filter(this.selectedUsers,function(t){return"Invited"===t.status}).length===this.selectedUsers.length?this.$activeSwitch.trigger("disable"):t.length!==this.selectedUsers.length&&0!==t.length?this.$activeSwitch.trigger("disable"):t.length?this.$activeSwitch.prop({checked:!0}).trigger("enable"):this.$activeSwitch.prop({checked:!1}).trigger("enable")},e.prototype.updateInvitationBtn=function(){return _.filter(this.selectedUsers,function(t){return"Invited"===t.status}).length===this.selectedUsers.length?this.$invitationBtn.trigger("enable"):this.$invitationBtn.trigger("disable")},e.prototype.updateRoles=function(){var t;return t=this.getRoleCounts(),this.$adminToggle.prop({checked:t.admins===this.selectedUsers.length}),this.$schedulerToggle.prop({checked:t.schedulers===this.selectedUsers.length}),this.$teachingAssistantToggle.prop({checked:t.teachingAssistants===this.selectedUsers.length}),this.$instructorToggle.prop({checked:t.instructors===this.selectedUsers.length}),this.$studentToggle.prop({checked:t.students===this.selectedUsers.length}),this.$roleToggles.trigger("change").trigger("enable")},e.prototype.getRoleCounts=function(){return{admins:_.filter(this.selectedUsers,function(t){return _.contains(t.roles,"Admin")}).length,schedulers:_.filter(this.selectedUsers,function(t){return _.contains(t.roles,"Scheduler")}).length,teachingAssistants:_.filter(this.selectedUsers,function(t){return _.contains(t.roles,"TeachingAssistant")}).length,instructors:_.filter(this.selectedUsers,function(t){return _.contains(t.roles,"Instructor")}).length,students:_.filter(this.selectedUsers,function(t){return _.contains(t.roles,"Student")}).length}},e.prototype.onRoleChange=function(){var t,e,i,o,n,s,r,a,h,l,c,u,p;return o=this.getRoleCounts(),r=this.selectedUsers.length,e=this.$adminToggle.prop("checked"),h=this.$schedulerToggle.prop("checked"),p=this.$teachingAssistantToggle.prop("checked"),s=this.$instructorToggle.prop("checked"),c=this.$studentToggle.prop("checked"),t=e&&o.admins<r||!e&&0<o.admins,a=h&&o.schedulers<r||!h&&0<o.schedulers,u=p&&o.teachingAssistants<r||!p&&0<o.teachingAssistants,n=s&&o.instructors<r||!s&&0<o.instructors,l=c&&o.students<r||!c&&0<o.students,i=t||a||n||l||u,!(e||h||s||c||p)?this.$changeRoleBtn.trigger("disable"):i?this.$changeRoleBtn.trigger("enable"):this.$changeRoleBtn.trigger("disable")},e.prototype.getUserIds=function(){return _.pluck(this.selectedUsers,"userId")},e.prototype.getRoles=function(){var t;return t=_.filter(this.$roleToggles,function(t){return $(t).prop("checked")}),_.map(t,function(t){return $(t).attr("name")})},e.prototype.getRoleChangeMessage=function(){var t,e,i,o;return t=this.getRoleCounts(),e=!this.$instructorToggle.prop("checked")&&0<t.instructors,i=!this.$studentToggle.prop("checked")&&0<t.students,o=!this.$teachingAssistantToggle.prop("checked")&&0<t.teachingAssistants,e&&i&&o?"Admin.Users.revokeAcademicRolesWarningBatch":e&&i?"Admin.Users.revokeInstructorAndStudentRoleWarningBatch":i&&o?"Admin.Users.revokeStudentAndTeachingAssistantRoleWarningBatch":e&&o?"Admin.Users.revokeInstructorAndTeachingAssistantRoleWarningBatch":e?"Admin.Users.revokeInstructorRoleWarningBatch":i?"Admin.Users.revokeStudentRoleWarningBatch":o?"Admin.Users.revokeTeachingAssistantRoleWarningBatch":"Admin.Users.changeRoleWarningBatch"},e.prototype.onChangeRolesSubmit=function(){return this.confirm(this.getRoleChangeMessage(),(t=this,function(){return t.changeRoles()}));var t},e.prototype.changeRoles=function(){return this.$el.trigger("Admin.Users.changeRolesForUsers",{ids:this.getUserIds(),roles:this.getRoles()})},e.prototype.onActiveSwitchChange=function(){var t;return t=this.$activeSwitch.prop("checked")?"Admin.Users.makeActiveConfirmation":"Admin.Users.makeInactiveConfirmation",1<this.selectedUsers.length&&(t+="Batch"),this.confirm(t,this.changeStatus,this.undoChangeStatus)},e.prototype.changeStatus=function(){var t;return t=this.$activeSwitch.prop("checked")?"Admin.Users.activateAll":"Admin.Users.deactivateAll",this.$el.trigger(t,{ids:this.getUserIds()})},e.prototype.undoChangeStatus=function(){var t;return t=this.$activeSwitch.prop("checked"),this.$activeSwitch.prop("checked",!t)},e.prototype.onInvitationSubmit=function(){var t;return"Admin.Users.resendInvitationConfirmation",this.confirm("Admin.Users.resendInvitationConfirmation",(t=this,function(){return t.resendInvitations()}))},e.prototype.resendInvitations=function(){return this.$el.trigger("Admin.Users.resendInvitations",{ids:this.getUserIds()})},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.users.Filters=function(t){function e(){return this.onSectionUpdateSuccess=i(this.onSectionUpdateSuccess,this),this.onChange=i(this.onChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){var t;return this.$termId=this.$("[name=termId]"),this.$courseId=this.$("[name=courseId]"),this.$sectionId=this.$("[name=sectionId]"),t=_.debounce(this.onChange,250),this.$termId.on("change",t),this.$courseId.on("change",t)},e.prototype.onChange=function(t,e){var i,o,n;return o=this.$termId.value(),null!=(i=this.$courseId.value())?(null!=(n=this.xhr)&&"function"==typeof n.abort&&n.abort(),this.xhr=Echo.routes.Sections.getSectionFilterOptions(i,o).ajax({type:"POST",contentType:"application/json",data:JSON.stringify({courseId:i,termId:o}),success:this.onSectionUpdateSuccess,error:this.onAjaxError})):this.$sectionId.trigger("Select.updateSelected","").trigger("disable")},e.prototype.onSectionUpdateSuccess=function(t){return this.$sectionId.trigger("Select.updateOptions",{options:t.data[0].html,keepEmptyOption:!0,maintainSelection:!0}).trigger("enable")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.users.Index=function(t){function e(){return this.onBatchOpError=i(this.onBatchOpError,this),this.onBatchOpSuccess=i(this.onBatchOpSuccess,this),this.onResendInvitations=i(this.onResendInvitations,this),this.onDeactivateAll=i(this.onDeactivateAll,this),this.onActivateAll=i(this.onActivateAll,this),this.onChangeRolesForusers=i(this.onChangeRolesForusers,this),this.refreshUserItem=i(this.refreshUserItem,this),this.onBatchUpdate=i(this.onBatchUpdate,this),this.onDeleteUserSuccess=i(this.onDeleteUserSuccess,this),this.onEditUserSuccess=i(this.onEditUserSuccess,this),this.onAddUserSuccess=i(this.onAddUserSuccess,this),this.onUserDelete=i(this.onUserDelete,this),this.onUserEdit=i(this.onUserEdit,this),this.onUserManageEnrollments=i(this.onUserManageEnrollments,this),this.onBulkActionButtonToggle=i(this.onBulkActionButtonToggle,this),this.onFilterBarUpdate=i(this.onFilterBarUpdate,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.selectedUsers=[],this.$batchActions=this.$(".batchActions"),this.$filters=this.$(".filterBar"),this.$table=this.$(".adminList-table"),this.onFiltersUpdate=_.debounce(this._onFiltersUpdate,250),this.$el.on("BulkActionButton.toggle",this.onBulkActionButtonToggle).on("FilterBar.update",this.onFilterBarUpdate).on("User.manageEnrollment",this.onUserManageEnrollments).on("User.edit",this.onUserEdit).on("User.delete",this.onUserDelete).on("Admin.Users.changeRolesForUsers",this.onChangeRolesForusers).on("Admin.Users.activateAll",this.onActivateAll).on("Admin.Users.deactivateAll",this.onDeactivateAll).on("Admin.Users.resendInvitations",this.onResendInvitations).on("Admin.Users.batchUpdate",this.onBatchUpdate),this.$body.on("AjaxForm.addUser.success",this.onAddUserSuccess).on("AjaxForm.editUser.success",this.onEditUserSuccess).on("AjaxForm.deleteUser.success",this.onDeleteUserSuccess),this.$el.trigger("FilterBar.requestUpdate")},e.prototype.onFilterBarUpdate=function(t,e){return this.filters=e,this.$table.trigger("AdminListTable.search",{url:Echo.routes.InstitutionUsers.search(),filters:this.filters})},e.prototype.onBulkActionButtonToggle=function(t,e){return this.$el.toggleClass("batch",e)},e.prototype.onUserManageEnrollments=function(t,e){return this.injectFromUrl(Echo.routes.UserSections.getUserEnrollmentModal(e),$("body"))},e.prototype.onUserEdit=function(t,e){return this.injectFromUrl(Echo.routes.InstitutionUsers.getEditUserModal(e),$("body"))},e.prototype.onUserDelete=function(t,e){return this.injectFromUrl(Echo.routes.InstitutionUsers.getDeleteUserModal(e),$("body"))},e.prototype.onAddUserSuccess=function(t,e){return this.$table.trigger("AdminListTable.itemsAdded",e)},e.prototype.onEditUserSuccess=function(t,e){return this.refreshUserItem(e.userId,e.html),this.$body.trigger("Modal.editUser.close")},e.prototype.onDeleteUserSuccess=function(t,e){return this.$table.find("[data-id="+e.userId+"]").remove(),this.$body.trigger("Modal.deleteUser.close")},e.prototype.onBatchUpdate=function(t,e){var i;return _.map(e.users,(i=this,function(t){return i.refreshUserItem(t.userId,t.html)})),this.$table.trigger("AdminListTable.refreshSelected")},e.prototype.refreshUserItem=function(t,e){return this.$table.find("[data-id="+t+"]").replaceWith(e)},e.prototype.onChangeRolesForusers=function(t,e){return this.submitBatchOp(Echo.routes.InstitutionUsers.batchUpdateRoles(),e)},e.prototype.onActivateAll=function(t,e){return this.submitBatchOp(Echo.routes.InstitutionUsers.reinstateAll(),e)},e.prototype.onDeactivateAll=function(t,e){return this.submitBatchOp(Echo.routes.InstitutionUsers.revokeAll(),e)},e.prototype.onResendInvitations=function(t,e){return this.submitBatchOp(Echo.routes.InstitutionUsers.resendEmailAll(),e)},e.prototype.submitBatchOp=function(t,e){return this.loadingOn(),this.ajax(t,{dataType:"json",data:e,success:this.onBatchOpSuccess,error:this.onBatchOpError})},e.prototype.onBatchOpSuccess=function(t,e,i){return this.loadingOff(),alertify.success(t.data[0].message),this.onBatchUpdate(null,t.data[0])},e.prototype.onBatchOpError=function(t){var e,i;if(this.loadingOff(),i=Echo.core.form.getErrorJSON(t))return null!=(e=_.filter(i,function(t,e){return"obj.roles"===e||"obj.roles.Instructor"===e}))[0]?alertify.error(this.i18n(e[0][0].msg)):alertify.error(this.i18n("Admin.Users.batchUpdateRolesError"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.users.User=function(t){function e(){return this.onStatusUpdateError=i(this.onStatusUpdateError,this),this.userUpdated=i(this.userUpdated,this),this.resetLms=i(this.resetLms,this),this.onUserResetLms=i(this.onUserResetLms,this),this.makeActive=i(this.makeActive,this),this.onUserMakeActive=i(this.onUserMakeActive,this),this.makeInactive=i(this.makeInactive,this),this.onUserMakeInactive=i(this.onUserMakeInactive,this),this.onResendInvitationSuccess=i(this.onResendInvitationSuccess,this),this.resendInvitation=i(this.resendInvitation,this),this.onUserResendInvitation=i(this.onUserResendInvitation,this),this.onClick=i(this.onClick,this),this.onCheckboxClick=i(this.onCheckboxClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.userId=t.userId,this.$checkbox=this.$(".adminTable-itemCheckbox"),this.$checkbox.on("click",this.onCheckboxClick),this.$el.on("click",this.onClick).on("User.resendInvitation",this.onUserResendInvitation).on("User.makeInactive",this.onUserMakeInactive).on("User.makeActive",this.onUserMakeActive).on("User.resetLmsAccounts",this.onUserResetLms)},e.prototype.onCheckboxClick=function(t,e){return null!=t?t.stopPropagation():void 0},e.prototype.onClick=function(t,e){var i;return i=this.$checkbox.prop("checked"),this.$checkbox.prop("checked",!i).trigger("change")},e.prototype.onUserResendInvitation=function(t){return null!=t&&t.stopPropagation(),this.confirm("Admin.Users.resendInvitationConfirmation",(e=this,function(){return e.resendInvitation()}));var e},e.prototype.resendInvitation=function(){return this.ajax(Echo.routes.InstitutionUsers.resendEmailAll(),{dataType:"json",data:{ids:[this.userId]},success:this.onResendInvitationSuccess,error:this.onResendInvitationError})},e.prototype.onResendInvitationSuccess=function(t,e,i){return alertify.success(this.i18n("Admin.Users.resendInvitationAllSuccess"))},e.prototype.onResendInvitationError=function(t){return alertify.error(t.responseJSON.message)},e.prototype.onUserMakeInactive=function(t){return null!=t&&t.stopPropagation(),this.confirm("Admin.Users.makeInactiveConfirmation",(e=this,function(){return e.makeInactive()}));var e},e.prototype.makeInactive=function(){return this.ajax(Echo.routes.InstitutionUsers.revokeAll(),{dataType:"json",data:{ids:[this.userId]},success:this.userUpdated,error:this.onStatusUpdateError})},e.prototype.onUserMakeActive=function(t){return null!=t&&t.stopPropagation(),this.confirm("Admin.Users.makeActiveConfirmation",(e=this,function(){return e.makeActive()}));var e},e.prototype.makeActive=function(){return this.ajax(Echo.routes.InstitutionUsers.reinstateAll(),{dataType:"json",data:{ids:[this.userId]},success:this.userUpdated,error:this.onStatusUpdateError})},e.prototype.onUserResetLms=function(t){return null!=t&&t.stopPropagation(),this.confirm("Admin.Users.resetLmsAccountsConfirmation",(e=this,function(){return e.resetLms()}));var e},e.prototype.resetLms=function(){return this.ajax(Echo.routes.InstitutionUsers.resetLmsAccounts(this.userId),{dataType:"json",success:this.userUpdated,error:this.onStatusUpdateError})},e.prototype.userUpdated=function(t,e,i){return alertify.success(this.i18n("Admin.Users.updateSuccess")),this.$el.trigger("Admin.Users.batchUpdate",t.data[0])},e.prototype.onStatusUpdateError=function(t){var e,i;if(i=Echo.core.form.getErrorJSON(t))return null!=(e=_.filter(i,function(t,e){return"obj.userId"===e}))[0]?alertify.error(this.i18n(e[0][0].msg)):void 0},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.pages.echoAdmin.promoCodes.Index=function(t){function i(){var t,e;return this.onGenerate=(t=this.onGenerate,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$count=this.$("input[name=count]"),this.$el.on("PromoCodes.generate",this.onGenerate)},i.prototype.onGenerate=function(){var t;if(!(+(t=this.$count.val().trim())<=0))return alertify.success(t+" promo codes generated"),window.location=Echo.routes.PromoCodes.generate(t).url},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.creation.BaseModal=function(t){function e(){return this.onSubmitSuccess=i(this.onSubmitSuccess,this),this.onSubmitError=i(this.onSubmitError,this),this.getSlideInsertPosition=i(this.getSlideInsertPosition,this),this.getSelectedSlide=i(this.getSelectedSlide,this),this.reset=i(this.reset,this),this.onPreviewSlide=i(this.onPreviewSlide,this),this.onSubmit=i(this.onSubmit,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){var t;return this.options.edit&&(this.activityId=this.$el.data("activity")),this.namespace=this.options.namespace,this.$question=this.$("[name=prompt]"),this.$embedWrapper=this.$(".embedMedia-wrapper"),this.$justificationSwitch=this.$(".justification-switch"),this.$container=this.$el.closest(".slideDeck-editor").find(".presentation-editor-slideList"),this.$doc.on("Modal."+this.namespace+".onClose",this.reset),this.$el.on("AjaxForm.submit",this.onSubmit),this.$el.on("editActivityModal.clear",(t=this,function(){return t.dispose()})),this.$el.on("preview.slide",this.onPreviewSlide)},e.prototype.onSubmit=function(){var t;if(t=this.checkDataValidity())return this._submit(t)},e.prototype.onPreviewSlide=function(t){var e,i;if(e=this.checkDataValidity())return this.getSlideInsertPosition(),i={activity:this.options.edit?e:e.activity,num:this.insertSlideNum},this.$el.trigger("Editor.previewActivitySlide",i)},e.prototype.checkDataValidity=function(){var t,e,i;if(t=this.giftWrap())return null==(e=this.options.edit?t.prompt:null!=(i=t.activity)?i.prompt:void 0)||""===e?alertify.alert(this.i18n("Activity.error.promptRequired")):t},e.prototype.reset=function(){return this.$question.val(""),this.$embedWrapper.trigger("EmbedMedia.reset"),this.$justificationSwitch.prop("checked",!1)},e.prototype._submit=function(t){var e,i;return this.getSlideInsertPosition(),this.options.edit?(e=Echo.routes.Activities.updateActivity(this.options.activityId),(i=t).num=this.insertSlideNum):(e=Echo.routes.Slides.create(this.options.slideDeckId),i={content:$.extend(t,{type:this.type}),num:this.insertSlideNum}),this.$("button").trigger("disable"),this.ajax(e,{data:i,success:this.onSubmitSuccess,error:this.onSubmitError})},e.prototype.getSelectedSlide=function(){return this.$container.find(".editor-slide.selected:last")},e.prototype.getSlideInsertPosition=function(){var t;return 0<(t=this.getSelectedSlide()).length?this.insertSlideNum=this.$container.find(".editor-slide").index(t)+1:this.insertSlideNum=this.$container.find(".editor-slide").length},e.prototype.onSubmitError=function(t){var e;return this.$("button").trigger("enable"),e="SlideCreation."+this.type+".submitError",Echo.core.form.onSubmitError(this.$el,t,{},e)},e.prototype.onSubmitSuccess=function(t){var e;return e=t.data,this.$("button").trigger("enable"),this.options.edit?this.$el.trigger("Slide.edited"):this.$el.trigger("Slide.created",{slide:e[0].html,num:this.insertSlideNum})},e}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.creation.ImageAnnotation=function(t){function o(){return this.onError=e(this.onError,this),this.clearUploadedImage=e(this.clearUploadedImage,this),this.uploadFailure=e(this.uploadFailure,this),this.uploadSuccess=e(this.uploadSuccess,this),this.updateSolution=e(this.updateSolution,this),this.onPreviewSlide=e(this.onPreviewSlide,this),this.giftWrap=e(this.giftWrap,this),this.reset=e(this.reset,this),this.onCanvasReady=e(this.onCanvasReady,this),this.onDocumentReady=e(this.onDocumentReady,this),o.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(o,Echo.widgets.activities.creation.BaseModal),o.prototype.activityType="ImageAnnotation",o.prototype.type="ActivitySlide",o.prototype.initialize=function(t){var e,i;return this.id=t.id,this.namespace=t.namespace,this.edit=t.edit,this.route=t.route,this.solution=t.solution,o.__super__.initialize.apply(this,arguments),this.imagePath=null,this.$uploadTrigger=this.$(".choose-image-btn"),this.$previewWrapper=this.$(".uploadedImage-wrapper"),this.$imageWithControls=this.$(".uploadedImageWithControls"),this.$uploadedImage=this.$previewWrapper.find("img"),this.$previewWrapper.find(".btn").trigger("disable"),this.$uploadedImage.on("load",(e=this,function(){return e.$previewWrapper.find(".btn").trigger("enable")})),this.$filename=this.$previewWrapper.find(".uploadedImage-filename"),this.$markerOpener=this.$(".mark-solution-btn"),this.$markerOpener.on("click",(i=this,function(){return i.$el.trigger("Modal."+i.id+".open")})),this.$el.on("FileStack.success",this.uploadSuccess).on("FileStack.failure",this.uploadFailure).on("clear.uploadedImage",this.clearUploadedImage).on("SlideCreation."+this.type+".submitError",this.onError),this.$doc.on(this.id+".updateSolution",this.updateSolution).on(this.id+".canvasReady",this.onCanvasReady).ready(this.onDocumentReady)},o.prototype.onDocumentReady=function(){if(this.edit&&(this.imagePath=this.$uploadedImage.attr("src"),this.$filename.html(this.imagePath),this.$uploadTrigger.hide(),this.$previewWrapper.show(),null!=this.solution))return this.solution=this.solution,this.updateSolutionDiv()},o.prototype.onCanvasReady=function(){if(null!=this.solution)return this.$doc.trigger(this.id+".loadSolution",this.solution)},o.prototype.updateSolutionDiv=function(){var t;if(this.$(".imageSolution").remove(),this.solution)return t=$("<div>").addClass("imageSolution").css({left:100*this.solution.left+"%",top:100*this.solution.top+"%",height:100*this.solution.height+"%",width:100*this.solution.width+"%"}),this.$imageWithControls.append(t)},o.prototype.reset=function(){return o.__super__.reset.apply(this,arguments),this.clearUploadedImage()},o.prototype.giftWrap=function(){var t;return t={prompt:this.$question.val().trim(),explanationRequired:this.$justificationSwitch.prop("checked")},null!=this.imagePath&&(t.activityContent={image:this.imagePath,type:this.activityType}),this.solution&&(t.solution={solution:this.solution,type:this.activityType}),this.options.edit?t:{activity:t}},o.prototype.onPreviewSlide=function(t){var e,i;if(e=this.giftWrap(),this.options.edit?null!=e.activityContent:null!=(null!=(i=e.activity)?i.activityContent:void 0))return o.__super__.onPreviewSlide.call(this,t);alertify.alert(this.i18n("Activity.error.imageAnnotation.imageRequired"))},o.prototype.updateSolution=function(t,e){return this.solution=e,this.updateSolutionDiv()},o.prototype.uploadSuccess=function(t,e){return this.$uploadedImage.attr("src",e.fileBlob.url),this.imagePath=e.fileBlob.url,this.$filename.html(e.fileBlob.filename),this.$uploadTrigger.hide(),this.$previewWrapper.show(),t.stopPropagation(),this.$doc.trigger(this.id+".setImage",e.fileBlob.url)},o.prototype.uploadFailure=function(t,e){return this.clearUploadedImage(),t.stopPropagation(),alertify.error(this.i18n("Errors.fileUploadError"))},o.prototype.clearUploadedImage=function(t){return this.$previewWrapper.hide(),this.$uploadTrigger.show(),this.$uploadedImage.attr("src",""),this.$filename.html(""),this.imagePath=null,this.solution=null,this.updateSolutionDiv(),this.$doc.trigger(this.id+".clearImage")},o.prototype.onError=function(t,e){var i,o,n,s;if(null!=(null!=e?e.formErrors:void 0)){for(i in s=[],n=e.formErrors){switch(o=n[i],i){case"obj.content.activity.activityContent":case"obj.activityContent":o="Activity.create.errors.imageAnnotation.missingImage";break;case"obj.content.activity.activityContent.image":case"obj.activityContent.image":o="Activity.error.badImage";break;default:o=null}o?s.push(alertify.error(this.i18n(o))):s.push(void 0)}return s}},o}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.creation.ImageAnnotationSolutionMarker=function(t){function e(){return this.saveSolution=i(this.saveSolution,this),this.clearSolution=i(this.clearSolution,this),this.sizeCanvas=i(this.sizeCanvas,this),this.updateImage=i(this.updateImage,this),this.onMouseMove=i(this.onMouseMove,this),this.onMouseUp=i(this.onMouseUp,this),this.onMouseDown=i(this.onMouseDown,this),this.clearImage=i(this.clearImage,this),this.drawSolution=i(this.drawSolution,this),this.loadSolution=i(this.loadSolution,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.solutionColor="rgba(255, 255, 0, 0.3)",e.prototype.solutionBorderColor="rgb(255, 255, 0)",e.prototype.solutionBorderThickness=6,e.prototype.initialize=function(t){return this.namespace=t.namespace,this.solution={},this.drag=!1,this.$stage=this.$(".imageQuizSolution-stage"),this.$image=this.$(".imageQuiz-image"),this.$solutionCanvas=this.$(".imageQuizSolution-canvas"),this.canvas=this.$solutionCanvas[0],this.canvasHeight=this.canvas.height,this.canvasWidth=this.canvas.width,this.canvas.getContext&&(this.canvasCtx=this.canvas.getContext("2d")),this.$el.on("clear.solution",this.clearSolution).on("save.solution",this.saveSolution),this.$doc.on(this.namespace+".setImage",this.updateImage).on("Modal."+this.namespace+".onOpen",this.sizeCanvas).on(this.namespace+".clearImage",this.clearImage).on(this.namespace+".loadSolution",this.loadSolution),this.$solutionCanvas.on("mousedown",this.onMouseDown).on("mouseup mouseout",this.onMouseUp).on("mousemove",this.onMouseMove)},e.prototype.loadSolution=function(t,e){if(e)return this.solution={startX:e.left*this.canvasWidth,startY:e.top*this.canvasHeight,w:e.width*this.canvasWidth,h:e.height*this.canvasHeight},this.drawSolution(this.solution)},e.prototype.drawSolution=function(t){var e,i,o,n;return this.canvasCtx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasCtx.fillStyle=this.solutionBorderColor,this.canvasCtx.fillRect(t.startX,t.startY,t.w,t.h),this.canvasCtx.fillStyle=this.solutionColor,o=0<t.w?(i=t.w-this.solutionBorderThickness,t.startX+this.solutionBorderThickness/2):(i=t.w+this.solutionBorderThickness,t.startX-this.solutionBorderThickness/2),n=0<t.h?(e=t.h-this.solutionBorderThickness,t.startY+this.solutionBorderThickness/2):(e=t.h+this.solutionBorderThickness,t.startY-this.solutionBorderThickness/2),this.canvasCtx.clearRect(o,n,i,e),this.canvasCtx.fillRect(o,n,i,e)},e.prototype.clearImage=function(){return this.$image.attr("src",""),this.clearSolution()},e.prototype.onMouseDown=function(t){var e,i,o,n;return i=(o=[this.$solutionCanvas.height(),this.$solutionCanvas.width(),this.$solutionCanvas.offset()])[0],n=o[1],e=o[2],this.solution.startX=(t.pageX-e.left)*(this.canvas.width/n),this.solution.startY=(t.pageY-e.top)*(this.canvas.height/i),this.drag=!0},e.prototype.onMouseUp=function(){return this.drag=!1},e.prototype.onMouseMove=function(t){var e,i,o,n;if(this.drag)return i=(o=[this.$solutionCanvas.height(),this.$solutionCanvas.width(),this.$solutionCanvas.offset()])[0],n=o[1],e=o[2],this.solution.w=(t.pageX-e.left)*(this.canvas.width/n)-this.solution.startX,this.solution.h=(t.pageY-e.top)*(this.canvas.height/i)-this.solution.startY,this.drawSolution(this.solution)},e.prototype.updateImage=function(t,e){return this.$image.attr("src",e)},e.prototype.sizeCanvas=function(){return this.$solutionCanvas.height(this.$image.height()).width(this.$image.width()),this.$el.trigger(this.namespace+".canvasReady")},e.prototype.clearSolution=function(){return this.solution={},this.canvasCtx.clearRect(0,0,this.canvas.width,this.canvas.height)},e.prototype.saveSolution=function(){var t;return $.isEmptyObject(this.solution)||(t={top:this.solutionTop(),left:this.solutionLeft(),height:Math.abs(this.solution.h)/this.canvasHeight,width:Math.abs(this.solution.w)/this.canvasWidth}),this.$el.trigger(this.namespace+".updateSolution",t).trigger("Modal."+this.namespace+".close")},e.prototype.solutionTop=function(){return this.solution.h<0?(this.solution.h+this.solution.startY)/this.canvasHeight:this.solution.startY/this.canvasHeight},e.prototype.solutionLeft=function(){return this.solution.w<0?(this.solution.w+this.solution.startX)/this.canvasWidth:this.solution.startX/this.canvasWidth},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.creation.MediaSlide=function(t){function e(){return this.reset=i(this.reset,this),this.giftWrap=i(this.giftWrap,this),this.updateFile=i(this.updateFile,this),this.onError=i(this.onError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.creation.BaseModal),e.prototype.initialize=function(t){return this.slideDeckId=t.slideDeckId,this.namespace=t.namespace,e.__super__.initialize.apply(this,arguments),this.height=this.width=0,this.$url=this.$("input[name=URL]"),this.$submitBtn=this.$(".creation-submit-btn"),this.$embedType=this.$("input[name=embedType]"),this.$el.on("EmbedMedia.updateFile",this.updateFile).on("SlideCreation.MediaSlide.submitError",this.onError).on("SlideCreation.EmbedlySlide.submitError",this.onError)},e.prototype.onError=function(){return alertify.error(this.i18n("Activity.createMediaSlide.submitError"))},e.prototype.getEmbedType=function(){return this.$embedType.filter(":checked").val()},e.prototype.embedFile=function(){return"file"===this.getEmbedType()},e.prototype.embedUrl=function(){return"url"===this.getEmbedType()},e.prototype.getUrl=function(){return $.trim(this.$url.val())},e.prototype.isUrlEmpty=function(){return""===this.getUrl()},e.prototype.updateFile=function(t,e){var i;if(null!=e)return this.file=e,this.$submitBtn.trigger("disable"),$("<img>").on("load",(i=this,function(t){return i.height=t.target.height,i.width=t.target.width,i.$submitBtn.trigger("enable")})).attr("src",this.file.url)},e.prototype.checkDataValidity=function(){return this.giftWrap()},e.prototype.giftWrap=function(){var t;return t=this.embedFile()?this.giftWrapFile():this.embedUrl()?this.giftWrapUrl():void 0,this.type=this.embedFile()?"MediaSlide":"EmbedlySlide",t},e.prototype.giftWrapUrl=function(){return this.isUrlEmpty()?(alertify.error(this.i18n("Activity.createMediaSlide.urlRequired")),!1):{url:this.getUrl()}},e.prototype.giftWrapFile=function(){return this.file?{file:this.file,height:this.height,width:this.width}:(alertify.error(this.i18n("Activity.createMediaSlide.fileRequired")),!1)},e.prototype.reset=function(){return e.__super__.reset.apply(this,arguments),this.$embedType.filter('[value="url"]').prop("checked",!0),this.file=null},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.creation.Modals=function(t){function e(){return this.closeSlideChooser=i(this.closeSlideChooser,this),this.closeActivityChooser=i(this.closeActivityChooser,this),this.closeAll=i(this.closeAll,this),this.editActivity=i(this.editActivity,this),this.getImportModalSuccess=i(this.getImportModalSuccess,this),this.importFromLibrary=i(this.importFromLibrary,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){var t,e,i,o;for(this.fileBlob=null,this.$editActivityModal=this.$(".modal-body-content.editActivity"),e=0,i=(o=this.options.activityModals).length;e<i;e++)t=o[e],this.$doc.on("Modal."+t+".open",this.closeActivityChooser);return this.$el.on("closeAllModals",this.closeAll).on("Activity.edit",this.editActivity),this.$doc.on("SlideDeck.importFromLibrary",this.importFromLibrary).on("Modal.mediaSlide.open",this.closeSlideChooser).on("FileStack.pick",this.closeSlideChooser)},e.prototype.importFromLibrary=function(){return this.closeSlideChooser(),$.ajax({url:Echo.routes.Library.importSlideDeckModalContent().url,contentType:"application/html",success:this.getImportModalSuccess,error:this.getImportModalFailure})},e.prototype.getImportModalSuccess=function(t){return this.$body.append(t).find("[data-id='"+this.options.mediaId+"']").remove()},e.prototype.editActivity=function(t,e){return t.stopPropagation(),this.$editActivityModal.find(".creation-modal").trigger("editActivityModal.clear"),this.$editActivityModal.html(e.data[0].html),this.$el.trigger("Modal.editActivity.open")},e.prototype.closeAll=function(){var t,e,i,o;for(e=0,i=(o=this.options.activityModals).length;e<i;e++)t=o[e],this.$el.trigger("Modal."+t+".close");return this.$el.trigger("Modal.mediaSlide.close"),this.$el.trigger("Modal.editActivity.close"),this.$el.trigger("Modal.importFromLibrary.close"),this.closeSlideChooser()},e.prototype.closeActivityChooser=function(){return this.$el.trigger("DropdownPanel.activityPickerDropdownPanel.close")},e.prototype.closeSlideChooser=function(){return this.$el.trigger("DropdownPanel.slidePickerDropdownPanel.close")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,o=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.widgets.activities.creation.MultipleChoice=function(t){function e(){return this.onError=i(this.onError,this),this.reset=i(this.reset,this),this.giftWrap=i(this.giftWrap,this),this.onItemAdded=i(this.onItemAdded,this),this.onItemRemoved=i(this.onItemRemoved,this),this.onUpdateFile=i(this.onUpdateFile,this),this.setMedia=i(this.setMedia,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.creation.BaseModal),e.prototype.activityType="MultipleChoice",e.prototype.type="ActivitySlide",e.prototype.initialize=function(t){if(this.activityId=t.activityId,this.edit=t.edit,this.namespace=t.namespace,this.slideDeckId=t.slideDeckId,this.solution=t.solution,this.embedlyUrl=t.embedlyUrl,this.image=t.image,e.__super__.initialize.apply(this,arguments),this.$optionsWrapper=this.$(".mcqOptions-wrapper"),this.$allAnswersSelect=this.$(".all-answers-select"),this.$inputList=this.$(".list"),this.$addEntryButton=this.$(".addEntryButton"),this.$urlField=this.$("input[name=URL]"),this.$embedToggle=this.$(".embedMedia-toggle"),this.$embedType=this.$("input[name=embedType]"),this.$el.on("SlideCreation."+this.type+".submitError",this.onError).on("InputList.itemAdded",this.onItemAdded).on("InputList.itemRemoved",this.onItemRemoved).on("EmbedMedia.updateFile",this.onUpdateFile),this.onItemAdded(),this.addDefaultOptions(),null!=this.solution&&this.markCorrectOptions(),null!=this.image||null!=this.embedlyUrl)return this.setMedia()},e.prototype.setMedia=function(){return this.$embedWrapper.trigger("EmbedMedia.setMedia",{file:this.image,url:this.embedlyUrl})},e.prototype.onUpdateFile=function(t,e){this.fileBlob=e},e.prototype.addDefaultOptions=function(){var t,e;if(!this.edit){for(e=[],t=1;t<=4;++t)e.push(this.$addEntryButton.trigger("click"));return e}},e.prototype.markCorrectOptions=function(){return this.$inputList.find(".option-wrapper").each((i=this,function(t,e){return i.$(e).find(".correct-btn").toggleClass("on",0<=o.call(i.solution,t)&&i.edit)}));var i},e.prototype.assignPlaceholders=function(){return this.$inputList.find(".option-wrapper").each((i=this,function(t,e){return i.$(e).find("[name=mcqOption]").attr("placeholder",Echo.core.helpers.numToAlpha(t)).trigger("change")}));var i},e.prototype.onItemRemoved=function(){return this.assignPlaceholders()},e.prototype.onItemAdded=function(){return this.assignPlaceholders()},e.prototype.giftWrap=function(){var i,o,n;return o=[],n=[],i=0,this.$inputList.find(".option-wrapper").each(function(){var t,e;return t=$.trim($(this).find("[name=mcqOption]").val()),e=$(this).find(".correct-btn.on"),""!==t?(o.push(t),0<e.length&&n.push(i),i++):0<e.length?!(i=-1):void 0}),-1===i?(alertify.error(this.i18n("Activity.create.errors.multipleChoice.emptyCorrectChoice")),!1):0===o.length?(alertify.error(this.i18n("Activity.create.errors.choicesEmpty")),!1):this._giftWrap(o,n)},e.prototype._giftWrap=function(t,e){var i,o,n,s;return i={prompt:this.$question.val().trim(),explanationRequired:this.$justificationSwitch.prop("checked"),activityContent:{choices:t,type:this.activityType}},e.length&&(i.solution={solution:e,type:this.activityType,selectAll:this.$allAnswersSelect.prop("checked")}),this.$embedToggle.prop("checked")&&(i.media="file"===this.$embedType.filter(":checked").val()?{image:{file:this.fileBlob,height:null!=(o=this.fileBlob)?o.height:void 0,width:null!=(n=this.fileBlob)?n.width:void 0},type:"ActivityImage"}:""!==(s=this.$urlField.val().trim())?{url:s,type:"ActivityEmbed"}:null),this.options.edit?i:{activity:i}},e.prototype.reset=function(){return e.__super__.reset.apply(this,arguments),this.$el.trigger("reset"),this.addDefaultOptions(),this.$allAnswersSelect.prop("checked",!1)},e.prototype.onError=function(t,e){var i,o,n,s;if(null!=(null!=e?e.formErrors:void 0)){for(i in s=[],n=e.formErrors)o=n[i],"obj.body"===i&&s.push(alertify.error(this.i18n(o[0].msg,o[0].args)));return s}},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.creation.NumericalAnswer=function(t){function e(){return this.reset=i(this.reset,this),this.giftWrap=i(this.giftWrap,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.creation.BaseModal),e.prototype.numericalType="NumericalAnswer",e.prototype.rangeType="RangeAnswer",e.prototype.type="ActivitySlide",e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.$from=this.$("[name=start]"),this.$to=this.$("[name=end]"),null!=this.options.solution?this.$from.val(this.options.solution):this.options.rangeSolution?(this.$from.val(this.options.rangeSolution.start),this.$to.val(this.options.rangeSolution.end)):void 0},e.prototype.giftWrap=function(){var t,e,i,o,n;return e=this.$from.val().trim(),i=""!==(o=this.$to.val().trim())?(this.activityType=n=this.rangeType,{start:+e,end:+o}):(this.activityType=n=this.numericalType,e),t={prompt:this.$question.val().trim(),explanationRequired:this.$justificationSwitch.prop("checked"),activityContent:{type:n},solution:{solution:i,type:n}},this.options.edit?t:{activity:t}},e.prototype.reset=function(){return e.__super__.reset.apply(this,arguments),this.$from.val(""),this.$to.val("")},e}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.creation.ReOrder=function(t){function i(){return this.onItemAdded=e(this.onItemAdded,this),this.onItemRemoved=e(this.onItemRemoved,this),this.onError=e(this.onError,this),this.reset=e(this.reset,this),this.giftWrap=e(this.giftWrap,this),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.activities.creation.BaseModal),i.prototype.activityType="ReOrder",i.prototype.type="ActivitySlide",i.prototype.initialize=function(t){return this.activityId=t.activityId,this.edit=t.edit,this.namespace=t.namespace,this.slideDeckId=t.slideDeckId,i.__super__.initialize.apply(this,arguments),this.$doc.ready((e=this,function(){return e.$optionsWrapper=e.$(".reOrderOptions-wrapper"),e.$hasCorrectAnswer=e.$(".hasCorrect-toggle"),e.$inputList=e.$(".list"),e.$addEntryButton=e.$(".addEntryButton"),e.$el.on("SlideCreation."+e.type+".submitError",e.onError).on("InputList.itemAdded",e.onItemAdded).on("InputList.itemRemoved",e.onItemRemoved),e.onItemAdded(),e.addDefaultOptions()}));var e},i.prototype.addDefaultOptions=function(){var t,e;if(!this.edit){for(e=[],t=1;t<=4;++t)e.push(this.$addEntryButton.trigger("click"));return e}},i.prototype.giftWrap=function(){var t,e,i,o,n,s,r;if(0===(i=this.$inputList.find(".option-wrapper").map(function(){var t;if(""!==(t=$.trim($(this).find("[name=reOrderOption]").val())))return t}).get()).length)return alertify.error(this.i18n("Activity.create.errors.choicesEmpty")),!1;if(s=_.shuffle(i),r=[],!0===this.$hasCorrectAnswer.prop("checked"))for(o=0,n=i.length;o<n;o++)e=i[o],r.push(s.indexOf(e));return t={prompt:this.$question.val().trim(),explanationRequired:this.$justificationSwitch.prop("checked"),activityContent:{choices:i,type:this.activityType}},0<r.length&&(t=$.extend(t,{activityContent:{choices:s,type:this.activityType},solution:{solution:r,type:this.activityType}})),this.options.edit?t:{activity:t}},i.prototype.reset=function(){return i.__super__.reset.apply(this,arguments),this.$el.trigger("reset"),this.addDefaultOptions(),this.$hasCorrectAnswer.prop("checked",!1)},i.prototype.onError=function(t,e){var i,o,n,s;if(null!=(null!=e?e.formErrors:void 0)){for(i in s=[],n=e.formErrors)o=n[i],"obj.body"===i&&s.push(alertify.error(this.i18n(o[0].msg,o[0].args)));return s}},i.prototype.assignPlaceholders=function(){return this.$inputList.find(".option-wrapper").each((i=this,function(t,e){return i.$(e).find("[name=reOrderOption]").attr("placeholder",t+1).trigger("change")}));var i},i.prototype.onItemRemoved=function(){return this.assignPlaceholders()},i.prototype.onItemAdded=function(){return this.assignPlaceholders()},i}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.creation.ShortAnswer=function(t){function i(){var t,e;return this.giftWrap=(t=this.giftWrap,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.activities.creation.BaseModal),i.prototype.activityType="ShortAnswer",i.prototype.type="ActivitySlide",i.prototype.giftWrap=function(){var t;return t={prompt:this.$question.val().trim(),explanationRequired:!1,activityContent:{type:this.activityType}},this.options.edit?t:{activity:t}},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.review.Activity=function(t){function e(){return this.onFetchEmbedlyContent=i(this.onFetchEmbedlyContent,this),this.onMediaClick=i(this.onMediaClick,this),this.responseSort=i(this.responseSort,this),this.defaultSort=i(this.defaultSort,this),this.onHeaderClick=i(this.onHeaderClick,this),this.onResponseClick=i(this.onResponseClick,this),this.generatePreview=i(this.generatePreview,this),this.onResponseMouseOverOut=i(this.onResponseMouseOverOut,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.studentResponseTemplate=_.template('<div class="student-row <%if(isWrong){%>wrong<%}%> <%if(isCorrect){%>correct<%}%> <%if(typeof justification != \'undefined\'){%>explained<%}%>" data-user="<%=id%>">\n  <div class="response-wrapper">\n    <div class="student cell"><%-student%></div>\n    <div class="response cell <%if(noResponse){%>noResponse<%}%>" data-sort="<%-sortCriteria%>"><%-response%></div>\n  </div>\n  <% if(typeof justification != \'undefined\') {%>\n    <div class="justification-wrapper"><%-justification%></div>\n  <% } %>\n</div>'),e.prototype.initialize=function(t){return this.activity=t.activity,this.image=t.image,this.responses=t.responses,e.__super__.initialize.apply(this,arguments),this.$responses=this.$(".students-view"),this.$content=this.$(".content"),this.$responseCount=this.$(".response-count span"),this.$el.on("ActivityView.dispose",this.dispose).on("click",".activity-embed-content",this.onMediaClick).on("click",".student-row:not(.title)",this.onResponseClick).on("click",".student-row.title .cell",this.onHeaderClick).on("click",".choice",this.onOptionClick).on("mouseover mouseout",".student-row:not(.title)",this.onResponseMouseOverOut),this.renderContent(),this.renderImage(),this.renderStudentResponses(),this.updateResponseCount(),this.$(".student-row.title .student").trigger("click")},e.prototype.scrollToResponse=function(t,e){if(t.offset().top-e.offset().top>=e.height())return e.animate({scrollTop:t.offset().top-e.offset().top})},e.prototype.onResponseMouseOverOut=function(t){var e,i;if(e=this.$(t.currentTarget),null!=(i=_.filter(this.responses,function(t){return t.user.id===e.attr("data-user")})[0]).response)return this.onResponseMouseActions(i,t.type)},e.prototype.onResponseMouseActions=function(){},e.prototype.onOptionClick=function(){},e.prototype.renderStudentResponses=function(){},e.prototype.renderContent=function(){},e.prototype.renderCorrectAnswer=function(){},e.prototype.updateResponseCount=function(){var t;return t=_.filter(this.responses,function(t){return null!=t.response}).length,this.updateResponseCountText(t,this.responses.length)},e.prototype.updateResponseCountText=function(t,e){return this.$responseCount.text(t+" / "+e)},e.prototype.sortBlankResponses=function(){var t,i,o;return i=this.$(".student-row.title .response").attr("data-sort-dir"),(t=_.filter(this.$(".student-row:not(.title)"),function(t){return""===$(t).find(".response").attr("data-sort").trim()})).sort((o=this,function(t,e){return o.defaultSort(t,e,i)})),_.map(this.$(".student-row:not(.title)"),function(t){if(""===$(t).find(".response").attr("data-sort").trim())return $(t).remove()}),"desc"===i?this.$(".student-row.title").after(t):this.$responses.append(t)},e.prototype.renderImage=function(){return this.$embeddedContent=$('<div class="embedded-content"></div>'),null!=this.image?(this.$(".activity-title").append(this.$embeddedContent),this.$embeddedContent.append("<img src='"+this.image.original.url+"' class='activity-embed-content' data-type='photo'/>")):null!=this.activity.embedlyUrl?(this.$(".activity-title").append(this.$embeddedContent),this.fetchEmbedlyContent([this.activity.embedlyUrl],this.generatePreview)):void 0},e.prototype.generatePreview=function(t){var e,i,o,n,s;for(s=[],i=0,o=t.length;i<o;i++)n=t[i],(e=function(){switch(n.type){case"video":return null!=n.thumbnail_url?$("<img>").attr("src",n.thumbnail_url):this.createLinkElement(n.original_url);case"photo":return $("<img>").attr("src",n.thumbnail_url);default:return this.createLinkElement(n.original_url)}}.call(this)).addClass("activity-embed-content").attr("data-url",n.original_url).attr("data-type",n.type),s.push(this.$embeddedContent.append(e));return s},e.prototype.createLinkElement=function(t){return $("<a>").text(t).attr({href:t,target:"_blank"})},e.prototype.getFullName=function(t){var e,i,o;return""===(e="Deleted"===t.status?"Deleted User":((null!=(i=t.firstName)?i:"")+" "+(null!=(o=t.lastName)?o:"")).trim())?t.email:e},e.prototype.onResponseClick=function(t){var e,i;if(e=this.$(t.currentTarget),this.$(".student-row:not(.title)").not(e).find(".justification-wrapper").slideUp(),e.find(".justification-wrapper").slideToggle(),null!=(i=_.filter(this.responses,function(t){return t.user.id===e.attr("data-user")})[0]).response)return this.responseClickActions(i)},e.prototype.responseClickActions=function(){},e.prototype.onHeaderClick=function(t){var e,i,o,n,s,r,a;if(e=this.$(t.currentTarget),this.$(".title .cell").not(e).removeAttr("data-sort-dir"),s=null!=(o=e.attr("data-sort-dir"))?o:"desc",i="asc"===s?"desc":"asc",e.attr("data-sort-dir",i),n=this.$(".student-row:not(.title)"),e.hasClass("student")?n.sort((a=this,function(t,e){return a.defaultSort(t,e,i)})):n.sort((r=this,function(t,e){return r.responseSort(t,e,i)})),this.$(".student-row:not(.title)").remove(),this.$responses.append(n),e.hasClass("response"))return this.sortBlankResponses()},e.prototype.defaultSort=function(t,e,i){var o,n;return o=this.$(t).find(".student").text().toUpperCase(),n=this.$(e).find(".student").text().toUpperCase(),this.compare(o,n,i)},e.prototype.responseSort=function(t,e,i){var o,n;return o=this.$(t).find(".response").attr("data-sort"),n=this.$(e).find(".response").attr("data-sort"),this.compare(o,n,i)},e.prototype.compare=function(t,e,i){return e<t||""===e.toString().trim()?"asc"===i:"desc"===i},e.prototype.onMediaClick=function(t){var e,i,o;if((e=$(t.target)).is("img"))return t.preventDefault(),"photo"===e.attr("data-type")?((i=$("<img>").addClass("lightbox-image")).on("load",(o=this,function(){return o.openLightBoxWithContent(i)})),i.attr("src",e.attr("src"))):this.fetchEmbedlyContent([e.attr("data-url")],this.onFetchEmbedlyContent)},e.prototype.onFetchEmbedlyContent=function(t){var e,i,o,n;for(n=[],e=0,i=t.length;e<i;e++)o=t[e],n.push(this.openLightBoxWithContent(o.html));return n},e.prototype.openLightBoxWithContent=function(t){return this.$el.trigger("Modal.imageLightBox.replaceContent",t),this.$el.trigger("Modal.imageLightBox.open")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.review.ImageAnnotation=function(t){function e(){return this.onResizeContent=i(this.onResizeContent,this),this.onResponseMouseout=i(this.onResponseMouseout,this),this.onResponseMouseover=i(this.onResponseMouseover,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.review.Activity),e.prototype.contentTemplate=_.template("<div class='image-wrapper'>\n  <img src='<%-image%>'/>\n  <div>\n    <% if(typeof solution != 'undefined') { %>\n      <div class='imageSolution' style='top: <%=solution.top * 100%>%; left: <%=solution.left * 100%>%; height: <%=solution.height * 100%>%; width: <%=solution.width * 100%>%'>\n      </div>\n    <% } %>\n    <% _.each(responses, function(response) {\n      if(typeof response.response != 'undefined') {\n    %>\n      <span class=\"marker\" data-user=\"<%=response.user.id%>\" style=\"top: <%=response.response.answer.solution.y * 100%>%; left: <%=response.response.answer.solution.x * 100%>%\">\n        <span></span>\n      </span>\n    <% }});%>\n  </div>\n</div>"),e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.$el.on("mouseover",".student-row:not(.title)",this.onResponseMouseover).on("mouseout",".student-row:not(.title)",this.onResponseMouseout).on("resize",this.onResizeContent)},e.prototype.onResponseMouseover=function(t){var e;return e=$(t.currentTarget).attr("data-user"),this.$(".marker").removeClass("selected").filter("[data-user='"+e+"']").addClass("selected")},e.prototype.onResponseMouseout=function(){return this.$(".marker").removeClass("selected")},e.prototype.renderStudentResponses=function(){var t,e,i,o,n,s,r,a,h;for(h=[],e=0,o=(n=this.responses).length;e<o;e++)a=null!=(r=n[e]).response?this.i18n("Analytics.hoverMessage"):this.i18n("Labels.noResponse"),i=this.isCorrect(r.response),t=this.studentResponseTemplate({student:this.getFullName(r.user),response:a,sortCriteria:null!=r.response?r.user.lastName:"",isCorrect:null!=r.response&&null!=this.activity.solution&&i,isWrong:null!=r.response&&null!=this.activity.solution&&!i,noResponse:null==r.response,justification:null!=(s=r.response)?s.explanation:void 0,id:r.user.id}),h.push(this.$responses.append(t));return h},e.prototype.isCorrect=function(t){var e,i,o,n;return null!=t&&null!=this.activity.solution&&(e=t.answer.solution,+(n=this.activity.solution.solution).left<=(i=+e.x)&&i<=+n.left+ +n.width&&+n.top<=(o=+e.y)&&o<=+n.top+ +n.height)},e.prototype.renderContent=function(){var t,e;return t=this.contentTemplate({image:this.activity.activityContent.image,responses:this.responses,solution:null!=(e=this.activity.solution)?e.solution:void 0}),this.$content.append(t),Echo.core.helpers.preloadImage(this.$("img").attr("src"),this.onResizeContent),this.onResizeContent()},e.prototype.onResizeContent=function(){var t,e;return t=this.$("img").width(),e=this.$(".image-wrapper").width(),this.$(".image-wrapper > div").css({left:(e-t)/2+"px",width:t+"px"})},e}()}.call(this),function(){var n={}.hasOwnProperty,h=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.widgets.activities.review.MultipleChoice=function(t){function i(){var t,e;return this.onOptionClick=(t=this.onOptionClick,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.widgets.activities.review.Activity),i.prototype.contentTemplate=_.template("<div data-choice='<%-letter%>' class='choice <% if(isCorrect) {%>correct<%}%><% if(isWrong) {%>wrong<%}%>'>\n  <div class=\"choice-wrapper\">\n    <span><%-content%></span>\n    <span class='letter'><%-letter%>.</span>\n    <span class='count'><%-count%></span>\n  </div>\n</div>"),i.prototype.onOptionClick=function(t){var e;return $(t.currentTarget).toggleClass("selected"),e=_.map(this.$content.find(".selected"),function(t){return $(t).attr("data-choice")}),this.$responses.find(".student-row:not(.title)").toggle(0===e.length),this.$responses.find(".response[data-sort*='"+e.join("")+"']").parent().parent().show(),0===e.length?this.updateResponseCount():this.updateResponseCountText(this.$responses.find(".student-row:visible:not(.title)").length,this.responses.length)},i.prototype.renderStudentResponses=function(){var t,e,i,o,n,s,r,a,h;for(a=[],e=0,i=(o=this.responses).length;e<i;e++)r=null!=(s=o[e]).response?_.map(s.response.answer.solution,function(e){return function(t){return Echo.core.helpers.numToAlpha(t)+". "+e.activity.activityContent.choices[t]}}(this)).join(", "):this.i18n("Labels.noResponse"),h=null!=s.response?_.map(s.response.answer.solution,function(t){return""+Echo.core.helpers.numToAlpha(t)}).join(""):"",t=this.studentResponseTemplate({student:this.getFullName(s.user),response:r,justification:null!=(n=s.response)?n.explanation:void 0,sortCriteria:h,isCorrect:this.isCorrect(s),isWrong:this.isWrong(s),noResponse:null==s.response,id:s.user.id}),a.push(this.$responses.append(t));return a},i.prototype.isWrong=function(t){return null!=t.response&&null!=this.activity.solution&&!this.isCorrect(t)},i.prototype.isCorrect=function(t){var e;return null!=t.response&&null!=this.activity.solution&&(_.filter(t.response.answer.solution,(e=this,function(t){return 0<=h.call(e.activity.solution.solution,t)})).length===t.response.answer.solution.length&&(this.activity.solution.solution.length===t.response.answer.solution.length||!this.activity.solution.selectAll))},i.prototype.renderContent=function(){var t,e,i,o,n,s,r,a;for(a=[],n=o=0,s=(r=this.activity.activityContent.choices).length;o<s;n=++o)e=r[n],i=this.getCountForChoice(n),t=this.contentTemplate({letter:Echo.core.helpers.numToAlpha(n),content:e,count:i,isCorrect:null!=this.activity.solution&&0<=h.call(this.activity.solution.solution,n),isWrong:null!=this.activity.solution&&!(0<=h.call(this.activity.solution.solution,n))}),a.push(this.$content.append(t));return a},i.prototype.getCountForChoice=function(i){return _.reduce(this.responses,function(t,e){return null!=e.response&&0<=h.call(e.response.answer.solution,i)?t+1:t},0)},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.review.NumericalAnswer=function(t){function e(){return this.responseSort=i(this.responseSort,this),this.onOptionClick=i(this.onOptionClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.review.Activity),e.prototype.contentTemplate=_.template("<div data-choice='<%-choice%>' class='choice <% if(isCorrect) {%>correct<%}%><% if(isWrong) {%>wrong<%}%>'>\n  <div class=\"choice-wrapper\">\n    <span><%-content%></span>\n    <span class='count'><%-count%></span>\n  </div>\n</div>"),e.prototype.onResponseMouseActions=function(t,e){return this.$content.find(".choice[data-choice='"+t.response.answer.solution+"']").toggleClass("hovered","mouseover"===e)},e.prototype.responseClickActions=function(t){var e;return e=this.$content.find(".choice[data-choice='"+t.response.answer.solution+"']"),this.scrollToResponse(e,e.parent().parent())},e.prototype.renderCorrectAnswer=function(){var t,e;if(null!=this.activity.solution)return t=this.contentTemplate({content:"NumericalAnswer"===this.activity.solution.type?this.activity.solution.solution:this.activity.solution.solution.start+" - "+this.activity.solution.solution.end,choice:"NumericalAnswer"===this.activity.solution.type?this.activity.solution.solution:this.activity.solution.solution.start+","+this.activity.solution.solution.end,count:null!=(e=this.correctAnswerCount)?e:0,isCorrect:!0,isWrong:!1}),this.$content.prepend(t)},e.prototype.onOptionClick=function(t){var e,i;return i=$(t.currentTarget),this.$content.find(".choice").not(i).removeClass("selected"),i.toggleClass("selected"),e=this.$content.find(".selected"),this.$responses.find(".student-row:not(.title)").toggle(0===e.length),this.showSelectedResponses(e),0===e.length?this.updateResponseCount():this.updateResponseCountText(this.$responses.find(".student-row:visible:not(.title)").length,this.responses.length)},e.prototype.showSelectedResponses=function(t){return this.$responses.find(".response[data-sort='"+$(t).attr("data-choice")+"']").parent().parent().show()},e.prototype.renderStudentResponses=function(){var t,e,i,o,n,s,r,a;for(a=[],e=0,i=(o=this.responses).length;e<i;e++)r=null!=(s=o[e]).response?s.response.answer.solution.toString().trim():"",t=this.studentResponseTemplate({student:this.getFullName(s.user),response:""===r?this.i18n("Labels.noResponse"):r,sortCriteria:r,isCorrect:null!=s.response&&this.isCorrect(r),isWrong:null!=s.response&&!this.isCorrect(r),noResponse:null==s.response,justification:null!=(n=s.response)?n.explanation:void 0,id:s.user.id}),a.push(this.$responses.append(t));return a},e.prototype.responseSort=function(t,e,i){var o,n;return o=this.$(t).find(".response").attr("data-sort"),n=this.$(e).find(".response").attr("data-sort"),this.compare(+o,+n,i)},e.prototype.renderContent=function(){var t,e,i,o,n,s,r,a,h,l;for(o in h=[],a=_.countBy(_.filter(this.responses,function(t){return null!=t.response}),function(t){return t.response.answer.solution}))l=a[o],h.push({key:o,count:l});for(e=0,n=(s=_.sortBy(h,function(t){return-t.count})).length;e<n;e++)r=s[e],(i=this.isCorrect(r.key))?this.correctAnswerCount=r.count:(t=this.contentTemplate({content:r.key,choice:r.key,count:r.count,isCorrect:i,isWrong:!i}),this.$content.append(t));return this.renderCorrectAnswer()},e.prototype.isCorrect=function(t){return null!=this.activity.solution&&+t==+this.activity.solution.solution},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.review.RangeAnswer=function(t){function c(){return c.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(c,Echo.widgets.activities.review.NumericalAnswer),c.prototype.isCorrect=function(t){var e;return null!=this.activity.solution&&+this.activity.solution.solution.start<=(e=+t)&&e<=+this.activity.solution.solution.end},c.prototype.responseClickActions=function(r){return this.$content.find(".choice").each((a=this,function(t,e){var i,o,n,s;return-1===(i=$(e).attr("data-choice")).indexOf(",")&&+i===r.response.answer.solution?(a.scrollToResponse($(e),$(e).parent().parent()),!1):-1!==i.indexOf(",")&&(s=(n=a.getCorrectSolution(e))[0],o=n[1],a.checkCorrectAnswer(s,o,r.response.answer.solution))?(a.scrollToResponse($(e),$(e).parent().parent()),!1):void 0}));var a},c.prototype.showSelectedResponses=function(t){var e,i,o,n,s,r,a,h,l;if($(t).hasClass("correct")){for(l=(s=this.getCorrectSolution(t))[0],i=s[1],h=[],o=0,n=(r=this.$responses.find(".student-row:not(.title)")).length;o<n;o++)a=r[o],e=$(a),h.push(e.toggle(this.checkCorrectAnswer(l,i,+e.find(".response").attr("data-sort"))));return h}return c.__super__.showSelectedResponses.call(this,t)},c.prototype.checkCorrectAnswer=function(t,e,i){return t<=i&&i<=e},c.prototype.getCorrectSolution=function(t){return _.map($(t).attr("data-choice").split(","),function(t){return+t.trim()})},c.prototype.onResponseMouseActions=function(r,a){return this.$content.find(".choice").each((h=this,function(t,e){var i,o,n,s;return-1===(i=$(e).attr("data-choice")).indexOf(",")?$(e).toggleClass("hovered","mouseover"===a&&+i===r.response.answer.solution):(s=(n=h.getCorrectSolution(e))[0],o=n[1],$(e).toggleClass("hovered","mouseover"===a&&h.checkCorrectAnswer(s,o,r.response.answer.solution)))}));var h},c}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.review.ReOrder=function(t){function e(){return this.onToggleViewClick=i(this.onToggleViewClick,this),this.onOptionClick=i(this.onOptionClick,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.review.Activity),e.prototype.contentTemplate=_.template("<div data-choice='<%-choice%>' class='choice <% if(isCorrect) {%>correct<%}%><% if(isWrong) {%>wrong<%}%>'>\n  <div class='choice-wrapper'>\n    <span><%-content%></span>\n    <% if(typeof letter != 'undefined') {%><span class='letter'><%-letter%>.</span><%}%>\n    <% if(typeof count != 'undefined') {%><span class='count'><%-count%></span><%}%>\n  </div>\n</div>"),e.prototype.resultTemplate=_.template('<div class="reorder-results-header">\n  <div><%=Echo.messages("Labels.results")%></div>\n  <div class="toggle-view">\n    <a href="#" class="view-list" title="<%=Echo.messages("Widgets.toggleView.switchToListView")%>">\n      <%=Echo.messages("Widgets.toggleView.switchToListView")%>\n    </a>\n    <a href="#" class="view-grid selected" title="<%=Echo.messages("Widgets.toggleView.switchToGridView")%>">\n      <%=Echo.messages("Widgets.toggleView.switchToGridView")%>\n    </a>\n  </div>\n</div>\n<div class="reorder-results-wrapper list">\n  <%=listHtml%>\n</div>\n<div class="reorder-results-wrapper grid">\n  <%=gridHtml%>\n</div>'),e.prototype.gridTemplate=_.template('<table class="reorder-grid">\n  <tr class="reorder-row">\n    <th class="choiceIndex">\n      <% if(hasSolution) { %>\n        <div class="correct-answer-text">\n          <div class="correct-notification">\n            <%=Echo.messages("Labels.correct")%>\n          </div>\n        </div>\n      <% } %>\n    </th>\n    <% _.each(indices, function(index) { %>\n      <th class="choiceIndex"><%=index+1%></th>\n    <% }); %>\n  </tr>\n  <% _.each(choices, function(choice, choiceIndex) { %>\n    <tr class="reorder-row" data-choice="<%=choice%>">\n      <td class="choice-text"><%=Echo.core.helpers.numToAlpha(choice)%></td>\n      <% _.each(gridCount[choice], function(count, index) { %>\n        <td class="reorder-cell <%if(choiceIndex == index) {%>diagonal<%}%>">\n          <%=count%>\n        </td>\n      <% }); %>\n    </tr>\n  <% }); %>\n</table>'),e.prototype.onResponseMouseActions=function(t,e){var i,o,n,s,r,a;for(this.$(".reorder-results-wrapper.list").find(".choice[data-choice='"+this.getAlphaString(t.response.answer.solution)+"']").toggleClass("hovered","mouseover"===e),a=[],n=o=0,s=(r=t.response.answer.solution).length;o<s;n=++o)i=r[n],a.push(this.$(".reorder-row[data-choice='"+i+"']").find("td").removeClass("hovered").eq(n+1).toggleClass("hovered","mouseover"===e));return a},e.prototype.responseClickActions=function(t){var e;return e=this.$(".reorder-results-wrapper.list").find(".choice[data-choice='"+this.getAlphaString(t.response.answer.solution)+"']"),this.scrollToResponse(e,e.parent().parent().parent())},e.prototype.onOptionClick=function(t){var e,i;if(0!==(i=$(t.currentTarget)).parents(".reorder-results-wrapper").length)return this.$content.find(".choice").not(i).removeClass("selected"),i.toggleClass("selected"),e=this.$(".reorder-results-wrapper").find(".choice.selected"),this.$responses.find(".student-row:not(.title)").toggle(0===e.length),this.showSelectedResponses(e),0===e.length?this.updateResponseCount():this.updateResponseCountText(this.$responses.find(".student-row:visible:not(.title)").length,this.responses.length)},e.prototype.showSelectedResponses=function(t){return this.$responses.find(".response[data-sort='"+$(t).attr("data-choice")+"']").parent().parent().show()},e.prototype.renderContent=function(){var t,e,i,o;for(e=i=0,o=this.activity.activityContent.choices.length-1;0<=o?i<=o:o<=i;e=0<=o?++i:--i)t=this.contentTemplate({letter:Echo.core.helpers.numToAlpha(e),content:this.activity.activityContent.choices[e],choice:"",isCorrect:!1,isWrong:!1}),this.$content.append(t);return this.renderResults()},e.prototype.renderResults=function(){var t;return t=this.resultTemplate({listHtml:this.generateListHtml(),gridHtml:this.generateGridHtml()}),this.$content.append(t),this.$el.on("click",".toggle-view a",this.onToggleViewClick),this.$(".view-list").trigger("click")},e.prototype.onToggleViewClick=function(t){var e;return e=$(t.currentTarget),this.$(".toggle-view a").removeClass("selected"),e.addClass("selected"),this.$(".reorder-results-wrapper.list").toggle(e.hasClass("view-list")),this.$(".reorder-results-wrapper.grid").toggle(e.hasClass("view-grid"))},e.prototype.generateListHtml=function(){var t,e,i,o,n,s,r,a,h,l,c;for(o in t="",l=[],h=_.countBy(_.filter(this.responses,function(t){return null!=t.response}),function(t){return t.response.answer.solution}))c=h[o],l.push({key:o,count:c});for(e=0,n=(s=_.sortBy(l,function(t){return-t.count})).length;e<n;e++)r=s[e],a=_.map(r.key.split(","),function(t){return parseInt(t)}),(i=null!=this.activity.solution&&this.solutionMatch(a))?this.correctAnswerCount=r.count:t+=this.contentTemplate({content:this.getContentString(a),count:r.count,choice:this.getAlphaString(a),isCorrect:i,isWrong:null!=this.activity.solution&&!this.solutionMatch(a)});return this.renderCorrectAnswer()+t},e.prototype.renderCorrectAnswer=function(){var t;return null==this.activity.solution?"":this.contentTemplate({content:this.getContentString(this.activity.solution.solution),count:null!=(t=this.correctAnswerCount)?t:0,choice:this.getAlphaString(this.activity.solution.solution),isCorrect:!0,isWrong:!1})},e.prototype.getAlphaString=function(t){return _.map(t,function(t){return Echo.core.helpers.numToAlpha(t)}).join("")},e.prototype.getContentString=function(t){return _.map(t,(e=this,function(t){return Echo.core.helpers.numToAlpha(t)+". "+e.activity.activityContent.choices[t]})).join(", ");var e},e.prototype.generateGridHtml=function(){var i,t,e,o,n,s,r,a,h,l;for(n=function(){l=[];for(var t=0,e=this.activity.activityContent.choices.length-1;0<=e?t<=e:e<=t;0<=e?t++:t--)l.push(t);return l}.apply(this),e=[],s=0,a=(t=null!=this.activity.solution?this.activity.solution.solution:n).length;s<a;s++)for(i=t[s],o=r=0,h=this.activity.activityContent.choices.length-1;0<=h?r<=h:h<=r;o=0<=h?++r:--r)null==e[i]&&(e[i]=[]),e[i][o]=_.filter(this.responses,function(t){var e;return(null!=(e=t.response)?e.answer.solution[o]:void 0)===i}).length;return this.gridTemplate({choices:t,indices:n,gridCount:e,hasSolution:null!=this.activity.solution})},e.prototype.renderStudentResponses=function(){var t,e,i,o,n,s,r,a,h;for(a=[],e=0,i=(o=this.responses).length;e<i;e++)s=o[e],r=this.getResponseText(s),h=this.getSortCriteria(s),t=this.studentResponseTemplate({student:this.getFullName(s.user),response:r,justification:null!=(n=s.response)?n.explanation:void 0,sortCriteria:h,isCorrect:this.isCorrect(s),isWrong:this.isWrong(s),noResponse:null==s.response,id:s.user.id}),a.push(this.$responses.append(t));return a},e.prototype.getResponseText=function(t){return null!=t.response?this.getContentString(t.response.answer.solution):this.i18n("Labels.noResponse")},e.prototype.getSortCriteria=function(t){return null!=t.response?this.getAlphaString(t.response.answer.solution):""},e.prototype.isWrong=function(t){return null!=t.response&&null!=this.activity.solution&&!this.solutionMatch(t.response.answer.solution)},e.prototype.isCorrect=function(t){return null!=t.response&&null!=this.activity.solution&&this.solutionMatch(t.response.answer.solution)},e.prototype.solutionMatch=function(t){var e,i,o,n,s,r;for(n=o=0,s=(r=this.activity.solution.solution).length;o<s&&(e=r[n],t[n]===e);n=++o)i=n;return i===this.activity.solution.solution.length-1},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.review.ShortAnswer=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.review.Activity),e.prototype.renderStudentResponses=function(){var t,e,i,o,n,s,r;for(r=[],e=0,i=(o=this.responses).length;e<i;e++)s=null!=(n=o[e]).response?n.response.answer.solution:this.i18n("Labels.noResponse"),t=this.studentResponseTemplate({student:this.getFullName(n.user),response:s,sortCriteria:null!=n.response?n.response.answer.solution.toString().trim().toLowerCase():"",isCorrect:!1,isWrong:!1,noResponse:null==n.response,id:n.user.id}),r.push(this.$responses.append(t));return r},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.review.Viewer=function(t){function e(){return this.onActivityFetch=i(this.onActivityFetch,this),this.onActivityChange=i(this.onActivityChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.lessonId=t.lessonId,this.activityTemplate=_.template(this.$(".activity-frame").html()),this.$activitySelect=this.$("[name=activityId]"),this.$activitySelect.on("change",this.onActivityChange),this.onActivityChange()},e.prototype.onActivityChange=function(){var t,e;return this.loadingOn(null,{theme:"light",opacity:"solid"}),t=this.$activitySelect.val(),Echo.routes.LessonActivities.getWithResults(this.lessonId,t).ajax({success:this.onActivityFetch,error:this.onError,complete:(e=this,function(){return e.loadingOff()})})},e.prototype.onActivityFetch=function(t){var e,i,o,n,s;if(null!=(null!=(i=t.data)?i[0]:void 0))return o=Echo.core.helpers.uuid(),e=this.activityTemplate({id:o,prompt:i[0].activity.prompt,cssClass:i[0].activity.activityContent.type,showHint:i[0].activity.explanationRequired,selectAll:null!=(n=null!=(s=i[0].activity.solution)?s.selectAll:void 0)&&n}),this.$(".activity-stage").trigger("ActivityView.dispose"),this.$el.append(e),new Echo.widgets.activities.review[i[0].activity.activityContent.type]({el:"#"+o,image:i[0].image,activity:i[0].activity,responses:i[0].responses})},e}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.viewer.Activity=function(t){function o(){return this.afterResize=e(this.afterResize,this),this.activityResize=e(this.activityResize,this),this.onToggleView=e(this.onToggleView,this),this.onEditStop=e(this.onEditStop,this),this.onEditStart=e(this.onEditStart,this),this.toggleViews=e(this.toggleViews,this),this.onGetResultsSuccess=e(this.onGetResultsSuccess,this),this._onActivityResponses=e(this._onActivityResponses,this),this.onActivityResultsClosed=e(this.onActivityResultsClosed,this),this.onActivityResultsOpened=e(this.onActivityResultsOpened,this),this.onSubmitSuccess=e(this.onSubmitSuccess,this),this.onSubmit=e(this.onSubmit,this),this.onToggleContentEdit=e(this.onToggleContentEdit,this),this.onManualUpdate=e(this.onManualUpdate,this),this.onFetchEmbedlyContent=e(this.onFetchEmbedlyContent,this),this.onEmbeddedMediaClick=e(this.onEmbeddedMediaClick,this),this.onDispose=e(this.onDispose,this),this._onActivityResponseDeleted=e(this._onActivityResponseDeleted,this),this._onActivityResponseCreateOrUpdate=e(this._onActivityResponseCreateOrUpdate,this),this.bodyListeners=e(this.bodyListeners,this),this.generatePreview=e(this.generatePreview,this),o.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(o,Echo.core.View),o.prototype.aspectRatio=4/3,o.prototype.editing=!0,o.prototype.submitting=!1,o.prototype.visible="content",o.prototype.initialize=function(t){var e;if(this.activity=t.activity,this.role=t.role,this.toggles=t.toggles,this.response=t.response,this.$embeddedMedia=this.$(".embedded-media"),this.$content=this.$(".activity-content-wrapper"),this.$results=this.$(".activity-results-wrapper"),this.$responseCount=this.$(".responseCount"),this.$totalStudentsCount=this.$(".totalStudentsCount"),this.$activityUpdateNotification=this.$(".activity-update-notification"),this.$activityUpdateText=this.$(".activity-update-text"),this.$toggleViewBtn=this.$(".toggle-view"),this.$justification=this.$(".activity-seeJustification"),this.onActivityResponses=_.debounce(this._onActivityResponses,500),this.initViews(),this.initEventListeners(),this.initEmbeddedMedia(),!(null!=(e=this.toggles)?e.isOpen:void 0))return this.onEditStop()},o.prototype.initEmbeddedMedia=function(){if(null!=this.activity.embedlyUrl)return this.fetchEmbedlyContent([this.activity.embedlyUrl],this.generatePreview)},o.prototype.generatePreview=function(t){var e,i,o,n,s;for(s=[],i=0,o=t.length;i<o;i++)n=t[i],(e=function(){switch(n.type){case"video":return null!=n.thumbnail_url?$("<img>").attr("src",n.thumbnail_url):this.createLinkElement(n.original_url);case"photo":return $("<img>").attr("src",n.thumbnail_url);default:return this.createLinkElement(n.original_url)}}.call(this)).addClass("activity-embed-content").attr("data-url",n.original_url).attr("data-type",n.type),s.push(this.$embeddedMedia.append(e));return s},o.prototype.createLinkElement=function(t){return $("<a>").text(t).attr({href:t,target:"_blank"})},o.prototype.bodyListeners=function(){var t,e,i;return t={},(null!=(e=this.options.toggles)?e.lessonId:void 0)&&(null!=(i=this.options.toggles)?i.activityId:void 0)&&(t["Lesson."+this.options.toggles.lessonId+".Activity."+this.options.toggles.activityId+".activityResponseCreated"]=this._onActivityResponseCreateOrUpdate,t["Lesson."+this.options.toggles.lessonId+".Activity."+this.options.toggles.activityId+".activityResponseUpdated"]=this._onActivityResponseCreateOrUpdate,t["Lesson."+this.options.toggles.lessonId+".Activity."+this.options.toggles.activityId+".activityResponseDeleted"]=this._onActivityResponseDeleted,t["Lesson."+this.options.toggles.lessonId+".Activity."+this.options.toggles.activityId+".activityResultsOpened"]=this.onActivityResultsOpened,t["Lesson."+this.options.toggles.lessonId+".Activity."+this.options.toggles.activityId+".activityResultsClosed"]=this.onActivityResultsClosed),$.extend(o.__super__.bodyListeners.apply(this,arguments),t)},o.prototype._onActivityResponseCreateOrUpdate=function(t,e){var i;return"Student"!==this.role||e.userId!==Echo.userId?this._onActivityResponses(t,e):(null!=(i=this.response)?i.createdAt:void 0)===e.timestamp||this.submitting?void 0:this.$el.trigger("Activity.update")},o.prototype._onActivityResponseDeleted=function(t,e){return"Student"===this.role&&e.userId===Echo.userId?this.onToggleContentEdit():this._onActivityResponses(t,e)},o.prototype.initViews=function(){var t,e;return this.toggleViews(null,null!=(t=this.toggles)?t.resultsOpen:void 0),this.$justification.toggle((null!=(e=this.toggles)?e.resultsOpen:void 0)&&!this.$(".activity-content.results").hasClass("gridView"))},o.prototype.initEventListeners=function(){var t,e,i;if(this.$el.on("Activity.manualUpdate",this.onManualUpdate).on("Activity.toggleView",this.onToggleView).on("ToggleView.showGrid",(i=this,function(){return i.toggleReOrderView({grid:!0})})).on("ToggleView.showList",(e=this,function(){return e.toggleReOrderView({grid:!1})})).on("Activity.dispose",this.onDispose).on("click",".activity-embed-content",this.onEmbeddedMediaClick).closest(".slide").on("Slide.resize",this.activityResize),(null!=(t=this.toggles)?t.isOpen:void 0)||"Instructor"===this.role)return this.wire()},o.prototype.onDispose=function(t){return t.stopPropagation(),this.dispose()},o.prototype.onEmbeddedMediaClick=function(t){var e,i,o;if((e=$(t.target)).is("img"))return t.preventDefault(),"photo"===e.attr("data-type")?((i=$("<img>").addClass("lightbox-image")).on("load",(o=this,function(){return o.openLightBoxWithContent(i)})),i.attr("src",e.attr("src"))):this.fetchEmbedlyContent([e.attr("data-url")],this.onFetchEmbedlyContent)},o.prototype.onFetchEmbedlyContent=function(t){var e,i,o,n;for(n=[],e=0,i=t.length;e<i;e++)o=t[e],n.push(this.openLightBoxWithContent(o.html));return n},o.prototype.openLightBoxWithContent=function(t){return this.$el.trigger("Modal.imageLightBox.replaceContent",t),this.$el.trigger("Modal.imageLightBox.open")},o.prototype.onManualUpdate=function(t,e){return this.$activityUpdateText.text(this.i18n(e)),this.$activityUpdateNotification.show()},o.prototype.wire=function(){if(this.$el.on("Activity.editStart",this.onEditStart).on("Activity.editStop",this.onEditStop).on("Activity.toggleContentEdit",this.onToggleContentEdit).on("AjaxForm.activityAnswer.success",this.onSubmitSuccess).on("AjaxForm.submit",this.onSubmit),"Instructor"===this.role)return this.$el.on("Activity.toggleInstructorResults",this.toggleViews)},o.prototype.onToggleContentEdit=function(){return this.$content.trigger("Activity.editAnswer",{UI:!0})},o.prototype.onSubmit=function(){return this.submitting=!0},o.prototype.onSubmitSuccess=function(t,e){return this.submitting=!1,this.response=e.response,this.updateResultsView(e.html),0<this.$results.length&&this.showView("results"),this.$content.trigger("Activity.answered")},o.prototype.updateResultsView=function(t){var e;return this.$(".activity-results-wrapper").addClass("toBeDeleted").remove().trigger("dispose"),this.$(".activity-body .activity-content-wrapper").after(t),this.$results=this.$(".activity-results-wrapper:not(.toBeDeleted)"),this.$content.toggleClass("noResults",!(null!=(e=this.toggles)?e.resultsOpen:void 0))},o.prototype.onActivityResultsOpened=function(){if(this.toggles.resultsOpen=!0,"Student"===this.role)return this.onActivityResponses()},o.prototype.onActivityResultsClosed=function(){var t;if(this.toggles.resultsOpen=!1,this.$content.toggleClass("noResults",!(null!=(t=this.toggles)?t.resultsOpen:void 0)),"Student"===this.role)return this.$results.trigger("dispose"),this.$results=this.$(".activity-results-wrapper"),this.showView("content")},o.prototype._onActivityResponses=function(t,i){var o;if("Instructor"===this.role||!1!==this.toggles.resultsOpen)return Echo.routes.Activities.getLessonActivityResults(this.toggles.lessonId,this.toggles.activityId).ajax({success:(o=this,function(t){var e;return e=null==i&&o.response||(null!=i?i.userId:void 0)===Echo.userId,o.onGetResultsSuccess(t,e)})})},o.prototype.onGetResultsSuccess=function(t,e){var i,o;return o=t.data,null==e&&(e=!1),i=this.reOrderVisibleView,this.updateResultsView(o[0].html),this.reOrderVisibleView=i,this.toggles.isOpen&&!e?this.resetVisibleView():this.toggles.isOpen&&"Instructor"!==this.role&&null==this.response||this.toggleViews(null,this.toggles.resultsOpen),this.updateResponseCount(o[0]),this.$(".toggle-view .view-"+this.reOrderVisibleView).trigger("click")},o.prototype.updateResponseCount=function(t){return this.$responseCount.text(t.responsesCount),this.$totalStudentsCount.text(t.numStudents)},o.prototype.toggleViews=function(t,e){return e?this.showView("results"):this.showView("content")},o.prototype.resetVisibleView=function(){return this.toggleViews(null,"results"===this.visible)},o.prototype.showView=function(t){return this.$content.toggle("content"===t),this.$results.toggle("results"===t),"Instructor"===this.role&&this.$toggleViewBtn.toggle("results"===t),this.visible=t,this.activityResize(),this.$el.trigger("Activity.updateVisibleView",this.visible)},o.prototype.onEditStart=function(){return this.showView("content"),this.editing=!0,this.$el.addClass("editing"),this.$el.trigger("Activity.editing",this.editing)},o.prototype.onEditStop=function(){return this.editing=!1,this.$el.removeClass("editing"),this.$el.trigger("Activity.editing",this.editing)},o.prototype.onToggleView=function(t,e){if(null!=e.visible)return this.showView(e.visible),0<this.$results.length&&null!=e.reOrderVisibleView?this.$(".toggle-view .view-"+e.reOrderVisibleView).trigger("click"):void 0},o.prototype.toggleReOrderView=function(t){return this.$(".activity-content.results").toggleClass("gridView",t.grid),this.reOrderVisibleView=t.grid?"grid":"list",this.activityResize(),this.$justification.toggle(!t.grid)},o.prototype.getFooter=function(){return"Instructor"===this.role?this.$(".activity-footer.instructor"):"content"===this.visible?this.$content.find(".activity-footer"):this.$results.find(".activity-footer")},o.prototype.isPreviewMode=function(){return 0!==this.$el.closest(".preview-stage, .slidePreview").length},o.prototype.activityResize=function(t){return this.height=this.$el.closest(".slide").height(),"content"===this.visible?this.content=this.$content.find(".activity-content"):this.content=this.$results.find(".activity-content"),this.footer=this.getFooter(),0!==this.$el.closest(".slidePreview").length||0!==this.$el.closest(".slide-contentRef-preview").length?this.content.trigger("resizeContentForPreview"):this.$el.css("maxHeight",this.findAvailableHeight()),this.afterResize(),this.$el.trigger("Stage.media.updateDimensions")},o.prototype.afterResize=function(){var t,e,i,o;if((0!==this.$el.closest(".slideDeck").length||0!==this.$el.closest(".ribbonSlide-container").length)&&(t=this.footer.outerHeight(),this.content.height("auto"),null!=this.content.offset()))return o=this.content.offset().top,0<this.content.closest("form").length&&(o-=this.content.closest("form").offset().top),i=this.$el.height()-t-o,e=this.isPreviewMode()?"height":"outerHeight",0<this.$el.find(".imageAnnotation").length&&(i=this.findAvailableHeight()-t-o),this.content[e](i).trigger("resizeContent")},o.prototype.findAvailableHeight=function(){var t;return t=0,this.isPreviewMode()||(t=this.findControlsHeight()),this.height-t},o.prototype.findControlsHeight=function(){var t,e;return 0===(t=this.$el.closest(".stage").find(".bottom-controls")).length?0:(0===(e=t.height())&&(t.children().not(".video-captions").css({visibility:"hidden",display:"table"}),e=t.height(),t.children().not(".video-captions").css({visibility:"visible",display:"none"})),e)},o}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.viewer.ActivityToggles=function(t){function e(){return this.onResetActivitySuccess=i(this.onResetActivitySuccess,this),this.onConfirmReset=i(this.onConfirmReset,this),this.onResetActivity=i(this.onResetActivity,this),this.onToggleAnswers=i(this.onToggleAnswers,this),this.onToggleResults=i(this.onToggleResults,this),this.onToggleActivity=i(this.onToggleActivity,this),this.onActivityResultsOpened=i(this.onActivityResultsOpened,this),this.onActivityResultsClosed=i(this.onActivityResultsClosed,this),this.onActivityClosed=i(this.onActivityClosed,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.toggles=t.toggles,this.isAnswerable=t.isAnswerable,this.$toggleActivityBtn=this.$(".toggle-activity-btn"),this.$toggleResultsBtn=this.$(".toggle-results-btn"),this.$toggleAnswersBtn=this.$(".toggle-answers-btn"),this.$resetActivityBtn=this.$(".reset-activity-btn"),this.$responseCount=this.$(".responseCount"),this.$justificationText=this.$(".activity-seeJustification"),this.$smsInstructions=this.$(".activity-smsInstructions"),this.$el.on("Activity.toggleActivity",this.onToggleActivity),this.$el.on("Activity.toggleResults",this.onToggleResults),this.wireAnswerToggle(),this.$el.on("Activity.reset",this.onResetActivity),this.route=function(t,e){return Echo.routes.LessonActivities[""+t+e](this.toggles.lessonId,this.toggles.activityId)},this.renderToggles()},e.prototype.bodyListeners=function(){var t;return(t={})["Lesson."+this.options.toggles.lessonId+".Activity."+this.options.toggles.activityId+".resultsOpened"]=this.onActivityResultsOpened,t["Lesson."+this.options.toggles.lessonId+".Activity."+this.options.toggles.activityId+".resultsClosed"]=this.onActivityResultsClosed,t["Lesson."+this.options.toggles.lessonId+".Activity."+this.options.toggles.activityId+".closed"]=this.onActivityClosed,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onActivityClosed=function(){return this.toggles.isOpen=!1},e.prototype.onActivityResultsClosed=function(){return this.updateResultsToggle(!1)},e.prototype.onActivityResultsOpened=function(){return this.updateResultsToggle(!0)},e.prototype.updateResultsToggle=function(t){return this.toggles.resultsOpen=t,this.renderToggles()},e.prototype.renderToggles=function(){var t;return this.renderToggle(this.$toggleActivityBtn,!this.toggles.isOpen),this.renderToggle(this.$toggleResultsBtn,this.toggles.resultsOpen),this.renderToggle(this.$toggleAnswersBtn,this.toggles.answersOpen),this.$smsInstructions.toggle(!this.toggles.resultsOpen),this.$justificationText.toggle(this.toggles.resultsOpen&&!(null!=(t=this.$(".toggle-view"))?t.hasClass("gridView"):void 0))},e.prototype.renderToggle=function(t,e){return t.toggleClass("active",e),t.attr("title",this.getTooltipMessage(t,e))},e.prototype.getTooltipMessage=function(t,e){var i;return i=t.hasClass("toggle-activity-btn")?e?"Activity.open":"Activity.close":t.hasClass("toggle-results-btn")?e?"Activity.hideResults":"Activity.showResults":t.hasClass("toggle-answers-btn")?e?"Activity.hideSolution":"Activity.showSolution":void 0,this.i18n(i)},e.prototype.wireAnswerToggle=function(){if(this.isAnswerable)return this.toggles.isOpen?(this.$el.off("Activity.toggleAnswers"),this.$toggleAnswersBtn.trigger("disable").removeClass("active")):(this.$toggleAnswersBtn.trigger("enable"),this.$el.on("Activity.toggleAnswers",this.onToggleAnswers))},e.prototype.performAction=function(t,e){var i,o,n,s,r;switch(i=$(e).hasClass("active"),t){case"Activity":o=i?"open":"close";break;default:o=i?"close":"open"}return this.route(o,t).ajax({beforeSend:(r=this,function(){return r.renderToggle($(e),!i)}),error:(s=this,function(){return s.renderToggle($(e),i)}),success:(n=this,function(){return n.onToggleChangeSuccess(o,t)})})},e.prototype.onToggleChangeSuccess=function(t,e){switch(e){case"Activity":return this.toggles.isOpen="open"===t,this.wireAnswerToggle();case"Results":return this.toggles.resultsOpen="open"===t,this.renderToggles(),this.$el.trigger("Activity.toggleInstructorResults",this.toggles.resultsOpen)}},e.prototype.onToggleActivity=function(){return this.performAction("Activity",this.$toggleActivityBtn)},e.prototype.onToggleResults=function(){return this.performAction("Results",this.$toggleResultsBtn)},e.prototype.onToggleAnswers=function(){return this.performAction("Answers",this.$toggleAnswersBtn)},e.prototype.onResetActivity=function(){return this.confirm("Activity.confirmReset",this.onConfirmReset)},e.prototype.onConfirmReset=function(){return Echo.routes.LessonActivities.resetActivity(this.toggles.lessonId,this.toggles.activityId).ajax({success:this.onResetActivitySuccess,error:(t=this,function(){return alertify.alert(t.i18n("Errors.activityResetError"))})});var t},e.prototype.onResetActivitySuccess=function(){return this.$responseCount.text(0),this.$el.trigger("Activity.resetSuccess")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.viewer.Content=function(t){function e(t){this.onResizeContentForPreview=i(this.onResizeContentForPreview,this),this.onResizeContent=i(this.onResizeContent,this),this.showExplanations=i(this.showExplanations,this),this.onEditStop=i(this.onEditStop,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.onEditStart=i(this.onEditStart,this),this.onActivityAnswered=i(this.onActivityAnswered,this),this.onDispose=i(this.onDispose,this),this.initView=i(this.initView,this),e.__super__.constructor.apply(this,arguments),this.lessonId=this.$el.closest(".activity-wrapper").data("lesson-id"),this.activityId=this.$el.closest(".activity-wrapper").data("activity-id"),this.$submitBtn=this.$("button[type=submit]"),this.$editBtn=this.$(".edit-answer-btn"),this.$explanationPrompt=this.$("input[name=explanation]"),this.$el.on("dispose",this.onDispose).on("Activity.answered",this.onActivityAnswered),setTimeout(this.initView,100)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initView=function(){var t;return this.hideButtons(),(null!=(t=this.toggles)?t.isOpen:void 0)&&null==this.response&&"Student"===this.role&&this.onEditStart(null,{UI:!0}),this.$el.on("Activity.editAnswer",this.onEditStart),this.initAnswer()},e.prototype.initAnswer=function(){},e.prototype.onDispose=function(t){return t.stopPropagation(),this.dispose()},e.prototype.onActivityAnswered=function(t){return t.stopPropagation(),this.onEditStop()},e.prototype.onEditStart=function(t,e){return(null!=e?e.UI:void 0)?this.onDeleteSuccess():(this.$editBtn.trigger("loading.on",{theme:"light",opacity:"solid"}),Echo.routes.ActivityResponses.deleteActivityResponse(this.lessonId,this.activityId).ajax({success:this.onDeleteSuccess,complete:(o=this,function(){return o.$editBtn.trigger("loading.off")}),error:(i=this,function(){return alertify.error(i.i18n("Errors.activityResponseDeleteError"))})}));var i,o},e.prototype.onDeleteSuccess=function(){if(this.$editBtn.removeClass("answered").trigger("disable"),this.$submitBtn.removeClass("answered").trigger("enable"),this.$explanationPrompt.trigger("enable"),this.$el.trigger("Activity.editStart"),this.$el.hasClass("activity-results-wrapper"))return this.$el.trigger("Activity.toggleContentEdit")},e.prototype.onEditStop=function(t){return this.hideButtons(),this.$el.trigger("Activity.editStop")},e.prototype.hideButtons=function(){return this.$submitBtn.addClass("answered").trigger("disable"),this.$editBtn.addClass("answered"),this.$explanationPrompt.trigger("disable")},e.prototype.showExplanations=function(t){return this.$el.find(".explanations-wrapper").trigger("show.explanation",{showId:$(t.currentTarget).data("index"),activityId:this.activityId})},e.prototype.onResizeContent=function(t){var e,i,o,n;if(this.$el.is(":visible")){if(null!=t&&t.stopPropagation(),e=this.$container.height(),n=(i=this.$container.width())/e,o=this.$image[0].naturalWidth/this.$image[0].naturalHeight,this.$image.height(this.height),this.$image.width("auto"),n<o){if(this.width=i<this.$image[0].naturalWidth?i:this.$image[0].naturalWidth,0===this.width)return;this.height=Math.floor(this.width/o),this.$image.width(this.width).height(this.height),this.width=this.$image.width(),this.height=this.$image.height()}else{if(this.height=e<this.$image[0].naturalHeight?e:this.$image[0].naturalHeight,0===this.height)return;this.$image.height(this.height),this.width=this.$image.width(),this.height=this.$image.height()}if(this.left=this.$image.offset().left-this.$image.parent().offset().left,0!==this.height)return this.$imageWrapper.height(this.height).width(this.width).css("left",this.left),this.$(".activity-content").height(this.height+this.$(".activity-results-title").outerHeight())}},e.prototype.onResizeContentForPreview=function(t){var e,i,o;if(this.$el.is(":visible")&&(t.stopPropagation(),0===this.$el.closest(".slide-contentRef-preview").length?this.$container.outerHeight(this.$el.closest(".slide-container").height()-this.$el.siblings(".activity-prompt").outerHeight()-140):this.$container.width(this.$el.closest(".slide").width()-200),e=this.$image.height(),o=this.$image.width(),i=this.$image.offset().left-this.$image.parent().offset().left,0!==e))return this.$imageWrapper.height(e).width(o).css("left",i)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.viewer.Explanations=function(t){function e(){return this.showNextExplanation=i(this.showNextExplanation,this),this.showPreviousExplanation=i(this.showPreviousExplanation,this),this.showExplanation=i(this.showExplanation,this),this.onModalOpen=i(this.onModalOpen,this),this.onModalClose=i(this.onModalClose,this),this.bodyListeners=i(this.bodyListeners,this),this.onKeydown=i(this.onKeydown,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.activityId=t.activityId,this.$explanationWrappers=this.$(".explanation-wrapper"),this.$previousArrow=this.$(".previous-explanation"),this.$nextArrow=this.$(".next-explanation"),this.$el.on("show.explanation",this.showExplanation).on("click",this.onMouseMove).closest(".modal").on("mousemove",this.onMouseMove),this.$body.on("keydown",this.onKeydown),this.$previousArrow.on("click",this.showPreviousExplanation),this.$nextArrow.on("click",this.showNextExplanation),this.moveCorrect()},e.prototype.onKeydown=function(t){switch(t.which){case this.KEYS.ARROW_LEFT:case this.KEYS.PAGE_UP:return this.showPreviousExplanation();case this.KEYS.ARROW_RIGHT:case this.KEYS.PAGE_DOWN:return this.showNextExplanation()}},e.prototype.moveCorrect=function(){var t;if(0<(t=this.$explanationWrappers.filter(".explanations-correct")).length)return this.$el.prepend(t)},e.prototype.bodyListeners=function(){var t;return(t={})["Modal.explanations."+this.options.activityId+".onClose"]=this.onModalClose,t["Modal.explanations."+this.options.activityId+".onOpen"]=this.onModalOpen,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onMouseMove=function(t){return t.stopPropagation()},e.prototype.onModalClose=function(){return this.$el.closest(".stage").removeClass("justificationsOpen")},e.prototype.onModalOpen=function(){return this.$el.closest(".stage").addClass("justificationsOpen")},e.prototype.showExplanation=function(t,e){return this.showCorrectExplanation($.trim(e.showId)),this.$el.trigger("Modal.explanations."+e.activityId+".open")},e.prototype.showCorrectExplanation=function(t){return this.$explanationWrappers.removeClass("visibleExplanation").filter("[data-index='"+t+"']").addClass("visibleExplanation"),this.toggleArrows()},e.prototype.toggleArrows=function(){if(this.visible=this.$(".explanation-wrapper.visibleExplanation"),0!==this.visible.length)return this.index=this.$(".explanation-wrapper").index(this.visible),this.$previousArrow.toggleClass("inActive",this.isFirst()),this.$nextArrow.toggleClass("inActive",this.isLast())},e.prototype.isFirst=function(){return 0===this.index},e.prototype.isLast=function(){return this.index+1===this.$explanationWrappers.length},e.prototype.showPreviousExplanation=function(){var t;if(!this.isFirst())return this.$explanationWrappers.removeClass("visibleExplanation"),null!=(t=this.visible)&&t.prev(".explanation-wrapper").addClass("visibleExplanation"),this.toggleArrows()},e.prototype.showNextExplanation=function(){var t;if(!this.isLast())return this.$explanationWrappers.removeClass("visibleExplanation"),null!=(t=this.visible)&&t.next(".explanation-wrapper").addClass("visibleExplanation"),this.toggleArrows()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.viewer.ImageAnnotation=function(t){function e(){return this.drawSolution=i(this.drawSolution,this),this.onClick=i(this.onClick,this),this.onFormError=i(this.onFormError,this),this.onTouch=i(this.onTouch,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.initialize=function(t){return this.toggles=t.toggles,this.role=t.role,this.response=t.response,this.solution=t.solution,this.$container=this.$(".imageAnnotation-container"),this.$imageWrapper=this.$("div.imageWrapper"),this.$image=this.$("img"),this.$imageMarker=this.$("span.marker.own-answer"),this.$hiddenAnswerX=this.$("[name=x]"),this.$hiddenAnswerY=this.$("[name=y]"),null!=this.solution&&this.drawSolution(),this.$el.on("resizeContent",this.onResizeContent).on("resizeContentForPreview",this.onResizeContentForPreview).closest(".activity").on("AjaxForm.activityAnswer.error",this.onFormError),this.$imageMarker.on("click",function(t){return t.stopPropagation()}),Echo.core.helpers.preloadImage(this.$image.attr("src"),(e=this,function(t){if(e.height=t.target.height,e.width=t.target.width,0===e.$el.closest(".preview-stage, .slidePreview").length)return e.onResizeContent(t)}));var e},e.prototype.onTouch=function(t){return this.touch=t.originalEvent.touches[0],this.$el.closest(".media").addClass("touch"),!0},e.prototype.initAnswer=function(){return null!=this.response?(this.$hiddenAnswerX.val(this.response.answer.solution.x),this.$hiddenAnswerY.val(this.response.answer.solution.y)):this.$imageMarker.hide()},e.prototype.onFormError=function(t,e){var i,o,n,s;if(null!=(null!=e?e.formErrors:void 0)){for(i in s=[],n=e.formErrors)o=n[i],"obj.answer.solution.x"!==i&&("error.path.missing"===(o=o[0].msg)&&(o="Activity.error.imageAnnotation.responseRequired"),s.push(alertify.error(this.i18n(o,o[0].args))));return s}},e.prototype.onEditStart=function(){return e.__super__.onEditStart.apply(this,arguments),this.$(".imageSolution").hide(),this.$imageWrapper.on("click.Activity.ImageAnnotation",this.onClick),this.$imageWrapper.on("touchstart",this.onTouch)},e.prototype.onEditStop=function(){return e.__super__.onEditStop.apply(this,arguments),this.$(".imageSolution").show(),this.$imageWrapper.off("click.Activity.ImageAnnotation")},e.prototype.onClick=function(t){var e,i;return null!=this.touch&&null!=this.touch.pageX&&this.touch.pageX>t.pageX&&(t.pageX=this.touch.pageX,t.pageY=this.touch.pageY),(i=this.$container.position()).left+=this.$imageWrapper.position().left+(this.$el.closest(".activity").parent().width()-this.$el.closest(".activity").width())/2,i.top+=this.$el.closest(".activity-wrapper").position().top,this.$el.closest(".media").removeClass("touch"),e={x:(t.pageX-i.left)/this.width*100,y:(t.pageY-i.top)/this.height*100},this.markImage(e.x,e.y)},e.prototype.markImage=function(t,e){return this.$imageMarker.css("left",t+"%").css("top",e+"%").show(),this.$hiddenAnswerX.val(t/100),this.$hiddenAnswerY.val(e/100)},e.prototype.drawSolution=function(){var t;return t=$("<div>").addClass("imageSolution").css({left:100*this.solution.left+"%",top:100*this.solution.top+"%",height:100*this.solution.height+"%",width:100*this.solution.width+"%"}),this.$imageWrapper.append(t)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.viewer.ImageAnnotationResults=function(t){function e(){return this.drawSolution=i(this.drawSolution,this),this.onClickMarker=i(this.onClickMarker,this),this.onClickExternal=i(this.onClickExternal,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.arrowSize=10,e.prototype.initialize=function(t){return this.solution=t.solution,this.$container=this.$(".imageAnnotation-container"),this.$imageWrapper=this.$("div.imageWrapper"),this.$image=this.$("img"),this.$imageMarker=this.$("span.marker"),this.$el.on("resizeContent",this.onResizeContent).on("resizeContentForPreview",this.onResizeContentForPreview),this.$imageMarker.on("click",this.onClickMarker),this.$body.on("click",this.onClickExternal),null!=this.solution&&this.drawSolution(),Echo.core.helpers.preloadImage(this.$image.attr("src"),(e=this,function(t){return e.height=t.target.height,e.width=t.target.width}));var e},e.prototype.deselectMarkers=function(){return this.$(".marker").removeClass("selected").find(".imageAnnotation-explanation").hide()},e.prototype.onClickExternal=function(){return this.deselectMarkers()},e.prototype.onClickMarker=function(t){var e;if(t.stopPropagation(),!(e=$(t.currentTarget)).hasClass("selected"))return this.deselectMarkers(),e.addClass("selected"),0<e.find(".imageAnnotation-explanation").length?this.displayExplanation(e):void 0},e.prototype.displayExplanation=function(t){var e,i,o,n;return e=this.$(".activity-content"),(o=(i=t.find(".imageAnnotation-explanation")).find(".tooltip-inner")).css("max-width",e.width()),i.css("width",e.width()).addClass("top").show().css("width",o.outerWidth()),n=i.width(),i.css("left",-(n-this.arrowSize)/2)},e.prototype.drawSolution=function(){var t;return t=$("<div>").addClass("imageSolution").css({left:100*this.solution.left+"%",top:100*this.solution.top+"%",height:100*this.solution.height+"%",width:100*this.solution.width+"%"}),this.$imageWrapper.append(t)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.activities.viewer.MultipleChoice=function(t){function e(){return this.onClick=i(this.onClick,this),this.onFormError=i(this.onFormError,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.initialize=function(t){return this.toggles=t.toggles,this.response=t.response,this.role=t.role,this.$choicesDiv=this.$("ul.choices"),this.$choices=this.$("li.choice"),this.$el.closest(".activity").on("AjaxForm.activityAnswer.error",this.onFormError)},e.prototype.onFormError=function(t,e){var i,o,n,s;if(null!=(null!=e?e.formErrors:void 0)){for(i in s=[],n=e.formErrors)"error.path.missing"===(o=(o=n[i])[0].msg)&&(o="Activity.error.multipleChoice.responseRequired"),s.push(alertify.error(this.i18n(o,o[0].args)));return s}},e.prototype.onEditStart=function(){return e.__super__.onEditStart.apply(this,arguments),this.$choices.on("click.Activity.MultipleChoice",this.onClick)},e.prototype.onEditStop=function(){return e.__super__.onEditStop.apply(this,arguments),this.$choices.off("click.Activity.MultipleChoice")},e.prototype.onClick=function(t){var e,i;return i=(e=$(t.currentTarget)).hasClass("selected"),t.ctrlKey||t.metaKey?i?this.updateAnswer(e,!1,""):this.updateAnswer(e,!0,e.data("index")):(this.deselectChoices(),this.updateAnswer(e,!0,e.data("index")))},e.prototype.updateAnswer=function(t,e,i){return t.toggleClass("selected",e).find("[type=hidden]").val(i)},e.prototype.deselectChoices=function(){return this.$choices.each((i=this,function(t,e){return i.updateAnswer(i.$(e),!1,"")}));var i},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.viewer.MultipleChoiceResults=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.initialize=function(t){return this.activityId=t.activityId,this.$choicesDiv=this.$("ul.choices"),this.$choices=this.$("li.choice"),this.$el.find("li").on("click",this.showExplanations)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.viewer.NumericalAnswer=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.initialize=function(t){return this.toggles=t.toggles,this.response=t.response,this.role=t.role,this.$solution=this.$("input[name=solution]")},e.prototype.onEditStart=function(){return e.__super__.onEditStart.apply(this,arguments),this.$solution.prop("disabled",!1)},e.prototype.onEditStop=function(){return e.__super__.onEditStop.apply(this,arguments),this.$solution.prop("disabled",!0)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.viewer.NumericalAnswerResults=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.initialize=function(t){return this.activityId=t.activityId,this.$el.find(".resultItem").on("click",this.showExplanations),this.moveSolution()},e.prototype.moveSolution=function(){var t;if(0<(t=this.$(".numericalAnswer.results .correctAnswer")).length)return this.$(".numericalAnswer.results .numericalAnswer-results-list").prepend(t)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.viewer.RangeAnswer=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.initialize=function(t){return this.toggles=t.toggles,this.response=t.response,this.role=t.role,this.$solution=this.$("input[name=solution]")},e.prototype.onEditStart=function(){return e.__super__.onEditStart.apply(this,arguments),this.$solution.prop("disabled",!1)},e.prototype.onEditStop=function(){return e.__super__.onEditStop.apply(this,arguments),this.$solution.prop("disabled",!0)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.viewer.RangeAnswerResults=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.initialize=function(t){return this.activityId=t.activityId,this.$el.find(".resultItem").on("click",this.showExplanations)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.viewer.ReOrder=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.initialize=function(t){return this.toggles=t.toggles,this.response=t.response,this.role=t.role,this.$choicesList=this.$el.find(".choices"),this.ghostItem=null,this.sortable=new Sortable(this.$choicesList.get(0),{disabled:!0})},e.prototype.onEditStart=function(){return e.__super__.onEditStart.apply(this,arguments),this.sortable.option("disabled",!1)},e.prototype.onEditStop=function(){return e.__super__.onEditStop.apply(this,arguments),this.sortable.option("disabled",!0)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.viewer.ReOrderResults=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.initialize=function(t){return this.activityId=t.activityId,this.$(".resultItem").on("click",this.showExplanations),this.moveSolution()},e.prototype.moveSolution=function(){var t;if(0<(t=this.$(".reorder-results.list-view .correctAnswer")).length)return this.$(".reorder-results.list-view").prepend(t)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.viewer.ShortAnswer=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.initialize=function(t){return this.toggles=t.toggles,this.response=t.response,this.role=t.role,this.$solution=this.$("textarea[name=solution]")},e.prototype.onEditStart=function(){return e.__super__.onEditStart.apply(this,arguments),this.$solution.prop("disabled",!1)},e.prototype.onEditStop=function(){return e.__super__.onEditStop.apply(this,arguments),this.$solution.prop("disabled",!0)},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.activities.viewer.ShortAnswerResults=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.widgets.activities.viewer.Content),e.prototype.initialize=function(){},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.Captions=function(t){function e(){return this.onFileUpload=i(this.onFileUpload,this),this.onSendToProcessSuccess=i(this.onSendToProcessSuccess,this),this.onSendConfirmation=i(this.onSendConfirmation,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.onDeleteConfirmation=i(this.onDeleteConfirmation,this),this.onCaptionsProcess=i(this.onCaptionsProcess,this),this.onCaptionsDelete=i(this.onCaptionsDelete,this),this.toggleDeleteBtn=i(this.toggleDeleteBtn,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.captionServiceUrl=t.captionServiceUrl,this.$deleteBtn=this.$(".dropdown .delete"),this.$toggle=this.$(".dropdown-toggle"),this.$process=this.$(".dropdown .process"),this.$el.on("Captions.delete",this.onCaptionsDelete).on("Captions.process",this.onCaptionsProcess).on("FileStack.success",".fileStack-wrapper",this.onFileUpload)},e.prototype.toggleDeleteBtn=function(t){var e;return e=t?"enable":"disable",this.$deleteBtn.trigger(e).parent().toggleClass("disabled",!t)},e.prototype.onCaptionsDelete=function(){return this.confirm("Caption.deleteConfirmation",this.onDeleteConfirmation)},e.prototype.onCaptionsProcess=function(){return this.confirm("Messages.sendForCaptioning",this.onSendConfirmation)},e.prototype.onDeleteConfirmation=function(){return Echo.routes.Captioning.removeCaptions(this.mediaId).ajax({beforeSend:(e=this,function(){return e.toggleDeleteBtn(!1)}),success:this.onDeleteSuccess,error:(t=this,function(){return alertify.error(t.i18n("Caption.delete.error")),t.toggleDeleteBtn(!0)})});var t,e},e.prototype.onDeleteSuccess=function(){return alertify.success(this.i18n("Caption.delete.success")),this.$toggle.text(this.i18n("Labels.add")),this.$el.removeClass("italic"),this.$process.text(this.i18n("Media.sendToProcess"))},e.prototype.onSendConfirmation=function(){return $.ajax({url:this.captionServiceUrl,success:this.onSendToProcessSuccess,error:(t=this,function(){return alertify.error(t.i18n("Errors.sendForCaptioningError"))})});var t},e.prototype.onSendToProcessSuccess=function(){return alertify.success(this.i18n("Messages.sendForCaptioningSuccess")),this.$toggle.text(this.i18n("Labels.processing")),this.$el.addClass("italic"),this.$process.text(this.i18n("Labels.reprocess")),this.toggleDeleteBtn(!0)},e.prototype.onFileUpload=function(t,e){var i,o,n;return i=e.fileBlob,this.ajax(Echo.routes.Captioning.customCaption(this.mediaId),{data:{name:"caption",fileBlob:i},success:(n=this,function(){return n.toggleDeleteBtn(!0),alertify.success(n.i18n("Caption.customCaptionSuccess"))}),error:(o=this,function(){return alertify.error(o.i18n("Caption.customCaptionError"))})})},e}()}.call(this),function(){var n={}.hasOwnProperty;Echo.widgets.media.details.ChangeOwnerModal=function(t){function i(){var t,e;return this.onFormSuccess=(t=this.onFormSuccess,e=this,function(){return t.apply(e,arguments)}),i.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(i,Echo.core.View),i.prototype.initialize=function(){return this.$el.on("AjaxForm.changeOwner.success",this.onFormSuccess)},i.prototype.onFormSuccess=function(){return this.$el.trigger("Modal.changeOwner.close"),alertify.success(this.i18n("Media.owner.changeSuccess"))},i}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.Details=function(t){function e(){return this.loadSharing=i(this.loadSharing,this),this.loadPublishing=i(this.loadPublishing,this),this.loadInfo=i(this.loadInfo,this),this.updateTabs=i(this.updateTabs,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.mode=t.mode,this.captureId=t.captureId,this.$el.on("MediaDetails.loadInfo",this.loadInfo).on("MediaDetails.loadPublishing",this.loadPublishing).on("MediaDetails.loadSharing",this.loadSharing),this.$infoTab=this.$(".tab.info"),this.$publishingTab=this.$(".tab.publishing"),this.$sharingTab=this.$(".tab.sharing"),this.$tabs=this.$(".tabs .tab"),this.$el.on("click",".tab.info:not(.disabled)",this.loadInfo).on("click",".tab.publishing:not(.disabled)",this.loadPublishing).on("click",".tab.sharing:not(.disabled)",this.loadSharing),"publish"!==this.mode||this.$publishingTab.hasClass("disabled")?this.loadInfo():this.loadPublishing()},e.prototype.updateTabs=function(t){return this.$tabs.removeClass("active").filter("."+t).addClass("active")},e.prototype.loadInfo=function(){return this.updateTabs("info"),this.hideDetails(),0===this.$el.find(".infoDetail").length&&this.mediaId?this.injectFromUrl(Echo.routes.Media.advancedInfo(this.mediaId),".mediaDetail"):0===this.$el.find(".infoDetail").length?this.injectFromUrl(Echo.routes.Captures.advancedInfo(this.captureId),".mediaDetail"):this.showDetails(".infoDetail")},e.prototype.loadPublishing=function(t,e){if(null==e||!e.swap)return this.updateTabs("publishing"),this.hideDetails(),0===this.$el.find(".publishingList").length&&null!=this.mediaId?this.injectFromUrl(Echo.routes.Media.publishInfo(this.mediaId),".mediaDetail"):this.showDetails(".publishingList");setTimeout(this.loadPublishing,100)},e.prototype.loadSharing=function(t,e){if(null==e||!e.swap)return this.updateTabs("sharing"),this.hideDetails(),0===this.$el.find(".sharingList").length&&null!=this.mediaId?this.injectFromUrl(Echo.routes.Media.shareInfo(this.mediaId),".mediaDetail"):this.showDetails(".sharingList");setTimeout(this.loadSharing,100)},e.prototype.hideDetails=function(){return this.$(".mediaDetail-content").hide()},e.prototype.showDetails=function(t){return this.$(t).show()},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.EmbedPublicLinkModal=function(t){function e(){return this.onAutoPlayChange=i(this.onAutoPlayChange,this),this.updateEmbedCode=i(this.updateEmbedCode,this),this.onEmbedLink=i(this.onEmbedLink,this),this.onClose=i(this.onClose,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.embedCode=_.template('<iframe height="<%=height%>" width="<%-width%>" allowfullscreen frameborder=0 src="<%=url%>"></iframe>'),e.prototype.initialize=function(t){return this.baseUrl=t.baseUrl,this.$embedCode=this.$("[name=embedCode]"),this.$autoplay=this.$("[name=autoplay]"),this.$automute=this.$("[name=automute]"),this.$dimensions=this.$("[name=dimensions]"),this.$body.on("PublicLink.embedLink",this.onEmbedLink).on("Modal.embedPublicLink.onClose",this.onClose),this.$el.on("change","[name=autoplay]",this.onAutoPlayChange),this.$el.on("change","select, .switch",this.updateEmbedCode)},e.prototype.onClose=function(){return this.$automute.prop("checked",!1).trigger("change"),this.$autoplay.prop("checked",!1).trigger("change"),this.$dimensions.val("640x360").trigger("change")},e.prototype.onEmbedLink=function(t,e){return this.linkId=e,this.updateEmbedCode()},e.prototype.queryString=function(){return"?autoplay="+this.$autoplay.prop("checked")+"&automute="+this.$automute.prop("checked")},e.prototype.updateEmbedCode=function(){var t,e,i;return i=(e=this.$dimensions.val().split("x"))[0],t=e[1],this.$embedCode.val(this.embedCode({height:t,width:i,url:this.baseUrl+Echo.routes.PublicLinks.video(this.linkId).url+this.queryString()}))},e.prototype.onAutoPlayChange=function(){return this.$autoplay.prop("checked")?this.$automute.prop("checked",!0).trigger("disable").closest(".switch").attr("data-tooltip",this.i18n("PublicLink.autoPlayWarning")).attr("data-tooltip-wrap",!0):this.$automute.trigger("enable").closest(".switch").removeAttr("data-tooltip")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.Main=function(t){function e(){return this.onEdit=i(this.onEdit,this),this.onMediaDeleteError=i(this.onMediaDeleteError,this),this.onMediaDeleteSuccess=i(this.onMediaDeleteSuccess,this),this.onConfirmDelete=i(this.onConfirmDelete,this),this.onDelete=i(this.onDelete,this),this.bodyListeners=i(this.bodyListeners,this),this.onEdited=i(this.onEdited,this),this.onCopyError=i(this.onCopyError,this),this.onCopySuccess=i(this.onCopySuccess,this),this.onCopy=i(this.onCopy,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.$content=this.$(".content"),this.$description=this.$(".description"),this.$mediaActions=this.$(".media-actions"),this.$tags=this.$(".tags"),this.$title=this.$(".header h1"),this.tagTemplate=_.template(this.$(".tag-template").html()),this.$el.on("MediaDetails.editInfo",this.onEdit).on("MediaDetails.delete",this.onDelete).on("MediaDetails.copy",this.onCopy)},e.prototype.onCopy=function(t){return t.stopPropagation(),this.confirm("Captures.createCopy.confirm",(e=this,function(){return Echo.routes.Media.copy(e.mediaId).ajax({beforeSend:function(){return e.loadingOn(null,{fixed:!0})},success:e.onCopySuccess,complete:e.loadingOff,error:e.onCopyError})}));var e},e.prototype.onCopySuccess=function(){return alertify.success(this.i18n("Captures.createCopy.success"))},e.prototype.onCopyError=function(){return alertify.error(this.i18n("Captures.createCopy.error"))},e.prototype.onEdited=function(t,e){var i;return this.$title.text(e.updatedMedia.name),this.$description.text(e.updatedMedia.description),this.$tags.empty(),_.each(e.updatedMedia.tags,(i=this,function(t){return i.$tags.append(i.tagTemplate({tag:t}))})),this.$content.toggleClass("withDescriptionAndTags",0!==e.updatedMedia.tags.length||""!==e.updatedMedia.description)},e.prototype.bodyListeners=function(){var t;return(t={})["Media."+this.options.mediaId+".edited"]=this.onEdited,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onDelete=function(t,e){return this.confirm("Library.warning.delete",(i=this,function(){return i.onConfirmDelete(e)}));var i},e.prototype.onConfirmDelete=function(t){return this.mediaId?Echo.routes.Media.delete(this.mediaId).ajax({success:this.onMediaDeleteSuccess,error:this.onMediaDeleteError}):this.ajax(Echo.routes.Captures.delete(),{data:{occurrenceIds:[t],scheduledIds:[]},beforeSend:(e=this,function(){return e.loadingOn(null,{theme:"dark"})}),success:this.onMediaDeleteSuccess,error:this.onMediaDeleteError});var e},e.prototype.onMediaDeleteSuccess=function(){return alertify.success(this.i18n("Media.delete.success")),setTimeout((i=this,function(){var t,e;return-1!==window.location.href.indexOf(i.mediaId)?(t=null!=(e=window.location.href.split("?")[1])?e:"",window.location.replace("/admin/captures#"+t)):window.location.replace("/home")}),1e3);var i},e.prototype.onMediaDeleteError=function(t,e){var i,o,n;return this.loadingOff(),i=null!=(o=null!=t&&null!=(n=t.responseJSON)?n.message:void 0)?o:this.i18n("Library.error.delete"),alertify.error(i)},e.prototype.onEdit=function(){return this.injectFromUrl(Echo.routes.Media.editorModal(this.mediaId))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.MediaOwner=function(t){function e(){return this.onClick=i(this.onClick,this),this.onChangeOwnerSuccess=i(this.onChangeOwnerSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.$body.on("AjaxForm.changeOwner.success",this.onChangeOwnerSuccess),this.$el.on("click",this.onClick)},e.prototype.onChangeOwnerSuccess=function(t,e){return this.$el.text(e.ownerName).attr("data-tooltip",e.ownerEmail)},e.prototype.onClick=function(){return this.injectFromUrl(Echo.routes.Media.changeOwnerModal(this.mediaId))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.PublicLink=function(t){function e(){return this.onUpdateError=i(this.onUpdateError,this),this.onUpdateSuccess=i(this.onUpdateSuccess,this),this._onPublicLinkChange=i(this._onPublicLinkChange,this),this.onSuccess=i(this.onSuccess,this),this.onDelete=i(this.onDelete,this),this.onEmbed=i(this.onEmbed,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.linkId=t.linkId,this.$form=this.$("form"),this.onPublicLinkChange=_.debounce(this._onPublicLinkChange,300),this.$el.on("PublicLink.delete",this.onDelete).on("PublicLink.embed",this.onEmbed).on("change keyup","input",this.onPublicLinkChange),this.formData=this.$form.serialize()},e.prototype.onEmbed=function(){return this.$el.trigger("PublicLink.embedLink",this.linkId).trigger("Modal.embedPublicLink.open")},e.prototype.onDelete=function(){return this.confirm("PublicLink.delete.confirm",(t=this,function(){return Echo.routes.PublicLinks.delete(t.linkId).ajax({success:t.onSuccess,error:t.onError})}));var t},e.prototype.onSuccess=function(){return alertify.success(this.i18n("PublicLink.delete.success")),this.$el.addClass("toBeDeleted").trigger("PublicLink.deleted"),this.dispose()},e.prototype._onPublicLinkChange=function(t){var e;if(this.$form.serialize()!==this.formData)return null!=this.successAlertTimeout&&clearTimeout(this.successAlertTimeout),this.ajax(Echo.routes.PublicLinks.updatePublicLink(this.linkId),{data:Echo.core.form.getData(this.$form),success:(e=this,function(){return e.onUpdateSuccess(t)}),error:this.onUpdateError})},e.prototype.onUpdateSuccess=function(t){var e,i;return this.formData=this.$form.serialize(),e=t.target&&this.$(t.target).is("input[type=text]")?5e3:1e3,this.successAlertTimeout=setTimeout((i=this,function(){return alertify.success(i.i18n("PublicLink.update.success"))}),e)},e.prototype.onUpdateError=function(){return alertify.error(this.i18n("PublicLink.update.error"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.PublicLinkInfo=function(t){function e(){return this.onTimeUpdate=i(this.onTimeUpdate,this),this.bodyListeners=i(this.bodyListeners,this),this.onPublicLinkInfoChange=i(this.onPublicLinkInfoChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.videoId=t.videoId,this.$startPosition=this.$("[name=timestamp]"),this.$timeSwitch=this.$("[name=toggleStart]"),this.$formInfo=this.$(".video-link-form-data"),this.$authRadio=this.$("[name=requireLogin]"),this.$el.on("change keyup","input",this.onPublicLinkInfoChange),this.renderFormInfo()},e.prototype.onPublicLinkInfoChange=function(){return this.renderFormInfo()},e.prototype.bodyListeners=function(){var t;return(t={})["Video.mediaEvent.timeUpdate."+this.options.videoId]=this.onTimeUpdate,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onTimeUpdate=function(t,e){var i;if(i=e.currentTime,(window.isMobile||!$(t.target).data("follow"))&&!this.$timeSwitch.prop("checked"))return this.$startPosition.val(Echo.core.helpers.msToTime(i)).trigger("change")},e.prototype.renderFormInfo=function(){var t,e;return e=this.$timeSwitch.prop("checked")?Echo.core.helpers.timeToMs(this.$startPosition.val()):"",t=this.$authRadio.filter(":checked").val(),this.$formInfo.html('<input type="hidden" name="startPosition" value="'+e+'" data-type="number" />\n<input type="hidden" name="authenticated" value="'+t+'" data-type="boolean" />')},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.PublishingList=function(t){function e(){return this.updateListState=i(this.updateListState,this),this.onPublishingItemSectionRemoved=i(this.onPublishingItemSectionRemoved,this),this.onMediaPublished=i(this.onMediaPublished,this),this.onPublisherModalError=i(this.onPublisherModalError,this),this.onPublisherModalSuccess=i(this.onPublisherModalSuccess,this),this.onMediaPublish=i(this.onMediaPublish,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.$list=this.$(".mediaDetailContent-section"),this.$el.on("Media.publish",this.onMediaPublish).on("PublishingListItemSection.removed",this.onPublishingItemSectionRemoved),this.updateListState()},e.prototype.bodyListeners=function(){var t;return(t={})["Media."+this.options.mediaId+".published"]=this.onMediaPublished,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onMediaPublish=function(){return Echo.routes.Publish.publisherModal(this.mediaId).ajax({success:this.onPublisherModalSuccess,error:this.onPublisherModalError})},e.prototype.onPublisherModalSuccess=function(t){return this.$body.append(t.data[0].html)},e.prototype.onPublisherModalError=function(){return alertify.alert(this.i18n("Media.publish.error.getPublishedOptionsError"))},e.prototype.onMediaPublished=function(){return this.$el.trigger("MediaDetails.loadPublishing",{swap:!0}),this.dispose()},e.prototype.onPublishingItemSectionRemoved=function(){return setTimeout(this.updateListState,100)},e.prototype.updateListState=function(){if(0===this.$(".detailListItem").length)return this.$list.addClass("no-results")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.PublishingListItem=function(t){function e(){return this.onPublishingItemSectionRemoved=i(this.onPublishingItemSectionRemoved,this),this.onClick=i(this.onClick,this),this.updateSectionCount=i(this.updateSectionCount,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.$sectionCount=this.$(".sectionCount"),this.$el.on("click",".detailListItem-primary",this.onClick).on("PublishingListItemSection.removed",this.onPublishingItemSectionRemoved),this.updateSectionCount()},e.prototype.getSectionCount=function(){return this.$(".detailListItem-secondary").length},e.prototype.updateSectionCount=function(){var t;return 0===(t=this.getSectionCount())?this.dispose():this.$sectionCount.text(t)},e.prototype.onClick=function(){return this.$el.toggleClass("expanded")},e.prototype.onPublishingItemSectionRemoved=function(){return setTimeout(this.updateSectionCount,100)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.PublishingListItemSection=function(t){function e(){return this.onMediaRepublished=i(this.onMediaRepublished,this),this.onPublishedOptionsModalError=i(this.onPublishedOptionsModalError,this),this.onPublishedOptionsModalSuccess=i(this.onPublishedOptionsModalSuccess,this),this.onClick=i(this.onClick,this),this.onUnPublishError=i(this.onUnPublishError,this),this.onUnPublishSuccess=i(this.onUnPublishSuccess,this),this.unPublish=i(this.unPublish,this),this.onMediaUnpublish=i(this.onMediaUnpublish,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){if(this.lessonId=t.lessonId,this.mediaId=t.mediaId,this.readOnly=t.readOnly,!this.readOnly)return this.$el.on("Media.unpublish",this.onMediaUnpublish).on("click",this.onClick)},e.prototype.bodyListeners=function(){var t;return(t={})["Media."+this.options.mediaId+".lesson."+this.options.lessonId+".republished"]=this.onMediaRepublished,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onMediaUnpublish=function(){return alertify.confirm(this.i18n("Media.publish.warning.unpublishVideo"),(e=this,function(t){if(t)return e.unPublish()}));var e},e.prototype.unPublish=function(){return this.$el.trigger("loading.on"),Echo.routes.Publish.unpublish(this.lessonId,this.mediaId).ajax({success:this.onUnPublishSuccess,error:this.onUnPublishError})},e.prototype.onUnPublishSuccess=function(){return alertify.success(this.i18n("Media.unpublish.success")),this.$el.trigger("PublishingListItemSection.removed").trigger("Media."+this.mediaId+".lesson."+this.lessonId+".unpublished"),this.dispose()},e.prototype.onUnPublishError=function(t){return this.$el.trigger("loading.off"),alertify.error(this.i18n(t.responseJSON.message))},e.prototype.onClick=function(){return Echo.routes.Publish.publishedOptionsModal(this.mediaId,this.lessonId).ajax({success:this.onPublishedOptionsModalSuccess,error:this.onPublishedOptionsModalError})},e.prototype.onPublishedOptionsModalSuccess=function(t){return this.$body.append(t.data[0].html)},e.prototype.onPublishedOptionsModalError=function(){return alertify.alert(this.i18n("Media.publish.error.getPublishedOptionsError"))},e.prototype.onMediaRepublished=function(){return this.$el.trigger("Media."+this.mediaId+".published")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.SharingList=function(t){function e(){return this.updateListState=i(this.updateListState,this),this.onMediaUnshared=i(this.onMediaUnshared,this),this.onMediaShared=i(this.onMediaShared,this),this.onShareModalSuccess=i(this.onShareModalSuccess,this),this.onShareModalOpen=i(this.onShareModalOpen,this),this.bodyListeners=i(this.bodyListeners,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.$list=this.$(".share-manager"),this.$el.on("Media.shareModal.open",this.onShareModalOpen).on("Media."+this.mediaId+".unshared",this.onMediaUnshared),this.updateListState()},e.prototype.bodyListeners=function(){var t;return(t={})["Media."+this.options.mediaId+".shared"]=this.onMediaShared,$.extend(e.__super__.bodyListeners.apply(this,arguments),t)},e.prototype.onShareModalOpen=function(){return Echo.routes.Media.shareModal(this.mediaId).ajax({success:this.onShareModalSuccess,error:this.onError})},e.prototype.onShareModalSuccess=function(t){return this.$body.append(t.data[0].html)},e.prototype.onMediaShared=function(){return this.$el.trigger("MediaDetails.loadSharing",{swap:!0}),this.dispose()},e.prototype.onMediaUnshared=function(){return setTimeout(this.updateListState,100)},e.prototype.updateListState=function(){if(0===this.$(".detailListItem").length)return this.$list.addClass("no-results")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.SharingListItem=function(t){function e(){return this.onUnshareError=i(this.onUnshareError,this),this.onUnshareSuccess=i(this.onUnshareSuccess,this),this.unshare=i(this.unshare,this),this.onMediaUnshare=i(this.onMediaUnshare,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.userId=t.userId,this.$el.on("Media.unshare",this.onMediaUnshare)},e.prototype.onMediaUnshare=function(t){return this.confirm("Media.unshare.warning",this.unshare)},e.prototype.unshare=function(){return this.$el.trigger("loading.on"),Echo.routes.Publish.unshare(this.userId,this.mediaId).ajax({success:this.onUnshareSuccess,error:this.onUnshareError})},e.prototype.onUnshareSuccess=function(){return alertify.success(this.i18n("Media.unshare.success")),this.$el.trigger("Media."+this.mediaId+".unshared"),this.dispose()},e.prototype.onUnshareError=function(){return this.$el.trigger("loading.off"),alertify.error(this.i18n("Media.unshare.error"))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.widgets.media.details.TranscriptionControls=function(t){function e(){return this.afterRespawn=i(this.afterRespawn,this),this.onError=i(this.onError,this),this.onUploadSuccess=i(this.onUploadSuccess,this),this.onTranscriptUploadSuccess=i(this.onTranscriptUploadSuccess,this),this.onRevertSuccess=i(this.onRevertSuccess,this),this.onRevert=i(this.onRevert,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.mediaId=t.mediaId,this.$el.on("Transcription.revert",this.onRevert).on("FileStack.success",".fileStack-wrapper",this.onTranscriptUploadSuccess)},e.prototype.onRevert=function(){return this.confirm("Transcriptions.revert.confirm",(t=this,function(){return t.ajax(Echo.routes.Transcriptions.revertForMedia(t.mediaId),{headers:{Accept:"text/html"},success:t.onRevertSuccess,error:t.onError})}));var t},e.prototype.onRevertSuccess=function(t){return this.updateView(t,"Transcriptions.revert.success")},e.prototype.onTranscriptUploadSuccess=function(t,e){var i;return i=e.fileBlob,this.ajax(Echo.routes.Transcriptions.uploadTranscription(this.mediaId),{headers:{Accept:"text/html"},data:{name:"transcript",fileBlob:i},success:this.onUploadSuccess,error:this.onError})},e.prototype.onUploadSuccess=function(t){return this.updateView(t,"Transcriptions.upload.success")},e.prototype.updateView=function(t,e){return this.messageKey=e,this.$el.trigger("replaceContent",t)},e.prototype.onError=function(t){var e,i;return e=null!=(i=t.responseJSON)?i.message:void 0,alertify.error(e)},e.prototype.afterRespawn=function(){return alertify.success(this.i18n(this.messageKey))},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.captures.filters.Filter=function(t){function e(){return this.onClear=i(this.onClear,this),this.onToggle=i(this.onToggle,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){var t,e,i,o,n;for(this.$clear=this.$("a.clear"),this.$content=this.$(".content"),this.$toggle=this.$("a.toggle"),n=Echo.helpers.Location.parseHash(),this.filterData={},t=0,i=(o=this.keys).length;t<i;t++)e=o[t],this.filterData[e]=n[e];return this.$el.on("click",".label",this.onToggle),this.$clear.on("click",this.onClear)},e.prototype.afterInitialize=function(t){return setTimeout((e=this,function(){return e.$el.trigger("Captures.initializeFilter",t)}),100);var e},e.prototype.onToggle=function(){return this.$el.toggleClass("open")},e.prototype.updateFilterDisplay=function(t){return this.$el.toggleClass("active",t),this.$el.toggleClass("open",t)},e.prototype.buildOption=function(t,e){return"<option value='"+t+"'>"+e+"</option>"},e.prototype.onClear=function(t){return null!=t&&t.stopPropagation(),this.$el.removeClass("active")},e}()}.call(this),function(){var e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.captures.filters.FilterDate=function(t){function o(){return this.onClear=e(this.onClear,this),this.onRadioChange=e(this.onRadioChange,this),o.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(o,Echo.pages.admin.captures.filters.Filter),o.prototype.keys=["startDate","endDate","dateRange"],o.prototype.initialize=function(){var e,i;return o.__super__.initialize.apply(this,arguments),this.$dateRange=this.$("fieldset[name=dateRange]"),this.$radios=this.$(".radio"),this.$startDate=this.$("[name=startDate]"),this.$endDate=this.$("[name=endDate]"),this.$el.on("change","input[type=radio]",this.onRadioChange),this.$startDate.on("change",(e=this,function(t){return e.filterData.startDate=e.$startDate.val()})),this.$endDate.on("change",(i=this,function(t){return i.filterData.endDate=i.$endDate.val()})),this.initDates(),this.afterInitialize(this.filterData)},o.prototype.initDates=function(){return this.filterData.dateRange&&this.$("input[name=dateRange][value="+this.filterData.dateRange+"]").prop("checked",!0).trigger("change"),this.updateFilterStatus()},o.prototype.onRadioChange=function(t){var e,i,o,n,s;if(this.$radios.removeClass("selected"),o=this.$("input[name=dateRange]:checked").val(),this.$(t.currentTarget).closest(".radio").toggleClass("selected",this.$(t.currentTarget).prop("checked")),this.$dateRange.toggle("dateRange"===o),this.updateFilterStatus(),e=new Date,"allTime"===o&&this.$el.removeClass("active"),i=null!=(n=function(){switch(o){case"today":return e;case"lastWeek":return this.getDateMinusOneWeek(e);case"lastMonth":return this.getDateMinusOneMonth(e)}}.call(this))?Echo.core.helpers.getISODateStringFromDate(new Date):void 0,s=null!=n?Echo.core.helpers.getISODateStringFromDate(n):void 0,"dateRange"!==o&&this.$startDate.trigger("Input.updateValue",s),"dateRange"!==o)return this.$endDate.trigger("Input.updateValue",i)},o.prototype.getDateMinusOneWeek=function(t){return t.setDate(t.getDate()-7),t},o.prototype.getDateMinusOneMonth=function(t){return t.setMonth(t.getMonth()-1),t},o.prototype.clear=function(){return this.$("input[name=dateRange]").prop("checked",!1).trigger("change"),this.$radios.removeClass("selected"),this.$startDate.trigger("Input.updateValue",void 0),this.$endDate.trigger("Input.updateValue",void 0),this.$dateRange.hide()},o.prototype.onClear=function(t){return this.clear(),o.__super__.onClear.call(this,t)},o.prototype.updateFilterStatus=function(){var t;return t=this.$("input[name=dateRange]:checked").val(),this.updateFilterDisplay(null!=t&&""!==t)},o}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.captures.filters.FilterInstructor=function(t){function e(){return this.onClear=i(this.onClear,this),this.onChange=i(this.onChange,this),this.onFilterFetchSuccess=i(this.onFilterFetchSuccess,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.pages.admin.captures.filters.Filter),e.prototype.keys=["instructorId"],e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.fetchFilter()},e.prototype.fetchFilter=function(){var t;return t=this.filterData.instructorId?this.filterData:null,Echo.routes.Captures.getInstructorFilter().ajax({data:t,success:this.onFilterFetchSuccess})},e.prototype.onFilterFetchSuccess=function(t){if(this.$content.html(t),this.$select=this.$("select"),this.$select.on("change",this.onChange),this.filterData.instructorId)return this.afterInitialize(this.filterData),this.onChange()},e.prototype.onChange=function(){return this.updateFilterDisplay(""!==this.$select.val())},e.prototype.onClear=function(t){return e.__super__.onClear.call(this,t),this.$select.trigger("Select.updateSelected","")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.captures.filters.FilterLocation=function(t){function e(){return this.onFilterFetchSuccess=i(this.onFilterFetchSuccess,this),this.onClear=i(this.onClear,this),this.onRoomSelectChange=i(this.onRoomSelectChange,this),this.onBuildingSelectChange=i(this.onBuildingSelectChange,this),this.onCampusSelectChange=i(this.onCampusSelectChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.pages.admin.captures.filters.Filter),e.prototype.keys=["campusId","buildingId","roomId"],e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.fetchFilter()},e.prototype.fetchFilter=function(){return Echo.routes.Captures.getLocationFilter().ajax({beforeSend:(e=this,function(){return e.$el.trigger("loading.on",{selector:".content"})}),data:this.filterData,success:this.onFilterFetchSuccess,complete:(t=this,function(){return t.loadingOff(null,{selector:".content"})})});var t,e},e.prototype.updateDependentSelect=function(t,e,i,o){var n,s,r,a,h,l;for(i=_.filter(i,(l=this,function(t){return t[o]===l.filterData[o]})),n="",r=0,a=(h=_.sortBy(i,function(t){return t.name.toLowerCase()})).length;r<a;r++)s=h[r],n+=this.buildOption(s.id,s.name);return t.trigger("Select.updateOptions",{options:n,keepEmptyOption:!0,maintainSelection:!0,selectFirstOption:!0}),this.filterData[o]?t.trigger("enable"):(e&&t.trigger("Select.updateSelected",""),t.trigger("disable")),this.updateFilterStatus()},e.prototype.onCampusSelectChange=function(){return this.filterData.campusId=this.$campusSelect.val(),this.updateDependentSelect(this.$buildingSelect,this.filterData.buildingId,this.buildings,"campusId")},e.prototype.onBuildingSelectChange=function(){return this.filterData.buildingId=this.$buildingSelect.val(),this.updateDependentSelect(this.$roomSelect,this.filterData.roomId,this.rooms,"buildingId")},e.prototype.onRoomSelectChange=function(){return this.filterData.roomId=this.$roomSelect.val(),this.updateFilterStatus()},e.prototype.onClear=function(t){return e.__super__.onClear.call(this,t),null!=this.$campusSelect&&null!=this.$buildingSelect&&null!=this.$roomSelect?(this.$campusSelect.trigger("Select.updateSelected",""),this.$buildingSelect.trigger("Select.updateSelected",""),this.$roomSelect.trigger("Select.updateSelected","")):this.filterData={}},e.prototype.onFilterFetchSuccess=function(t){var e,i;if(e=t.data,this.$content.html(null!=e&&null!=(i=e[0])?i.html:void 0),null!=(null!=e?e[0]:void 0))return this.buildings=e[0].buildings,this.rooms=e[0].rooms,this.$campusSelect=this.$("[name=campusId]"),this.$buildingSelect=this.$("[name=buildingId]"),this.$roomSelect=this.$("[name=roomId]"),this.$campusSelect.on("change",this.onCampusSelectChange),this.$buildingSelect.on("change",this.onBuildingSelectChange),this.$roomSelect.on("change",this.onRoomSelectChange),this.updateDependentSelect(this.$buildingSelect,this.filterData.buildingId,this.buildings,"campusId"),this.updateDependentSelect(this.$roomSelect,this.filterData.roomId,this.rooms,"buildingId"),this.isFilterSet()?this.afterInitialize(this.filterData):void 0},e.prototype.isFilterSet=function(){var t;return 0<(null!=(t=this.filterData.campusId||this.filterData.buildingId||this.filterData.roomId)?t.length:void 0)},e.prototype.updateFilterStatus=function(){return this.updateFilterDisplay(this.isFilterSet())},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.captures.filters.FilterPublishInfo=function(t){function e(){return this.onFilterFetchSuccess=i(this.onFilterFetchSuccess,this),this.onClear=i(this.onClear,this),this.onSectionSelectChange=i(this.onSectionSelectChange,this),this.onCourseSelectChange=i(this.onCourseSelectChange,this),this.onDepartmentSelectChange=i(this.onDepartmentSelectChange,this),this.onOrganizationSelectChange=i(this.onOrganizationSelectChange,this),this.onTermSelectChange=i(this.onTermSelectChange,this),this.resetCourseFilter=i(this.resetCourseFilter,this),this.onCourseSearchSuccess=i(this.onCourseSearchSuccess,this),this.checkSelectedCourse=i(this.checkSelectedCourse,this),this.updateCourseFilter=i(this.updateCourseFilter,this),this.onSectionFilterUpdateSuccess=i(this.onSectionFilterUpdateSuccess,this),this.onSectionFilterUpdateError=i(this.onSectionFilterUpdateError,this),this.initialize=i(this.initialize,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.pages.admin.captures.filters.Filter),e.prototype.keys=["organizationId","departmentId","courseId","sectionId","termId"],e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.fetchFilter()},e.prototype.fetchFilter=function(){return Echo.routes.Captures.getPublishInfoFilter().ajax({beforeSend:(e=this,function(){return e.$el.trigger("loading.on",{selector:".content"})}),data:this.filterData,success:this.onFilterFetchSuccess,complete:(t=this,function(){return t.loadingOff(null,{selector:".content"})})});var t,e},e.prototype.updateSelected=function(t,e,i){if(null!=e&&null!=t&&t.trigger("Select.updateSelected",e),null!=i&&e)return i()},e.prototype.updateSectionFilter=function(){var t;return this.filterData.courseId?(""!==this.filterData.termId&&(t={termId:this.filterData.termId}),Echo.routes.Sections.getSectionFilterOptions(this.filterData.courseId).ajax({data:t,success:this.onSectionFilterUpdateSuccess,error:this.onSectionFilterUpdateError})):this.onSectionFilterUpdateError()},e.prototype.onSectionFilterUpdateError=function(){return this.$sectionSelect.trigger("Select.updateSelected","").trigger("disable")},e.prototype.onSectionFilterUpdateSuccess=function(t){var e,i;if(null!=(null!=(e=t.data)?e[0]:void 0))return this.$sectionSelect.trigger("Select.updateOptions",this.selectOptions(e[0].html)).trigger("Select.updateSelected",this.filterData.sectionId),i=0===e[0].sectionCount?"disable":"enable",this.$sectionSelect.trigger(i)},e.prototype.updateCourseFilter=function(){if(this.$courseSelect.trigger("select2.addAjaxData",{departmentId:this.filterData.departmentId,organizationId:this.filterData.organizationId}),this.filterData.departmentId||this.filterData.organizationId)return this.checkSelectedCourse()},e.prototype.checkSelectedCourse=function(){var t,e;if(null!=(e=this.filterData.courseId?this.$courseSelect.select2("data")[0].text:null)&&(e=e.split(":")[0]),e)return t={departmentId:this.filterData.departmentId,organizationId:this.filterData.organizationId,searchText:e,pageNumber:0},Echo.routes.Courses.searchName().ajax({data:t,success:this.onCourseSearchSuccess,error:this.resetCourseFilter})},e.prototype.onCourseSearchSuccess=function(t){var e;if(0===_.filter(t.results,(e=this,function(t){return t.id===e.filterData.courseId})).length)return this.resetCourseFilter()},e.prototype.resetCourseFilter=function(){return this.$courseSelect.trigger("Select.updateSelected","")},e.prototype.onTermSelectChange=function(){return this.filterData.termId=this.$termSelect.val(),this.updateSectionFilter(),this.updateFilterStatus()},e.prototype.onOrganizationSelectChange=function(){var t,e;return this.filterData.organizationId=this.$organizationSelect.val(),t=_.filter(this.departments,(e=this,function(t){return""===e.filterData.organizationId||null!=t.organizationId&&t.organizationId===e.filterData.organizationId})),this.$departmentSelect.trigger("Select.updateOptions",this.selectOptions(this.buildOptions(t))),this.updateCourseFilter(),this.updateFilterStatus()},e.prototype.onDepartmentSelectChange=function(){return this.filterData.departmentId=this.$departmentSelect.val(),this.updateCourseFilter(),this.updateFilterStatus()},e.prototype.onCourseSelectChange=function(){return this.filterData.courseId=this.$courseSelect.val(),this.updateSectionFilter(),this.updateFilterStatus()},e.prototype.onSectionSelectChange=function(){return this.filterData.sectionId=this.$sectionSelect.val(),this.updateFilterStatus()},e.prototype.selectOptions=function(t){return{options:t,keepEmptyOption:!0,selectFirstOption:!0,maintainSelection:!0}},e.prototype.buildOptions=function(t){var e,i,o,n;for(e="",i=0,n=t.length;i<n;i++)o=t[i],e+=this.buildOption(o.id,o.name);return e},e.prototype.isFilterSet=function(){var t;return 0<(null!=(t=this.filterData.termId||this.filterData.organizationId||this.filterData.departmentId||this.filterData.courseId||this.filterData.sectionId)?t.length:void 0)},e.prototype.updateFilterStatus=function(){return this.updateFilterDisplay(this.isFilterSet())},e.prototype.onClear=function(t){return e.__super__.onClear.call(this,t),null==this.$selects?this.filterData={}:(this.$termSelect.trigger("Select.updateSelected",""),this.$organizationSelect.trigger("Select.updateSelected",""),this.$departmentSelect.trigger("Select.updateSelected",""),this.$courseSelect.trigger("Select.updateSelected",""),this.$sectionSelect.trigger("Select.updateSelected","").trigger("disable"))},e.prototype.onFilterFetchSuccess=function(t){var e,i,o;if(e=t.data,this.$content.html(null!=e&&null!=(i=e[0])?i.html:void 0),null!=(null!=e?e[0]:void 0))return this.departments=e[0].departments,this.$termSelect=this.$("[name=termId]"),this.$organizationSelect=this.$("[name=organizationId]"),this.$departmentSelect=this.$("[name=departmentId]"),this.$courseSelect=this.$("[name=courseId]"),this.$sectionSelect=this.$("[name=sectionId]"),this.$selects=this.$("select"),this.$termSelect.on("change",this.onTermSelectChange),this.$organizationSelect.on("change",this.onOrganizationSelectChange),this.$departmentSelect.on("change",this.onDepartmentSelectChange),this.$courseSelect.on("change",this.onCourseSelectChange),this.$sectionSelect.on("change",this.onSectionSelectChange),this.isFilterSet()?(setTimeout((o=this,function(){return o.updateSelected(null,o.filterData.termId,o.onTermSelectChange),o.updateSelected(o.$courseSelect,o.filterData.courseId,o.onCourseSelectChange),o.updateSelected(o.$departmentSelect,o.filterData.departmentId,o.onDepartmentSelectChange),o.updateSelected(o.$organizationSelect,o.filterData.organizationId,o.onOrganizationSelectChange),o.updateSelected(o.$sectionSelect,o.filterData.sectionId)}),150),this.afterInitialize(this.filterData),this.updateFilterStatus()):void 0},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.captures.filters.FilterSource=function(t){function e(){return this.onClear=i(this.onClear,this),this.onChange=i(this.onChange,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.pages.admin.captures.filters.Filter),e.prototype.keys=["source"],e.prototype.initialize=function(){if(e.__super__.initialize.apply(this,arguments),this.$select=this.$("select"),this.$select.on("change",this.onChange),this.filterData.source)return this.afterInitialize(this.filterData),this.onChange()},e.prototype.onChange=function(){return this.updateFilterDisplay(""!==this.$select.val())},e.prototype.onClear=function(t){return e.__super__.onClear.call(this,t),this.$select.trigger("Select.updateSelected","")},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.scheduling.captureDayView.CaptureDayView=function(t){function e(){return this.onClear=i(this.onClear,this),this.onAddEvent=i(this.onAddEvent,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(){return this.Event=Echo.pages.admin.scheduling.captureDayView.Event,this.$el.on("CaptureDayView.clear",this.onClear),this.$el.on("CaptureDayView.addEvent",this.onAddEvent),this.eventTemplate=_.template(this.$(".event-template").html()),this.overlayTemplate=_.template(this.$(".overlay-template").html()),this.hourRowHeight=this.$(".hourRow").outerHeight(),this.events=[]},e.prototype.getFirstHour=function(){return this.Event.getFirstEventByStartTime(this.events).startTime.hour},e.prototype.getLastHour=function(){return this.Event.getLastEventByEndTime(this.events).endTime.hour},e.prototype.onAddEvent=function(t,e){var i;return i=new this.Event({eventData:e,eventTemplate:this.eventTemplate,overlayTemplate:this.overlayTemplate}),this.events.push(i),i.renderIntoContainer(this.$(".events"),this.hourRowHeight),this.recenterAndResizeView()},e.prototype.onClear=function(){return this.$(".events").empty(),this.events=[]},e.prototype.recenterAndResizeView=function(){var t,e,i;return 2,i=this.$(".hourRow").height(),e=Math.max(0,(this.getFirstHour()-2)*i),t=(this.getLastHour()-this.getFirstHour()+1+4)*i,this.$(".hours").css({marginTop:-e,height:t+e}),this.$el.trigger("CaptureDayView.resize",t)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;Echo.pages.admin.scheduling.captureDayView.Event=function(t){function e(){return this.removeOverlay=i(this.removeOverlay,this),this.onEditClick=i(this.onEditClick,this),this.onDeleteError=i(this.onDeleteError,this),this.onDeleteSingleError=i(this.onDeleteSingleError,this),this.onDeleteSuccess=i(this.onDeleteSuccess,this),this.onDeleteClick=i(this.onDeleteClick,this),this.deleteSchedule=i(this.deleteSchedule,this),this.createOverlay=i(this.createOverlay,this),this.addExclusion=i(this.addExclusion,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.getFirstEventByStartTime=function(t){return _.reduce(t,function(t,e){return e.startTime.hour<t.startTime.hour?e:t})},e.getLastEventByEndTime=function(t){return _.reduce(t,function(t,e){return e.endTime.hour>t.endTime.hour?e:t})},e.parseTimeString=function(t){var e;return{hour:(e=_.map(t.split(":"),function(t){return parseInt(t,10)}))[0],minute:e[1],second:e[2]}},e.prototype.initialize=function(t){if(this.eventData=t.eventData,this.eventTemplate=t.eventTemplate,this.overlayTemplate=t.overlayTemplate,this.startTime=e.parseTimeString(this.eventData.startTime),this.endTime=e.parseTimeString(this.eventData.endTime),this.$el=$("<li/>",{class:"event"}),this.eventData.clickable)return this.initializeCallbacks()},e.prototype.initializeCallbacks=function(){return this.$el.on("click",this.createOverlay).on("DeleteCaptureModal.deleteAll",this.deleteSchedule).on("DeleteCaptureModal.deleteSingle",this.addExclusion),this.$doc.on("mousedown",this.removeOverlay)},e.prototype.addExclusion=function(){var t;return t=Echo.core.helpers.getISODateStringFromDate(this.eventData.currentDate),this.ajax(Echo.routes.CaptureSchedules.addExclusion(this.eventData.id),{data:{date:t},success:this.onDeleteSuccess,error:this.onDeleteSingleError})},e.prototype.createOverlay=function(){var t,e;return t=this.$el.offset(),(e=$("<div/>",{class:"captureDayViewOverlay"})).appendTo("body"),e.html(this.overlayTemplate(this)),e.css({top:t.top-e.outerHeight(),left:t.left}),e.on("mousedown",this.stopPropagation),e.find(".close").on("click",this.removeOverlay),e.find(".edit").on("click",this.onEditClick),e.find(".delete").on("click",this.onDeleteClick)},e.prototype.deleteSchedule=function(){return Echo.routes.CaptureSchedules.delete(this.eventData.id).ajax({success:this.onDeleteSuccess,error:this.onDeleteError})},e.prototype.formatTime=function(t){var e,i,o,n;return e=t.hour,n=t.minute,0===(i=e%12)&&(i=12),o=e<12?"am":"pm",i+":"+Echo.core.helpers.padNumber(n)+o},e.prototype.getDuration=function(){return 60*this.endTime.hour+this.endTime.minute-(60*this.startTime.hour+this.startTime.minute)},e.prototype.getSummary=function(){return this.eventData.summary},e.prototype.getInstructorEmail=function(){return this.eventData.instructorEmail},e.prototype.onDeleteClick=function(){return this.removeOverlay(),null!=this.eventData.rrule?$("body").trigger("Modal.deleteCapture.open",{respondTo:this.$el}):this.deleteSchedule()},e.prototype.onDeleteSuccess=function(){return window.location.reload()},e.prototype.onDeleteSingleError=function(t){var e,i,o;return e=null!=(i=null!=t&&null!=(o=t.responseJSON)?o.message:void 0)?i:"Admin.captures.single.deleteError",alertify.error(this.i18n(e))},e.prototype.onDeleteError=function(t){var e,i,o;return e=null!=(i=null!=t&&null!=(o=t.responseJSON)?o.message:void 0)?i:"Admin.Scheduling.deleteError",alertify.error(this.i18n(e))},e.prototype.onEditClick=function(){return this.removeOverlay(),this.injectFromUrl(Echo.routes.CaptureSchedules.editModal(this.eventData.id))},e.prototype.removeOverlay=function(){return $(".captureDayViewOverlay").remove()},e.prototype.renderIntoContainer=function(t,e){return this.$el.html(this.eventTemplate(this)),this.$el.css({top:(this.startTime.minute/60+this.startTime.hour)*e,height:this.getDuration()*e/60,backgroundColor:this.eventData.color}),this.$el.appendTo(t)},e}()}.call(this),function(){var i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,s=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Echo.pages.admin.scheduling.captureDayView.NavigatableCaptureDayView=function(t){function e(){return this.onCaptureDayViewResize=i(this.onCaptureDayViewResize,this),this.nextOccurrence=i(this.nextOccurrence,this),this.goToPreviousOccurrence=i(this.goToPreviousOccurrence,this),this.goToNextOccurrence=i(this.goToNextOccurrence,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,Echo.core.View),e.prototype.initialize=function(t){return this.rruleString=t.rruleString,this.currentServerTime=t.currentServerTime,this.startDate=t.startDate,this.startTime=t.startTime,this.exclusions=t.exclusions,this.roomSchedules=t.roomSchedules,this.monthNames=t.monthNames,this.nextDayLink=this.$(".next-day"),this.prevDayLink=this.$(".previous-day"),this.changeDayLinks=this.$(".previous-day,.next-day"),this.captureDayView=this.$(".captureDayView"),this.nextDayLink.on("click",this.goToNextOccurrence),this.prevDayLink.on("click",this.goToPreviousOccurrence),this.changeDayLinks.on("click",function(t){return t.preventDefault()}),this.$el.on("CaptureDayView.resize",this.onCaptureDayViewResize),this.initializeRRules(),this.render()},e.prototype.initializeRRules=function(){var t,e,i,o;for(this.rrule=Echo.core.helpers.getRRuleFromEvent({startDate:this.startDate,startTime:this.startTime,rruleString:this.rruleString}),t=0,e=(i=this.roomSchedules).length;t<e;t++)(o=i[t]).rrule=Echo.core.helpers.getRRuleFromEvent(o);return this.rrule?(this.currentDay=new Date(this.currentServerTime),this.currentDay.setDate(this.currentDay.getDate()-1),this.goToNextOccurrence()):this.currentDay=Echo.core.helpers.getDateFromISODateString(this.startDate)},e.prototype.getRoomSchedulesForToday=function(){return _.filter(this.roomSchedules,(r=this,function(t){var e,i,o,n,s;return null!=t.rrule?(s=r.currentDay.getFullYear(),o=r.currentDay.getMonth(),e=r.currentDay.getDate(),n=new Date(s,o,e,0,0,0),i=new Date(s,o,e,23,59,59),0!==t.rrule.between(n,i,!0).length):r.roomScheduleIsCurrentDate(t)}));var r},e.prototype.getTodayDateString=function(){return this.monthNames[this.currentDay.getMonth()]+" "+this.currentDay.getDate()+" - "+this.currentDay.getFullYear()},e.prototype.goToNextOccurrence=function(){var t;if(t=this.nextOccurrence())return this.currentDay=t,this.render()},e.prototype.goToPreviousOccurrence=function(){var t;if(t=this.previousOccurrence())return this.currentDay=t,this.render()},e.prototype.nextOccurrence=function(t){return this.relativeOccurence(this.currentDay,"after")},e.prototype.onCaptureDayViewResize=function(t,e){return t.stopPropagation(),e+=this.$el.outerHeight()-this.$(".captureDayView").outerHeight(),this.$el.trigger("SectionRuleRow.resize",e)},e.prototype.previousOccurrence=function(t){return this.relativeOccurence(this.currentDay,"before")},e.prototype.relativeOccurence=function(t,e){var i,o,n;return(i=null!=(n=this.rrule)?n[e](t):void 0)?(o=Echo.core.helpers.getISODateStringFromDate(i),0<=s.call(this.exclusions,o)?this.relativeOccurence(i,e):i):null},e.prototype.roomScheduleIsCurrentDate=function(t){var e,i,o,n;return n=Echo.core.helpers.getDateFromISODateString(t.startDate),o=this.currentDay.getFullYear()===n.getFullYear(),i=this.currentDay.getMonth()===n.getMonth(),e=this.currentDay.getDate()===n.getDate(),o&&i&&e},e.prototype.render=function(){var t,e,i,o;for(this.$(".date-string").text(this.getTodayDateString()),this.captureDayView.trigger("CaptureDayView.clear"),t=0,e=(i=this.getRoomSchedulesForToday()).length;t<e;t++)(o=i[t]).currentDate=this.currentDay,this.captureDayView.trigger("CaptureDayView.addEvent",o);if(this.changeDayLinks.removeClass("disabled"),this.nextOccurrence()||this.nextDayLink.addClass("disabled"),!this.previousOccurrence())return this.prevDayLink.addClass("disabled")},e}()}.call(this);